<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>Battle Plan v13</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="color-scheme" content="light">
  <meta name="theme-color" content="#f6f7fb">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Battle Plan">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" sizes="180x180">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%23fff' d='M10 55h80v10H10zM20 35h60v10H20zM35 15h30v10H35z'/%3E%3C/svg%3E">
  <style>
    /* TEMA LIGHT FISSO - Sempre attivo indipendentemente dalle preferenze del sistema */
    :root{
      --bg:#f6f7fb; --bg-soft:#f0f3f8;
      --card:#ffffff; --card-soft:#ffffff;
      --text:#152236; --muted:#6e7f93;
      --hair: rgba(0,0,0,.06); --hair2: rgba(0,0,0,.12);
      --accent: #5dd3ff;
      --accent2:#8d7bff;
      --ok: #2ecc71;
      --warn:#ffb454;
      --danger:#ff5c5c;
      --shadow: 0 6px 22px rgba(10,20,30,.08);
      --radius: 16px;
    }
    
    /* TEMA DARK DISABILITATO - Mantenuto per futuro ripristino
    :root{
      --bg: #0e1116;
      --bg-soft: #121722;
      --card: #151b26;
      --card-soft: #141a24;
      --text: #e9eef5;
      --muted: #9fb0c3;
      --hair: rgba(255,255,255,.08);
      --hair2: rgba(255,255,255,.16);
      --shadow: 0 6px 22px rgba(0,0,0,.35);
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f6f7fb; --bg-soft:#f0f3f8;
        --card:#ffffff; --card-soft:#ffffff;
        --text:#152236; --muted:#6e7f93;
        --hair: rgba(0,0,0,.06); --hair2: rgba(0,0,0,.12);
        --shadow: 0 6px 22px rgba(10,20,30,.08);
      }
    }
    */
    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0; font: 15px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 10% -10%, rgba(93,211,255,.10), transparent 60%),
                  radial-gradient(900px 500px at 110% 10%, rgba(141,123,255,.10), transparent 60%),
                  var(--bg);
      color:var(--text);
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    a{ color:var(--accent); text-decoration:none; }
    .wrap{ max-width: 1180px; margin: calc(56px + env(safe-area-inset-top) + 32px) auto 40px; padding: 0 16px; }
    .grid{ display:grid; gap:12px; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:flex-start; }
    .right{ margin-left:auto; }
    .small{ font-size:12px; }
    .big{ font-size:20px; font-weight:800; }
    .muted{ color:var(--muted); }
    .neon{ color: var(--accent); text-shadow: 0 0 22px rgba(93,211,255,.35); }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
      border:1px solid var(--hair);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
    }
    .card.kpi, .card[data-kpi]{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid var(--hair2);
      box-shadow: 0 10px 24px rgba(0,0,0,.28), inset 0 1px 0 rgba(255,255,255,.06);
    }

    label{ display:block; font-size:12px; color:var(--muted); margin-bottom:4px; }
    input, select{
      background: var(--bg-soft);
      color: var(--text);
      border:1px solid var(--hair2);
      border-radius: 12px;
      padding:10px 12px;
      min-width: 140px;
      outline: none;
      transition: border .15s ease;
    }
    input:focus, select:focus{ border-color: var(--accent); }

    button{
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color:#fff; border:0; border-radius: 999px;
      padding:10px 14px; font-weight:700; cursor:pointer;
      box-shadow: 0 6px 14px rgba(93,211,255,.25);
      transition: transform .05s ease, box-shadow .2s ease, opacity .2s ease;
      white-space:nowrap;
    }
    button:hover{ transform: translateY(-1px); }
    button.ghost{
      background: transparent;
      color: var(--text);
      border:1px solid var(--hair2);
      box-shadow: none;
    }
    button.ghost:hover{ border-color: var(--accent); }

    .badge{
      display:inline-block; padding:4px 8px; border-radius:999px;
      background: rgba(141,123,255,.18); color:#fff;
      border:1px solid var(--hair2); font-size:12px;
    }

    .topbar{
      position:fixed; top:0; left:0; right:0; height: calc(56px + env(safe-area-inset-top));
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background: rgba(20,24,34,.46);
      backdrop-filter: saturate(160%) blur(8px);
      border-bottom:1px solid var(--hair);
      padding: env(safe-area-inset-top) 12px 0; z-index: 50;
    }
    @media (min-width: 981px){
      .topbar{
        background: rgba(20,24,34,.72);
        border-bottom:1px solid var(--hair2);
      }
      .topbar .nav.right button.ghost{ color: rgba(255,255,255,.92); border-color: rgba(255,255,255,.22); }
      .topbar .nav.right button.ghost:hover{ border-color: var(--accent); }
    }

    .brand{ display:flex; align-items:center; gap:10px; }
    .logo{ font-weight:900; letter-spacing:.6px; }
    .nav.right{ display:flex; align-items:center; gap:8px; }
    .hamb{ width:34px; height:26px; display:none; flex-direction:column; justify-content:space-between; cursor:pointer; }
    .hamb span{ height:3px; background:var(--text); border-radius:2px; display:block; width:100%; }

    .drawer{
      position:fixed; top:56px; left:0; bottom:0; width:280px; transform: translateX(-100%);
      background: rgba(20,24,34,.92); backdrop-filter: blur(6px);
      border-right:1px solid var(--hair);
      padding:12px; z-index:60; transition: transform .18s ease-in-out;
    }
    .drawer.open{ transform: translateX(0); }
    .drawer .row{ flex-direction:column; align-items:stretch; }
    .drawer button{ text-align:left; padding:10px 12px; font-weight:600; border-radius:12px; }

    @media (max-width: 980px){
      .nav.right{ display:none; }
      .hamb{ display:flex; }
      .wrap{ margin-top: calc(56px + env(safe-area-inset-top) + 32px); }
      button, input, select{ font-size:14px; padding:9px 12px; }
    }

    .hero{
      position:relative; height:180px; display:grid; place-items:center; overflow:hidden;
      border-bottom:1px solid var(--hair);
    }
    .hero .title{ font-size:28px; font-weight:900; letter-spacing:.3px; }
    .hero .small{ font-size:14px; color:var(--muted); font-weight:600; }
    .hero .layer.glow{
      position:absolute; inset:-20%;
      background: radial-gradient(600px 360px at var(--gx,60%) var(--gy,30%), rgba(93,211,255,.15), transparent 60%),
                  radial-gradient(600px 360px at calc(100% - var(--gx,40%)) calc(100% - var(--gy,70%)), rgba(141,123,255,.15), transparent 60%);
      pointer-events:none;
    }
    .hero .layer.grid{
      position:absolute; inset:0; background:
        linear-gradient(transparent 23px, rgba(255,255,255,.05) 24px) 0 0/26px 26px,
        linear-gradient(90deg, transparent 23px, rgba(255,255,255,.05) 24px) 0 0/26px 26px;
      opacity:.3; pointer-events:none;
    }

    .calendar{
      display:grid; grid-template-columns: 40px repeat(7, 1fr);
      gap:8px; align-items:stretch;
    }
    .weekLabel{
      font-size:12px; color:var(--muted); display:flex; align-items:center; justify-content:center;
      border:1px dashed var(--hair); border-radius:10px; padding:6px 0;
    }
    .day{
      border:1px solid var(--hair2); border-radius:12px; padding:8px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      min-height:120px; cursor:pointer;
      transition: border-color .15s ease, outline-color .15s ease, box-shadow .15s ease;
    }
    .day .dnum{ font-weight:900; font-size:16px; }

    .day.today{
      outline: 2px solid var(--accent);
      box-shadow: inset 0 0 0 1px rgba(93,211,255,.25);
      position: relative;
    }
    .day.today::after{
      content: "Oggi";
      position: absolute; top:6px; right:8px;
      font-size:10px; opacity:.8; color: var(--accent);
    }

    .tag{ display:inline-block; font-size:11px; padding:2px 6px; border-radius:10px; border:1px solid var(--hair2); }

    #toast-container{
      position: fixed; left:50%; transform: translateX(-50%);
      bottom: 24px; display:flex; flex-direction:column; gap:8px; z-index:100;
    }
    .toast{
      background: rgba(20,24,34,.92); color:#fff;
      border:1px solid var(--hair2); border-radius: 12px;
      padding:10px 14px; box-shadow: var(--shadow);
      animation: pop .18s ease-out;
    }
    @keyframes pop{ from{ transform: translateY(4px); opacity: .0 } to{ transform: translateY(0); opacity: 1 } }
    
    .confetti{ position:fixed; inset:0; pointer-events:none; z-index:90; }

    .last-app:hover, .last-bp:hover{ border-color: var(--accent); box-shadow: 0 6px 18px rgba(93,211,255,.18); }

    .lb-card{
      background: linear-gradient(180deg, rgba(93,211,255,.15), rgba(141,123,255,.12));
      text-align:center;
    }
    .lb-bar{ height:10px; background:rgba(255,255,255,0.1); border-radius:6px; overflow:hidden; margin-top:6px; }
    .lb-bar>div{ height:100%; background:linear-gradient(90deg,var(--accent),var(--accent2)); }

    .row > div{ min-width: 200px; flex: 1 1 200px; }

    canvas{ image-rendering: -webkit-optimize-contrast; }
    
    /* Modern Table Styles */
    .table {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid var(--hair);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,.1);
    }
    
    .table table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: transparent;
    }
    
    .table thead {
      background: linear-gradient(180deg, rgba(93,211,255,.08), rgba(141,123,255,.06));
      border-bottom: 1px solid var(--hair2);
    }
    
    .table th {
      padding: 16px 20px;
      text-align: left;
      font-weight: 700;
      font-size: 13px;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 1px solid var(--hair2);
      position: relative;
    }
    
    .table th:not(:last-child)::after {
      content: '';
      position: absolute;
      right: 0;
      top: 20%;
      bottom: 20%;
      width: 1px;
      background: var(--hair);
    }
    
    .table tbody tr {
      transition: all 0.2s ease;
      border-bottom: 1px solid var(--hair);
    }
    
    .table tbody tr:hover {
      background: linear-gradient(90deg, rgba(93,211,255,.06), rgba(141,123,255,.04));
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,.1);
    }
    
    .table tbody tr:last-child {
      border-bottom: none;
    }
    
    .table td {
      padding: 16px 20px;
      font-size: 14px;
      color: var(--text);
      vertical-align: middle;
      border-bottom: 1px solid var(--hair);
    }
    
    .table td:last-child {
      text-align: right;
    }
    
    .table .amount {
      font-weight: 600;
      color: var(--accent);
    }
    
    .table .status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .table .status.pending {
      background: rgba(255, 180, 84, .2);
      color: var(--warn);
      border: 1px solid rgba(255, 180, 84, .3);
    }
    
    .table .status.completed {
      background: rgba(46, 204, 113, .2);
      color: var(--ok);
      border: 1px solid rgba(46, 204, 113, .3);
    }
    
    .table .status.overdue {
      background: rgba(255, 92, 92, .2);
      color: var(--danger);
      border: 1px solid rgba(255, 92, 92, .3);
    }
    
    .table .status.started {
      background: rgba(93, 211, 255, .2);
      color: var(--accent);
      border: 1px solid rgba(93, 211, 255, .3);
    }
    
    /* Enhanced Card Styles for GI Page */
    .gi-card {
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid var(--hair2);
      border-radius: var(--radius);
      box-shadow: 0 8px 32px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.08);
      padding: 24px;
      margin-bottom: 24px;
      position: relative;
      overflow: hidden;
    }
    
    .gi-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
    }
    
    .gi-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--hair);
    }
    
    .gi-card-title {
      font-size: 18px;
      font-weight: 800;
      color: var(--text);
      margin: 0;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .gi-card-title::before {
      content: '';
      width: 4px;
      height: 20px;
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      border-radius: 2px;
    }
    
    .gi-card-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .gi-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .gi-stat-card {
      background: linear-gradient(135deg, rgba(93,211,255,.08), rgba(141,123,255,.06));
      border: 1px solid rgba(93,211,255,.2);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .gi-stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(93,211,255,.15);
    }
    
    .gi-stat-value {
      font-size: 28px;
      font-weight: 900;
      color: var(--accent);
      margin-bottom: 8px;
      text-shadow: 0 0 20px rgba(93,211,255,.3);
    }
    
    .gi-stat-label {
      font-size: 12px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }
    
    /* Floating Action Button */
    .fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(93,211,255,.4);
      transition: all 0.3s ease;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .fab:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 32px rgba(93,211,255,.5);
    }
    
    .fab:active {
      transform: scale(0.95);
    }
    
    /* Enhanced animations and transitions */
    .gi-card {
      animation: fadeInUp 0.6s ease-out;
    }
    
    .gi-stat-card {
      animation: fadeInUp 0.6s ease-out;
    }
    
    .gi-stat-card:nth-child(1) { animation-delay: 0.1s; }
    .gi-stat-card:nth-child(2) { animation-delay: 0.2s; }
    .gi-stat-card:nth-child(3) { animation-delay: 0.3s; }
    .gi-stat-card:nth-child(4) { animation-delay: 0.4s; }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Enhanced table animations */
    .table tbody tr {
      animation: slideInRow 0.3s ease-out;
    }
    
    .table tbody tr:nth-child(even) {
      animation-delay: 0.05s;
    }
    
    @keyframes slideInRow {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    /* Loading states */
    .gi-loading {
      opacity: 0.6;
      pointer-events: none;
    }
    
    .gi-loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin: -10px 0 0 -10px;
      border: 2px solid var(--accent);
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Responsive improvements */
    @media (max-width: 768px) {
      .table th, .table td {
        padding: 12px 16px;
        font-size: 13px;
      }
      
      .gi-card {
        padding: 16px;
        margin-bottom: 16px;
      }
      
      .gi-card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
      
      .gi-stats-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .fab {
        bottom: 16px;
        right: 16px;
        width: 48px;
        height: 48px;
        font-size: 20px;
      }
      
      /* All columns visible on mobile with horizontal scroll */
    }
    
    @media (max-width: 480px) {
      .gi-card-title {
        font-size: 16px;
      }
      
      .gi-stat-value {
        font-size: 24px;
      }
      
      .table th, .table td {
        padding: 10px 12px;
        font-size: 12px;
      }
      
      /* All columns visible on very small screens with horizontal scroll */
    }
    
    /* Unified filters: equal widths + responsive grid */
    .uf .row, .uf-row{
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      align-items: end;
    }
    .uf .row > div, .uf-row > div{ min-width: 0; }
    .uf select, .uf input, .uf-row select, .uf-row input{ width: 100%; min-width: 0; }
    .uf-row button{ width:auto; justify-self:start; }
    .uf .row .actions, .uf-row .actions{ display:flex; gap:8px; justify-self:end; align-self:end; }
    @media (min-width: 981px){
      .uf .row, .uf-row{ grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
    }

    /* Calendar controls layout */
    #cal_controls{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    #cal_controls .cal-row{
      display:flex;
      gap:10px;
      align-items:end;
    }
    #cal_controls .cal-row > *{ flex:1 1 0; }
    #cal_controls button{ flex:0 0 auto; }
    @media (max-width:600px){
      #cal_controls{
        display:grid;
        grid-template-columns:1fr 1fr;
        grid-template-areas:
          "consult consult"
          "prev month next"
          "add add"
          "free free"
          "fourh refresh";
        align-items:end;
      }
      #cal_controls .cal-row{ display:contents; }
      #cal_consultant_wrap{ grid-area:consult; }
      #cal_prev{ grid-area:prev; justify-self:start; }
      #cal_month_wrap{ grid-area:month; }
      #cal_next{ grid-area:next; }
      #cal_add{ grid-area:add; justify-self:start; }
      #only_free{ grid-area:free; }
      #only_4h{ grid-area:fourh; }
      #cal_refresh{ grid-area:refresh; justify-self:end; }
      /* Make filter chips full-width to prevent overlap */
      #only_free, #only_4h{ display:flex !important; width:100% !important; min-width:0 !important; align-items:center; }
      #cal_prev, #cal_next, #cal_add, #cal_refresh{ min-width:0; }
    }
  </style>
  <script type="module" crossorigin src="/assets/index-DDWjjG7c.js"></script>
  <link rel="stylesheet" crossorigin href="/assets/index-5y824dI4.css">
  <script type="module">import.meta.url;import("_").catch(()=>1);(async function*(){})().next();window.__vite_is_modern_browser=true</script>
  <script type="module">!function(){if(window.__vite_is_modern_browser)return;console.warn("vite: loading legacy chunks, syntax error above and the same error below should be ignored");var e=document.getElementById("vite-legacy-polyfill"),n=document.createElement("script");n.src=e.src,n.onload=function(){System.import(document.getElementById('vite-legacy-entry').getAttribute('data-src'))},document.body.appendChild(n)}();</script>
</head>
<body>
  <div id="app"><!-- UI injected by main.js --></div>

<!-- Polyfill & Core shims now bundled via main.js imports -->

<!-- Logging library -->
<script>
  window.logger = window.logger || ['debug','info','log','warn','error'].reduce((acc, lvl) => {
    acc[lvl] = (console[lvl] || console.log).bind(console);
    return acc;
  }, {});
</script>
<!-- Pino browser build provided via bundled logger.js (see main.js imports) -->

<script>window.BP_USE_SERIES_API = true;</script>

<!-- App core (render UI) -->

<!-- Librerie locali incluse nel bundle (vedi main.js) -->

<!-- === FINAL PACK: CSS rimane separato; JS Ã¨ nel bundle === -->
<!-- push-client.js incluso nel bundle -->

  <!-- Service Worker per Push (registrazione semplice) -->
  <script>
    (function(){
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function(){
          navigator.serviceWorker.register('/push-sw.js')
            .then(function(reg){ logger.info('[BP] SW registrato', reg.scope); })
            .catch(function(err){ logger.warn('[BP] SW errore', err); });
        });
      }
    })();
  </script>
  <script nomodule>!function(){var e=document,t=e.createElement("script");if(!("noModule"in t)&&"onbeforeload"in t){var n=!1;e.addEventListener("beforeload",(function(e){if(e.target===t)n=!0;else if(!e.target.hasAttribute("nomodule")||!n)return;e.preventDefault()}),!0),t.type="module",t.src=".",e.head.appendChild(t),t.remove()}}();</script>
  <script nomodule crossorigin id="vite-legacy-polyfill" src="/assets/polyfills-legacy-BRAKqSvN.js"></script>
  <script nomodule crossorigin id="vite-legacy-entry" data-src="/assets/index-legacy-B9QWa49R.js">System.import(document.getElementById('vite-legacy-entry').getAttribute('data-src'))</script>
</body>
</html>
