var pr=Object.defineProperty;var mr=(n,t,e)=>t in n?pr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var ht=(n,t,e)=>mr(n,typeof t!="symbol"?t+"":t,e);function $f(){import.meta.url,import("_").catch(()=>1),(async function*(){})().next()}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=e(o);fetch(o.href,s)}})();/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Yn(n){return n+.5|0}const Ue=(n,t,e)=>Math.max(Math.min(n,e),t);function Dn(n){return Ue(Yn(n*2.55),0,255)}function Ye(n){return Ue(Yn(n*255),0,255)}function Be(n){return Ue(Yn(n/2.55)/100,0,1)}function jo(n){return Ue(Yn(n*100),0,100)}const ve={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},lo=[..."0123456789ABCDEF"],gr=n=>lo[n&15],vr=n=>lo[(n&240)>>4]+lo[n&15],$n=n=>(n&240)>>4===(n&15),br=n=>$n(n.r)&&$n(n.g)&&$n(n.b)&&$n(n.a);function yr(n){var t=n.length,e;return n[0]==="#"&&(t===4||t===5?e={r:255&ve[n[1]]*17,g:255&ve[n[2]]*17,b:255&ve[n[3]]*17,a:t===5?ve[n[4]]*17:255}:(t===7||t===9)&&(e={r:ve[n[1]]<<4|ve[n[2]],g:ve[n[3]]<<4|ve[n[4]],b:ve[n[5]]<<4|ve[n[6]],a:t===9?ve[n[7]]<<4|ve[n[8]]:255})),e}const wr=(n,t)=>n<255?t(n):"";function _r(n){var t=br(n)?gr:vr;return n?"#"+t(n.r)+t(n.g)+t(n.b)+wr(n.a,t):void 0}const xr=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function pa(n,t,e){const i=t*Math.min(e,1-e),o=(s,a=(s+n/30)%12)=>e-i*Math.max(Math.min(a-3,9-a,1),-1);return[o(0),o(8),o(4)]}function Sr(n,t,e){const i=(o,s=(o+n/60)%6)=>e-e*t*Math.max(Math.min(s,4-s,1),0);return[i(5),i(3),i(1)]}function Cr(n,t,e){const i=pa(n,1,.5);let o;for(t+e>1&&(o=1/(t+e),t*=o,e*=o),o=0;o<3;o++)i[o]*=1-t-e,i[o]+=t;return i}function Dr(n,t,e,i,o){return n===o?(t-e)/i+(t<e?6:0):t===o?(e-n)/i+2:(n-t)/i+4}function ko(n){const e=n.r/255,i=n.g/255,o=n.b/255,s=Math.max(e,i,o),a=Math.min(e,i,o),r=(s+a)/2;let l,c,d;return s!==a&&(d=s-a,c=r>.5?d/(2-s-a):d/(s+a),l=Dr(e,i,o,d,s),l=l*60+.5),[l|0,c||0,r]}function Io(n,t,e,i){return(Array.isArray(t)?n(t[0],t[1],t[2]):n(t,e,i)).map(Ye)}function Mo(n,t,e){return Io(pa,n,t,e)}function kr(n,t,e){return Io(Cr,n,t,e)}function Ir(n,t,e){return Io(Sr,n,t,e)}function ma(n){return(n%360+360)%360}function Mr(n){const t=xr.exec(n);let e=255,i;if(!t)return;t[5]!==i&&(e=t[6]?Dn(+t[5]):Ye(+t[5]));const o=ma(+t[2]),s=+t[3]/100,a=+t[4]/100;return t[1]==="hwb"?i=kr(o,s,a):t[1]==="hsv"?i=Ir(o,s,a):i=Mo(o,s,a),{r:i[0],g:i[1],b:i[2],a:e}}function Er(n,t){var e=ko(n);e[0]=ma(e[0]+t),e=Mo(e),n.r=e[0],n.g=e[1],n.b=e[2]}function Tr(n){if(!n)return;const t=ko(n),e=t[0],i=jo(t[1]),o=jo(t[2]);return n.a<255?"hsla(".concat(e,", ").concat(i,"%, ").concat(o,"%, ").concat(Be(n.a),")"):"hsl(".concat(e,", ").concat(i,"%, ").concat(o,"%)")}const Wo={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Yo={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Pr(){const n={},t=Object.keys(Yo),e=Object.keys(Wo);let i,o,s,a,r;for(i=0;i<t.length;i++){for(a=r=t[i],o=0;o<e.length;o++)s=e[o],r=r.replace(s,Wo[s]);s=parseInt(Yo[a],16),n[r]=[s>>16&255,s>>8&255,s&255]}return n}let Gn;function Ar(n){Gn||(Gn=Pr(),Gn.transparent=[0,0,0,0]);const t=Gn[n.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const Br=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Lr(n){const t=Br.exec(n);let e=255,i,o,s;if(t){if(t[7]!==i){const a=+t[7];e=t[8]?Dn(a):Ue(a*255,0,255)}return i=+t[1],o=+t[3],s=+t[5],i=255&(t[2]?Dn(i):Ue(i,0,255)),o=255&(t[4]?Dn(o):Ue(o,0,255)),s=255&(t[6]?Dn(s):Ue(s,0,255)),{r:i,g:o,b:s,a:e}}}function Or(n){return n&&(n.a<255?"rgba(".concat(n.r,", ").concat(n.g,", ").concat(n.b,", ").concat(Be(n.a),")"):"rgb(".concat(n.r,", ").concat(n.g,", ").concat(n.b,")"))}const ji=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,un=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function Fr(n,t,e){const i=un(Be(n.r)),o=un(Be(n.g)),s=un(Be(n.b));return{r:Ye(ji(i+e*(un(Be(t.r))-i))),g:Ye(ji(o+e*(un(Be(t.g))-o))),b:Ye(ji(s+e*(un(Be(t.b))-s))),a:n.a+e*(t.a-n.a)}}function Xn(n,t,e){if(n){let i=ko(n);i[t]=Math.max(0,Math.min(i[t]+i[t]*e,t===0?360:1)),i=Mo(i),n.r=i[0],n.g=i[1],n.b=i[2]}}function ga(n,t){return n&&Object.assign(t||{},n)}function qo(n){var t={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(t={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(t.a=Ye(n[3]))):(t=ga(n,{r:0,g:0,b:0,a:1}),t.a=Ye(t.a)),t}function Nr(n){return n.charAt(0)==="r"?Lr(n):Mr(n)}class Nn{constructor(t){if(t instanceof Nn)return t;const e=typeof t;let i;e==="object"?i=qo(t):e==="string"&&(i=yr(t)||Ar(t)||Nr(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=ga(this._rgb);return t&&(t.a=Be(t.a)),t}set rgb(t){this._rgb=qo(t)}rgbString(){return this._valid?Or(this._rgb):void 0}hexString(){return this._valid?_r(this._rgb):void 0}hslString(){return this._valid?Tr(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,o=t.rgb;let s;const a=e===s?.5:e,r=2*a-1,l=i.a-o.a,c=((r*l===-1?r:(r+l)/(1+r*l))+1)/2;s=1-c,i.r=255&c*i.r+s*o.r+.5,i.g=255&c*i.g+s*o.g+.5,i.b=255&c*i.b+s*o.b+.5,i.a=a*i.a+(1-a)*o.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=Fr(this._rgb,t._rgb,e)),this}clone(){return new Nn(this.rgb)}alpha(t){return this._rgb.a=Ye(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=Yn(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Xn(this._rgb,2,t),this}darken(t){return Xn(this._rgb,2,-t),this}saturate(t){return Xn(this._rgb,1,t),this}desaturate(t){return Xn(this._rgb,1,-t),this}rotate(t){return Er(this._rgb,t),this}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Ee(){}const Rr=(()=>{let n=0;return()=>n++})();function Mt(n){return n==null}function Ut(n){if(Array.isArray&&Array.isArray(n))return!0;const t=Object.prototype.toString.call(n);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function Tt(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function qt(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function ge(n,t){return qt(n)?n:t}function Dt(n,t){return typeof n>"u"?t:n}const Vr=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/t,va=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*t:+n;function Nt(n,t,e){if(n&&typeof n.call=="function")return n.apply(e,t)}function Ot(n,t,e,i){let o,s,a;if(Ut(n))for(s=n.length,o=0;o<s;o++)t.call(e,n[o],o);else if(Tt(n))for(a=Object.keys(n),s=a.length,o=0;o<s;o++)t.call(e,n[a[o]],a[o])}function xi(n,t){let e,i,o,s;if(!n||!t||n.length!==t.length)return!1;for(e=0,i=n.length;e<i;++e)if(o=n[e],s=t[e],o.datasetIndex!==s.datasetIndex||o.index!==s.index)return!1;return!0}function Si(n){if(Ut(n))return n.map(Si);if(Tt(n)){const t=Object.create(null),e=Object.keys(n),i=e.length;let o=0;for(;o<i;++o)t[e[o]]=Si(n[e[o]]);return t}return n}function ba(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function zr(n,t,e,i){if(!ba(n))return;const o=t[n],s=e[n];Tt(o)&&Tt(s)?Rn(o,s,i):t[n]=Si(s)}function Rn(n,t,e){const i=Ut(t)?t:[t],o=i.length;if(!Tt(n))return n;e=e||{};const s=e.merger||zr;let a;for(let r=0;r<o;++r){if(a=i[r],!Tt(a))continue;const l=Object.keys(a);for(let c=0,d=l.length;c<d;++c)s(l[c],n,a,e)}return n}function Pn(n,t){return Rn(n,t,{merger:Ur})}function Ur(n,t,e){if(!ba(n))return;const i=t[n],o=e[n];Tt(i)&&Tt(o)?Pn(i,o):Object.prototype.hasOwnProperty.call(t,n)||(t[n]=Si(o))}const $o={"":n=>n,x:n=>n.x,y:n=>n.y};function Hr(n){const t=n.split("."),e=[];let i="";for(const o of t)i+=o,i.endsWith("\\")?i=i.slice(0,-1)+".":(e.push(i),i="");return e}function jr(n){const t=Hr(n);return e=>{for(const i of t){if(i==="")break;e=e&&e[i]}return e}}function qe(n,t){return($o[t]||($o[t]=jr(t)))(n)}function Eo(n){return n.charAt(0).toUpperCase()+n.slice(1)}const Vn=n=>typeof n<"u",$e=n=>typeof n=="function",Go=(n,t)=>{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0};function Wr(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const Bt=Math.PI,Rt=2*Bt,Yr=Rt+Bt,Ci=Number.POSITIVE_INFINITY,qr=Bt/180,Gt=Bt/2,Je=Bt/4,Xo=Bt*2/3,He=Math.log10,ke=Math.sign;function An(n,t,e){return Math.abs(n-t)<e}function Ko(n){const t=Math.round(n);n=An(n,t,n/1e3)?t:n;const e=Math.pow(10,Math.floor(He(n))),i=n/e;return(i<=1?1:i<=2?2:i<=5?5:10)*e}function $r(n){const t=[],e=Math.sqrt(n);let i;for(i=1;i<e;i++)n%i===0&&(t.push(i),t.push(n/i));return e===(e|0)&&t.push(e),t.sort((o,s)=>o-s).pop(),t}function Gr(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function pn(n){return!Gr(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function Xr(n,t){const e=Math.round(n);return e-t<=n&&e+t>=n}function ya(n,t,e){let i,o,s;for(i=0,o=n.length;i<o;i++)s=n[i][e],isNaN(s)||(t.min=Math.min(t.min,s),t.max=Math.max(t.max,s))}function we(n){return n*(Bt/180)}function To(n){return n*(180/Bt)}function Jo(n){if(!qt(n))return;let t=1,e=0;for(;Math.round(n*t)/t!==n;)t*=10,e++;return e}function wa(n,t){const e=t.x-n.x,i=t.y-n.y,o=Math.sqrt(e*e+i*i);let s=Math.atan2(i,e);return s<-.5*Bt&&(s+=Rt),{angle:s,distance:o}}function co(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function Kr(n,t){return(n-t+Yr)%Rt-Bt}function ae(n){return(n%Rt+Rt)%Rt}function zn(n,t,e,i){const o=ae(n),s=ae(t),a=ae(e),r=ae(s-o),l=ae(a-o),c=ae(o-s),d=ae(o-a);return o===s||o===a||i&&s===a||r>l&&c<d}function te(n,t,e){return Math.max(t,Math.min(e,n))}function Jr(n){return te(n,-32768,32767)}function Oe(n,t,e,i=1e-6){return n>=Math.min(t,e)-i&&n<=Math.max(t,e)+i}function Po(n,t,e){e=e||(a=>n[a]<t);let i=n.length-1,o=0,s;for(;i-o>1;)s=o+i>>1,e(s)?o=s:i=s;return{lo:o,hi:i}}const Fe=(n,t,e,i)=>Po(n,e,i?o=>{const s=n[o][t];return s<e||s===e&&n[o+1][t]===e}:o=>n[o][t]<e),Zr=(n,t,e)=>Po(n,e,i=>n[i][t]>=e);function Qr(n,t,e){let i=0,o=n.length;for(;i<o&&n[i]<t;)i++;for(;o>i&&n[o-1]>e;)o--;return i>0||o<n.length?n.slice(i,o):n}const _a=["push","pop","shift","splice","unshift"];function tl(n,t){if(n._chartjs){n._chartjs.listeners.push(t);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),_a.forEach(e=>{const i="_onData"+Eo(e),o=n[e];Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value(...s){const a=o.apply(this,s);return n._chartjs.listeners.forEach(r=>{typeof r[i]=="function"&&r[i](...s)}),a}})})}function Zo(n,t){const e=n._chartjs;if(!e)return;const i=e.listeners,o=i.indexOf(t);o!==-1&&i.splice(o,1),!(i.length>0)&&(_a.forEach(s=>{delete n[s]}),delete n._chartjs)}function xa(n){const t=new Set(n);return t.size===n.length?n:Array.from(t)}const Sa=(function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame})();function Ca(n,t){let e=[],i=!1;return function(...o){e=o,i||(i=!0,Sa.call(window,()=>{i=!1,n.apply(t,e)}))}}function el(n,t){let e;return function(...i){return t?(clearTimeout(e),e=setTimeout(n,t,i)):n.apply(this,i),t}}const Ao=n=>n==="start"?"left":n==="end"?"right":"center",se=(n,t,e)=>n==="start"?t:n==="end"?e:(t+e)/2,nl=(n,t,e,i)=>n===(i?"left":"right")?e:n==="center"?(t+e)/2:t;function Da(n,t,e){const i=t.length;let o=0,s=i;if(n._sorted){const{iScale:a,vScale:r,_parsed:l}=n,c=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,d=a.axis,{min:u,max:f,minDefined:h,maxDefined:w}=a.getUserBounds();if(h){if(o=Math.min(Fe(l,d,u).lo,e?i:Fe(t,d,a.getPixelForValue(u)).lo),c){const x=l.slice(0,o+1).reverse().findIndex(S=>!Mt(S[r.axis]));o-=Math.max(0,x)}o=te(o,0,i-1)}if(w){let x=Math.max(Fe(l,a.axis,f,!0).hi+1,e?0:Fe(t,d,a.getPixelForValue(f),!0).hi+1);if(c){const S=l.slice(x-1).findIndex(O=>!Mt(O[r.axis]));x+=Math.max(0,S)}s=te(x,o,i)-o}else s=i-o}return{start:o,count:s}}function ka(n){const{xScale:t,yScale:e,_scaleRanges:i}=n,o={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!i)return n._scaleRanges=o,!0;const s=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==e.min||i.ymax!==e.max;return Object.assign(i,o),s}const Kn=n=>n===0||n===1,Qo=(n,t,e)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-t)*Rt/e)),ts=(n,t,e)=>Math.pow(2,-10*n)*Math.sin((n-t)*Rt/e)+1,Bn={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*Gt)+1,easeOutSine:n=>Math.sin(n*Gt),easeInOutSine:n=>-.5*(Math.cos(Bt*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>Kn(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>Kn(n)?n:Qo(n,.075,.3),easeOutElastic:n=>Kn(n)?n:ts(n,.075,.3),easeInOutElastic(n){return Kn(n)?n:n<.5?.5*Qo(n*2,.1125,.45):.5+.5*ts(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let t=1.70158;return(n/=.5)<1?.5*(n*n*(((t*=1.525)+1)*n-t)):.5*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)},easeInBounce:n=>1-Bn.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?Bn.easeInBounce(n*2)*.5:Bn.easeOutBounce(n*2-1)*.5+.5};function Bo(n){if(n&&typeof n=="object"){const t=n.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function es(n){return Bo(n)?n:new Nn(n)}function Wi(n){return Bo(n)?n:new Nn(n).saturate(.5).darken(.1).hexString()}const il=["x","y","borderWidth","radius","tension"],ol=["color","borderColor","backgroundColor"];function sl(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),n.set("animations",{colors:{type:"color",properties:ol},numbers:{type:"number",properties:il}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function al(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const ns=new Map;function rl(n,t){t=t||{};const e=n+JSON.stringify(t);let i=ns.get(e);return i||(i=new Intl.NumberFormat(n,t),ns.set(e,i)),i}function qn(n,t,e){return rl(t,e).format(n)}const Ia={values(n){return Ut(n)?n:""+n},numeric(n,t,e){if(n===0)return"0";const i=this.chart.options.locale;let o,s=n;if(e.length>1){const c=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(c<1e-4||c>1e15)&&(o="scientific"),s=ll(n,e)}const a=He(Math.abs(s)),r=isNaN(a)?1:Math.max(Math.min(-1*Math.floor(a),20),0),l={notation:o,minimumFractionDigits:r,maximumFractionDigits:r};return Object.assign(l,this.options.ticks.format),qn(n,i,l)},logarithmic(n,t,e){if(n===0)return"0";const i=e[t].significand||n/Math.pow(10,Math.floor(He(n)));return[1,2,3,5,10,15].includes(i)||t>.8*e.length?Ia.numeric.call(this,n,t,e):""}};function ll(n,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&n!==Math.floor(n)&&(e=n-Math.floor(n)),e}var Bi={formatters:Ia};function cl(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Bi.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const ln=Object.create(null),uo=Object.create(null);function Ln(n,t){if(!t)return n;const e=t.split(".");for(let i=0,o=e.length;i<o;++i){const s=e[i];n=n[s]||(n[s]=Object.create(null))}return n}function Yi(n,t,e){return typeof t=="string"?Rn(Ln(n,t),e):Rn(Ln(n,""),t)}class dl{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,o)=>Wi(o.backgroundColor),this.hoverBorderColor=(i,o)=>Wi(o.borderColor),this.hoverColor=(i,o)=>Wi(o.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return Yi(this,t,e)}get(t){return Ln(this,t)}describe(t,e){return Yi(uo,t,e)}override(t,e){return Yi(ln,t,e)}route(t,e,i,o){const s=Ln(this,t),a=Ln(this,i),r="_"+e;Object.defineProperties(s,{[r]:{value:s[e],writable:!0},[e]:{enumerable:!0,get(){const l=this[r],c=a[o];return Tt(l)?Object.assign({},c,l):Dt(l,c)},set(l){this[r]=l}}})}apply(t){t.forEach(e=>e(this))}}var Ht=new dl({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[sl,al,cl]);function ul(n){return!n||Mt(n.size)||Mt(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function Di(n,t,e,i,o){let s=t[o];return s||(s=t[o]=n.measureText(o).width,e.push(o)),s>i&&(i=s),i}function fl(n,t,e,i){i=i||{};let o=i.data=i.data||{},s=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(o=i.data={},s=i.garbageCollect=[],i.font=t),n.save(),n.font=t;let a=0;const r=e.length;let l,c,d,u,f;for(l=0;l<r;l++)if(u=e[l],u!=null&&!Ut(u))a=Di(n,o,s,a,u);else if(Ut(u))for(c=0,d=u.length;c<d;c++)f=u[c],f!=null&&!Ut(f)&&(a=Di(n,o,s,a,f));n.restore();const h=s.length/2;if(h>e.length){for(l=0;l<h;l++)delete o[s[l]];s.splice(0,h)}return a}function Ze(n,t,e){const i=n.currentDevicePixelRatio,o=e!==0?Math.max(e/2,.5):0;return Math.round((t-o)*i)/i+o}function is(n,t){!t&&!n||(t=t||n.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,n.width,n.height),t.restore())}function fo(n,t,e,i){Ma(n,t,e,i,null)}function Ma(n,t,e,i,o){let s,a,r,l,c,d,u,f;const h=t.pointStyle,w=t.rotation,x=t.radius;let S=(w||0)*qr;if(h&&typeof h=="object"&&(s=h.toString(),s==="[object HTMLImageElement]"||s==="[object HTMLCanvasElement]")){n.save(),n.translate(e,i),n.rotate(S),n.drawImage(h,-h.width/2,-h.height/2,h.width,h.height),n.restore();return}if(!(isNaN(x)||x<=0)){switch(n.beginPath(),h){default:o?n.ellipse(e,i,o/2,x,0,0,Rt):n.arc(e,i,x,0,Rt),n.closePath();break;case"triangle":d=o?o/2:x,n.moveTo(e+Math.sin(S)*d,i-Math.cos(S)*x),S+=Xo,n.lineTo(e+Math.sin(S)*d,i-Math.cos(S)*x),S+=Xo,n.lineTo(e+Math.sin(S)*d,i-Math.cos(S)*x),n.closePath();break;case"rectRounded":c=x*.516,l=x-c,a=Math.cos(S+Je)*l,u=Math.cos(S+Je)*(o?o/2-c:l),r=Math.sin(S+Je)*l,f=Math.sin(S+Je)*(o?o/2-c:l),n.arc(e-u,i-r,c,S-Bt,S-Gt),n.arc(e+f,i-a,c,S-Gt,S),n.arc(e+u,i+r,c,S,S+Gt),n.arc(e-f,i+a,c,S+Gt,S+Bt),n.closePath();break;case"rect":if(!w){l=Math.SQRT1_2*x,d=o?o/2:l,n.rect(e-d,i-l,2*d,2*l);break}S+=Je;case"rectRot":u=Math.cos(S)*(o?o/2:x),a=Math.cos(S)*x,r=Math.sin(S)*x,f=Math.sin(S)*(o?o/2:x),n.moveTo(e-u,i-r),n.lineTo(e+f,i-a),n.lineTo(e+u,i+r),n.lineTo(e-f,i+a),n.closePath();break;case"crossRot":S+=Je;case"cross":u=Math.cos(S)*(o?o/2:x),a=Math.cos(S)*x,r=Math.sin(S)*x,f=Math.sin(S)*(o?o/2:x),n.moveTo(e-u,i-r),n.lineTo(e+u,i+r),n.moveTo(e+f,i-a),n.lineTo(e-f,i+a);break;case"star":u=Math.cos(S)*(o?o/2:x),a=Math.cos(S)*x,r=Math.sin(S)*x,f=Math.sin(S)*(o?o/2:x),n.moveTo(e-u,i-r),n.lineTo(e+u,i+r),n.moveTo(e+f,i-a),n.lineTo(e-f,i+a),S+=Je,u=Math.cos(S)*(o?o/2:x),a=Math.cos(S)*x,r=Math.sin(S)*x,f=Math.sin(S)*(o?o/2:x),n.moveTo(e-u,i-r),n.lineTo(e+u,i+r),n.moveTo(e+f,i-a),n.lineTo(e-f,i+a);break;case"line":a=o?o/2:Math.cos(S)*x,r=Math.sin(S)*x,n.moveTo(e-a,i-r),n.lineTo(e+a,i+r);break;case"dash":n.moveTo(e,i),n.lineTo(e+Math.cos(S)*(o?o/2:x),i+Math.sin(S)*x);break;case!1:n.closePath();break}n.fill(),t.borderWidth>0&&n.stroke()}}function Ne(n,t,e){return e=e||.5,!t||n&&n.x>t.left-e&&n.x<t.right+e&&n.y>t.top-e&&n.y<t.bottom+e}function Li(n,t){n.save(),n.beginPath(),n.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),n.clip()}function Oi(n){n.restore()}function hl(n,t,e,i,o){if(!t)return n.lineTo(e.x,e.y);if(o==="middle"){const s=(t.x+e.x)/2;n.lineTo(s,t.y),n.lineTo(s,e.y)}else o==="after"!=!!i?n.lineTo(t.x,e.y):n.lineTo(e.x,t.y);n.lineTo(e.x,e.y)}function pl(n,t,e,i){if(!t)return n.lineTo(e.x,e.y);n.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?e.cp2x:e.cp1x,i?e.cp2y:e.cp1y,e.x,e.y)}function ml(n,t){t.translation&&n.translate(t.translation[0],t.translation[1]),Mt(t.rotation)||n.rotate(t.rotation),t.color&&(n.fillStyle=t.color),t.textAlign&&(n.textAlign=t.textAlign),t.textBaseline&&(n.textBaseline=t.textBaseline)}function gl(n,t,e,i,o){if(o.strikethrough||o.underline){const s=n.measureText(i),a=t-s.actualBoundingBoxLeft,r=t+s.actualBoundingBoxRight,l=e-s.actualBoundingBoxAscent,c=e+s.actualBoundingBoxDescent,d=o.strikethrough?(l+c)/2:c;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=o.decorationWidth||2,n.moveTo(a,d),n.lineTo(r,d),n.stroke()}}function vl(n,t){const e=n.fillStyle;n.fillStyle=t.color,n.fillRect(t.left,t.top,t.width,t.height),n.fillStyle=e}function cn(n,t,e,i,o,s={}){const a=Ut(t)?t:[t],r=s.strokeWidth>0&&s.strokeColor!=="";let l,c;for(n.save(),n.font=o.string,ml(n,s),l=0;l<a.length;++l)c=a[l],s.backdrop&&vl(n,s.backdrop),r&&(s.strokeColor&&(n.strokeStyle=s.strokeColor),Mt(s.strokeWidth)||(n.lineWidth=s.strokeWidth),n.strokeText(c,e,i,s.maxWidth)),n.fillText(c,e,i,s.maxWidth),gl(n,e,i,c,s),i+=Number(o.lineHeight);n.restore()}function Un(n,t){const{x:e,y:i,w:o,h:s,radius:a}=t;n.arc(e+a.topLeft,i+a.topLeft,a.topLeft,1.5*Bt,Bt,!0),n.lineTo(e,i+s-a.bottomLeft),n.arc(e+a.bottomLeft,i+s-a.bottomLeft,a.bottomLeft,Bt,Gt,!0),n.lineTo(e+o-a.bottomRight,i+s),n.arc(e+o-a.bottomRight,i+s-a.bottomRight,a.bottomRight,Gt,0,!0),n.lineTo(e+o,i+a.topRight),n.arc(e+o-a.topRight,i+a.topRight,a.topRight,0,-Gt,!0),n.lineTo(e+a.topLeft,i)}const bl=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,yl=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function wl(n,t){const e=(""+n).match(bl);if(!e||e[1]==="normal")return t*1.2;switch(n=+e[2],e[3]){case"px":return n;case"%":n/=100;break}return t*n}const _l=n=>+n||0;function Lo(n,t){const e={},i=Tt(t),o=i?Object.keys(t):t,s=Tt(n)?i?a=>Dt(n[a],n[t[a]]):a=>n[a]:()=>n;for(const a of o)e[a]=_l(s(a));return e}function Ea(n){return Lo(n,{top:"y",right:"x",bottom:"y",left:"x"})}function an(n){return Lo(n,["topLeft","topRight","bottomLeft","bottomRight"])}function le(n){const t=Ea(n);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function Zt(n,t){n=n||{},t=t||Ht.font;let e=Dt(n.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let i=Dt(n.style,t.style);i&&!(""+i).match(yl)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const o={family:Dt(n.family,t.family),lineHeight:wl(Dt(n.lineHeight,t.lineHeight),e),size:e,style:i,weight:Dt(n.weight,t.weight),string:""};return o.string=ul(o),o}function kn(n,t,e,i){let o,s,a;for(o=0,s=n.length;o<s;++o)if(a=n[o],a!==void 0&&a!==void 0)return a}function xl(n,t,e){const{min:i,max:o}=n,s=va(t,(o-i)/2),a=(r,l)=>e&&r===0?0:r+l;return{min:a(i,-Math.abs(s)),max:a(o,s)}}function Ge(n,t){return Object.assign(Object.create(n),t)}function Oo(n,t=[""],e,i,o=()=>n[0]){const s=e||n;typeof i>"u"&&(i=Ba("_fallback",n));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:s,_fallback:i,_getTarget:o,override:r=>Oo([r,...n],t,s,i)};return new Proxy(a,{deleteProperty(r,l){return delete r[l],delete r._keys,delete n[0][l],!0},get(r,l){return Pa(r,l,()=>Tl(l,t,n,r))},getOwnPropertyDescriptor(r,l){return Reflect.getOwnPropertyDescriptor(r._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(r,l){return ss(r).includes(l)},ownKeys(r){return ss(r)},set(r,l,c){const d=r._storage||(r._storage=o());return r[l]=d[l]=c,delete r._keys,!0}})}function mn(n,t,e,i){const o={_cacheable:!1,_proxy:n,_context:t,_subProxy:e,_stack:new Set,_descriptors:Ta(n,i),setContext:s=>mn(n,s,e,i),override:s=>mn(n.override(s),t,e,i)};return new Proxy(o,{deleteProperty(s,a){return delete s[a],delete n[a],!0},get(s,a,r){return Pa(s,a,()=>Cl(s,a,r))},getOwnPropertyDescriptor(s,a){return s._descriptors.allKeys?Reflect.has(n,a)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,a)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(s,a){return Reflect.has(n,a)},ownKeys(){return Reflect.ownKeys(n)},set(s,a,r){return n[a]=r,delete s[a],!0}})}function Ta(n,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:i=t.indexable,_allKeys:o=t.allKeys}=n;return{allKeys:o,scriptable:e,indexable:i,isScriptable:$e(e)?e:()=>e,isIndexable:$e(i)?i:()=>i}}const Sl=(n,t)=>n?n+Eo(t):t,Fo=(n,t)=>Tt(t)&&n!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function Pa(n,t,e){if(Object.prototype.hasOwnProperty.call(n,t)||t==="constructor")return n[t];const i=e();return n[t]=i,i}function Cl(n,t,e){const{_proxy:i,_context:o,_subProxy:s,_descriptors:a}=n;let r=i[t];return $e(r)&&a.isScriptable(t)&&(r=Dl(t,r,n,e)),Ut(r)&&r.length&&(r=kl(t,r,n,a.isIndexable)),Fo(t,r)&&(r=mn(r,o,s&&s[t],a)),r}function Dl(n,t,e,i){const{_proxy:o,_context:s,_subProxy:a,_stack:r}=e;if(r.has(n))throw new Error("Recursion detected: "+Array.from(r).join("->")+"->"+n);r.add(n);let l=t(s,a||i);return r.delete(n),Fo(n,l)&&(l=No(o._scopes,o,n,l)),l}function kl(n,t,e,i){const{_proxy:o,_context:s,_subProxy:a,_descriptors:r}=e;if(typeof s.index<"u"&&i(n))return t[s.index%t.length];if(Tt(t[0])){const l=t,c=o._scopes.filter(d=>d!==l);t=[];for(const d of l){const u=No(c,o,n,d);t.push(mn(u,s,a&&a[n],r))}}return t}function Aa(n,t,e){return $e(n)?n(t,e):n}const Il=(n,t)=>n===!0?t:typeof n=="string"?qe(t,n):void 0;function Ml(n,t,e,i,o){for(const s of t){const a=Il(e,s);if(a){n.add(a);const r=Aa(a._fallback,e,o);if(typeof r<"u"&&r!==e&&r!==i)return r}else if(a===!1&&typeof i<"u"&&e!==i)return null}return!1}function No(n,t,e,i){const o=t._rootScopes,s=Aa(t._fallback,e,i),a=[...n,...o],r=new Set;r.add(i);let l=os(r,a,e,s||e,i);return l===null||typeof s<"u"&&s!==e&&(l=os(r,a,s,l,i),l===null)?!1:Oo(Array.from(r),[""],o,s,()=>El(t,e,i))}function os(n,t,e,i,o){for(;e;)e=Ml(n,t,e,i,o);return e}function El(n,t,e){const i=n._getTarget();t in i||(i[t]={});const o=i[t];return Ut(o)&&Tt(e)?e:o||{}}function Tl(n,t,e,i){let o;for(const s of t)if(o=Ba(Sl(s,n),e),typeof o<"u")return Fo(n,o)?No(e,i,n,o):o}function Ba(n,t){for(const e of t){if(!e)continue;const i=e[n];if(typeof i<"u")return i}}function ss(n){let t=n._keys;return t||(t=n._keys=Pl(n._scopes)),t}function Pl(n){const t=new Set;for(const e of n)for(const i of Object.keys(e).filter(o=>!o.startsWith("_")))t.add(i);return Array.from(t)}function La(n,t,e,i){const{iScale:o}=n,{key:s="r"}=this._parsing,a=new Array(i);let r,l,c,d;for(r=0,l=i;r<l;++r)c=r+e,d=t[c],a[r]={r:o.parse(qe(d,s),c)};return a}const Al=Number.EPSILON||1e-14,gn=(n,t)=>t<n.length&&!n[t].skip&&n[t],Oa=n=>n==="x"?"y":"x";function Bl(n,t,e,i){const o=n.skip?t:n,s=t,a=e.skip?t:e,r=co(s,o),l=co(a,s);let c=r/(r+l),d=l/(r+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const u=i*c,f=i*d;return{previous:{x:s.x-u*(a.x-o.x),y:s.y-u*(a.y-o.y)},next:{x:s.x+f*(a.x-o.x),y:s.y+f*(a.y-o.y)}}}function Ll(n,t,e){const i=n.length;let o,s,a,r,l,c=gn(n,0);for(let d=0;d<i-1;++d)if(l=c,c=gn(n,d+1),!(!l||!c)){if(An(t[d],0,Al)){e[d]=e[d+1]=0;continue}o=e[d]/t[d],s=e[d+1]/t[d],r=Math.pow(o,2)+Math.pow(s,2),!(r<=9)&&(a=3/Math.sqrt(r),e[d]=o*a*t[d],e[d+1]=s*a*t[d])}}function Ol(n,t,e="x"){const i=Oa(e),o=n.length;let s,a,r,l=gn(n,0);for(let c=0;c<o;++c){if(a=r,r=l,l=gn(n,c+1),!r)continue;const d=r[e],u=r[i];a&&(s=(d-a[e])/3,r["cp1".concat(e)]=d-s,r["cp1".concat(i)]=u-s*t[c]),l&&(s=(l[e]-d)/3,r["cp2".concat(e)]=d+s,r["cp2".concat(i)]=u+s*t[c])}}function Fl(n,t="x"){const e=Oa(t),i=n.length,o=Array(i).fill(0),s=Array(i);let a,r,l,c=gn(n,0);for(a=0;a<i;++a)if(r=l,l=c,c=gn(n,a+1),!!l){if(c){const d=c[t]-l[t];o[a]=d!==0?(c[e]-l[e])/d:0}s[a]=r?c?ke(o[a-1])!==ke(o[a])?0:(o[a-1]+o[a])/2:o[a-1]:o[a]}Ll(n,o,s),Ol(n,s,t)}function Jn(n,t,e){return Math.max(Math.min(n,e),t)}function Nl(n,t){let e,i,o,s,a,r=Ne(n[0],t);for(e=0,i=n.length;e<i;++e)a=s,s=r,r=e<i-1&&Ne(n[e+1],t),s&&(o=n[e],a&&(o.cp1x=Jn(o.cp1x,t.left,t.right),o.cp1y=Jn(o.cp1y,t.top,t.bottom)),r&&(o.cp2x=Jn(o.cp2x,t.left,t.right),o.cp2y=Jn(o.cp2y,t.top,t.bottom)))}function Rl(n,t,e,i,o){let s,a,r,l;if(t.spanGaps&&(n=n.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")Fl(n,o);else{let c=i?n[n.length-1]:n[0];for(s=0,a=n.length;s<a;++s)r=n[s],l=Bl(c,r,n[Math.min(s+1,a-(i?0:1))%a],t.tension),r.cp1x=l.previous.x,r.cp1y=l.previous.y,r.cp2x=l.next.x,r.cp2y=l.next.y,c=r}t.capBezierPoints&&Nl(n,e)}function Ro(){return typeof window<"u"&&typeof document<"u"}function Vo(n){let t=n.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function ki(n,t,e){let i;return typeof n=="string"?(i=parseInt(n,10),n.indexOf("%")!==-1&&(i=i/100*t.parentNode[e])):i=n,i}const Fi=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function Vl(n,t){return Fi(n).getPropertyValue(t)}const zl=["top","right","bottom","left"];function rn(n,t,e){const i={};e=e?"-"+e:"";for(let o=0;o<4;o++){const s=zl[o];i[s]=parseFloat(n[t+"-"+s+e])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const Ul=(n,t,e)=>(n>0||t>0)&&(!e||!e.shadowRoot);function Hl(n,t){const e=n.touches,i=e&&e.length?e[0]:n,{offsetX:o,offsetY:s}=i;let a=!1,r,l;if(Ul(o,s,n.target))r=o,l=s;else{const c=t.getBoundingClientRect();r=i.clientX-c.left,l=i.clientY-c.top,a=!0}return{x:r,y:l,box:a}}function nn(n,t){if("native"in n)return n;const{canvas:e,currentDevicePixelRatio:i}=t,o=Fi(e),s=o.boxSizing==="border-box",a=rn(o,"padding"),r=rn(o,"border","width"),{x:l,y:c,box:d}=Hl(n,e),u=a.left+(d&&r.left),f=a.top+(d&&r.top);let{width:h,height:w}=t;return s&&(h-=a.width+r.width,w-=a.height+r.height),{x:Math.round((l-u)/h*e.width/i),y:Math.round((c-f)/w*e.height/i)}}function jl(n,t,e){let i,o;if(t===void 0||e===void 0){const s=n&&Vo(n);if(!s)t=n.clientWidth,e=n.clientHeight;else{const a=s.getBoundingClientRect(),r=Fi(s),l=rn(r,"border","width"),c=rn(r,"padding");t=a.width-c.width-l.width,e=a.height-c.height-l.height,i=ki(r.maxWidth,s,"clientWidth"),o=ki(r.maxHeight,s,"clientHeight")}}return{width:t,height:e,maxWidth:i||Ci,maxHeight:o||Ci}}const Zn=n=>Math.round(n*10)/10;function Wl(n,t,e,i){const o=Fi(n),s=rn(o,"margin"),a=ki(o.maxWidth,n,"clientWidth")||Ci,r=ki(o.maxHeight,n,"clientHeight")||Ci,l=jl(n,t,e);let{width:c,height:d}=l;if(o.boxSizing==="content-box"){const f=rn(o,"border","width"),h=rn(o,"padding");c-=h.width+f.width,d-=h.height+f.height}return c=Math.max(0,c-s.width),d=Math.max(0,i?c/i:d-s.height),c=Zn(Math.min(c,a,l.maxWidth)),d=Zn(Math.min(d,r,l.maxHeight)),c&&!d&&(d=Zn(c/2)),(t!==void 0||e!==void 0)&&i&&l.height&&d>l.height&&(d=l.height,c=Zn(Math.floor(d*i))),{width:c,height:d}}function as(n,t,e){const i=t||1,o=Math.floor(n.height*i),s=Math.floor(n.width*i);n.height=Math.floor(n.height),n.width=Math.floor(n.width);const a=n.canvas;return a.style&&(e||!a.style.height&&!a.style.width)&&(a.style.height="".concat(n.height,"px"),a.style.width="".concat(n.width,"px")),n.currentDevicePixelRatio!==i||a.height!==o||a.width!==s?(n.currentDevicePixelRatio=i,a.height=o,a.width=s,n.ctx.setTransform(i,0,0,i,0,0),!0):!1}const Yl=(function(){let n=!1;try{const t={get passive(){return n=!0,!1}};Ro()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch(t){}return n})();function rs(n,t){const e=Vl(n,t),i=e&&e.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function on(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:n.y+e*(t.y-n.y)}}function ql(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:i==="middle"?e<.5?n.y:t.y:i==="after"?e<1?n.y:t.y:e>0?t.y:n.y}}function $l(n,t,e,i){const o={x:n.cp2x,y:n.cp2y},s={x:t.cp1x,y:t.cp1y},a=on(n,o,e),r=on(o,s,e),l=on(s,t,e),c=on(a,r,e),d=on(r,l,e);return on(c,d,e)}const Gl=function(n,t){return{x(e){return n+n+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,i){return e-i},leftForLtr(e,i){return e-i}}},Xl=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,t){return n+t},leftForLtr(n,t){return n}}};function hn(n,t,e){return n?Gl(t,e):Xl()}function Fa(n,t){let e,i;(t==="ltr"||t==="rtl")&&(e=n.canvas.style,i=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),n.prevTextDirection=i)}function Na(n,t){t!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",t[0],t[1]))}function Ra(n){return n==="angle"?{between:zn,compare:Kr,normalize:ae}:{between:Oe,compare:(t,e)=>t-e,normalize:t=>t}}function ls({start:n,end:t,count:e,loop:i,style:o}){return{start:n%e,end:t%e,loop:i&&(t-n+1)%e===0,style:o}}function Kl(n,t,e){const{property:i,start:o,end:s}=e,{between:a,normalize:r}=Ra(i),l=t.length;let{start:c,end:d,loop:u}=n,f,h;if(u){for(c+=l,d+=l,f=0,h=l;f<h&&a(r(t[c%l][i]),o,s);++f)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:u,style:n.style}}function Va(n,t,e){if(!e)return[n];const{property:i,start:o,end:s}=e,a=t.length,{compare:r,between:l,normalize:c}=Ra(i),{start:d,end:u,loop:f,style:h}=Kl(n,t,e),w=[];let x=!1,S=null,O,N,J;const ot=()=>l(o,J,O)&&r(o,J)!==0,y=()=>r(s,O)===0||l(s,J,O),I=()=>x||ot(),R=()=>!x||y();for(let P=d,W=d;P<=u;++P)N=t[P%a],!N.skip&&(O=c(N[i]),O!==J&&(x=l(O,o,s),S===null&&I()&&(S=r(O,o)===0?P:W),S!==null&&R()&&(w.push(ls({start:S,end:P,loop:f,count:a,style:h})),S=null),W=P,J=O));return S!==null&&w.push(ls({start:S,end:u,loop:f,count:a,style:h})),w}function za(n,t){const e=[],i=n.segments;for(let o=0;o<i.length;o++){const s=Va(i[o],n.points,t);s.length&&e.push(...s)}return e}function Jl(n,t,e,i){let o=0,s=t-1;if(e&&!i)for(;o<t&&!n[o].skip;)o++;for(;o<t&&n[o].skip;)o++;for(o%=t,e&&(s+=o);s>o&&n[s%t].skip;)s--;return s%=t,{start:o,end:s}}function Zl(n,t,e,i){const o=n.length,s=[];let a=t,r=n[t],l;for(l=t+1;l<=e;++l){const c=n[l%o];c.skip||c.stop?r.skip||(i=!1,s.push({start:t%o,end:(l-1)%o,loop:i}),t=a=c.stop?l:null):(a=l,r.skip&&(t=l)),r=c}return a!==null&&s.push({start:t%o,end:a%o,loop:i}),s}function Ql(n,t){const e=n.points,i=n.options.spanGaps,o=e.length;if(!o)return[];const s=!!n._loop,{start:a,end:r}=Jl(e,o,s,i);if(i===!0)return cs(n,[{start:a,end:r,loop:s}],e,t);const l=r<a?r+o:r,c=!!n._fullLoop&&a===0&&r===o-1;return cs(n,Zl(e,a,l,c),e,t)}function cs(n,t,e,i){return!i||!i.setContext||!e?t:tc(n,t,e,i)}function tc(n,t,e,i){const o=n._chart.getContext(),s=ds(n.options),{_datasetIndex:a,options:{spanGaps:r}}=n,l=e.length,c=[];let d=s,u=t[0].start,f=u;function h(w,x,S,O){const N=r?-1:1;if(w!==x){for(w+=l;e[w%l].skip;)w-=N;for(;e[x%l].skip;)x+=N;w%l!==x%l&&(c.push({start:w%l,end:x%l,loop:S,style:O}),d=O,u=x%l)}}for(const w of t){u=r?u:w.start;let x=e[u%l],S;for(f=u+1;f<=w.end;f++){const O=e[f%l];S=ds(i.setContext(Ge(o,{type:"segment",p0:x,p1:O,p0DataIndex:(f-1)%l,p1DataIndex:f%l,datasetIndex:a}))),ec(S,d)&&h(u,f-1,w.loop,d),x=O,d=S}u<f-1&&h(u,f-1,w.loop,d)}return c}function ds(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function ec(n,t){if(!t)return!1;const e=[],i=function(o,s){return Bo(s)?(e.includes(s)||e.push(s),e.indexOf(s)):s};return JSON.stringify(n,i)!==JSON.stringify(t,i)}function Qn(n,t,e){return n.options.clip?n[e]:t[e]}function nc(n,t){const{xScale:e,yScale:i}=n;return e&&i?{left:Qn(e,t,"left"),right:Qn(e,t,"right"),top:Qn(i,t,"top"),bottom:Qn(i,t,"bottom")}:t}function Ua(n,t){const e=t._clip;if(e.disabled)return!1;const i=nc(t,n.chartArea);return{left:e.left===!1?0:i.left-(e.left===!0?0:e.left),right:e.right===!1?n.width:i.right+(e.right===!0?0:e.right),top:e.top===!1?0:i.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?n.height:i.bottom+(e.bottom===!0?0:e.bottom)}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class ic{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,o){const s=e.listeners[o],a=e.duration;s.forEach(r=>r({chart:t,initial:e.initial,numSteps:a,currentStep:Math.min(i-e.start,a)}))}_refresh(){this._request||(this._running=!0,this._request=Sa.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((i,o)=>{if(!i.running||!i.items.length)return;const s=i.items;let a=s.length-1,r=!1,l;for(;a>=0;--a)l=s[a],l._active?(l._total>i.duration&&(i.duration=l._total),l.tick(t),r=!0):(s[a]=s[s.length-1],s.pop());r&&(o.draw(),this._notify(o,i,t,"progress")),s.length||(i.running=!1,this._notify(o,i,t,"complete"),i.initial=!1),e+=s.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((i,o)=>Math.max(i,o._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let o=i.length-1;for(;o>=0;--o)i[o].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Pe=new ic;const us="transparent",oc={boolean(n,t,e){return e>.5?t:n},color(n,t,e){const i=es(n||us),o=i.valid&&es(t||us);return o&&o.valid?o.mix(i,e).hexString():t},number(n,t,e){return n+(t-n)*e}};class sc{constructor(t,e,i,o){const s=e[i];o=kn([t.to,o,s,t.from]);const a=kn([t.from,s,o]);this._active=!0,this._fn=t.fn||oc[t.type||typeof a],this._easing=Bn[t.easing]||Bn.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=a,this._to=o,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const o=this._target[this._prop],s=i-this._start,a=this._duration-s;this._start=i,this._duration=Math.floor(Math.max(a,t.duration)),this._total+=s,this._loop=!!t.loop,this._to=kn([t.to,e,o,t.from]),this._from=kn([t.from,o,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,o=this._prop,s=this._from,a=this._loop,r=this._to;let l;if(this._active=s!==r&&(a||e<i),!this._active){this._target[o]=r,this._notify(!0);return}if(e<0){this._target[o]=s;return}l=e/i%2,l=a&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[o]=this._fn(s,r,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,i)=>{t.push({res:e,rej:i})})}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let o=0;o<i.length;o++)i[o][e]()}}class Ha{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!Tt(t))return;const e=Object.keys(Ht.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(o=>{const s=t[o];if(!Tt(s))return;const a={};for(const r of e)a[r]=s[r];(Ut(s.properties)&&s.properties||[o]).forEach(r=>{(r===o||!i.has(r))&&i.set(r,a)})})}_animateOptions(t,e){const i=e.options,o=rc(t,i);if(!o)return[];const s=this._createAnimations(o,i);return i.$shared&&ac(t.options.$animations,i).then(()=>{t.options=i},()=>{}),s}_createAnimations(t,e){const i=this._properties,o=[],s=t.$animations||(t.$animations={}),a=Object.keys(e),r=Date.now();let l;for(l=a.length-1;l>=0;--l){const c=a[l];if(c.charAt(0)==="$")continue;if(c==="options"){o.push(...this._animateOptions(t,e));continue}const d=e[c];let u=s[c];const f=i.get(c);if(u)if(f&&u.active()){u.update(f,d,r);continue}else u.cancel();if(!f||!f.duration){t[c]=d;continue}s[c]=u=new sc(f,t,c,d),o.push(u)}return o}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const i=this._createAnimations(t,e);if(i.length)return Pe.add(this._chart,i),!0}}function ac(n,t){const e=[],i=Object.keys(t);for(let o=0;o<i.length;o++){const s=n[i[o]];s&&s.active()&&e.push(s.wait())}return Promise.all(e)}function rc(n,t){if(!t)return;let e=n.options;if(!e){n.options=t;return}return e.$shared&&(n.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function fs(n,t){const e=n&&n.options||{},i=e.reverse,o=e.min===void 0?t:0,s=e.max===void 0?t:0;return{start:i?s:o,end:i?o:s}}function lc(n,t,e){if(e===!1)return!1;const i=fs(n,e),o=fs(t,e);return{top:o.end,right:i.end,bottom:o.start,left:i.start}}function cc(n){let t,e,i,o;return Tt(n)?(t=n.top,e=n.right,i=n.bottom,o=n.left):t=e=i=o=n,{top:t,right:e,bottom:i,left:o,disabled:n===!1}}function ja(n,t){const e=[],i=n._getSortedDatasetMetas(t);let o,s;for(o=0,s=i.length;o<s;++o)e.push(i[o].index);return e}function hs(n,t,e,i={}){const o=n.keys,s=i.mode==="single";let a,r,l,c;if(t===null)return;let d=!1;for(a=0,r=o.length;a<r;++a){if(l=+o[a],l===e){if(d=!0,i.all)continue;break}c=n.values[l],qt(c)&&(s||t===0||ke(t)===ke(c))&&(t+=c)}return!d&&!i.all?0:t}function dc(n,t){const{iScale:e,vScale:i}=t,o=e.axis==="x"?"x":"y",s=i.axis==="x"?"x":"y",a=Object.keys(n),r=new Array(a.length);let l,c,d;for(l=0,c=a.length;l<c;++l)d=a[l],r[l]={[o]:d,[s]:n[d]};return r}function qi(n,t){const e=n&&n.options.stacked;return e||e===void 0&&t.stack!==void 0}function uc(n,t,e){return"".concat(n.id,".").concat(t.id,".").concat(e.stack||e.type)}function fc(n){const{min:t,max:e,minDefined:i,maxDefined:o}=n.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:o?e:Number.POSITIVE_INFINITY}}function hc(n,t,e){const i=n[t]||(n[t]={});return i[e]||(i[e]={})}function ps(n,t,e,i){for(const o of t.getMatchingVisibleMetas(i).reverse()){const s=n[o.index];if(e&&s>0||!e&&s<0)return o.index}return null}function ms(n,t){const{chart:e,_cachedMeta:i}=n,o=e._stacks||(e._stacks={}),{iScale:s,vScale:a,index:r}=i,l=s.axis,c=a.axis,d=uc(s,a,i),u=t.length;let f;for(let h=0;h<u;++h){const w=t[h],{[l]:x,[c]:S}=w,O=w._stacks||(w._stacks={});f=O[c]=hc(o,d,x),f[r]=S,f._top=ps(f,a,!0,i.type),f._bottom=ps(f,a,!1,i.type);const N=f._visualValues||(f._visualValues={});N[r]=S}}function $i(n,t){const e=n.scales;return Object.keys(e).filter(i=>e[i].axis===t).shift()}function pc(n,t){return Ge(n,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function mc(n,t,e){return Ge(n,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function wn(n,t){const e=n.controller.index,i=n.vScale&&n.vScale.axis;if(i){t=t||n._parsed;for(const o of t){const s=o._stacks;if(!s||s[i]===void 0||s[i][e]===void 0)return;delete s[i][e],s[i]._visualValues!==void 0&&s[i]._visualValues[e]!==void 0&&delete s[i]._visualValues[e]}}}const Gi=n=>n==="reset"||n==="none",gs=(n,t)=>t?n:Object.assign({},n),gc=(n,t,e)=>n&&!t.hidden&&t._stacked&&{keys:ja(e,!0),values:null};class _e{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=qi(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&wn(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),o=(u,f,h,w)=>u==="x"?f:u==="r"?w:h,s=e.xAxisID=Dt(i.xAxisID,$i(t,"x")),a=e.yAxisID=Dt(i.yAxisID,$i(t,"y")),r=e.rAxisID=Dt(i.rAxisID,$i(t,"r")),l=e.indexAxis,c=e.iAxisID=o(l,s,a,r),d=e.vAxisID=o(l,a,s,r);e.xScale=this.getScaleForId(s),e.yScale=this.getScaleForId(a),e.rScale=this.getScaleForId(r),e.iScale=this.getScaleForId(c),e.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Zo(this._data,this),t._stacked&&wn(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(Tt(e)){const o=this._cachedMeta;this._data=dc(e,o)}else if(i!==e){if(i){Zo(i,this);const o=this._cachedMeta;wn(o),o._parsed=[]}e&&Object.isExtensible(e)&&tl(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let o=!1;this._dataCheck();const s=e._stacked;e._stacked=qi(e.vScale,e),e.stack!==i.stack&&(o=!0,wn(e),e.stack=i.stack),this._resyncElements(t),(o||s!==e._stacked)&&(ms(this,e._parsed),e._stacked=qi(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:o}=this,{iScale:s,_stacked:a}=i,r=s.axis;let l=t===0&&e===o.length?!0:i._sorted,c=t>0&&i._parsed[t-1],d,u,f;if(this._parsing===!1)i._parsed=o,i._sorted=!0,f=o;else{Ut(o[t])?f=this.parseArrayData(i,o,t,e):Tt(o[t])?f=this.parseObjectData(i,o,t,e):f=this.parsePrimitiveData(i,o,t,e);const h=()=>u[r]===null||c&&u[r]<c[r];for(d=0;d<e;++d)i._parsed[d+t]=u=f[d],l&&(h()&&(l=!1),c=u);i._sorted=l}a&&ms(this,f)}parsePrimitiveData(t,e,i,o){const{iScale:s,vScale:a}=t,r=s.axis,l=a.axis,c=s.getLabels(),d=s===a,u=new Array(o);let f,h,w;for(f=0,h=o;f<h;++f)w=f+i,u[f]={[r]:d||s.parse(c[w],w),[l]:a.parse(e[w],w)};return u}parseArrayData(t,e,i,o){const{xScale:s,yScale:a}=t,r=new Array(o);let l,c,d,u;for(l=0,c=o;l<c;++l)d=l+i,u=e[d],r[l]={x:s.parse(u[0],d),y:a.parse(u[1],d)};return r}parseObjectData(t,e,i,o){const{xScale:s,yScale:a}=t,{xAxisKey:r="x",yAxisKey:l="y"}=this._parsing,c=new Array(o);let d,u,f,h;for(d=0,u=o;d<u;++d)f=d+i,h=e[f],c[d]={x:s.parse(qe(h,r),f),y:a.parse(qe(h,l),f)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const o=this.chart,s=this._cachedMeta,a=e[t.axis],r={keys:ja(o,!0),values:e._stacks[t.axis]._visualValues};return hs(r,a,s.index,{mode:i})}updateRangeFromParsed(t,e,i,o){const s=i[e.axis];let a=s===null?NaN:s;const r=o&&i._stacks[e.axis];o&&r&&(o.values=r,a=hs(o,s,this._cachedMeta.index)),t.min=Math.min(t.min,a),t.max=Math.max(t.max,a)}getMinMax(t,e){const i=this._cachedMeta,o=i._parsed,s=i._sorted&&t===i.iScale,a=o.length,r=this._getOtherScale(t),l=gc(e,i,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:u}=fc(r);let f,h;function w(){h=o[f];const x=h[r.axis];return!qt(h[t.axis])||d>x||u<x}for(f=0;f<a&&!(!w()&&(this.updateRangeFromParsed(c,t,h,l),s));++f);if(s){for(f=a-1;f>=0;--f)if(!w()){this.updateRangeFromParsed(c,t,h,l);break}}return c}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let o,s,a;for(o=0,s=e.length;o<s;++o)a=e[o][t.axis],qt(a)&&i.push(a);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,o=e.vScale,s=this.getParsed(t);return{label:i?""+i.getLabelForValue(s[i.axis]):"",value:o?""+o.getLabelForValue(s[o.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=cc(Dt(this.options.clip,lc(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,o=i.data||[],s=e.chartArea,a=[],r=this._drawStart||0,l=this._drawCount||o.length-r,c=this.options.drawActiveElementsOnTop;let d;for(i.dataset&&i.dataset.draw(t,s,r,l),d=r;d<r+l;++d){const u=o[d];u.hidden||(u.active&&c?a.push(u):u.draw(t,s))}for(d=0;d<a.length;++d)a[d].draw(t,s)}getStyle(t,e){const i=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const o=this.getDataset();let s;if(t>=0&&t<this._cachedMeta.data.length){const a=this._cachedMeta.data[t];s=a.$context||(a.$context=mc(this.getContext(),t,a)),s.parsed=this.getParsed(t),s.raw=o.data[t],s.index=s.dataIndex=t}else s=this.$context||(this.$context=pc(this.chart.getContext(),this.index)),s.dataset=o,s.index=s.datasetIndex=this.index;return s.active=!!e,s.mode=i,s}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const o=e==="active",s=this._cachedDataOpts,a=t+"-"+e,r=s[a],l=this.enableOptionSharing&&Vn(i);if(r)return gs(r,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,t),u=o?["".concat(t,"Hover"),"hover",t,""]:[t,""],f=c.getOptionScopes(this.getDataset(),d),h=Object.keys(Ht.elements[t]),w=()=>this.getContext(i,o,e),x=c.resolveNamedOptions(f,h,w,u);return x.$shared&&(x.$shared=l,s[a]=Object.freeze(gs(x,l))),x}_resolveAnimations(t,e,i){const o=this.chart,s=this._cachedDataOpts,a="animation-".concat(e),r=s[a];if(r)return r;let l;if(o.options.animation!==!1){const d=this.chart.config,u=d.datasetAnimationScopeKeys(this._type,e),f=d.getOptionScopes(this.getDataset(),u);l=d.createResolver(f,this.getContext(t,i,e))}const c=new Ha(o,l&&l.animations);return l&&l._cacheable&&(s[a]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||Gi(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),o=this._sharedOptions,s=this.getSharedOptions(i),a=this.includeOptions(e,s)||s!==o;return this.updateSharedOptions(s,e,i),{sharedOptions:s,includeOptions:a}}updateElement(t,e,i,o){Gi(o)?Object.assign(t,i):this._resolveAnimations(e,o).update(t,i)}updateSharedOptions(t,e,i){t&&!Gi(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,o){t.active=o;const s=this.getStyle(e,o);this._resolveAnimations(e,i,o).update(t,{options:!o&&this.getSharedOptions(s)||s})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[r,l,c]of this._syncList)this[r](l,c);this._syncList=[];const o=i.length,s=e.length,a=Math.min(s,o);a&&this.parse(0,a),s>o?this._insertElements(o,s-o,t):s<o&&this._removeElements(s,o-s)}_insertElements(t,e,i=!0){const o=this._cachedMeta,s=o.data,a=t+e;let r;const l=c=>{for(c.length+=e,r=c.length-1;r>=a;r--)c[r]=c[r-e]};for(l(s),r=t;r<a;++r)s[r]=new this.dataElementType;this._parsing&&l(o._parsed),this.parse(t,e),i&&this.updateElements(s,t,e,"reset")}updateElements(t,e,i,o){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const o=i._parsed.splice(t,e);i._stacked&&wn(i,o)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,o]=t;this[e](i,o)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}ht(_e,"defaults",{}),ht(_e,"datasetElementType",null),ht(_e,"dataElementType",null);function vc(n,t){if(!n._cache.$bar){const e=n.getMatchingVisibleMetas(t);let i=[];for(let o=0,s=e.length;o<s;o++)i=i.concat(e[o].controller.getAllParsedValues(n));n._cache.$bar=xa(i.sort((o,s)=>o-s))}return n._cache.$bar}function bc(n){const t=n.iScale,e=vc(t,n.type);let i=t._length,o,s,a,r;const l=()=>{a===32767||a===-32768||(Vn(r)&&(i=Math.min(i,Math.abs(a-r)||i)),r=a)};for(o=0,s=e.length;o<s;++o)a=t.getPixelForValue(e[o]),l();for(r=void 0,o=0,s=t.ticks.length;o<s;++o)a=t.getPixelForTick(o),l();return i}function yc(n,t,e,i){const o=e.barThickness;let s,a;return Mt(o)?(s=t.min*e.categoryPercentage,a=e.barPercentage):(s=o*i,a=1),{chunk:s/i,ratio:a,start:t.pixels[n]-s/2}}function wc(n,t,e,i){const o=t.pixels,s=o[n];let a=n>0?o[n-1]:null,r=n<o.length-1?o[n+1]:null;const l=e.categoryPercentage;a===null&&(a=s-(r===null?t.end-t.start:r-s)),r===null&&(r=s+s-a);const c=s-(s-Math.min(a,r))/2*l;return{chunk:Math.abs(r-a)/2*l/i,ratio:e.barPercentage,start:c}}function _c(n,t,e,i){const o=e.parse(n[0],i),s=e.parse(n[1],i),a=Math.min(o,s),r=Math.max(o,s);let l=a,c=r;Math.abs(a)>Math.abs(r)&&(l=r,c=a),t[e.axis]=c,t._custom={barStart:l,barEnd:c,start:o,end:s,min:a,max:r}}function Wa(n,t,e,i){return Ut(n)?_c(n,t,e,i):t[e.axis]=e.parse(n,i),t}function vs(n,t,e,i){const o=n.iScale,s=n.vScale,a=o.getLabels(),r=o===s,l=[];let c,d,u,f;for(c=e,d=e+i;c<d;++c)f=t[c],u={},u[o.axis]=r||o.parse(a[c],c),l.push(Wa(f,u,s,c));return l}function Xi(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function xc(n,t,e){return n!==0?ke(n):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function Sc(n){let t,e,i,o,s;return n.horizontal?(t=n.base>n.x,e="left",i="right"):(t=n.base<n.y,e="bottom",i="top"),t?(o="end",s="start"):(o="start",s="end"),{start:e,end:i,reverse:t,top:o,bottom:s}}function Cc(n,t,e,i){let o=t.borderSkipped;const s={};if(!o){n.borderSkipped=s;return}if(o===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:a,end:r,reverse:l,top:c,bottom:d}=Sc(n);o==="middle"&&e&&(n.enableBorderRadius=!0,(e._top||0)===i?o=c:(e._bottom||0)===i?o=d:(s[bs(d,a,r,l)]=!0,o=c)),s[bs(o,a,r,l)]=!0,n.borderSkipped=s}function bs(n,t,e,i){return i?(n=Dc(n,t,e),n=ys(n,e,t)):n=ys(n,t,e),n}function Dc(n,t,e){return n===t?e:n===e?t:n}function ys(n,t,e){return n==="start"?t:n==="end"?e:n}function kc(n,{inflateAmount:t},e){n.inflateAmount=t==="auto"?e===1?.33:0:t}class di extends _e{parsePrimitiveData(t,e,i,o){return vs(t,e,i,o)}parseArrayData(t,e,i,o){return vs(t,e,i,o)}parseObjectData(t,e,i,o){const{iScale:s,vScale:a}=t,{xAxisKey:r="x",yAxisKey:l="y"}=this._parsing,c=s.axis==="x"?r:l,d=a.axis==="x"?r:l,u=[];let f,h,w,x;for(f=i,h=i+o;f<h;++f)x=e[f],w={},w[s.axis]=s.parse(qe(x,c),f),u.push(Wa(qe(x,d),w,a,f));return u}updateRangeFromParsed(t,e,i,o){super.updateRangeFromParsed(t,e,i,o);const s=i._custom;s&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,s.min),t.max=Math.max(t.max,s.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:o}=e,s=this.getParsed(t),a=s._custom,r=Xi(a)?"["+a.start+", "+a.end+"]":""+o.getLabelForValue(s[o.axis]);return{label:""+i.getLabelForValue(s[i.axis]),value:r}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,i,o){const s=o==="reset",{index:a,_cachedMeta:{vScale:r}}=this,l=r.getBasePixel(),c=r.isHorizontal(),d=this._getRuler(),{sharedOptions:u,includeOptions:f}=this._getSharedOptions(e,o);for(let h=e;h<e+i;h++){const w=this.getParsed(h),x=s||Mt(w[r.axis])?{base:l,head:l}:this._calculateBarValuePixels(h),S=this._calculateBarIndexPixels(h,d),O=(w._stacks||{})[r.axis],N={horizontal:c,base:x.base,enableBorderRadius:!O||Xi(w._custom)||a===O._top||a===O._bottom,x:c?x.head:S.center,y:c?S.center:x.head,height:c?S.size:Math.abs(x.size),width:c?Math.abs(x.size):S.size};f&&(N.options=u||this.resolveDataElementOptions(h,t[h].active?"active":o));const J=N.options||t[h].options;Cc(N,J,O,a),kc(N,J,d.ratio),this.updateElement(t[h],h,N,o)}}_getStacks(t,e){const{iScale:i}=this._cachedMeta,o=i.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),s=i.options.stacked,a=[],r=this._cachedMeta.controller.getParsed(e),l=r&&r[i.axis],c=d=>{const u=d._parsed.find(h=>h[i.axis]===l),f=u&&u[d.vScale.axis];if(Mt(f)||isNaN(f))return!0};for(const d of o)if(!(e!==void 0&&c(d))&&((s===!1||a.indexOf(d.stack)===-1||s===void 0&&d.stack===void 0)&&a.push(d.stack),d.index===t))break;return a.length||a.push(void 0),a}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(i=>t[i].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[Dt(this.chart.options.indexAxis==="x"?i.xAxisID:i.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,i){const o=this._getStacks(t,i),s=e!==void 0?o.indexOf(e):-1;return s===-1?o.length-1:s}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,o=[];let s,a;for(s=0,a=e.data.length;s<a;++s)o.push(i.getPixelForValue(this.getParsed(s)[i.axis],s));const r=t.barThickness;return{min:r||bc(e),pixels:o,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:r?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:i,index:o},options:{base:s,minBarLength:a}}=this,r=s||0,l=this.getParsed(t),c=l._custom,d=Xi(c);let u=l[e.axis],f=0,h=i?this.applyStack(e,l,i):u,w,x;h!==u&&(f=h-u,h=u),d&&(u=c.barStart,h=c.barEnd-c.barStart,u!==0&&ke(u)!==ke(c.barEnd)&&(f=0),f+=u);const S=!Mt(s)&&!d?s:f;let O=e.getPixelForValue(S);if(this.chart.getDataVisibility(t)?w=e.getPixelForValue(f+h):w=O,x=w-O,Math.abs(x)<a){x=xc(x,e,r)*a,u===r&&(O-=x/2);const N=e.getPixelForDecimal(0),J=e.getPixelForDecimal(1),ot=Math.min(N,J),y=Math.max(N,J);O=Math.max(Math.min(O,y),ot),w=O+x,i&&!d&&(l._stacks[e.axis]._visualValues[o]=e.getValueForPixel(w)-e.getValueForPixel(O))}if(O===e.getPixelForValue(r)){const N=ke(x)*e.getLineWidthForValue(r)/2;O+=N,x-=N}return{size:x,base:O,head:w,center:w+x/2}}_calculateBarIndexPixels(t,e){const i=e.scale,o=this.options,s=o.skipNull,a=Dt(o.maxBarThickness,1/0);let r,l;const c=this._getAxisCount();if(e.grouped){const d=s?this._getStackCount(t):e.stackCount,u=o.barThickness==="flex"?wc(t,e,o,d*c):yc(t,e,o,d*c),f=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,h=this._getAxis().indexOf(Dt(f,this.getFirstScaleIdForIndexAxis())),w=this._getStackIndex(this.index,this._cachedMeta.stack,s?t:void 0)+h;r=u.start+u.chunk*w+u.chunk/2,l=Math.min(a,u.chunk*u.ratio)}else r=i.getPixelForValue(this.getParsed(t)[i.axis],t),l=Math.min(a,e.min*e.ratio);return{base:r-l/2,head:r+l/2,center:r,size:l}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,o=i.length;let s=0;for(;s<o;++s)this.getParsed(s)[e.axis]!==null&&!i[s].hidden&&i[s].draw(this._ctx)}}ht(di,"id","bar"),ht(di,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),ht(di,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class ui extends _e{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,o){const s=super.parsePrimitiveData(t,e,i,o);for(let a=0;a<s.length;a++)s[a]._custom=this.resolveDataElementOptions(a+i).radius;return s}parseArrayData(t,e,i,o){const s=super.parseArrayData(t,e,i,o);for(let a=0;a<s.length;a++){const r=e[i+a];s[a]._custom=Dt(r[2],this.resolveDataElementOptions(a+i).radius)}return s}parseObjectData(t,e,i,o){const s=super.parseObjectData(t,e,i,o);for(let a=0;a<s.length;a++){const r=e[i+a];s[a]._custom=Dt(r&&r.r&&+r.r,this.resolveDataElementOptions(a+i).radius)}return s}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:o,yScale:s}=e,a=this.getParsed(t),r=o.getLabelForValue(a.x),l=s.getLabelForValue(a.y),c=a._custom;return{label:i[t]||"",value:"("+r+", "+l+(c?", "+c:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,o){const s=o==="reset",{iScale:a,vScale:r}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(e,o),d=a.axis,u=r.axis;for(let f=e;f<e+i;f++){const h=t[f],w=!s&&this.getParsed(f),x={},S=x[d]=s?a.getPixelForDecimal(.5):a.getPixelForValue(w[d]),O=x[u]=s?r.getBasePixel():r.getPixelForValue(w[u]);x.skip=isNaN(S)||isNaN(O),c&&(x.options=l||this.resolveDataElementOptions(f,h.active?"active":o),s&&(x.options.radius=0)),this.updateElement(h,f,x,o)}}resolveDataElementOptions(t,e){const i=this.getParsed(t);let o=super.resolveDataElementOptions(t,e);o.$shared&&(o=Object.assign({},o,{$shared:!1}));const s=o.radius;return e!=="active"&&(o.radius=0),o.radius+=Dt(i&&i._custom,s),o}}ht(ui,"id","bubble"),ht(ui,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),ht(ui,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function Ic(n,t,e){let i=1,o=1,s=0,a=0;if(t<Rt){const r=n,l=r+t,c=Math.cos(r),d=Math.sin(r),u=Math.cos(l),f=Math.sin(l),h=(J,ot,y)=>zn(J,r,l,!0)?1:Math.max(ot,ot*e,y,y*e),w=(J,ot,y)=>zn(J,r,l,!0)?-1:Math.min(ot,ot*e,y,y*e),x=h(0,c,u),S=h(Gt,d,f),O=w(Bt,c,u),N=w(Bt+Gt,d,f);i=(x-O)/2,o=(S-N)/2,s=-(x+O)/2,a=-(S+N)/2}return{ratioX:i,ratioY:o,offsetX:s,offsetY:a}}class sn extends _e{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,o=this._cachedMeta;if(this._parsing===!1)o._parsed=i;else{let s=l=>+i[l];if(Tt(i[t])){const{key:l="value"}=this._parsing;s=c=>+qe(i[c],l)}let a,r;for(a=t,r=t+e;a<r;++a)o._parsed[a]=s(a)}}_getRotation(){return we(this.options.rotation-90)}_getCircumference(){return we(this.options.circumference)}_getRotationExtents(){let t=Rt,e=-Rt;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const o=this.chart.getDatasetMeta(i).controller,s=o._getRotation(),a=o._getCircumference();t=Math.min(t,s),e=Math.max(e,s+a)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,o=this._cachedMeta,s=o.data,a=this.getMaxBorderWidth()+this.getMaxOffset(s)+this.options.spacing,r=Math.max((Math.min(i.width,i.height)-a)/2,0),l=Math.min(Vr(this.options.cutout,r),1),c=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:f,ratioY:h,offsetX:w,offsetY:x}=Ic(u,d,l),S=(i.width-a)/f,O=(i.height-a)/h,N=Math.max(Math.min(S,O)/2,0),J=va(this.options.radius,N),ot=Math.max(J*l,0),y=(J-ot)/this._getVisibleDatasetWeightTotal();this.offsetX=w*J,this.offsetY=x*J,o.total=this.calculateTotal(),this.outerRadius=J-y*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-y*c,0),this.updateElements(s,0,s.length,t)}_circumference(t,e){const i=this.options,o=this._cachedMeta,s=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||o._parsed[t]===null||o.data[t].hidden?0:this.calculateCircumference(o._parsed[t]*s/Rt)}updateElements(t,e,i,o){const s=o==="reset",a=this.chart,r=a.chartArea,c=a.options.animation,d=(r.left+r.right)/2,u=(r.top+r.bottom)/2,f=s&&c.animateScale,h=f?0:this.innerRadius,w=f?0:this.outerRadius,{sharedOptions:x,includeOptions:S}=this._getSharedOptions(e,o);let O=this._getRotation(),N;for(N=0;N<e;++N)O+=this._circumference(N,s);for(N=e;N<e+i;++N){const J=this._circumference(N,s),ot=t[N],y={x:d+this.offsetX,y:u+this.offsetY,startAngle:O,endAngle:O+J,circumference:J,outerRadius:w,innerRadius:h};S&&(y.options=x||this.resolveDataElementOptions(N,ot.active?"active":o)),O+=J,this.updateElement(ot,N,y,o)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let i=0,o;for(o=0;o<e.length;o++){const s=t._parsed[o];s!==null&&!isNaN(s)&&this.chart.getDataVisibility(o)&&!e[o].hidden&&(i+=Math.abs(s))}return i}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?Rt*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,o=i.data.labels||[],s=qn(e._parsed[t],i.options.locale);return{label:o[t]||"",value:s}}getMaxBorderWidth(t){let e=0;const i=this.chart;let o,s,a,r,l;if(!t){for(o=0,s=i.data.datasets.length;o<s;++o)if(i.isDatasetVisible(o)){a=i.getDatasetMeta(o),t=a.data,r=a.controller;break}}if(!t)return 0;for(o=0,s=t.length;o<s;++o)l=r.resolveDataElementOptions(o),l.borderAlign!=="inner"&&(e=Math.max(e,l.borderWidth||0,l.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,o=t.length;i<o;++i){const s=this.resolveDataElementOptions(i);e=Math.max(e,s.offset||0,s.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(Dt(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}ht(sn,"id","doughnut"),ht(sn,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),ht(sn,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),ht(sn,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:o}}=t.legend.options;return e.labels.map((s,a)=>{const l=t.getDatasetMeta(0).controller.getStyle(a);return{text:s,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:o,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(a),index:a}})}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}}});class fi extends _e{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:o=[],_dataset:s}=e,a=this.chart._animationsDisabled;let{start:r,count:l}=Da(e,o,a);this._drawStart=r,this._drawCount=l,ka(e)&&(r=0,l=o.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!s._decimated,i.points=o;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(i,void 0,{animated:!a,options:c},t),this.updateElements(o,r,l,t)}updateElements(t,e,i,o){const s=o==="reset",{iScale:a,vScale:r,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:d,includeOptions:u}=this._getSharedOptions(e,o),f=a.axis,h=r.axis,{spanGaps:w,segment:x}=this.options,S=pn(w)?w:Number.POSITIVE_INFINITY,O=this.chart._animationsDisabled||s||o==="none",N=e+i,J=t.length;let ot=e>0&&this.getParsed(e-1);for(let y=0;y<J;++y){const I=t[y],R=O?I:{};if(y<e||y>=N){R.skip=!0;continue}const P=this.getParsed(y),W=Mt(P[h]),X=R[f]=a.getPixelForValue(P[f],y),V=R[h]=s||W?r.getBasePixel():r.getPixelForValue(l?this.applyStack(r,P,l):P[h],y);R.skip=isNaN(X)||isNaN(V)||W,R.stop=y>0&&Math.abs(P[f]-ot[f])>S,x&&(R.parsed=P,R.raw=c.data[y]),u&&(R.options=d||this.resolveDataElementOptions(y,I.active?"active":o)),O||this.updateElement(I,y,R,o),ot=P}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,o=t.data||[];if(!o.length)return i;const s=o[0].size(this.resolveDataElementOptions(0)),a=o[o.length-1].size(this.resolveDataElementOptions(o.length-1));return Math.max(i,s,a)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}ht(fi,"id","line"),ht(fi,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),ht(fi,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class On extends _e{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,o=i.data.labels||[],s=qn(e._parsed[t].r,i.options.locale);return{label:o[t]||"",value:s}}parseObjectData(t,e,i,o){return La.bind(this)(t,e,i,o)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,o)=>{const s=this.getParsed(o).r;!isNaN(s)&&this.chart.getDataVisibility(o)&&(s<e.min&&(e.min=s),s>e.max&&(e.max=s))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,o=Math.min(e.right-e.left,e.bottom-e.top),s=Math.max(o/2,0),a=Math.max(i.cutoutPercentage?s/100*i.cutoutPercentage:1,0),r=(s-a)/t.getVisibleDatasetCount();this.outerRadius=s-r*this.index,this.innerRadius=this.outerRadius-r}updateElements(t,e,i,o){const s=o==="reset",a=this.chart,l=a.options.animation,c=this._cachedMeta.rScale,d=c.xCenter,u=c.yCenter,f=c.getIndexAngle(0)-.5*Bt;let h=f,w;const x=360/this.countVisibleElements();for(w=0;w<e;++w)h+=this._computeAngle(w,o,x);for(w=e;w<e+i;w++){const S=t[w];let O=h,N=h+this._computeAngle(w,o,x),J=a.getDataVisibility(w)?c.getDistanceFromCenterForValue(this.getParsed(w).r):0;h=N,s&&(l.animateScale&&(J=0),l.animateRotate&&(O=N=f));const ot={x:d,y:u,innerRadius:0,outerRadius:J,startAngle:O,endAngle:N,options:this.resolveDataElementOptions(w,S.active?"active":o)};this.updateElement(S,w,ot,o)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((i,o)=>{!isNaN(this.getParsed(o).r)&&this.chart.getDataVisibility(o)&&e++}),e}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?we(this.resolveDataElementOptions(t,e).angle||i):0}}ht(On,"id","polarArea"),ht(On,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),ht(On,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:o}}=t.legend.options;return e.labels.map((s,a)=>{const l=t.getDatasetMeta(0).controller.getStyle(a);return{text:s,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:o,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(a),index:a}})}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class ho extends sn{}ht(ho,"id","pie"),ht(ho,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class hi extends _e{getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}parseObjectData(t,e,i,o){return La.bind(this)(t,e,i,o)}update(t){const e=this._cachedMeta,i=e.dataset,o=e.data||[],s=e.iScale.getLabels();if(i.points=o,t!=="resize"){const a=this.resolveDatasetElementOptions(t);this.options.showLine||(a.borderWidth=0);const r={_loop:!0,_fullLoop:s.length===o.length,options:a};this.updateElement(i,void 0,r,t)}this.updateElements(o,0,o.length,t)}updateElements(t,e,i,o){const s=this._cachedMeta.rScale,a=o==="reset";for(let r=e;r<e+i;r++){const l=t[r],c=this.resolveDataElementOptions(r,l.active?"active":o),d=s.getPointPositionForValue(r,this.getParsed(r).r),u=a?s.xCenter:d.x,f=a?s.yCenter:d.y,h={x:u,y:f,angle:d.angle,skip:isNaN(u)||isNaN(f),options:c};this.updateElement(l,r,h,o)}}}ht(hi,"id","radar"),ht(hi,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),ht(hi,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class pi extends _e{getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:o,yScale:s}=e,a=this.getParsed(t),r=o.getLabelForValue(a.x),l=s.getLabelForValue(a.y);return{label:i[t]||"",value:"("+r+", "+l+")"}}update(t){const e=this._cachedMeta,{data:i=[]}=e,o=this.chart._animationsDisabled;let{start:s,count:a}=Da(e,i,o);if(this._drawStart=s,this._drawCount=a,ka(e)&&(s=0,a=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:r,_dataset:l}=e;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!l._decimated,r.points=i;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(r,void 0,{animated:!o,options:c},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(i,s,a,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,i,o){const s=o==="reset",{iScale:a,vScale:r,_stacked:l,_dataset:c}=this._cachedMeta,d=this.resolveDataElementOptions(e,o),u=this.getSharedOptions(d),f=this.includeOptions(o,u),h=a.axis,w=r.axis,{spanGaps:x,segment:S}=this.options,O=pn(x)?x:Number.POSITIVE_INFINITY,N=this.chart._animationsDisabled||s||o==="none";let J=e>0&&this.getParsed(e-1);for(let ot=e;ot<e+i;++ot){const y=t[ot],I=this.getParsed(ot),R=N?y:{},P=Mt(I[w]),W=R[h]=a.getPixelForValue(I[h],ot),X=R[w]=s||P?r.getBasePixel():r.getPixelForValue(l?this.applyStack(r,I,l):I[w],ot);R.skip=isNaN(W)||isNaN(X)||P,R.stop=ot>0&&Math.abs(I[h]-J[h])>O,S&&(R.parsed=I,R.raw=c.data[ot]),f&&(R.options=u||this.resolveDataElementOptions(ot,y.active?"active":o)),N||this.updateElement(y,ot,R,o),J=I}this.updateSharedOptions(u,o,d)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let r=0;for(let l=e.length-1;l>=0;--l)r=Math.max(r,e[l].size(this.resolveDataElementOptions(l))/2);return r>0&&r}const i=t.dataset,o=i.options&&i.options.borderWidth||0;if(!e.length)return o;const s=e[0].size(this.resolveDataElementOptions(0)),a=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(o,s,a)/2}}ht(pi,"id","scatter"),ht(pi,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),ht(pi,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var Mc=Object.freeze({__proto__:null,BarController:di,BubbleController:ui,DoughnutController:sn,LineController:fi,PieController:ho,PolarAreaController:On,RadarController:hi,ScatterController:pi});function Qe(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class zo{constructor(t){ht(this,"options");this.options=t||{}}static override(t){Object.assign(zo.prototype,t)}init(){}formats(){return Qe()}parse(){return Qe()}format(){return Qe()}add(){return Qe()}diff(){return Qe()}startOf(){return Qe()}endOf(){return Qe()}}var Ec={_date:zo};function Tc(n,t,e,i){const{controller:o,data:s,_sorted:a}=n,r=o._cachedMeta.iScale,l=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(r&&t===r.axis&&t!=="r"&&a&&s.length){const c=r._reversePixels?Zr:Fe;if(i){if(o._sharedOptions){const d=s[0],u=typeof d.getRange=="function"&&d.getRange(t);if(u){const f=c(s,t,e-u),h=c(s,t,e+u);return{lo:f.lo,hi:h.hi}}}}else{const d=c(s,t,e);if(l){const{vScale:u}=o._cachedMeta,{_parsed:f}=n,h=f.slice(0,d.lo+1).reverse().findIndex(x=>!Mt(x[u.axis]));d.lo-=Math.max(0,h);const w=f.slice(d.hi).findIndex(x=>!Mt(x[u.axis]));d.hi+=Math.max(0,w)}return d}}return{lo:0,hi:s.length-1}}function Ni(n,t,e,i,o){const s=n.getSortedVisibleDatasetMetas(),a=e[t];for(let r=0,l=s.length;r<l;++r){const{index:c,data:d}=s[r],{lo:u,hi:f}=Tc(s[r],t,a,o);for(let h=u;h<=f;++h){const w=d[h];w.skip||i(w,c,h)}}}function Pc(n){const t=n.indexOf("x")!==-1,e=n.indexOf("y")!==-1;return function(i,o){const s=t?Math.abs(i.x-o.x):0,a=e?Math.abs(i.y-o.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(a,2))}}function Ki(n,t,e,i,o){const s=[];return!o&&!n.isPointInArea(t)||Ni(n,e,t,function(r,l,c){!o&&!Ne(r,n.chartArea,0)||r.inRange(t.x,t.y,i)&&s.push({element:r,datasetIndex:l,index:c})},!0),s}function Ac(n,t,e,i){let o=[];function s(a,r,l){const{startAngle:c,endAngle:d}=a.getProps(["startAngle","endAngle"],i),{angle:u}=wa(a,{x:t.x,y:t.y});zn(u,c,d)&&o.push({element:a,datasetIndex:r,index:l})}return Ni(n,e,t,s),o}function Bc(n,t,e,i,o,s){let a=[];const r=Pc(e);let l=Number.POSITIVE_INFINITY;function c(d,u,f){const h=d.inRange(t.x,t.y,o);if(i&&!h)return;const w=d.getCenterPoint(o);if(!(!!s||n.isPointInArea(w))&&!h)return;const S=r(t,w);S<l?(a=[{element:d,datasetIndex:u,index:f}],l=S):S===l&&a.push({element:d,datasetIndex:u,index:f})}return Ni(n,e,t,c),a}function Ji(n,t,e,i,o,s){return!s&&!n.isPointInArea(t)?[]:e==="r"&&!i?Ac(n,t,e,o):Bc(n,t,e,i,o,s)}function ws(n,t,e,i,o){const s=[],a=e==="x"?"inXRange":"inYRange";let r=!1;return Ni(n,e,t,(l,c,d)=>{l[a]&&l[a](t[e],o)&&(s.push({element:l,datasetIndex:c,index:d}),r=r||l.inRange(t.x,t.y,o))}),i&&!r?[]:s}var Lc={modes:{index(n,t,e,i){const o=nn(t,n),s=e.axis||"x",a=e.includeInvisible||!1,r=e.intersect?Ki(n,o,s,i,a):Ji(n,o,s,!1,i,a),l=[];return r.length?(n.getSortedVisibleDatasetMetas().forEach(c=>{const d=r[0].index,u=c.data[d];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:d})}),l):[]},dataset(n,t,e,i){const o=nn(t,n),s=e.axis||"xy",a=e.includeInvisible||!1;let r=e.intersect?Ki(n,o,s,i,a):Ji(n,o,s,!1,i,a);if(r.length>0){const l=r[0].datasetIndex,c=n.getDatasetMeta(l).data;r=[];for(let d=0;d<c.length;++d)r.push({element:c[d],datasetIndex:l,index:d})}return r},point(n,t,e,i){const o=nn(t,n),s=e.axis||"xy",a=e.includeInvisible||!1;return Ki(n,o,s,i,a)},nearest(n,t,e,i){const o=nn(t,n),s=e.axis||"xy",a=e.includeInvisible||!1;return Ji(n,o,s,e.intersect,i,a)},x(n,t,e,i){const o=nn(t,n);return ws(n,o,"x",e.intersect,i)},y(n,t,e,i){const o=nn(t,n);return ws(n,o,"y",e.intersect,i)}}};const Ya=["left","top","right","bottom"];function _n(n,t){return n.filter(e=>e.pos===t)}function _s(n,t){return n.filter(e=>Ya.indexOf(e.pos)===-1&&e.box.axis===t)}function xn(n,t){return n.sort((e,i)=>{const o=t?i:e,s=t?e:i;return o.weight===s.weight?o.index-s.index:o.weight-s.weight})}function Oc(n){const t=[];let e,i,o,s,a,r;for(e=0,i=(n||[]).length;e<i;++e)o=n[e],{position:s,options:{stack:a,stackWeight:r=1}}=o,t.push({index:e,box:o,pos:s,horizontal:o.isHorizontal(),weight:o.weight,stack:a&&s+a,stackWeight:r});return t}function Fc(n){const t={};for(const e of n){const{stack:i,pos:o,stackWeight:s}=e;if(!i||!Ya.includes(o))continue;const a=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});a.count++,a.weight+=s}return t}function Nc(n,t){const e=Fc(n),{vBoxMaxWidth:i,hBoxMaxHeight:o}=t;let s,a,r;for(s=0,a=n.length;s<a;++s){r=n[s];const{fullSize:l}=r.box,c=e[r.stack],d=c&&r.stackWeight/c.weight;r.horizontal?(r.width=d?d*i:l&&t.availableWidth,r.height=o):(r.width=i,r.height=d?d*o:l&&t.availableHeight)}return e}function Rc(n){const t=Oc(n),e=xn(t.filter(c=>c.box.fullSize),!0),i=xn(_n(t,"left"),!0),o=xn(_n(t,"right")),s=xn(_n(t,"top"),!0),a=xn(_n(t,"bottom")),r=_s(t,"x"),l=_s(t,"y");return{fullSize:e,leftAndTop:i.concat(s),rightAndBottom:o.concat(l).concat(a).concat(r),chartArea:_n(t,"chartArea"),vertical:i.concat(o).concat(l),horizontal:s.concat(a).concat(r)}}function xs(n,t,e,i){return Math.max(n[e],t[e])+Math.max(n[i],t[i])}function qa(n,t){n.top=Math.max(n.top,t.top),n.left=Math.max(n.left,t.left),n.bottom=Math.max(n.bottom,t.bottom),n.right=Math.max(n.right,t.right)}function Vc(n,t,e,i){const{pos:o,box:s}=e,a=n.maxPadding;if(!Tt(o)){e.size&&(n[o]-=e.size);const u=i[e.stack]||{size:0,count:1};u.size=Math.max(u.size,e.horizontal?s.height:s.width),e.size=u.size/u.count,n[o]+=e.size}s.getPadding&&qa(a,s.getPadding());const r=Math.max(0,t.outerWidth-xs(a,n,"left","right")),l=Math.max(0,t.outerHeight-xs(a,n,"top","bottom")),c=r!==n.w,d=l!==n.h;return n.w=r,n.h=l,e.horizontal?{same:c,other:d}:{same:d,other:c}}function zc(n){const t=n.maxPadding;function e(i){const o=Math.max(t[i]-n[i],0);return n[i]+=o,o}n.y+=e("top"),n.x+=e("left"),e("right"),e("bottom")}function Uc(n,t){const e=t.maxPadding;function i(o){const s={left:0,top:0,right:0,bottom:0};return o.forEach(a=>{s[a]=Math.max(t[a],e[a])}),s}return i(n?["left","right"]:["top","bottom"])}function In(n,t,e,i){const o=[];let s,a,r,l,c,d;for(s=0,a=n.length,c=0;s<a;++s){r=n[s],l=r.box,l.update(r.width||t.w,r.height||t.h,Uc(r.horizontal,t));const{same:u,other:f}=Vc(t,e,r,i);c|=u&&o.length,d=d||f,l.fullSize||o.push(r)}return c&&In(o,t,e,i)||d}function ti(n,t,e,i,o){n.top=e,n.left=t,n.right=t+i,n.bottom=e+o,n.width=i,n.height=o}function Ss(n,t,e,i){const o=e.padding;let{x:s,y:a}=t;for(const r of n){const l=r.box,c=i[r.stack]||{placed:0,weight:1},d=r.stackWeight/c.weight||1;if(r.horizontal){const u=t.w*d,f=c.size||l.height;Vn(c.start)&&(a=c.start),l.fullSize?ti(l,o.left,a,e.outerWidth-o.right-o.left,f):ti(l,t.left+c.placed,a,u,f),c.start=a,c.placed+=u,a=l.bottom}else{const u=t.h*d,f=c.size||l.width;Vn(c.start)&&(s=c.start),l.fullSize?ti(l,s,o.top,f,e.outerHeight-o.bottom-o.top):ti(l,s,t.top+c.placed,f,u),c.start=s,c.placed+=u,s=l.right}}t.x=s,t.y=a}var re={addBox(n,t){n.boxes||(n.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},n.boxes.push(t)},removeBox(n,t){const e=n.boxes?n.boxes.indexOf(t):-1;e!==-1&&n.boxes.splice(e,1)},configure(n,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(n,t,e,i){if(!n)return;const o=le(n.options.layout.padding),s=Math.max(t-o.width,0),a=Math.max(e-o.height,0),r=Rc(n.boxes),l=r.vertical,c=r.horizontal;Ot(n.boxes,x=>{typeof x.beforeLayout=="function"&&x.beforeLayout()});const d=l.reduce((x,S)=>S.box.options&&S.box.options.display===!1?x:x+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:e,padding:o,availableWidth:s,availableHeight:a,vBoxMaxWidth:s/2/d,hBoxMaxHeight:a/2}),f=Object.assign({},o);qa(f,le(i));const h=Object.assign({maxPadding:f,w:s,h:a,x:o.left,y:o.top},o),w=Nc(l.concat(c),u);In(r.fullSize,h,u,w),In(l,h,u,w),In(c,h,u,w)&&In(l,h,u,w),zc(h),Ss(r.leftAndTop,h,u,w),h.x+=h.w,h.y+=h.h,Ss(r.rightAndBottom,h,u,w),n.chartArea={left:h.left,top:h.top,right:h.left+h.w,bottom:h.top+h.h,height:h.h,width:h.w},Ot(r.chartArea,x=>{const S=x.box;Object.assign(S,n.chartArea),S.update(h.w,h.h,{left:0,top:0,right:0,bottom:0})})}};class $a{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,o){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,o?Math.floor(e/o):i)}}isAttached(t){return!0}updateConfig(t){}}class Hc extends $a{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const mi="$chartjs",jc={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Cs=n=>n===null||n==="";function Wc(n,t){const e=n.style,i=n.getAttribute("height"),o=n.getAttribute("width");if(n[mi]={initial:{height:i,width:o,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",Cs(o)){const s=rs(n,"width");s!==void 0&&(n.width=s)}if(Cs(i))if(n.style.height==="")n.height=n.width/(t||2);else{const s=rs(n,"height");s!==void 0&&(n.height=s)}return n}const Ga=Yl?{passive:!0}:!1;function Yc(n,t,e){n&&n.addEventListener(t,e,Ga)}function qc(n,t,e){n&&n.canvas&&n.canvas.removeEventListener(t,e,Ga)}function $c(n,t){const e=jc[n.type]||n.type,{x:i,y:o}=nn(n,t);return{type:e,chart:t,native:n,x:i!==void 0?i:null,y:o!==void 0?o:null}}function Ii(n,t){for(const e of n)if(e===t||e.contains(t))return!0}function Gc(n,t,e){const i=n.canvas,o=new MutationObserver(s=>{let a=!1;for(const r of s)a=a||Ii(r.addedNodes,i),a=a&&!Ii(r.removedNodes,i);a&&e()});return o.observe(document,{childList:!0,subtree:!0}),o}function Xc(n,t,e){const i=n.canvas,o=new MutationObserver(s=>{let a=!1;for(const r of s)a=a||Ii(r.removedNodes,i),a=a&&!Ii(r.addedNodes,i);a&&e()});return o.observe(document,{childList:!0,subtree:!0}),o}const Hn=new Map;let Ds=0;function Xa(){const n=window.devicePixelRatio;n!==Ds&&(Ds=n,Hn.forEach((t,e)=>{e.currentDevicePixelRatio!==n&&t()}))}function Kc(n,t){Hn.size||window.addEventListener("resize",Xa),Hn.set(n,t)}function Jc(n){Hn.delete(n),Hn.size||window.removeEventListener("resize",Xa)}function Zc(n,t,e){const i=n.canvas,o=i&&Vo(i);if(!o)return;const s=Ca((r,l)=>{const c=o.clientWidth;e(r,l),c<o.clientWidth&&e()},window),a=new ResizeObserver(r=>{const l=r[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||s(c,d)});return a.observe(o),Kc(n,s),a}function Zi(n,t,e){e&&e.disconnect(),t==="resize"&&Jc(n)}function Qc(n,t,e){const i=n.canvas,o=Ca(s=>{n.ctx!==null&&e($c(s,n))},n);return Yc(i,t,o),o}class td extends $a{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(Wc(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e[mi])return!1;const i=e[mi].initial;["height","width"].forEach(s=>{const a=i[s];Mt(a)?e.removeAttribute(s):e.setAttribute(s,a)});const o=i.style||{};return Object.keys(o).forEach(s=>{e.style[s]=o[s]}),e.width=e.width,delete e[mi],!0}addEventListener(t,e,i){this.removeEventListener(t,e);const o=t.$proxies||(t.$proxies={}),a={attach:Gc,detach:Xc,resize:Zc}[e]||Qc;o[e]=a(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),o=i[e];if(!o)return;({attach:Zi,detach:Zi,resize:Zi}[e]||qc)(t,e,o),i[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,o){return Wl(t,e,i,o)}isAttached(t){const e=t&&Vo(t);return!!(e&&e.isConnected)}}function ed(n){return!Ro()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?Hc:td}class xe{constructor(){ht(this,"x");ht(this,"y");ht(this,"active",!1);ht(this,"options");ht(this,"$animations")}tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return pn(this.x)&&pn(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const o={};return t.forEach(s=>{o[s]=i[s]&&i[s].active()?i[s]._to:this[s]}),o}}ht(xe,"defaults",{}),ht(xe,"defaultRoutes");function nd(n,t){const e=n.options.ticks,i=id(n),o=Math.min(e.maxTicksLimit||i,i),s=e.major.enabled?sd(t):[],a=s.length,r=s[0],l=s[a-1],c=[];if(a>o)return ad(t,c,s,a/o),c;const d=od(s,t,o);if(a>0){let u,f;const h=a>1?Math.round((l-r)/(a-1)):null;for(ei(t,c,d,Mt(h)?0:r-h,r),u=0,f=a-1;u<f;u++)ei(t,c,d,s[u],s[u+1]);return ei(t,c,d,l,Mt(h)?t.length:l+h),c}return ei(t,c,d),c}function id(n){const t=n.options.offset,e=n._tickSize(),i=n._length/e+(t?0:1),o=n._maxLength/e;return Math.floor(Math.min(i,o))}function od(n,t,e){const i=rd(n),o=t.length/e;if(!i)return Math.max(o,1);const s=$r(i);for(let a=0,r=s.length-1;a<r;a++){const l=s[a];if(l>o)return l}return Math.max(o,1)}function sd(n){const t=[];let e,i;for(e=0,i=n.length;e<i;e++)n[e].major&&t.push(e);return t}function ad(n,t,e,i){let o=0,s=e[0],a;for(i=Math.ceil(i),a=0;a<n.length;a++)a===s&&(t.push(n[a]),o++,s=e[o*i])}function ei(n,t,e,i,o){const s=Dt(i,0),a=Math.min(Dt(o,n.length),n.length);let r=0,l,c,d;for(e=Math.ceil(e),o&&(l=o-i,e=l/Math.floor(l/e)),d=s;d<0;)r++,d=Math.round(s+r*e);for(c=Math.max(s,0);c<a;c++)c===d&&(t.push(n[c]),r++,d=Math.round(s+r*e))}function rd(n){const t=n.length;let e,i;if(t<2)return!1;for(i=n[0],e=1;e<t;++e)if(n[e]-n[e-1]!==i)return!1;return i}const ld=n=>n==="left"?"right":n==="right"?"left":n,ks=(n,t,e)=>t==="top"||t==="left"?n[t]+e:n[t]-e,Is=(n,t)=>Math.min(t||n,n);function Ms(n,t){const e=[],i=n.length/t,o=n.length;let s=0;for(;s<o;s+=i)e.push(n[Math.floor(s)]);return e}function cd(n,t,e){const i=n.ticks.length,o=Math.min(t,i-1),s=n._startPixel,a=n._endPixel,r=1e-6;let l=n.getPixelForTick(o),c;if(!(e&&(i===1?c=Math.max(l-s,a-l):t===0?c=(n.getPixelForTick(1)-l)/2:c=(l-n.getPixelForTick(o-1))/2,l+=o<t?c:-c,l<s-r||l>a+r)))return l}function dd(n,t){Ot(n,e=>{const i=e.gc,o=i.length/2;let s;if(o>t){for(s=0;s<o;++s)delete e.data[i[s]];i.splice(0,o)}})}function Sn(n){return n.drawTicks?n.tickLength:0}function Es(n,t){if(!n.display)return 0;const e=Zt(n.font,t),i=le(n.padding);return(Ut(n.text)?n.text.length:1)*e.lineHeight+i.height}function ud(n,t){return Ge(n,{scale:t,type:"scale"})}function fd(n,t,e){return Ge(n,{tick:e,index:t,type:"tick"})}function hd(n,t,e){let i=Ao(n);return(e&&t!=="right"||!e&&t==="right")&&(i=ld(i)),i}function pd(n,t,e,i){const{top:o,left:s,bottom:a,right:r,chart:l}=n,{chartArea:c,scales:d}=l;let u=0,f,h,w;const x=a-o,S=r-s;if(n.isHorizontal()){if(h=se(i,s,r),Tt(e)){const O=Object.keys(e)[0],N=e[O];w=d[O].getPixelForValue(N)+x-t}else e==="center"?w=(c.bottom+c.top)/2+x-t:w=ks(n,e,t);f=r-s}else{if(Tt(e)){const O=Object.keys(e)[0],N=e[O];h=d[O].getPixelForValue(N)-S+t}else e==="center"?h=(c.left+c.right)/2-S+t:h=ks(n,e,t);w=se(i,a,o),u=e==="left"?-Gt:Gt}return{titleX:h,titleY:w,maxWidth:f,rotation:u}}class dn extends xe{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:o}=this;return t=ge(t,Number.POSITIVE_INFINITY),e=ge(e,Number.NEGATIVE_INFINITY),i=ge(i,Number.POSITIVE_INFINITY),o=ge(o,Number.NEGATIVE_INFINITY),{min:ge(t,i),max:ge(e,o),minDefined:qt(t),maxDefined:qt(e)}}getMinMax(t){let{min:e,max:i,minDefined:o,maxDefined:s}=this.getUserBounds(),a;if(o&&s)return{min:e,max:i};const r=this.getMatchingVisibleMetas();for(let l=0,c=r.length;l<c;++l)a=r[l].controller.getMinMax(this,t),o||(e=Math.min(e,a.min)),s||(i=Math.max(i,a.max));return e=s&&e>i?i:e,i=o&&e>i?e:i,{min:ge(e,ge(i,e)),max:ge(i,ge(e,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Nt(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:o,grace:s,ticks:a}=this.options,r=a.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=xl(this,s,o),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=r<this.ticks.length;this._convertTicksToLabels(l?Ms(this.ticks,r):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),a.display&&(a.autoSkip||a.source==="auto")&&(this.ticks=nd(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,i;this.isHorizontal()?(e=this.left,i=this.right):(e=this.top,i=this.bottom,t=!t),this._startPixel=e,this._endPixel=i,this._reversePixels=t,this._length=i-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Nt(this.options.afterUpdate,[this])}beforeSetDimensions(){Nt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Nt(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),Nt(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Nt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,o,s;for(i=0,o=t.length;i<o;i++)s=t[i],s.label=Nt(e.callback,[s.value,i,t],this)}afterTickToLabelConversion(){Nt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Nt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=Is(this.ticks.length,t.ticks.maxTicksLimit),o=e.minRotation||0,s=e.maxRotation;let a=o,r,l,c;if(!this._isVisible()||!e.display||o>=s||i<=1||!this.isHorizontal()){this.labelRotation=o;return}const d=this._getLabelSizes(),u=d.widest.width,f=d.highest.height,h=te(this.chart.width-u,0,this.maxWidth);r=t.offset?this.maxWidth/i:h/(i-1),u+6>r&&(r=h/(i-(t.offset?.5:1)),l=this.maxHeight-Sn(t.grid)-e.padding-Es(t.title,this.chart.options.font),c=Math.sqrt(u*u+f*f),a=To(Math.min(Math.asin(te((d.highest.height+6)/r,-1,1)),Math.asin(te(l/c,-1,1))-Math.asin(te(f/c,-1,1)))),a=Math.max(o,Math.min(s,a))),this.labelRotation=a}afterCalculateLabelRotation(){Nt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Nt(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:o,grid:s}}=this,a=this._isVisible(),r=this.isHorizontal();if(a){const l=Es(o,e.options.font);if(r?(t.width=this.maxWidth,t.height=Sn(s)+l):(t.height=this.maxHeight,t.width=Sn(s)+l),i.display&&this.ticks.length){const{first:c,last:d,widest:u,highest:f}=this._getLabelSizes(),h=i.padding*2,w=we(this.labelRotation),x=Math.cos(w),S=Math.sin(w);if(r){const O=i.mirror?0:S*u.width+x*f.height;t.height=Math.min(this.maxHeight,t.height+O+h)}else{const O=i.mirror?0:x*u.width+S*f.height;t.width=Math.min(this.maxWidth,t.width+O+h)}this._calculatePadding(c,d,S,x)}}this._handleMargins(),r?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,o){const{ticks:{align:s,padding:a},position:r}=this.options,l=this.labelRotation!==0,c=r!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let f=0,h=0;l?c?(f=o*t.width,h=i*e.height):(f=i*t.height,h=o*e.width):s==="start"?h=e.width:s==="end"?f=t.width:s!=="inner"&&(f=t.width/2,h=e.width/2),this.paddingLeft=Math.max((f-d+a)*this.width/(this.width-d),0),this.paddingRight=Math.max((h-u+a)*this.width/(this.width-u),0)}else{let d=e.height/2,u=t.height/2;s==="start"?(d=0,u=t.height):s==="end"&&(d=e.height,u=0),this.paddingTop=d+a,this.paddingBottom=u+a}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Nt(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,i;for(e=0,i=t.length;e<i;e++)Mt(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=Ms(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,i){const{ctx:o,_longestTextCache:s}=this,a=[],r=[],l=Math.floor(e/Is(e,i));let c=0,d=0,u,f,h,w,x,S,O,N,J,ot,y;for(u=0;u<e;u+=l){if(w=t[u].label,x=this._resolveTickFontOptions(u),o.font=S=x.string,O=s[S]=s[S]||{data:{},gc:[]},N=x.lineHeight,J=ot=0,!Mt(w)&&!Ut(w))J=Di(o,O.data,O.gc,J,w),ot=N;else if(Ut(w))for(f=0,h=w.length;f<h;++f)y=w[f],!Mt(y)&&!Ut(y)&&(J=Di(o,O.data,O.gc,J,y),ot+=N);a.push(J),r.push(ot),c=Math.max(J,c),d=Math.max(ot,d)}dd(s,e);const I=a.indexOf(c),R=r.indexOf(d),P=W=>({width:a[W]||0,height:r[W]||0});return{first:P(0),last:P(e-1),widest:P(I),highest:P(R),widths:a,heights:r}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Jr(this._alignToPixels?Ze(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=fd(this.getContext(),t,i))}return this.$context||(this.$context=ud(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=we(this.labelRotation),i=Math.abs(Math.cos(e)),o=Math.abs(Math.sin(e)),s=this._getLabelSizes(),a=t.autoSkipPadding||0,r=s?s.widest.width+a:0,l=s?s.highest.height+a:0;return this.isHorizontal()?l*i>r*o?r/i:l/o:l*o<r*i?l/i:r/o}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,o=this.options,{grid:s,position:a,border:r}=o,l=s.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),f=Sn(s),h=[],w=r.setContext(this.getContext()),x=w.display?w.width:0,S=x/2,O=function(at){return Ze(i,at,x)};let N,J,ot,y,I,R,P,W,X,V,G,rt;if(a==="top")N=O(this.bottom),R=this.bottom-f,W=N-S,V=O(t.top)+S,rt=t.bottom;else if(a==="bottom")N=O(this.top),V=t.top,rt=O(t.bottom)-S,R=N+S,W=this.top+f;else if(a==="left")N=O(this.right),I=this.right-f,P=N-S,X=O(t.left)+S,G=t.right;else if(a==="right")N=O(this.left),X=t.left,G=O(t.right)-S,I=N+S,P=this.left+f;else if(e==="x"){if(a==="center")N=O((t.top+t.bottom)/2+.5);else if(Tt(a)){const at=Object.keys(a)[0],C=a[at];N=O(this.chart.scales[at].getPixelForValue(C))}V=t.top,rt=t.bottom,R=N+S,W=R+f}else if(e==="y"){if(a==="center")N=O((t.left+t.right)/2);else if(Tt(a)){const at=Object.keys(a)[0],C=a[at];N=O(this.chart.scales[at].getPixelForValue(C))}I=N-S,P=I-f,X=t.left,G=t.right}const $=Dt(o.ticks.maxTicksLimit,u),tt=Math.max(1,Math.ceil(u/$));for(J=0;J<u;J+=tt){const at=this.getContext(J),C=s.setContext(at),E=r.setContext(at),k=C.lineWidth,U=C.color,H=E.dash||[],j=E.dashOffset,q=C.tickWidth,et=C.tickColor,Y=C.tickBorderDash||[],lt=C.tickBorderDashOffset;ot=cd(this,J,l),ot!==void 0&&(y=Ze(i,ot,k),c?I=P=X=G=y:R=W=V=rt=y,h.push({tx1:I,ty1:R,tx2:P,ty2:W,x1:X,y1:V,x2:G,y2:rt,width:k,color:U,borderDash:H,borderDashOffset:j,tickWidth:q,tickColor:et,tickBorderDash:Y,tickBorderDashOffset:lt}))}return this._ticksLength=u,this._borderValue=N,h}_computeLabelItems(t){const e=this.axis,i=this.options,{position:o,ticks:s}=i,a=this.isHorizontal(),r=this.ticks,{align:l,crossAlign:c,padding:d,mirror:u}=s,f=Sn(i.grid),h=f+d,w=u?-d:h,x=-we(this.labelRotation),S=[];let O,N,J,ot,y,I,R,P,W,X,V,G,rt="middle";if(o==="top")I=this.bottom-w,R=this._getXAxisLabelAlignment();else if(o==="bottom")I=this.top+w,R=this._getXAxisLabelAlignment();else if(o==="left"){const tt=this._getYAxisLabelAlignment(f);R=tt.textAlign,y=tt.x}else if(o==="right"){const tt=this._getYAxisLabelAlignment(f);R=tt.textAlign,y=tt.x}else if(e==="x"){if(o==="center")I=(t.top+t.bottom)/2+h;else if(Tt(o)){const tt=Object.keys(o)[0],at=o[tt];I=this.chart.scales[tt].getPixelForValue(at)+h}R=this._getXAxisLabelAlignment()}else if(e==="y"){if(o==="center")y=(t.left+t.right)/2-h;else if(Tt(o)){const tt=Object.keys(o)[0],at=o[tt];y=this.chart.scales[tt].getPixelForValue(at)}R=this._getYAxisLabelAlignment(f).textAlign}e==="y"&&(l==="start"?rt="top":l==="end"&&(rt="bottom"));const $=this._getLabelSizes();for(O=0,N=r.length;O<N;++O){J=r[O],ot=J.label;const tt=s.setContext(this.getContext(O));P=this.getPixelForTick(O)+s.labelOffset,W=this._resolveTickFontOptions(O),X=W.lineHeight,V=Ut(ot)?ot.length:1;const at=V/2,C=tt.color,E=tt.textStrokeColor,k=tt.textStrokeWidth;let U=R;a?(y=P,R==="inner"&&(O===N-1?U=this.options.reverse?"left":"right":O===0?U=this.options.reverse?"right":"left":U="center"),o==="top"?c==="near"||x!==0?G=-V*X+X/2:c==="center"?G=-$.highest.height/2-at*X+X:G=-$.highest.height+X/2:c==="near"||x!==0?G=X/2:c==="center"?G=$.highest.height/2-at*X:G=$.highest.height-V*X,u&&(G*=-1),x!==0&&!tt.showLabelBackdrop&&(y+=X/2*Math.sin(x))):(I=P,G=(1-V)*X/2);let H;if(tt.showLabelBackdrop){const j=le(tt.backdropPadding),q=$.heights[O],et=$.widths[O];let Y=G-j.top,lt=0-j.left;switch(rt){case"middle":Y-=q/2;break;case"bottom":Y-=q;break}switch(R){case"center":lt-=et/2;break;case"right":lt-=et;break;case"inner":O===N-1?lt-=et:O>0&&(lt-=et/2);break}H={left:lt,top:Y,width:et+j.width,height:q+j.height,color:tt.backdropColor}}S.push({label:ot,font:W,textOffset:G,options:{rotation:x,color:C,strokeColor:E,strokeWidth:k,textAlign:U,textBaseline:rt,translation:[y,I],backdrop:H}})}return S}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-we(this.labelRotation))return t==="top"?"left":"right";let o="center";return e.align==="start"?o="left":e.align==="end"?o="right":e.align==="inner"&&(o="inner"),o}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:o,padding:s}}=this.options,a=this._getLabelSizes(),r=t+s,l=a.widest.width;let c,d;return e==="left"?o?(d=this.right+s,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-r,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d=this.left)):e==="right"?o?(d=this.left+s,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+r,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:o,width:s,height:a}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,o,s,a),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const o=this.ticks.findIndex(s=>s.value===t);return o>=0?e.setContext(this.getContext(o)).lineWidth:0}drawGrid(t){const e=this.options.grid,i=this.ctx,o=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let s,a;const r=(l,c,d)=>{!d.width||!d.color||(i.save(),i.lineWidth=d.width,i.strokeStyle=d.color,i.setLineDash(d.borderDash||[]),i.lineDashOffset=d.borderDashOffset,i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(c.x,c.y),i.stroke(),i.restore())};if(e.display)for(s=0,a=o.length;s<a;++s){const l=o[s];e.drawOnChartArea&&r({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),e.drawTicks&&r({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:i,grid:o}}=this,s=i.setContext(this.getContext()),a=i.display?s.width:0;if(!a)return;const r=o.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,u,f;this.isHorizontal()?(c=Ze(t,this.left,a)-a/2,d=Ze(t,this.right,r)+r/2,u=f=l):(u=Ze(t,this.top,a)-a/2,f=Ze(t,this.bottom,r)+r/2,c=d=l),e.save(),e.lineWidth=s.width,e.strokeStyle=s.color,e.beginPath(),e.moveTo(c,u),e.lineTo(d,f),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,o=this._computeLabelArea();o&&Li(i,o);const s=this.getLabelItems(t);for(const a of s){const r=a.options,l=a.font,c=a.label,d=a.textOffset;cn(i,c,0,d,l,r)}o&&Oi(i)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:o}}=this;if(!i.display)return;const s=Zt(i.font),a=le(i.padding),r=i.align;let l=s.lineHeight/2;e==="bottom"||e==="center"||Tt(e)?(l+=a.bottom,Ut(i.text)&&(l+=s.lineHeight*(i.text.length-1))):l+=a.top;const{titleX:c,titleY:d,maxWidth:u,rotation:f}=pd(this,l,e,r);cn(t,i.text,0,0,s,{color:i.color,maxWidth:u,rotation:f,textAlign:hd(r,e,o),textBaseline:"middle",translation:[c,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=Dt(t.grid&&t.grid.z,-1),o=Dt(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==dn.prototype.draw?[{z:e,draw:s=>{this.draw(s)}}]:[{z:i,draw:s=>{this.drawBackground(),this.drawGrid(s),this.drawTitle()}},{z:o,draw:()=>{this.drawBorder()}},{z:e,draw:s=>{this.drawLabels(s)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",o=[];let s,a;for(s=0,a=e.length;s<a;++s){const r=e[s];r[i]===this.id&&(!t||r.type===t)&&o.push(r)}return o}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return Zt(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class ni{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;vd(e)&&(i=this.register(e));const o=this.items,s=t.id,a=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+t);return s in o||(o[s]=t,md(t,a,i),this.override&&Ht.override(t.id,t.overrides)),a}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,o=this.scope;i in e&&delete e[i],o&&i in Ht[o]&&(delete Ht[o][i],this.override&&delete ln[i])}}function md(n,t,e){const i=Rn(Object.create(null),[e?Ht.get(e):{},Ht.get(t),n.defaults]);Ht.set(t,i),n.defaultRoutes&&gd(t,n.defaultRoutes),n.descriptors&&Ht.describe(t,n.descriptors)}function gd(n,t){Object.keys(t).forEach(e=>{const i=e.split("."),o=i.pop(),s=[n].concat(i).join("."),a=t[e].split("."),r=a.pop(),l=a.join(".");Ht.route(s,o,l,r)})}function vd(n){return"id"in n&&"defaults"in n}class bd{constructor(){this.controllers=new ni(_e,"datasets",!0),this.elements=new ni(xe,"elements"),this.plugins=new ni(Object,"plugins"),this.scales=new ni(dn,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach(o=>{const s=i||this._getRegistryForType(o);i||s.isForType(o)||s===this.plugins&&o.id?this._exec(t,s,o):Ot(o,a=>{const r=i||this._getRegistryForType(a);this._exec(t,r,a)})})}_exec(t,e,i){const o=Eo(t);Nt(i["before"+o],[],i),e[t](i),Nt(i["after"+o],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const o=e.get(t);if(o===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return o}}var De=new bd;class yd{constructor(){this._init=[]}notify(t,e,i,o){e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const s=o?this._descriptors(t).filter(o):this._descriptors(t),a=this._notify(s,t,e,i);return e==="afterDestroy"&&(this._notify(s,t,"stop"),this._notify(this._init,t,"uninstall")),a}_notify(t,e,i,o){o=o||{};for(const s of t){const a=s.plugin,r=a[i],l=[e,o,s.options];if(Nt(r,l,a)===!1&&o.cancelable)return!1}return!0}invalidate(){Mt(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,o=Dt(i.options&&i.options.plugins,{}),s=wd(i);return o===!1&&!e?[]:xd(t,s,o,e)}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,o=(s,a)=>s.filter(r=>!a.some(l=>r.plugin.id===l.plugin.id));this._notify(o(e,i),t,"stop"),this._notify(o(i,e),t,"start")}}function wd(n){const t={},e=[],i=Object.keys(De.plugins.items);for(let s=0;s<i.length;s++)e.push(De.getPlugin(i[s]));const o=n.plugins||[];for(let s=0;s<o.length;s++){const a=o[s];e.indexOf(a)===-1&&(e.push(a),t[a.id]=!0)}return{plugins:e,localIds:t}}function _d(n,t){return!t&&n===!1?null:n===!0?{}:n}function xd(n,{plugins:t,localIds:e},i,o){const s=[],a=n.getContext();for(const r of t){const l=r.id,c=_d(i[l],o);c!==null&&s.push({plugin:r,options:Sd(n.config,{plugin:r,local:e[l]},c,a)})}return s}function Sd(n,{plugin:t,local:e},i,o){const s=n.pluginScopeKeys(t),a=n.getOptionScopes(i,s);return e&&t.defaults&&a.push(t.defaults),n.createResolver(a,o,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function po(n,t){const e=Ht.datasets[n]||{};return((t.datasets||{})[n]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function Cd(n,t){let e=n;return n==="_index_"?e=t:n==="_value_"&&(e=t==="x"?"y":"x"),e}function Dd(n,t){return n===t?"_index_":"_value_"}function Ts(n){if(n==="x"||n==="y"||n==="r")return n}function kd(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function mo(n,...t){if(Ts(n))return n;for(const e of t){const i=e.axis||kd(e.position)||n.length>1&&Ts(n[0].toLowerCase());if(i)return i}throw new Error("Cannot determine type of '".concat(n,"' axis. Please provide 'axis' or 'position' option."))}function Ps(n,t,e){if(e[t+"AxisID"]===n)return{axis:t}}function Id(n,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(i=>i.xAxisID===n||i.yAxisID===n);if(e.length)return Ps(n,"x",e[0])||Ps(n,"y",e[0])}return{}}function Md(n,t){const e=ln[n.type]||{scales:{}},i=t.scales||{},o=po(n.type,t),s=Object.create(null);return Object.keys(i).forEach(a=>{const r=i[a];if(!Tt(r))return console.error("Invalid scale configuration for scale: ".concat(a));if(r._proxy)return console.warn("Ignoring resolver passed as options for scale: ".concat(a));const l=mo(a,r,Id(a,n),Ht.scales[r.type]),c=Dd(l,o),d=e.scales||{};s[a]=Pn(Object.create(null),[{axis:l},r,d[l],d[c]])}),n.data.datasets.forEach(a=>{const r=a.type||n.type,l=a.indexAxis||po(r,t),d=(ln[r]||{}).scales||{};Object.keys(d).forEach(u=>{const f=Cd(u,l),h=a[f+"AxisID"]||f;s[h]=s[h]||Object.create(null),Pn(s[h],[{axis:f},i[h],d[u]])})}),Object.keys(s).forEach(a=>{const r=s[a];Pn(r,[Ht.scales[r.type],Ht.scale])}),s}function Ka(n){const t=n.options||(n.options={});t.plugins=Dt(t.plugins,{}),t.scales=Md(n,t)}function Ja(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function Ed(n){return n=n||{},n.data=Ja(n.data),Ka(n),n}const As=new Map,Za=new Set;function ii(n,t){let e=As.get(n);return e||(e=t(),As.set(n,e),Za.add(e)),e}const Cn=(n,t,e)=>{const i=qe(t,e);i!==void 0&&n.add(i)};class Td{constructor(t){this._config=Ed(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Ja(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),Ka(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return ii(t,()=>[["datasets.".concat(t),""]])}datasetAnimationScopeKeys(t,e){return ii("".concat(t,".transition.").concat(e),()=>[["datasets.".concat(t,".transitions.").concat(e),"transitions.".concat(e)],["datasets.".concat(t),""]])}datasetElementScopeKeys(t,e){return ii("".concat(t,"-").concat(e),()=>[["datasets.".concat(t,".elements.").concat(e),"datasets.".concat(t),"elements.".concat(e),""]])}pluginScopeKeys(t){const e=t.id,i=this.type;return ii("".concat(i,"-plugin-").concat(e),()=>[["plugins.".concat(e),...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const i=this._scopeCache;let o=i.get(t);return(!o||e)&&(o=new Map,i.set(t,o)),o}getOptionScopes(t,e,i){const{options:o,type:s}=this,a=this._cachedScopes(t,i),r=a.get(e);if(r)return r;const l=new Set;e.forEach(d=>{t&&(l.add(t),d.forEach(u=>Cn(l,t,u))),d.forEach(u=>Cn(l,o,u)),d.forEach(u=>Cn(l,ln[s]||{},u)),d.forEach(u=>Cn(l,Ht,u)),d.forEach(u=>Cn(l,uo,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),Za.has(e)&&a.set(e,c),c}chartOptionScopes(){const{options:t,type:e}=this;return[t,ln[e]||{},Ht.datasets[e]||{},{type:e},Ht,uo]}resolveNamedOptions(t,e,i,o=[""]){const s={$shared:!0},{resolver:a,subPrefixes:r}=Bs(this._resolverCache,t,o);let l=a;if(Ad(a,e)){s.$shared=!1,i=$e(i)?i():i;const c=this.createResolver(t,i,r);l=mn(a,i,c)}for(const c of e)s[c]=l[c];return s}createResolver(t,e,i=[""],o){const{resolver:s}=Bs(this._resolverCache,t,i);return Tt(e)?mn(s,e,void 0,o):s}}function Bs(n,t,e){let i=n.get(t);i||(i=new Map,n.set(t,i));const o=e.join();let s=i.get(o);return s||(s={resolver:Oo(t,e),subPrefixes:e.filter(r=>!r.toLowerCase().includes("hover"))},i.set(o,s)),s}const Pd=n=>Tt(n)&&Object.getOwnPropertyNames(n).some(t=>$e(n[t]));function Ad(n,t){const{isScriptable:e,isIndexable:i}=Ta(n);for(const o of t){const s=e(o),a=i(o),r=(a||s)&&n[o];if(s&&($e(r)||Pd(r))||a&&Ut(r))return!0}return!1}var Bd="4.5.0";const Ld=["top","bottom","left","right","chartArea"];function Ls(n,t){return n==="top"||n==="bottom"||Ld.indexOf(n)===-1&&t==="x"}function Os(n,t){return function(e,i){return e[n]===i[n]?e[t]-i[t]:e[n]-i[n]}}function Fs(n){const t=n.chart,e=t.options.animation;t.notifyPlugins("afterRender"),Nt(e&&e.onComplete,[n],t)}function Od(n){const t=n.chart,e=t.options.animation;Nt(e&&e.onProgress,[n],t)}function Qa(n){return Ro()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const gi={},Ns=n=>{const t=Qa(n);return Object.values(gi).filter(e=>e.canvas===t).pop()};function Fd(n,t,e){const i=Object.keys(n);for(const o of i){const s=+o;if(s>=t){const a=n[o];delete n[o],(e>0||s>t)&&(n[s+e]=a)}}}function Nd(n,t,e,i){return!e||n.type==="mouseout"?null:i?t:n}var Ve;let Le=(Ve=class{static register(...t){De.add(...t),Rs()}static unregister(...t){De.remove(...t),Rs()}constructor(t,e){const i=this.config=new Td(e),o=Qa(t),s=Ns(o);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas with ID '"+s.canvas.id+"' can be reused.");const a=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||ed(o)),this.platform.updateConfig(i);const r=this.platform.acquireContext(o,a.aspectRatio),l=r&&r.canvas,c=l&&l.height,d=l&&l.width;if(this.id=Rr(),this.ctx=r,this.canvas=l,this.width=d,this.height=c,this._options=a,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new yd,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=el(u=>this.update(u),a.resizeDelay||0),this._dataChanges=[],gi[this.id]=this,!r||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Pe.listen(this,"complete",Fs),Pe.listen(this,"progress",Od),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:o,_aspectRatio:s}=this;return Mt(t)?e&&s?s:o?i/o:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return De}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():as(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return is(this.canvas,this.ctx),this}stop(){return Pe.stop(this),this}resize(t,e){Pe.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,o=this.canvas,s=i.maintainAspectRatio&&this.aspectRatio,a=this.platform.getMaximumSize(o,t,e,s),r=i.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=a.width,this.height=a.height,this._aspectRatio=this.aspectRatio,as(this,r,!0)&&(this.notifyPlugins("resize",{size:a}),Nt(i.onResize,[this,a],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};Ot(e,(i,o)=>{i.id=o})}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,o=Object.keys(i).reduce((a,r)=>(a[r]=!1,a),{});let s=[];e&&(s=s.concat(Object.keys(e).map(a=>{const r=e[a],l=mo(a,r),c=l==="r",d=l==="x";return{options:r,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),Ot(s,a=>{const r=a.options,l=r.id,c=mo(l,r),d=Dt(r.type,a.dtype);(r.position===void 0||Ls(r.position,c)!==Ls(a.dposition))&&(r.position=a.dposition),o[l]=!0;let u=null;if(l in i&&i[l].type===d)u=i[l];else{const f=De.getScale(d);u=new f({id:l,type:d,ctx:this.ctx,chart:this}),i[u.id]=u}u.init(r,t)}),Ot(o,(a,r)=>{a||delete i[r]}),Ot(i,a=>{re.configure(this,a,a.options),re.addBox(this,a)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort((o,s)=>o.index-s.index),i>e){for(let o=e;o<i;++o)this._destroyDatasetMeta(o);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(Os("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((i,o)=>{e.filter(s=>s===i._dataset).length===0&&this._destroyDatasetMeta(o)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,o;for(this._removeUnreferencedMetasets(),i=0,o=e.length;i<o;i++){const s=e[i];let a=this.getDatasetMeta(i);const r=s.type||this.config.type;if(a.type&&a.type!==r&&(this._destroyDatasetMeta(i),a=this.getDatasetMeta(i)),a.type=r,a.indexAxis=s.indexAxis||po(r,this.options),a.order=s.order||0,a.index=i,a.label=""+s.label,a.visible=this.isDatasetVisible(i),a.controller)a.controller.updateIndex(i),a.controller.linkScales();else{const l=De.getController(r),{datasetElementType:c,dataElementType:d}=Ht.datasets[r];Object.assign(l,{dataElementType:De.getElement(d),datasetElementType:c&&De.getElement(c)}),a.controller=new l(this,i),t.push(a.controller)}}return this._updateMetasets(),t}_resetElements(){Ot(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),o=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let a=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:u}=this.getDatasetMeta(c),f=!o&&s.indexOf(u)===-1;u.buildOrUpdateElements(f),a=Math.max(+u.getMaxOverflow(),a)}a=this._minPadding=i.layout.autoPadding?a:0,this._updateLayout(a),o||Ot(s,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(Os("z","_idx"));const{_active:r,_lastEvent:l}=this;l?this._eventHandler(l,!0):r.length&&this._updateHoverStyles(r,r,!0),this.render()}_updateScales(){Ot(this.scales,t=>{re.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!Go(e,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:o,count:s}of e){const a=i==="_removeElements"?-s:s;Fd(t,o,a)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=s=>new Set(t.filter(a=>a[0]===s).map((a,r)=>r+","+a.splice(1).join(","))),o=i(0);for(let s=1;s<e;s++)if(!Go(o,i(s)))return;return Array.from(o).map(s=>s.split(",")).map(s=>({method:s[1],start:+s[2],count:+s[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;re.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],Ot(this.boxes,o=>{i&&o.position==="chartArea"||(o.configure&&o.configure(),this._layers.push(...o._layers()))},this),this._layers.forEach((o,s)=>{o._idx=s}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,i=this.data.datasets.length;e<i;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,$e(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),o={meta:i,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",o)!==!1&&(i.controller._update(e),o.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",o))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Pe.has(this)?this.attached&&!Pe.running(this)&&Pe.start(this):(this.draw(),Fs({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:o}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,o)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let o,s;for(o=0,s=e.length;o<s;++o){const a=e[o];(!t||a.visible)&&i.push(a)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i={meta:t,index:t.index,cancelable:!0},o=Ua(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(o&&Li(e,o),t.controller.draw(),o&&Oi(e),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return Ne(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,o){const s=Lc.modes[e];return typeof s=="function"?s(this,t,i,o):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let o=i.filter(s=>s&&s._dataset===e).pop();return o||(o={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(o)),o}getContext(){return this.$context||(this.$context=Ge(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!e.hidden}setDatasetVisibility(t,e){const i=this.getDatasetMeta(t);i.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const o=i?"show":"hide",s=this.getDatasetMeta(t),a=s.controller._resolveAnimations(void 0,o);Vn(e)?(s.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),a.update(s,{visible:i}),this.update(r=>r.datasetIndex===t?o:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),Pe.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),is(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete gi[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(s,a)=>{e.addEventListener(this,s,a),t[s]=a},o=(s,a,r)=>{s.offsetX=a,s.offsetY=r,this._eventHandler(s)};Ot(this.options.events,s=>i(s,o))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(l,c)=>{e.addEventListener(this,l,c),t[l]=c},o=(l,c)=>{t[l]&&(e.removeEventListener(this,l,c),delete t[l])},s=(l,c)=>{this.canvas&&this.resize(l,c)};let a;const r=()=>{o("attach",r),this.attached=!0,this.resize(),i("resize",s),i("detach",a)};a=()=>{this.attached=!1,o("resize",s),this._stop(),this._resize(0,0),i("attach",r)},e.isAttached(this.canvas)?r():a()}unbindEvents(){Ot(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},Ot(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const o=i?"set":"remove";let s,a,r,l;for(e==="dataset"&&(s=this.getDatasetMeta(t[0].datasetIndex),s.controller["_"+o+"DatasetHoverStyle"]()),r=0,l=t.length;r<l;++r){a=t[r];const c=a&&this.getDatasetMeta(a.datasetIndex).controller;c&&c[o+"HoverStyle"](a.element,a.datasetIndex,a.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map(({datasetIndex:s,index:a})=>{const r=this.getDatasetMeta(s);if(!r)throw new Error("No dataset found at index "+s);return{datasetIndex:s,element:r.data[a],index:a}});!xi(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,i){const o=this.options.hover,s=(l,c)=>l.filter(d=>!c.some(u=>d.datasetIndex===u.datasetIndex&&d.index===u.index)),a=s(e,t),r=i?t:s(t,e);a.length&&this.updateHoverStyle(a,o.mode,!1),r.length&&o.mode&&this.updateHoverStyle(r,o.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},o=a=>(a.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,o)===!1)return;const s=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,o),(s||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:o=[],options:s}=this,a=e,r=this._getActiveElements(t,o,i,a),l=Wr(t),c=Nd(t,this._lastEvent,i,l);i&&(this._lastEvent=null,Nt(s.onHover,[t,r,this],this),l&&Nt(s.onClick,[t,r,this],this));const d=!xi(r,o);return(d||e)&&(this._active=r,this._updateHoverStyles(r,o,e)),this._lastEvent=c,d}_getActiveElements(t,e,i,o){if(t.type==="mouseout")return[];if(!i)return e;const s=this.options.hover;return this.getElementsAtEventForMode(t,s.mode,s,o)}},ht(Ve,"defaults",Ht),ht(Ve,"instances",gi),ht(Ve,"overrides",ln),ht(Ve,"registry",De),ht(Ve,"version",Bd),ht(Ve,"getChart",Ns),Ve);function Rs(){return Ot(Le.instances,n=>n._plugins.invalidate())}function Rd(n,t,e){const{startAngle:i,x:o,y:s,outerRadius:a,innerRadius:r,options:l}=t,{borderWidth:c,borderJoinStyle:d}=l,u=Math.min(c/a,ae(i-e));if(n.beginPath(),n.arc(o,s,a-c/2,i+u/2,e-u/2),r>0){const f=Math.min(c/r,ae(i-e));n.arc(o,s,r+c/2,e-f/2,i+f/2,!0)}else{const f=Math.min(c/2,a*ae(i-e));if(d==="round")n.arc(o,s,f,e-Bt/2,i+Bt/2,!0);else if(d==="bevel"){const h=2*f*f,w=-h*Math.cos(e+Bt/2)+o,x=-h*Math.sin(e+Bt/2)+s,S=h*Math.cos(i+Bt/2)+o,O=h*Math.sin(i+Bt/2)+s;n.lineTo(w,x),n.lineTo(S,O)}}n.closePath(),n.moveTo(0,0),n.rect(0,0,n.canvas.width,n.canvas.height),n.clip("evenodd")}function Vd(n,t,e){const{startAngle:i,pixelMargin:o,x:s,y:a,outerRadius:r,innerRadius:l}=t;let c=o/r;n.beginPath(),n.arc(s,a,r,i-c,e+c),l>o?(c=o/l,n.arc(s,a,l,e+c,i-c,!0)):n.arc(s,a,o,e+Gt,i-Gt),n.closePath(),n.clip()}function zd(n){return Lo(n,["outerStart","outerEnd","innerStart","innerEnd"])}function Ud(n,t,e,i){const o=zd(n.options.borderRadius),s=(e-t)/2,a=Math.min(s,i*t/2),r=l=>{const c=(e-Math.min(s,l))*i/2;return te(l,0,Math.min(s,c))};return{outerStart:r(o.outerStart),outerEnd:r(o.outerEnd),innerStart:te(o.innerStart,0,a),innerEnd:te(o.innerEnd,0,a)}}function fn(n,t,e,i){return{x:e+n*Math.cos(t),y:i+n*Math.sin(t)}}function Mi(n,t,e,i,o,s){const{x:a,y:r,startAngle:l,pixelMargin:c,innerRadius:d}=t,u=Math.max(t.outerRadius+i+e-c,0),f=d>0?d+i+e+c:0;let h=0;const w=o-l;if(i){const tt=d>0?d-i:0,at=u>0?u-i:0,C=(tt+at)/2,E=C!==0?w*C/(C+i):w;h=(w-E)/2}const x=Math.max(.001,w*u-e/Bt)/u,S=(w-x)/2,O=l+S+h,N=o-S-h,{outerStart:J,outerEnd:ot,innerStart:y,innerEnd:I}=Ud(t,f,u,N-O),R=u-J,P=u-ot,W=O+J/R,X=N-ot/P,V=f+y,G=f+I,rt=O+y/V,$=N-I/G;if(n.beginPath(),s){const tt=(W+X)/2;if(n.arc(a,r,u,W,tt),n.arc(a,r,u,tt,X),ot>0){const k=fn(P,X,a,r);n.arc(k.x,k.y,ot,X,N+Gt)}const at=fn(G,N,a,r);if(n.lineTo(at.x,at.y),I>0){const k=fn(G,$,a,r);n.arc(k.x,k.y,I,N+Gt,$+Math.PI)}const C=(N-I/f+(O+y/f))/2;if(n.arc(a,r,f,N-I/f,C,!0),n.arc(a,r,f,C,O+y/f,!0),y>0){const k=fn(V,rt,a,r);n.arc(k.x,k.y,y,rt+Math.PI,O-Gt)}const E=fn(R,O,a,r);if(n.lineTo(E.x,E.y),J>0){const k=fn(R,W,a,r);n.arc(k.x,k.y,J,O-Gt,W)}}else{n.moveTo(a,r);const tt=Math.cos(W)*u+a,at=Math.sin(W)*u+r;n.lineTo(tt,at);const C=Math.cos(X)*u+a,E=Math.sin(X)*u+r;n.lineTo(C,E)}n.closePath()}function Hd(n,t,e,i,o){const{fullCircles:s,startAngle:a,circumference:r}=t;let l=t.endAngle;if(s){Mi(n,t,e,i,l,o);for(let c=0;c<s;++c)n.fill();isNaN(r)||(l=a+(r%Rt||Rt))}return Mi(n,t,e,i,l,o),n.fill(),l}function jd(n,t,e,i,o){const{fullCircles:s,startAngle:a,circumference:r,options:l}=t,{borderWidth:c,borderJoinStyle:d,borderDash:u,borderDashOffset:f,borderRadius:h}=l,w=l.borderAlign==="inner";if(!c)return;n.setLineDash(u||[]),n.lineDashOffset=f,w?(n.lineWidth=c*2,n.lineJoin=d||"round"):(n.lineWidth=c,n.lineJoin=d||"bevel");let x=t.endAngle;if(s){Mi(n,t,e,i,x,o);for(let S=0;S<s;++S)n.stroke();isNaN(r)||(x=a+(r%Rt||Rt))}w&&Vd(n,t,x),l.selfJoin&&x-a>=Bt&&h===0&&d!=="miter"&&Rd(n,t,x),s||(Mi(n,t,e,i,x,o),n.stroke())}class Mn extends xe{constructor(e){super();ht(this,"circumference");ht(this,"endAngle");ht(this,"fullCircles");ht(this,"innerRadius");ht(this,"outerRadius");ht(this,"pixelMargin");ht(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,i,o){const s=this.getProps(["x","y"],o),{angle:a,distance:r}=wa(s,{x:e,y:i}),{startAngle:l,endAngle:c,innerRadius:d,outerRadius:u,circumference:f}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],o),h=(this.options.spacing+this.options.borderWidth)/2,w=Dt(f,c-l),x=zn(a,l,c)&&l!==c,S=w>=Rt||x,O=Oe(r,d+h,u+h);return S&&O}getCenterPoint(e){const{x:i,y:o,startAngle:s,endAngle:a,innerRadius:r,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:c,spacing:d}=this.options,u=(s+a)/2,f=(r+l+d+c)/2;return{x:i+Math.cos(u)*f,y:o+Math.sin(u)*f}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:i,circumference:o}=this,s=(i.offset||0)/4,a=(i.spacing||0)/2,r=i.circular;if(this.pixelMargin=i.borderAlign==="inner"?.33:0,this.fullCircles=o>Rt?Math.floor(o/Rt):0,o===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const l=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(l)*s,Math.sin(l)*s);const c=1-Math.sin(Math.min(Bt,o||0)),d=s*c;e.fillStyle=i.backgroundColor,e.strokeStyle=i.borderColor,Hd(e,this,d,a,r),jd(e,this,d,a,r),e.restore()}}ht(Mn,"id","arc"),ht(Mn,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),ht(Mn,"defaultRoutes",{backgroundColor:"backgroundColor"}),ht(Mn,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"});function tr(n,t,e=t){n.lineCap=Dt(e.borderCapStyle,t.borderCapStyle),n.setLineDash(Dt(e.borderDash,t.borderDash)),n.lineDashOffset=Dt(e.borderDashOffset,t.borderDashOffset),n.lineJoin=Dt(e.borderJoinStyle,t.borderJoinStyle),n.lineWidth=Dt(e.borderWidth,t.borderWidth),n.strokeStyle=Dt(e.borderColor,t.borderColor)}function Wd(n,t,e){n.lineTo(e.x,e.y)}function Yd(n){return n.stepped?hl:n.tension||n.cubicInterpolationMode==="monotone"?pl:Wd}function er(n,t,e={}){const i=n.length,{start:o=0,end:s=i-1}=e,{start:a,end:r}=t,l=Math.max(o,a),c=Math.min(s,r),d=o<a&&s<a||o>r&&s>r;return{count:i,start:l,loop:t.loop,ilen:c<l&&!d?i+c-l:c-l}}function qd(n,t,e,i){const{points:o,options:s}=t,{count:a,start:r,loop:l,ilen:c}=er(o,e,i),d=Yd(s);let{move:u=!0,reverse:f}=i||{},h,w,x;for(h=0;h<=c;++h)w=o[(r+(f?c-h:h))%a],!w.skip&&(u?(n.moveTo(w.x,w.y),u=!1):d(n,x,w,f,s.stepped),x=w);return l&&(w=o[(r+(f?c:0))%a],d(n,x,w,f,s.stepped)),!!l}function $d(n,t,e,i){const o=t.points,{count:s,start:a,ilen:r}=er(o,e,i),{move:l=!0,reverse:c}=i||{};let d=0,u=0,f,h,w,x,S,O;const N=ot=>(a+(c?r-ot:ot))%s,J=()=>{x!==S&&(n.lineTo(d,S),n.lineTo(d,x),n.lineTo(d,O))};for(l&&(h=o[N(0)],n.moveTo(h.x,h.y)),f=0;f<=r;++f){if(h=o[N(f)],h.skip)continue;const ot=h.x,y=h.y,I=ot|0;I===w?(y<x?x=y:y>S&&(S=y),d=(u*d+ot)/++u):(J(),n.lineTo(ot,y),w=I,u=0,x=S=y),O=y}J()}function go(n){const t=n.options,e=t.borderDash&&t.borderDash.length;return!n._decimated&&!n._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?$d:qd}function Gd(n){return n.stepped?ql:n.tension||n.cubicInterpolationMode==="monotone"?$l:on}function Xd(n,t,e,i){let o=t._path;o||(o=t._path=new Path2D,t.path(o,e,i)&&o.closePath()),tr(n,t.options),n.stroke(o)}function Kd(n,t,e,i){const{segments:o,options:s}=t,a=go(t);for(const r of o)tr(n,s,r.style),n.beginPath(),a(n,t,r,{start:e,end:e+i-1})&&n.closePath(),n.stroke()}const Jd=typeof Path2D=="function";function Zd(n,t,e,i){Jd&&!t.options.segment?Xd(n,t,e,i):Kd(n,t,e,i)}class je extends xe{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const o=i.spanGaps?this._loop:this._fullLoop;Rl(this._points,i,t,o,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Ql(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,o=t[e],s=this.points,a=za(this,{property:e,start:o,end:o});if(!a.length)return;const r=[],l=Gd(i);let c,d;for(c=0,d=a.length;c<d;++c){const{start:u,end:f}=a[c],h=s[u],w=s[f];if(h===w){r.push(h);continue}const x=Math.abs((o-h[e])/(w[e]-h[e])),S=l(h,w,x,i.stepped);S[e]=t[e],r.push(S)}return r.length===1?r[0]:r}pathSegment(t,e,i){return go(this)(t,this,e,i)}path(t,e,i){const o=this.segments,s=go(this);let a=this._loop;e=e||0,i=i||this.points.length-e;for(const r of o)a&=s(t,this,r,{start:e,end:e+i-1});return!!a}draw(t,e,i,o){const s=this.options||{};(this.points||[]).length&&s.borderWidth&&(t.save(),Zd(t,this,i,o),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}ht(je,"id","line"),ht(je,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),ht(je,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),ht(je,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function Vs(n,t,e,i){const o=n.options,{[e]:s}=n.getProps([e],i);return Math.abs(t-s)<o.radius+o.hitRadius}class vi extends xe{constructor(e){super();ht(this,"parsed");ht(this,"skip");ht(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,i,o){const s=this.options,{x:a,y:r}=this.getProps(["x","y"],o);return Math.pow(e-a,2)+Math.pow(i-r,2)<Math.pow(s.hitRadius+s.radius,2)}inXRange(e,i){return Vs(this,e,"x",i)}inYRange(e,i){return Vs(this,e,"y",i)}getCenterPoint(e){const{x:i,y:o}=this.getProps(["x","y"],e);return{x:i,y:o}}size(e){e=e||this.options||{};let i=e.radius||0;i=Math.max(i,i&&e.hoverRadius||0);const o=i&&e.borderWidth||0;return(i+o)*2}draw(e,i){const o=this.options;this.skip||o.radius<.1||!Ne(this,i,this.size(o)/2)||(e.strokeStyle=o.borderColor,e.lineWidth=o.borderWidth,e.fillStyle=o.backgroundColor,fo(e,o,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}ht(vi,"id","point"),ht(vi,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),ht(vi,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function nr(n,t){const{x:e,y:i,base:o,width:s,height:a}=n.getProps(["x","y","base","width","height"],t);let r,l,c,d,u;return n.horizontal?(u=a/2,r=Math.min(e,o),l=Math.max(e,o),c=i-u,d=i+u):(u=s/2,r=e-u,l=e+u,c=Math.min(i,o),d=Math.max(i,o)),{left:r,top:c,right:l,bottom:d}}function We(n,t,e,i){return n?0:te(t,e,i)}function Qd(n,t,e){const i=n.options.borderWidth,o=n.borderSkipped,s=Ea(i);return{t:We(o.top,s.top,0,e),r:We(o.right,s.right,0,t),b:We(o.bottom,s.bottom,0,e),l:We(o.left,s.left,0,t)}}function tu(n,t,e){const{enableBorderRadius:i}=n.getProps(["enableBorderRadius"]),o=n.options.borderRadius,s=an(o),a=Math.min(t,e),r=n.borderSkipped,l=i||Tt(o);return{topLeft:We(!l||r.top||r.left,s.topLeft,0,a),topRight:We(!l||r.top||r.right,s.topRight,0,a),bottomLeft:We(!l||r.bottom||r.left,s.bottomLeft,0,a),bottomRight:We(!l||r.bottom||r.right,s.bottomRight,0,a)}}function eu(n){const t=nr(n),e=t.right-t.left,i=t.bottom-t.top,o=Qd(n,e/2,i/2),s=tu(n,e/2,i/2);return{outer:{x:t.left,y:t.top,w:e,h:i,radius:s},inner:{x:t.left+o.l,y:t.top+o.t,w:e-o.l-o.r,h:i-o.t-o.b,radius:{topLeft:Math.max(0,s.topLeft-Math.max(o.t,o.l)),topRight:Math.max(0,s.topRight-Math.max(o.t,o.r)),bottomLeft:Math.max(0,s.bottomLeft-Math.max(o.b,o.l)),bottomRight:Math.max(0,s.bottomRight-Math.max(o.b,o.r))}}}}function Qi(n,t,e,i){const o=t===null,s=e===null,r=n&&!(o&&s)&&nr(n,i);return r&&(o||Oe(t,r.left,r.right))&&(s||Oe(e,r.top,r.bottom))}function nu(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function iu(n,t){n.rect(t.x,t.y,t.w,t.h)}function to(n,t,e={}){const i=n.x!==e.x?-t:0,o=n.y!==e.y?-t:0,s=(n.x+n.w!==e.x+e.w?t:0)-i,a=(n.y+n.h!==e.y+e.h?t:0)-o;return{x:n.x+i,y:n.y+o,w:n.w+s,h:n.h+a,radius:n.radius}}class bi extends xe{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:o}}=this,{inner:s,outer:a}=eu(this),r=nu(a.radius)?Un:iu;t.save(),(a.w!==s.w||a.h!==s.h)&&(t.beginPath(),r(t,to(a,e,s)),t.clip(),r(t,to(s,-e,a)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),r(t,to(s,e)),t.fillStyle=o,t.fill(),t.restore()}inRange(t,e,i){return Qi(this,t,e,i)}inXRange(t,e){return Qi(this,t,null,e)}inYRange(t,e){return Qi(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:o,horizontal:s}=this.getProps(["x","y","base","horizontal"],t);return{x:s?(e+o)/2:e,y:s?i:(i+o)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}ht(bi,"id","bar"),ht(bi,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),ht(bi,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var ou=Object.freeze({__proto__:null,ArcElement:Mn,BarElement:bi,LineElement:je,PointElement:vi});const vo=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],zs=vo.map(n=>n.replace("rgb(","rgba(").replace(")",", 0.5)"));function ir(n){return vo[n%vo.length]}function or(n){return zs[n%zs.length]}function su(n,t){return n.borderColor=ir(t),n.backgroundColor=or(t),++t}function au(n,t){return n.backgroundColor=n.data.map(()=>ir(t++)),t}function ru(n,t){return n.backgroundColor=n.data.map(()=>or(t++)),t}function lu(n){let t=0;return(e,i)=>{const o=n.getDatasetMeta(i).controller;o instanceof sn?t=au(e,t):o instanceof On?t=ru(e,t):o&&(t=su(e,t))}}function Us(n){let t;for(t in n)if(n[t].borderColor||n[t].backgroundColor)return!0;return!1}function cu(n){return n&&(n.borderColor||n.backgroundColor)}function du(){return Ht.borderColor!=="rgba(0,0,0,0.1)"||Ht.backgroundColor!=="rgba(0,0,0,0.1)"}var uu={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(n,t,e){if(!e.enabled)return;const{data:{datasets:i},options:o}=n.config,{elements:s}=o,a=Us(i)||cu(o)||s&&Us(s)||du();if(!e.forceOverride&&a)return;const r=lu(n);i.forEach(r)}};function fu(n,t,e,i,o){const s=o.samples||i;if(s>=e)return n.slice(t,t+e);const a=[],r=(e-2)/(s-2);let l=0;const c=t+e-1;let d=t,u,f,h,w,x;for(a[l++]=n[d],u=0;u<s-2;u++){let S=0,O=0,N;const J=Math.floor((u+1)*r)+1+t,ot=Math.min(Math.floor((u+2)*r)+1,e)+t,y=ot-J;for(N=J;N<ot;N++)S+=n[N].x,O+=n[N].y;S/=y,O/=y;const I=Math.floor(u*r)+1+t,R=Math.min(Math.floor((u+1)*r)+1,e)+t,{x:P,y:W}=n[d];for(h=w=-1,N=I;N<R;N++)w=.5*Math.abs((P-S)*(n[N].y-W)-(P-n[N].x)*(O-W)),w>h&&(h=w,f=n[N],x=N);a[l++]=f,d=x}return a[l++]=n[c],a}function hu(n,t,e,i){let o=0,s=0,a,r,l,c,d,u,f,h,w,x;const S=[],O=t+e-1,N=n[t].x,ot=n[O].x-N;for(a=t;a<t+e;++a){r=n[a],l=(r.x-N)/ot*i,c=r.y;const y=l|0;if(y===d)c<w?(w=c,u=a):c>x&&(x=c,f=a),o=(s*o+r.x)/++s;else{const I=a-1;if(!Mt(u)&&!Mt(f)){const R=Math.min(u,f),P=Math.max(u,f);R!==h&&R!==I&&S.push({...n[R],x:o}),P!==h&&P!==I&&S.push({...n[P],x:o})}a>0&&I!==h&&S.push(n[I]),S.push(r),d=y,s=0,w=x=c,u=f=h=a}}return S}function sr(n){if(n._decimated){const t=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function Hs(n){n.data.datasets.forEach(t=>{sr(t)})}function pu(n,t){const e=t.length;let i=0,o;const{iScale:s}=n,{min:a,max:r,minDefined:l,maxDefined:c}=s.getUserBounds();return l&&(i=te(Fe(t,s.axis,a).lo,0,e-1)),c?o=te(Fe(t,s.axis,r).hi+1,i,e)-i:o=e-i,{start:i,count:o}}var mu={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,t,e)=>{if(!e.enabled){Hs(n);return}const i=n.width;n.data.datasets.forEach((o,s)=>{const{_data:a,indexAxis:r}=o,l=n.getDatasetMeta(s),c=a||o.data;if(kn([r,n.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const d=n.scales[l.xAxisID];if(d.type!=="linear"&&d.type!=="time"||n.options.parsing)return;let{start:u,count:f}=pu(l,c);const h=e.threshold||4*i;if(f<=h){sr(o);return}Mt(a)&&(o._data=c,delete o.data,Object.defineProperty(o,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(x){this._data=x}}));let w;switch(e.algorithm){case"lttb":w=fu(c,u,f,i,e);break;case"min-max":w=hu(c,u,f,i);break;default:throw new Error("Unsupported decimation algorithm '".concat(e.algorithm,"'"))}o._decimated=w})},destroy(n){Hs(n)}};function gu(n,t,e){const i=n.segments,o=n.points,s=t.points,a=[];for(const r of i){let{start:l,end:c}=r;c=Ri(l,c,o);const d=bo(e,o[l],o[c],r.loop);if(!t.segments){a.push({source:r,target:d,start:o[l],end:o[c]});continue}const u=za(t,d);for(const f of u){const h=bo(e,s[f.start],s[f.end],f.loop),w=Va(r,o,h);for(const x of w)a.push({source:x,target:f,start:{[e]:js(d,h,"start",Math.max)},end:{[e]:js(d,h,"end",Math.min)}})}}return a}function bo(n,t,e,i){if(i)return;let o=t[n],s=e[n];return n==="angle"&&(o=ae(o),s=ae(s)),{property:n,start:o,end:s}}function vu(n,t){const{x:e=null,y:i=null}=n||{},o=t.points,s=[];return t.segments.forEach(({start:a,end:r})=>{r=Ri(a,r,o);const l=o[a],c=o[r];i!==null?(s.push({x:l.x,y:i}),s.push({x:c.x,y:i})):e!==null&&(s.push({x:e,y:l.y}),s.push({x:e,y:c.y}))}),s}function Ri(n,t,e){for(;t>n;t--){const i=e[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function js(n,t,e,i){return n&&t?i(n[e],t[e]):n?n[e]:t?t[e]:0}function ar(n,t){let e=[],i=!1;return Ut(n)?(i=!0,e=n):e=vu(n,t),e.length?new je({points:e,options:{tension:0},_loop:i,_fullLoop:i}):null}function Ws(n){return n&&n.fill!==!1}function bu(n,t,e){let o=n[t].fill;const s=[t];let a;if(!e)return o;for(;o!==!1&&s.indexOf(o)===-1;){if(!qt(o))return o;if(a=n[o],!a)return!1;if(a.visible)return o;s.push(o),o=a.fill}return!1}function yu(n,t,e){const i=Su(n);if(Tt(i))return isNaN(i.value)?!1:i;let o=parseFloat(i);return qt(o)&&Math.floor(o)===o?wu(i[0],t,o,e):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function wu(n,t,e,i){return(n==="-"||n==="+")&&(e=t+e),e===t||e<0||e>=i?!1:e}function _u(n,t){let e=null;return n==="start"?e=t.bottom:n==="end"?e=t.top:Tt(n)?e=t.getPixelForValue(n.value):t.getBasePixel&&(e=t.getBasePixel()),e}function xu(n,t,e){let i;return n==="start"?i=e:n==="end"?i=t.options.reverse?t.min:t.max:Tt(n)?i=n.value:i=t.getBaseValue(),i}function Su(n){const t=n.options,e=t.fill;let i=Dt(e&&e.target,e);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function Cu(n){const{scale:t,index:e,line:i}=n,o=[],s=i.segments,a=i.points,r=Du(t,e);r.push(ar({x:null,y:t.bottom},i));for(let l=0;l<s.length;l++){const c=s[l];for(let d=c.start;d<=c.end;d++)ku(o,a[d],r)}return new je({points:o,options:{}})}function Du(n,t){const e=[],i=n.getMatchingVisibleMetas("line");for(let o=0;o<i.length;o++){const s=i[o];if(s.index===t)break;s.hidden||e.unshift(s.dataset)}return e}function ku(n,t,e){const i=[];for(let o=0;o<e.length;o++){const s=e[o],{first:a,last:r,point:l}=Iu(s,t,"x");if(!(!l||a&&r)){if(a)i.unshift(l);else if(n.push(l),!r)break}}n.push(...i)}function Iu(n,t,e){const i=n.interpolate(t,e);if(!i)return{};const o=i[e],s=n.segments,a=n.points;let r=!1,l=!1;for(let c=0;c<s.length;c++){const d=s[c],u=a[d.start][e],f=a[d.end][e];if(Oe(o,u,f)){r=o===u,l=o===f;break}}return{first:r,last:l,point:i}}class rr{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:o,y:s,radius:a}=this;return e=e||{start:0,end:Rt},t.arc(o,s,a,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:o}=this,s=t.angle;return{x:e+Math.cos(s)*o,y:i+Math.sin(s)*o,angle:s}}}function Mu(n){const{chart:t,fill:e,line:i}=n;if(qt(e))return Eu(t,e);if(e==="stack")return Cu(n);if(e==="shape")return!0;const o=Tu(n);return o instanceof rr?o:ar(o,i)}function Eu(n,t){const e=n.getDatasetMeta(t);return e&&n.isDatasetVisible(t)?e.dataset:null}function Tu(n){return(n.scale||{}).getPointPositionForValue?Au(n):Pu(n)}function Pu(n){const{scale:t={},fill:e}=n,i=_u(e,t);if(qt(i)){const o=t.isHorizontal();return{x:o?i:null,y:o?null:i}}return null}function Au(n){const{scale:t,fill:e}=n,i=t.options,o=t.getLabels().length,s=i.reverse?t.max:t.min,a=xu(e,t,s),r=[];if(i.grid.circular){const l=t.getPointPositionForValue(0,s);return new rr({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(a)})}for(let l=0;l<o;++l)r.push(t.getPointPositionForValue(l,a));return r}function eo(n,t,e){const i=Mu(t),{chart:o,index:s,line:a,scale:r,axis:l}=t,c=a.options,d=c.fill,u=c.backgroundColor,{above:f=u,below:h=u}=d||{},w=o.getDatasetMeta(s),x=Ua(o,w);i&&a.points.length&&(Li(n,e),Bu(n,{line:a,target:i,above:f,below:h,area:e,scale:r,axis:l,clip:x}),Oi(n))}function Bu(n,t){const{line:e,target:i,above:o,below:s,area:a,scale:r,clip:l}=t,c=e._loop?"angle":t.axis;n.save();let d=s;s!==o&&(c==="x"?(Ys(n,i,a.top),no(n,{line:e,target:i,color:o,scale:r,property:c,clip:l}),n.restore(),n.save(),Ys(n,i,a.bottom)):c==="y"&&(qs(n,i,a.left),no(n,{line:e,target:i,color:s,scale:r,property:c,clip:l}),n.restore(),n.save(),qs(n,i,a.right),d=o)),no(n,{line:e,target:i,color:d,scale:r,property:c,clip:l}),n.restore()}function Ys(n,t,e){const{segments:i,points:o}=t;let s=!0,a=!1;n.beginPath();for(const r of i){const{start:l,end:c}=r,d=o[l],u=o[Ri(l,c,o)];s?(n.moveTo(d.x,d.y),s=!1):(n.lineTo(d.x,e),n.lineTo(d.x,d.y)),a=!!t.pathSegment(n,r,{move:a}),a?n.closePath():n.lineTo(u.x,e)}n.lineTo(t.first().x,e),n.closePath(),n.clip()}function qs(n,t,e){const{segments:i,points:o}=t;let s=!0,a=!1;n.beginPath();for(const r of i){const{start:l,end:c}=r,d=o[l],u=o[Ri(l,c,o)];s?(n.moveTo(d.x,d.y),s=!1):(n.lineTo(e,d.y),n.lineTo(d.x,d.y)),a=!!t.pathSegment(n,r,{move:a}),a?n.closePath():n.lineTo(e,u.y)}n.lineTo(e,t.first().y),n.closePath(),n.clip()}function no(n,t){const{line:e,target:i,property:o,color:s,scale:a,clip:r}=t,l=gu(e,i,o);for(const{source:c,target:d,start:u,end:f}of l){const{style:{backgroundColor:h=s}={}}=c,w=i!==!0;n.save(),n.fillStyle=h,Lu(n,a,r,w&&bo(o,u,f)),n.beginPath();const x=!!e.pathSegment(n,c);let S;if(w){x?n.closePath():$s(n,i,f,o);const O=!!i.pathSegment(n,d,{move:x,reverse:!0});S=x&&O,S||$s(n,i,u,o)}n.closePath(),n.fill(S?"evenodd":"nonzero"),n.restore()}}function Lu(n,t,e,i){const o=t.chart.chartArea,{property:s,start:a,end:r}=i||{};if(s==="x"||s==="y"){let l,c,d,u;s==="x"?(l=a,c=o.top,d=r,u=o.bottom):(l=o.left,c=a,d=o.right,u=r),n.beginPath(),e&&(l=Math.max(l,e.left),d=Math.min(d,e.right),c=Math.max(c,e.top),u=Math.min(u,e.bottom)),n.rect(l,c,d-l,u-c),n.clip()}}function $s(n,t,e,i){const o=t.interpolate(e,i);o&&n.lineTo(o.x,o.y)}var Ou={id:"filler",afterDatasetsUpdate(n,t,e){const i=(n.data.datasets||[]).length,o=[];let s,a,r,l;for(a=0;a<i;++a)s=n.getDatasetMeta(a),r=s.dataset,l=null,r&&r.options&&r instanceof je&&(l={visible:n.isDatasetVisible(a),index:a,fill:yu(r,a,i),chart:n,axis:s.controller.options.indexAxis,scale:s.vScale,line:r}),s.$filler=l,o.push(l);for(a=0;a<i;++a)l=o[a],!(!l||l.fill===!1)&&(l.fill=bu(o,a,e.propagate))},beforeDraw(n,t,e){const i=e.drawTime==="beforeDraw",o=n.getSortedVisibleDatasetMetas(),s=n.chartArea;for(let a=o.length-1;a>=0;--a){const r=o[a].$filler;r&&(r.line.updateControlPoints(s,r.axis),i&&r.fill&&eo(n.ctx,r,s))}},beforeDatasetsDraw(n,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const i=n.getSortedVisibleDatasetMetas();for(let o=i.length-1;o>=0;--o){const s=i[o].$filler;Ws(s)&&eo(n.ctx,s,n.chartArea)}},beforeDatasetDraw(n,t,e){const i=t.meta.$filler;!Ws(i)||e.drawTime!=="beforeDatasetDraw"||eo(n.ctx,i,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Gs=(n,t)=>{let{boxHeight:e=t,boxWidth:i=t}=n;return n.usePointStyle&&(e=Math.min(e,t),i=n.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:e,itemHeight:Math.max(t,e)}},Fu=(n,t)=>n!==null&&t!==null&&n.datasetIndex===t.datasetIndex&&n.index===t.index;class Xs extends xe{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=Nt(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(i=>t.filter(i,this.chart.data))),t.sort&&(e=e.sort((i,o)=>t.sort(i,o,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,o=Zt(i.font),s=o.size,a=this._computeTitleHeight(),{boxWidth:r,itemHeight:l}=Gs(i,s);let c,d;e.font=o.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(a,s,r,l)+10):(d=this.maxHeight,c=this._fitCols(a,o,r,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(d,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,o){const{ctx:s,maxWidth:a,options:{labels:{padding:r}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=o+r;let u=t;s.textAlign="left",s.textBaseline="middle";let f=-1,h=-d;return this.legendItems.forEach((w,x)=>{const S=i+e/2+s.measureText(w.text).width;(x===0||c[c.length-1]+S+2*r>a)&&(u+=d,c[c.length-(x>0?0:1)]=0,h+=d,f++),l[x]={left:0,top:h,row:f,width:S,height:o},c[c.length-1]+=S+r}),u}_fitCols(t,e,i,o){const{ctx:s,maxHeight:a,options:{labels:{padding:r}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=a-t;let u=r,f=0,h=0,w=0,x=0;return this.legendItems.forEach((S,O)=>{const{itemWidth:N,itemHeight:J}=Nu(i,e,s,S,o);O>0&&h+J+2*r>d&&(u+=f+r,c.push({width:f,height:h}),w+=f+r,x++,f=h=0),l[O]={left:w,top:h,col:x,width:N,height:J},f=Math.max(f,N),h+=J+r}),u+=f,c.push({width:f,height:h}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:o},rtl:s}}=this,a=hn(s,this.left,this.width);if(this.isHorizontal()){let r=0,l=se(i,this.left+o,this.right-this.lineWidths[r]);for(const c of e)r!==c.row&&(r=c.row,l=se(i,this.left+o,this.right-this.lineWidths[r])),c.top+=this.top+t+o,c.left=a.leftForLtr(a.x(l),c.width),l+=c.width+o}else{let r=0,l=se(i,this.top+t+o,this.bottom-this.columnSizes[r].height);for(const c of e)c.col!==r&&(r=c.col,l=se(i,this.top+t+o,this.bottom-this.columnSizes[r].height)),c.top=l,c.left+=this.left+o,c.left=a.leftForLtr(a.x(c.left),c.width),l+=c.height+o}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;Li(t,this),this._draw(),Oi(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:o}=this,{align:s,labels:a}=t,r=Ht.color,l=hn(t.rtl,this.left,this.width),c=Zt(a.font),{padding:d}=a,u=c.size,f=u/2;let h;this.drawTitle(),o.textAlign=l.textAlign("left"),o.textBaseline="middle",o.lineWidth=.5,o.font=c.string;const{boxWidth:w,boxHeight:x,itemHeight:S}=Gs(a,u),O=function(I,R,P){if(isNaN(w)||w<=0||isNaN(x)||x<0)return;o.save();const W=Dt(P.lineWidth,1);if(o.fillStyle=Dt(P.fillStyle,r),o.lineCap=Dt(P.lineCap,"butt"),o.lineDashOffset=Dt(P.lineDashOffset,0),o.lineJoin=Dt(P.lineJoin,"miter"),o.lineWidth=W,o.strokeStyle=Dt(P.strokeStyle,r),o.setLineDash(Dt(P.lineDash,[])),a.usePointStyle){const X={radius:x*Math.SQRT2/2,pointStyle:P.pointStyle,rotation:P.rotation,borderWidth:W},V=l.xPlus(I,w/2),G=R+f;Ma(o,X,V,G,a.pointStyleWidth&&w)}else{const X=R+Math.max((u-x)/2,0),V=l.leftForLtr(I,w),G=an(P.borderRadius);o.beginPath(),Object.values(G).some(rt=>rt!==0)?Un(o,{x:V,y:X,w,h:x,radius:G}):o.rect(V,X,w,x),o.fill(),W!==0&&o.stroke()}o.restore()},N=function(I,R,P){cn(o,P.text,I,R+S/2,c,{strikethrough:P.hidden,textAlign:l.textAlign(P.textAlign)})},J=this.isHorizontal(),ot=this._computeTitleHeight();J?h={x:se(s,this.left+d,this.right-i[0]),y:this.top+d+ot,line:0}:h={x:this.left+d,y:se(s,this.top+ot+d,this.bottom-e[0].height),line:0},Fa(this.ctx,t.textDirection);const y=S+d;this.legendItems.forEach((I,R)=>{o.strokeStyle=I.fontColor,o.fillStyle=I.fontColor;const P=o.measureText(I.text).width,W=l.textAlign(I.textAlign||(I.textAlign=a.textAlign)),X=w+f+P;let V=h.x,G=h.y;l.setWidth(this.width),J?R>0&&V+X+d>this.right&&(G=h.y+=y,h.line++,V=h.x=se(s,this.left+d,this.right-i[h.line])):R>0&&G+y>this.bottom&&(V=h.x=V+e[h.line].width+d,h.line++,G=h.y=se(s,this.top+ot+d,this.bottom-e[h.line].height));const rt=l.x(V);if(O(rt,G,I),V=nl(W,V+w+f,J?V+X:this.right,t.rtl),N(l.x(V),G,I),J)h.x+=X+d;else if(typeof I.text!="string"){const $=c.lineHeight;h.y+=lr(I,$)+d}else h.y+=y}),Na(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=Zt(e.font),o=le(e.padding);if(!e.display)return;const s=hn(t.rtl,this.left,this.width),a=this.ctx,r=e.position,l=i.size/2,c=o.top+l;let d,u=this.left,f=this.width;if(this.isHorizontal())f=Math.max(...this.lineWidths),d=this.top+c,u=se(t.align,u,this.right-f);else{const w=this.columnSizes.reduce((x,S)=>Math.max(x,S.height),0);d=c+se(t.align,this.top,this.bottom-w-t.labels.padding-this._computeTitleHeight())}const h=se(r,u,u+f);a.textAlign=s.textAlign(Ao(r)),a.textBaseline="middle",a.strokeStyle=e.color,a.fillStyle=e.color,a.font=i.string,cn(a,e.text,h,d,i)}_computeTitleHeight(){const t=this.options.title,e=Zt(t.font),i=le(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,o,s;if(Oe(t,this.left,this.right)&&Oe(e,this.top,this.bottom)){for(s=this.legendHitBoxes,i=0;i<s.length;++i)if(o=s[i],Oe(t,o.left,o.left+o.width)&&Oe(e,o.top,o.top+o.height))return this.legendItems[i]}return null}handleEvent(t){const e=this.options;if(!zu(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const o=this._hoveredItem,s=Fu(o,i);o&&!s&&Nt(e.onLeave,[t,o,this],this),this._hoveredItem=i,i&&!s&&Nt(e.onHover,[t,i,this],this)}else i&&Nt(e.onClick,[t,i,this],this)}}function Nu(n,t,e,i,o){const s=Ru(i,n,t,e),a=Vu(o,i,t.lineHeight);return{itemWidth:s,itemHeight:a}}function Ru(n,t,e,i){let o=n.text;return o&&typeof o!="string"&&(o=o.reduce((s,a)=>s.length>a.length?s:a)),t+e.size/2+i.measureText(o).width}function Vu(n,t,e){let i=n;return typeof t.text!="string"&&(i=lr(t,e)),i}function lr(n,t){const e=n.text?n.text.length:0;return t*e}function zu(n,t){return!!((n==="mousemove"||n==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(n==="click"||n==="mouseup"))}var Uu={id:"legend",_element:Xs,start(n,t,e){const i=n.legend=new Xs({ctx:n.ctx,options:e,chart:n});re.configure(n,i,e),re.addBox(n,i)},stop(n){re.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,t,e){const i=n.legend;re.configure(n,i,e),i.options=e},afterUpdate(n){const t=n.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(n,t){t.replay||n.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,t,e){const i=t.datasetIndex,o=e.chart;o.isDatasetVisible(i)?(o.hide(i),t.hidden=!0):(o.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const t=n.data.datasets,{labels:{usePointStyle:e,pointStyle:i,textAlign:o,color:s,useBorderRadius:a,borderRadius:r}}=n.legend.options;return n._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(e?0:void 0),d=le(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:s,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:i||c.pointStyle,rotation:c.rotation,textAlign:o||c.textAlign,borderRadius:a&&(r||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class Uo extends xe{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const o=Ut(i.text)?i.text.length:1;this._padding=le(i.padding);const s=o*Zt(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=s:this.width=s}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:i,bottom:o,right:s,options:a}=this,r=a.align;let l=0,c,d,u;return this.isHorizontal()?(d=se(r,i,s),u=e+t,c=s-i):(a.position==="left"?(d=i+t,u=se(r,o,e),l=Bt*-.5):(d=s-t,u=se(r,e,o),l=Bt*.5),c=o-e),{titleX:d,titleY:u,maxWidth:c,rotation:l}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=Zt(e.font),s=i.lineHeight/2+this._padding.top,{titleX:a,titleY:r,maxWidth:l,rotation:c}=this._drawArgs(s);cn(t,e.text,0,0,i,{color:e.color,maxWidth:l,rotation:c,textAlign:Ao(e.align),textBaseline:"middle",translation:[a,r]})}}function Hu(n,t){const e=new Uo({ctx:n.ctx,options:t,chart:n});re.configure(n,e,t),re.addBox(n,e),n.titleBlock=e}var ju={id:"title",_element:Uo,start(n,t,e){Hu(n,e)},stop(n){const t=n.titleBlock;re.removeBox(n,t),delete n.titleBlock},beforeUpdate(n,t,e){const i=n.titleBlock;re.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const oi=new WeakMap;var Wu={id:"subtitle",start(n,t,e){const i=new Uo({ctx:n.ctx,options:e,chart:n});re.configure(n,i,e),re.addBox(n,i),oi.set(n,i)},stop(n){re.removeBox(n,oi.get(n)),oi.delete(n)},beforeUpdate(n,t,e){const i=oi.get(n);re.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const En={average(n){if(!n.length)return!1;let t,e,i=new Set,o=0,s=0;for(t=0,e=n.length;t<e;++t){const r=n[t].element;if(r&&r.hasValue()){const l=r.tooltipPosition();i.add(l.x),o+=l.y,++s}}return s===0||i.size===0?!1:{x:[...i].reduce((r,l)=>r+l)/i.size,y:o/s}},nearest(n,t){if(!n.length)return!1;let e=t.x,i=t.y,o=Number.POSITIVE_INFINITY,s,a,r;for(s=0,a=n.length;s<a;++s){const l=n[s].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=co(t,c);d<o&&(o=d,r=l)}}if(r){const l=r.tooltipPosition();e=l.x,i=l.y}return{x:e,y:i}}};function Se(n,t){return t&&(Ut(t)?Array.prototype.push.apply(n,t):n.push(t)),n}function Ae(n){return(typeof n=="string"||n instanceof String)&&n.indexOf("\n")>-1?n.split("\n"):n}function Yu(n,t){const{element:e,datasetIndex:i,index:o}=t,s=n.getDatasetMeta(i).controller,{label:a,value:r}=s.getLabelAndValue(o);return{chart:n,label:a,parsed:s.getParsed(o),raw:n.data.datasets[i].data[o],formattedValue:r,dataset:s.getDataset(),dataIndex:o,datasetIndex:i,element:e}}function Ks(n,t){const e=n.chart.ctx,{body:i,footer:o,title:s}=n,{boxWidth:a,boxHeight:r}=t,l=Zt(t.bodyFont),c=Zt(t.titleFont),d=Zt(t.footerFont),u=s.length,f=o.length,h=i.length,w=le(t.padding);let x=w.height,S=0,O=i.reduce((ot,y)=>ot+y.before.length+y.lines.length+y.after.length,0);if(O+=n.beforeBody.length+n.afterBody.length,u&&(x+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),O){const ot=t.displayColors?Math.max(r,l.lineHeight):l.lineHeight;x+=h*ot+(O-h)*l.lineHeight+(O-1)*t.bodySpacing}f&&(x+=t.footerMarginTop+f*d.lineHeight+(f-1)*t.footerSpacing);let N=0;const J=function(ot){S=Math.max(S,e.measureText(ot).width+N)};return e.save(),e.font=c.string,Ot(n.title,J),e.font=l.string,Ot(n.beforeBody.concat(n.afterBody),J),N=t.displayColors?a+2+t.boxPadding:0,Ot(i,ot=>{Ot(ot.before,J),Ot(ot.lines,J),Ot(ot.after,J)}),N=0,e.font=d.string,Ot(n.footer,J),e.restore(),S+=w.width,{width:S,height:x}}function qu(n,t){const{y:e,height:i}=t;return e<i/2?"top":e>n.height-i/2?"bottom":"center"}function $u(n,t,e,i){const{x:o,width:s}=i,a=e.caretSize+e.caretPadding;if(n==="left"&&o+s+a>t.width||n==="right"&&o-s-a<0)return!0}function Gu(n,t,e,i){const{x:o,width:s}=e,{width:a,chartArea:{left:r,right:l}}=n;let c="center";return i==="center"?c=o<=(r+l)/2?"left":"right":o<=s/2?c="left":o>=a-s/2&&(c="right"),$u(c,n,t,e)&&(c="center"),c}function Js(n,t,e){const i=e.yAlign||t.yAlign||qu(n,e);return{xAlign:e.xAlign||t.xAlign||Gu(n,t,e,i),yAlign:i}}function Xu(n,t){let{x:e,width:i}=n;return t==="right"?e-=i:t==="center"&&(e-=i/2),e}function Ku(n,t,e){let{y:i,height:o}=n;return t==="top"?i+=e:t==="bottom"?i-=o+e:i-=o/2,i}function Zs(n,t,e,i){const{caretSize:o,caretPadding:s,cornerRadius:a}=n,{xAlign:r,yAlign:l}=e,c=o+s,{topLeft:d,topRight:u,bottomLeft:f,bottomRight:h}=an(a);let w=Xu(t,r);const x=Ku(t,l,c);return l==="center"?r==="left"?w+=c:r==="right"&&(w-=c):r==="left"?w-=Math.max(d,f)+o:r==="right"&&(w+=Math.max(u,h)+o),{x:te(w,0,i.width-t.width),y:te(x,0,i.height-t.height)}}function si(n,t,e){const i=le(e.padding);return t==="center"?n.x+n.width/2:t==="right"?n.x+n.width-i.right:n.x+i.left}function Qs(n){return Se([],Ae(n))}function Ju(n,t,e){return Ge(n,{tooltip:t,tooltipItems:e,type:"tooltip"})}function ta(n,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?n.override(e):n}const cr={beforeTitle:Ee,title(n){if(n.length>0){const t=n[0],e=t.chart.data.labels,i=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return e[t.dataIndex]}return""},afterTitle:Ee,beforeBody:Ee,beforeLabel:Ee,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let t=n.dataset.label||"";t&&(t+=": ");const e=n.formattedValue;return Mt(e)||(t+=e),t},labelColor(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Ee,afterBody:Ee,beforeFooter:Ee,footer:Ee,afterFooter:Ee};function fe(n,t,e,i){const o=n[t].call(e,i);return typeof o>"u"?cr[t].call(e,i):o}class yo extends xe{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),o=i.enabled&&e.options.animation&&i.animations,s=new Ha(this.chart,o);return o._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=Ju(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:i}=e,o=fe(i,"beforeTitle",this,t),s=fe(i,"title",this,t),a=fe(i,"afterTitle",this,t);let r=[];return r=Se(r,Ae(o)),r=Se(r,Ae(s)),r=Se(r,Ae(a)),r}getBeforeBody(t,e){return Qs(fe(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:i}=e,o=[];return Ot(t,s=>{const a={before:[],lines:[],after:[]},r=ta(i,s);Se(a.before,Ae(fe(r,"beforeLabel",this,s))),Se(a.lines,fe(r,"label",this,s)),Se(a.after,Ae(fe(r,"afterLabel",this,s))),o.push(a)}),o}getAfterBody(t,e){return Qs(fe(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:i}=e,o=fe(i,"beforeFooter",this,t),s=fe(i,"footer",this,t),a=fe(i,"afterFooter",this,t);let r=[];return r=Se(r,Ae(o)),r=Se(r,Ae(s)),r=Se(r,Ae(a)),r}_createItems(t){const e=this._active,i=this.chart.data,o=[],s=[],a=[];let r=[],l,c;for(l=0,c=e.length;l<c;++l)r.push(Yu(this.chart,e[l]));return t.filter&&(r=r.filter((d,u,f)=>t.filter(d,u,f,i))),t.itemSort&&(r=r.sort((d,u)=>t.itemSort(d,u,i))),Ot(r,d=>{const u=ta(t.callbacks,d);o.push(fe(u,"labelColor",this,d)),s.push(fe(u,"labelPointStyle",this,d)),a.push(fe(u,"labelTextColor",this,d))}),this.labelColors=o,this.labelPointStyles=s,this.labelTextColors=a,this.dataPoints=r,r}update(t,e){const i=this.options.setContext(this.getContext()),o=this._active;let s,a=[];if(!o.length)this.opacity!==0&&(s={opacity:0});else{const r=En[i.position].call(this,o,this._eventPosition);a=this._createItems(i),this.title=this.getTitle(a,i),this.beforeBody=this.getBeforeBody(a,i),this.body=this.getBody(a,i),this.afterBody=this.getAfterBody(a,i),this.footer=this.getFooter(a,i);const l=this._size=Ks(this,i),c=Object.assign({},r,l),d=Js(this.chart,i,c),u=Zs(i,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,s={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:r.x,caretY:r.y}}this._tooltipItems=a,this.$context=void 0,s&&this._resolveAnimations().update(this,s),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,o){const s=this.getCaretPosition(t,i,o);e.lineTo(s.x1,s.y1),e.lineTo(s.x2,s.y2),e.lineTo(s.x3,s.y3)}getCaretPosition(t,e,i){const{xAlign:o,yAlign:s}=this,{caretSize:a,cornerRadius:r}=i,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:u}=an(r),{x:f,y:h}=t,{width:w,height:x}=e;let S,O,N,J,ot,y;return s==="center"?(ot=h+x/2,o==="left"?(S=f,O=S-a,J=ot+a,y=ot-a):(S=f+w,O=S+a,J=ot-a,y=ot+a),N=S):(o==="left"?O=f+Math.max(l,d)+a:o==="right"?O=f+w-Math.max(c,u)-a:O=this.caretX,s==="top"?(J=h,ot=J-a,S=O-a,N=O+a):(J=h+x,ot=J+a,S=O+a,N=O-a),y=J),{x1:S,x2:O,x3:N,y1:J,y2:ot,y3:y}}drawTitle(t,e,i){const o=this.title,s=o.length;let a,r,l;if(s){const c=hn(i.rtl,this.x,this.width);for(t.x=si(this,i.titleAlign,i),e.textAlign=c.textAlign(i.titleAlign),e.textBaseline="middle",a=Zt(i.titleFont),r=i.titleSpacing,e.fillStyle=i.titleColor,e.font=a.string,l=0;l<s;++l)e.fillText(o[l],c.x(t.x),t.y+a.lineHeight/2),t.y+=a.lineHeight+r,l+1===s&&(t.y+=i.titleMarginBottom-r)}}_drawColorBox(t,e,i,o,s){const a=this.labelColors[i],r=this.labelPointStyles[i],{boxHeight:l,boxWidth:c}=s,d=Zt(s.bodyFont),u=si(this,"left",s),f=o.x(u),h=l<d.lineHeight?(d.lineHeight-l)/2:0,w=e.y+h;if(s.usePointStyle){const x={radius:Math.min(c,l)/2,pointStyle:r.pointStyle,rotation:r.rotation,borderWidth:1},S=o.leftForLtr(f,c)+c/2,O=w+l/2;t.strokeStyle=s.multiKeyBackground,t.fillStyle=s.multiKeyBackground,fo(t,x,S,O),t.strokeStyle=a.borderColor,t.fillStyle=a.backgroundColor,fo(t,x,S,O)}else{t.lineWidth=Tt(a.borderWidth)?Math.max(...Object.values(a.borderWidth)):a.borderWidth||1,t.strokeStyle=a.borderColor,t.setLineDash(a.borderDash||[]),t.lineDashOffset=a.borderDashOffset||0;const x=o.leftForLtr(f,c),S=o.leftForLtr(o.xPlus(f,1),c-2),O=an(a.borderRadius);Object.values(O).some(N=>N!==0)?(t.beginPath(),t.fillStyle=s.multiKeyBackground,Un(t,{x,y:w,w:c,h:l,radius:O}),t.fill(),t.stroke(),t.fillStyle=a.backgroundColor,t.beginPath(),Un(t,{x:S,y:w+1,w:c-2,h:l-2,radius:O}),t.fill()):(t.fillStyle=s.multiKeyBackground,t.fillRect(x,w,c,l),t.strokeRect(x,w,c,l),t.fillStyle=a.backgroundColor,t.fillRect(S,w+1,c-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:o}=this,{bodySpacing:s,bodyAlign:a,displayColors:r,boxHeight:l,boxWidth:c,boxPadding:d}=i,u=Zt(i.bodyFont);let f=u.lineHeight,h=0;const w=hn(i.rtl,this.x,this.width),x=function(P){e.fillText(P,w.x(t.x+h),t.y+f/2),t.y+=f+s},S=w.textAlign(a);let O,N,J,ot,y,I,R;for(e.textAlign=a,e.textBaseline="middle",e.font=u.string,t.x=si(this,S,i),e.fillStyle=i.bodyColor,Ot(this.beforeBody,x),h=r&&S!=="right"?a==="center"?c/2+d:c+2+d:0,ot=0,I=o.length;ot<I;++ot){for(O=o[ot],N=this.labelTextColors[ot],e.fillStyle=N,Ot(O.before,x),J=O.lines,r&&J.length&&(this._drawColorBox(e,t,ot,w,i),f=Math.max(u.lineHeight,l)),y=0,R=J.length;y<R;++y)x(J[y]),f=u.lineHeight;Ot(O.after,x)}h=0,f=u.lineHeight,Ot(this.afterBody,x),t.y-=s}drawFooter(t,e,i){const o=this.footer,s=o.length;let a,r;if(s){const l=hn(i.rtl,this.x,this.width);for(t.x=si(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=l.textAlign(i.footerAlign),e.textBaseline="middle",a=Zt(i.footerFont),e.fillStyle=i.footerColor,e.font=a.string,r=0;r<s;++r)e.fillText(o[r],l.x(t.x),t.y+a.lineHeight/2),t.y+=a.lineHeight+i.footerSpacing}}drawBackground(t,e,i,o){const{xAlign:s,yAlign:a}=this,{x:r,y:l}=t,{width:c,height:d}=i,{topLeft:u,topRight:f,bottomLeft:h,bottomRight:w}=an(o.cornerRadius);e.fillStyle=o.backgroundColor,e.strokeStyle=o.borderColor,e.lineWidth=o.borderWidth,e.beginPath(),e.moveTo(r+u,l),a==="top"&&this.drawCaret(t,e,i,o),e.lineTo(r+c-f,l),e.quadraticCurveTo(r+c,l,r+c,l+f),a==="center"&&s==="right"&&this.drawCaret(t,e,i,o),e.lineTo(r+c,l+d-w),e.quadraticCurveTo(r+c,l+d,r+c-w,l+d),a==="bottom"&&this.drawCaret(t,e,i,o),e.lineTo(r+h,l+d),e.quadraticCurveTo(r,l+d,r,l+d-h),a==="center"&&s==="left"&&this.drawCaret(t,e,i,o),e.lineTo(r,l+u),e.quadraticCurveTo(r,l,r+u,l),e.closePath(),e.fill(),o.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,o=i&&i.x,s=i&&i.y;if(o||s){const a=En[t.position].call(this,this._active,this._eventPosition);if(!a)return;const r=this._size=Ks(this,t),l=Object.assign({},a,this._size),c=Js(e,t,l),d=Zs(t,l,c,e);(o._to!==d.x||s._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=r.width,this.height=r.height,this.caretX=a.x,this.caretY=a.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const o={width:this.width,height:this.height},s={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const a=le(e.padding),r=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&r&&(t.save(),t.globalAlpha=i,this.drawBackground(s,t,o,e),Fa(t,e.textDirection),s.y+=a.top,this.drawTitle(s,t,e),this.drawBody(s,t,e),this.drawFooter(s,t,e),Na(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,o=t.map(({datasetIndex:r,index:l})=>{const c=this.chart.getDatasetMeta(r);if(!c)throw new Error("Cannot find a dataset at index "+r);return{datasetIndex:r,element:c.data[l],index:l}}),s=!xi(i,o),a=this._positionChanged(o,e);(s||a)&&(this._active=o,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const o=this.options,s=this._active||[],a=this._getActiveElements(t,s,e,i),r=this._positionChanged(a,t),l=e||!xi(a,s)||r;return l&&(this._active=a,(o.enabled||o.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),l}_getActiveElements(t,e,i,o){const s=this.options;if(t.type==="mouseout")return[];if(!o)return e.filter(r=>this.chart.data.datasets[r.datasetIndex]&&this.chart.getDatasetMeta(r.datasetIndex).controller.getParsed(r.index)!==void 0);const a=this.chart.getElementsAtEventForMode(t,s.mode,s,i);return s.reverse&&a.reverse(),a}_positionChanged(t,e){const{caretX:i,caretY:o,options:s}=this,a=En[s.position].call(this,t,e);return a!==!1&&(i!==a.x||o!==a.y)}}ht(yo,"positioners",En);var Zu={id:"tooltip",_element:yo,positioners:En,afterInit(n,t,e){e&&(n.tooltip=new yo({chart:n,options:e}))},beforeUpdate(n,t,e){n.tooltip&&n.tooltip.initialize(e)},reset(n,t,e){n.tooltip&&n.tooltip.initialize(e)},afterDraw(n){const t=n.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(n.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",e)}},afterEvent(n,t){if(n.tooltip){const e=t.replay;n.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,t)=>t.bodyFont.size,boxWidth:(n,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:cr},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Qu=Object.freeze({__proto__:null,Colors:uu,Decimation:mu,Filler:Ou,Legend:Uu,SubTitle:Wu,Title:ju,Tooltip:Zu});const tf=(n,t,e,i)=>(typeof t=="string"?(e=n.push(t)-1,i.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function ef(n,t,e,i){const o=n.indexOf(t);if(o===-1)return tf(n,t,e,i);const s=n.lastIndexOf(t);return o!==s?e:o}const nf=(n,t)=>n===null?null:te(Math.round(n),0,t);function ea(n){const t=this.getLabels();return n>=0&&n<t.length?t[n]:n}class wo extends dn{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const i=this.getLabels();for(const{index:o,label:s}of e)i[o]===s&&i.splice(o,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(Mt(t))return null;const i=this.getLabels();return e=isFinite(e)&&i[e]===t?e:ef(i,t,Dt(e,t),this._addedLabels),nf(e,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:o}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),e||(o=this.getLabels().length-1)),this.min=i,this.max=o}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,o=[];let s=this.getLabels();s=t===0&&e===s.length-1?s:s.slice(t,e+1),this._valueRange=Math.max(s.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let a=t;a<=e;a++)o.push({value:a});return o}getLabelForValue(t){return ea.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}ht(wo,"id","category"),ht(wo,"defaults",{ticks:{callback:ea}});function of(n,t){const e=[],{bounds:o,step:s,min:a,max:r,precision:l,count:c,maxTicks:d,maxDigits:u,includeBounds:f}=n,h=s||1,w=d-1,{min:x,max:S}=t,O=!Mt(a),N=!Mt(r),J=!Mt(c),ot=(S-x)/(u+1);let y=Ko((S-x)/w/h)*h,I,R,P,W;if(y<1e-14&&!O&&!N)return[{value:x},{value:S}];W=Math.ceil(S/y)-Math.floor(x/y),W>w&&(y=Ko(W*y/w/h)*h),Mt(l)||(I=Math.pow(10,l),y=Math.ceil(y*I)/I),o==="ticks"?(R=Math.floor(x/y)*y,P=Math.ceil(S/y)*y):(R=x,P=S),O&&N&&s&&Xr((r-a)/s,y/1e3)?(W=Math.round(Math.min((r-a)/y,d)),y=(r-a)/W,R=a,P=r):J?(R=O?a:R,P=N?r:P,W=c-1,y=(P-R)/W):(W=(P-R)/y,An(W,Math.round(W),y/1e3)?W=Math.round(W):W=Math.ceil(W));const X=Math.max(Jo(y),Jo(R));I=Math.pow(10,Mt(l)?X:l),R=Math.round(R*I)/I,P=Math.round(P*I)/I;let V=0;for(O&&(f&&R!==a?(e.push({value:a}),R<a&&V++,An(Math.round((R+V*y)*I)/I,a,na(a,ot,n))&&V++):R<a&&V++);V<W;++V){const G=Math.round((R+V*y)*I)/I;if(N&&G>r)break;e.push({value:G})}return N&&f&&P!==r?e.length&&An(e[e.length-1].value,r,na(r,ot,n))?e[e.length-1].value=r:e.push({value:r}):(!N||P===r)&&e.push({value:P}),e}function na(n,t,{horizontal:e,minRotation:i}){const o=we(i),s=(e?Math.sin(o):Math.cos(o))||.001,a=.75*t*(""+n).length;return Math.min(t/s,a)}class Ei extends dn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return Mt(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:o,max:s}=this;const a=l=>o=e?o:l,r=l=>s=i?s:l;if(t){const l=ke(o),c=ke(s);l<0&&c<0?r(0):l>0&&c>0&&a(0)}if(o===s){let l=s===0?1:Math.abs(s*.05);r(s+l),t||a(o-l)}this.min=o,this.max=s}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:i}=t,o;return i?(o=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,o>1e3&&(console.warn("scales.".concat(this.id,".ticks.stepSize: ").concat(i," would result generating up to ").concat(o," ticks. Limiting to 1000.")),o=1e3)):(o=this.computeTickLimit(),e=e||11),e&&(o=Math.min(e,o)),o}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const o={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},s=this._range||this,a=of(o,s);return t.bounds==="ticks"&&ya(a,this,"value"),t.reverse?(a.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),a}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const o=(i-e)/Math.max(t.length-1,1)/2;e-=o,i+=o}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return qn(t,this.chart.options.locale,this.options.ticks.format)}}class _o extends Ei{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=qt(t)?t:0,this.max=qt(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=we(this.options.ticks.minRotation),o=(t?Math.sin(i):Math.cos(i))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,s.lineHeight/o))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}ht(_o,"id","linear"),ht(_o,"defaults",{ticks:{callback:Bi.formatters.numeric}});const jn=n=>Math.floor(He(n)),tn=(n,t)=>Math.pow(10,jn(n)+t);function ia(n){return n/Math.pow(10,jn(n))===1}function oa(n,t,e){const i=Math.pow(10,e),o=Math.floor(n/i);return Math.ceil(t/i)-o}function sf(n,t){const e=t-n;let i=jn(e);for(;oa(n,t,i)>10;)i++;for(;oa(n,t,i)<10;)i--;return Math.min(i,jn(n))}function af(n,{min:t,max:e}){t=ge(n.min,t);const i=[],o=jn(t);let s=sf(t,e),a=s<0?Math.pow(10,Math.abs(s)):1;const r=Math.pow(10,s),l=o>s?Math.pow(10,o):0,c=Math.round((t-l)*a)/a,d=Math.floor((t-l)/r/10)*r*10;let u=Math.floor((c-d)/Math.pow(10,s)),f=ge(n.min,Math.round((l+d+u*Math.pow(10,s))*a)/a);for(;f<e;)i.push({value:f,major:ia(f),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(s++,u=2,a=s>=0?1:a),f=Math.round((l+d+u*Math.pow(10,s))*a)/a;const h=ge(n.max,f);return i.push({value:h,major:ia(h),significand:u}),i}class xo extends dn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=Ei.prototype.parse.apply(this,[t,e]);if(i===0){this._zero=!0;return}return qt(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=qt(t)?Math.max(0,t):null,this.max=qt(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!qt(this._userMin)&&(this.min=t===tn(this.min,0)?tn(this.min,-1):tn(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,o=this.max;const s=r=>i=t?i:r,a=r=>o=e?o:r;i===o&&(i<=0?(s(1),a(10)):(s(tn(i,-1)),a(tn(o,1)))),i<=0&&s(tn(o,-1)),o<=0&&a(tn(i,1)),this.min=i,this.max=o}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},i=af(e,this);return t.bounds==="ticks"&&ya(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":qn(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=He(t),this._valueRange=He(this.max)-He(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(He(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}ht(xo,"id","logarithmic"),ht(xo,"defaults",{ticks:{callback:Bi.formatters.logarithmic,major:{enabled:!0}}});function So(n){const t=n.ticks;if(t.display&&n.display){const e=le(t.backdropPadding);return Dt(t.font&&t.font.size,Ht.font.size)+e.height}return 0}function rf(n,t,e){return e=Ut(e)?e:[e],{w:fl(n,t.string,e),h:e.length*t.lineHeight}}function sa(n,t,e,i,o){return n===i||n===o?{start:t-e/2,end:t+e/2}:n<i||n>o?{start:t-e,end:t}:{start:t,end:t+e}}function lf(n){const t={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},e=Object.assign({},t),i=[],o=[],s=n._pointLabels.length,a=n.options.pointLabels,r=a.centerPointLabels?Bt/s:0;for(let l=0;l<s;l++){const c=a.setContext(n.getPointLabelContext(l));o[l]=c.padding;const d=n.getPointPosition(l,n.drawingArea+o[l],r),u=Zt(c.font),f=rf(n.ctx,u,n._pointLabels[l]);i[l]=f;const h=ae(n.getIndexAngle(l)+r),w=Math.round(To(h)),x=sa(w,d.x,f.w,0,180),S=sa(w,d.y,f.h,90,270);cf(e,t,h,x,S)}n.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),n._pointLabelItems=ff(n,i,o)}function cf(n,t,e,i,o){const s=Math.abs(Math.sin(e)),a=Math.abs(Math.cos(e));let r=0,l=0;i.start<t.l?(r=(t.l-i.start)/s,n.l=Math.min(n.l,t.l-r)):i.end>t.r&&(r=(i.end-t.r)/s,n.r=Math.max(n.r,t.r+r)),o.start<t.t?(l=(t.t-o.start)/a,n.t=Math.min(n.t,t.t-l)):o.end>t.b&&(l=(o.end-t.b)/a,n.b=Math.max(n.b,t.b+l))}function df(n,t,e){const i=n.drawingArea,{extra:o,additionalAngle:s,padding:a,size:r}=e,l=n.getPointPosition(t,i+o+a,s),c=Math.round(To(ae(l.angle+Gt))),d=mf(l.y,r.h,c),u=hf(c),f=pf(l.x,r.w,u);return{visible:!0,x:l.x,y:d,textAlign:u,left:f,top:d,right:f+r.w,bottom:d+r.h}}function uf(n,t){if(!t)return!0;const{left:e,top:i,right:o,bottom:s}=n;return!(Ne({x:e,y:i},t)||Ne({x:e,y:s},t)||Ne({x:o,y:i},t)||Ne({x:o,y:s},t))}function ff(n,t,e){const i=[],o=n._pointLabels.length,s=n.options,{centerPointLabels:a,display:r}=s.pointLabels,l={extra:So(s)/2,additionalAngle:a?Bt/o:0};let c;for(let d=0;d<o;d++){l.padding=e[d],l.size=t[d];const u=df(n,d,l);i.push(u),r==="auto"&&(u.visible=uf(u,c),u.visible&&(c=u))}return i}function hf(n){return n===0||n===180?"center":n<180?"left":"right"}function pf(n,t,e){return e==="right"?n-=t:e==="center"&&(n-=t/2),n}function mf(n,t,e){return e===90||e===270?n-=t/2:(e>270||e<90)&&(n-=t),n}function gf(n,t,e){const{left:i,top:o,right:s,bottom:a}=e,{backdropColor:r}=t;if(!Mt(r)){const l=an(t.borderRadius),c=le(t.backdropPadding);n.fillStyle=r;const d=i-c.left,u=o-c.top,f=s-i+c.width,h=a-o+c.height;Object.values(l).some(w=>w!==0)?(n.beginPath(),Un(n,{x:d,y:u,w:f,h,radius:l}),n.fill()):n.fillRect(d,u,f,h)}}function vf(n,t){const{ctx:e,options:{pointLabels:i}}=n;for(let o=t-1;o>=0;o--){const s=n._pointLabelItems[o];if(!s.visible)continue;const a=i.setContext(n.getPointLabelContext(o));gf(e,a,s);const r=Zt(a.font),{x:l,y:c,textAlign:d}=s;cn(e,n._pointLabels[o],l,c+r.lineHeight/2,r,{color:a.color,textAlign:d,textBaseline:"middle"})}}function dr(n,t,e,i){const{ctx:o}=n;if(e)o.arc(n.xCenter,n.yCenter,t,0,Rt);else{let s=n.getPointPosition(0,t);o.moveTo(s.x,s.y);for(let a=1;a<i;a++)s=n.getPointPosition(a,t),o.lineTo(s.x,s.y)}}function bf(n,t,e,i,o){const s=n.ctx,a=t.circular,{color:r,lineWidth:l}=t;!a&&!i||!r||!l||e<0||(s.save(),s.strokeStyle=r,s.lineWidth=l,s.setLineDash(o.dash||[]),s.lineDashOffset=o.dashOffset,s.beginPath(),dr(n,e,a,i),s.closePath(),s.stroke(),s.restore())}function yf(n,t,e){return Ge(n,{label:e,index:t,type:"pointLabel"})}class Tn extends Ei{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=le(So(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=qt(t)&&!isNaN(t)?t:0,this.max=qt(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/So(this.options))}generateTickLabels(t){Ei.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,i)=>{const o=Nt(this.options.pointLabels.callback,[e,i],this);return o||o===0?o:""}).filter((e,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?lf(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,o){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-o)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,o))}getIndexAngle(t){const e=Rt/(this._pointLabels.length||1),i=this.options.startAngle||0;return ae(t*e+we(i))}getDistanceFromCenterForValue(t){if(Mt(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(Mt(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return yf(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const o=this.getIndexAngle(t)-Gt+i;return{x:Math.cos(o)*e+this.xCenter,y:Math.sin(o)*e+this.yCenter,angle:o}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:o,bottom:s}=this._pointLabelItems[t];return{left:e,top:i,right:o,bottom:s}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),dr(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:i,grid:o,border:s}=e,a=this._pointLabels.length;let r,l,c;if(e.pointLabels.display&&vf(this,a),o.display&&this.ticks.forEach((d,u)=>{if(u!==0||u===0&&this.min<0){l=this.getDistanceFromCenterForValue(d.value);const f=this.getContext(u),h=o.setContext(f),w=s.setContext(f);bf(this,h,l,a,w)}}),i.display){for(t.save(),r=a-1;r>=0;r--){const d=i.setContext(this.getPointLabelContext(r)),{color:u,lineWidth:f}=d;!f||!u||(t.lineWidth=f,t.strokeStyle=u,t.setLineDash(d.borderDash),t.lineDashOffset=d.borderDashOffset,l=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),c=this.getPointPosition(r,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const o=this.getIndexAngle(0);let s,a;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(o),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((r,l)=>{if(l===0&&this.min>=0&&!e.reverse)return;const c=i.setContext(this.getContext(l)),d=Zt(c.font);if(s=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=d.string,a=t.measureText(r.label).width,t.fillStyle=c.backdropColor;const u=le(c.backdropPadding);t.fillRect(-a/2-u.left,-s-d.size/2-u.top,a+u.width,d.size+u.height)}cn(t,r.label,0,-s,d,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}ht(Tn,"id","radialLinear"),ht(Tn,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Bi.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),ht(Tn,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),ht(Tn,"descriptors",{angleLines:{_fallback:"grid"}});const Vi={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},pe=Object.keys(Vi);function aa(n,t){return n-t}function ra(n,t){if(Mt(t))return null;const e=n._adapter,{parser:i,round:o,isoWeekday:s}=n._parseOpts;let a=t;return typeof i=="function"&&(a=i(a)),qt(a)||(a=typeof i=="string"?e.parse(a,i):e.parse(a)),a===null?null:(o&&(a=o==="week"&&(pn(s)||s===!0)?e.startOf(a,"isoWeek",s):e.startOf(a,o)),+a)}function la(n,t,e,i){const o=pe.length;for(let s=pe.indexOf(n);s<o-1;++s){const a=Vi[pe[s]],r=a.steps?a.steps:Number.MAX_SAFE_INTEGER;if(a.common&&Math.ceil((e-t)/(r*a.size))<=i)return pe[s]}return pe[o-1]}function wf(n,t,e,i,o){for(let s=pe.length-1;s>=pe.indexOf(e);s--){const a=pe[s];if(Vi[a].common&&n._adapter.diff(o,i,a)>=t-1)return a}return pe[e?pe.indexOf(e):0]}function _f(n){for(let t=pe.indexOf(n)+1,e=pe.length;t<e;++t)if(Vi[pe[t]].common)return pe[t]}function ca(n,t,e){if(!e)n[t]=!0;else if(e.length){const{lo:i,hi:o}=Po(e,t),s=e[i]>=t?e[i]:e[o];n[s]=!0}}function xf(n,t,e,i){const o=n._adapter,s=+o.startOf(t[0].value,i),a=t[t.length-1].value;let r,l;for(r=s;r<=a;r=+o.add(r,1,i))l=e[r],l>=0&&(t[l].major=!0);return t}function da(n,t,e){const i=[],o={},s=t.length;let a,r;for(a=0;a<s;++a)r=t[a],o[r]=a,i.push({value:r,major:!1});return s===0||!e?i:xf(n,i,o,e)}class Wn extends dn{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const i=t.time||(t.time={}),o=this._adapter=new Ec._date(t.adapters.date);o.init(e),Pn(i.displayFormats,o.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:ra(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:o,max:s,minDefined:a,maxDefined:r}=this.getUserBounds();function l(c){!a&&!isNaN(c.min)&&(o=Math.min(o,c.min)),!r&&!isNaN(c.max)&&(s=Math.max(s,c.max))}(!a||!r)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),o=qt(o)&&!isNaN(o)?o:+e.startOf(Date.now(),i),s=qt(s)&&!isNaN(s)?s:+e.endOf(Date.now(),i)+1,this.min=Math.min(o,s-1),this.max=Math.max(o+1,s)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,o=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&o.length&&(this.min=this._userMin||o[0],this.max=this._userMax||o[o.length-1]);const s=this.min,a=this.max,r=Qr(o,s,a);return this._unit=e.unit||(i.autoSkip?la(e.minUnit,this.min,this.max,this._getLabelCapacity(s)):wf(this,r.length,e.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:_f(this._unit),this.initOffsets(o),t.reverse&&r.reverse(),da(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,i=0,o,s;this.options.offset&&t.length&&(o=this.getDecimalForValue(t[0]),t.length===1?e=1-o:e=(this.getDecimalForValue(t[1])-o)/2,s=this.getDecimalForValue(t[t.length-1]),t.length===1?i=s:i=(s-this.getDecimalForValue(t[t.length-2]))/2);const a=t.length<3?.5:.25;e=te(e,0,a),i=te(i,0,a),this._offsets={start:e,end:i,factor:1/(e+1+i)}}_generate(){const t=this._adapter,e=this.min,i=this.max,o=this.options,s=o.time,a=s.unit||la(s.minUnit,e,i,this._getLabelCapacity(e)),r=Dt(o.ticks.stepSize,1),l=a==="week"?s.isoWeekday:!1,c=pn(l)||l===!0,d={};let u=e,f,h;if(c&&(u=+t.startOf(u,"isoWeek",l)),u=+t.startOf(u,c?"day":a),t.diff(i,e,a)>1e5*r)throw new Error(e+" and "+i+" are too far apart with stepSize of "+r+" "+a);const w=o.ticks.source==="data"&&this.getDataTimestamps();for(f=u,h=0;f<i;f=+t.add(f,r,a),h++)ca(d,f,w);return(f===i||o.bounds==="ticks"||h===1)&&ca(d,f,w),Object.keys(d).sort(aa).map(x=>+x)}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}format(t,e){const o=this.options.time.displayFormats,s=this._unit,a=e||o[s];return this._adapter.format(t,a)}_tickFormatFunction(t,e,i,o){const s=this.options,a=s.ticks.callback;if(a)return Nt(a,[t,e,i],this);const r=s.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&r[l],u=c&&r[c],f=i[e],h=c&&u&&f&&f.major;return this._adapter.format(t,o||(h?u:d))}generateTickLabels(t){let e,i,o;for(e=0,i=t.length;e<i;++e)o=t[e],o.label=this._tickFormatFunction(o.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,o=we(this.isHorizontal()?e.maxRotation:e.minRotation),s=Math.cos(o),a=Math.sin(o),r=this._resolveTickFontOptions(0).size;return{w:i*s+r*a,h:i*a+r*s}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,o=i[e.unit]||i.millisecond,s=this._tickFormatFunction(t,0,da(this,[t],this._majorUnit),o),a=this._getLabelSize(s),r=Math.floor(this.isHorizontal()?this.width/a.w:this.height/a.h)-1;return r>0?r:1}getDataTimestamps(){let t=this._cache.data||[],e,i;if(t.length)return t;const o=this.getMatchingVisibleMetas();if(this._normalized&&o.length)return this._cache.data=o[0].controller.getAllParsedValues(this);for(e=0,i=o.length;e<i;++e)t=t.concat(o[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const o=this.getLabels();for(e=0,i=o.length;e<i;++e)t.push(ra(this,o[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return xa(t.sort(aa))}}ht(Wn,"id","time"),ht(Wn,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function ai(n,t,e){let i=0,o=n.length-1,s,a,r,l;e?(t>=n[i].pos&&t<=n[o].pos&&({lo:i,hi:o}=Fe(n,"pos",t)),{pos:s,time:r}=n[i],{pos:a,time:l}=n[o]):(t>=n[i].time&&t<=n[o].time&&({lo:i,hi:o}=Fe(n,"time",t)),{time:s,pos:r}=n[i],{time:a,pos:l}=n[o]);const c=a-s;return c?r+(l-r)*(t-s)/c:r}class Co extends Wn{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=ai(e,this.min),this._tableRange=ai(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,o=[],s=[];let a,r,l,c,d;for(a=0,r=t.length;a<r;++a)c=t[a],c>=e&&c<=i&&o.push(c);if(o.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(a=0,r=o.length;a<r;++a)d=o[a+1],l=o[a-1],c=o[a],Math.round((d+l)/2)!==c&&s.push({time:c,pos:a/(r-1)});return s}_generate(){const t=this.min,e=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(e)||i.length===1)&&i.push(e),i.sort((o,s)=>o-s)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return e.length&&i.length?t=this.normalize(e.concat(i)):t=e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(ai(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return ai(this._table,i*this._tableRange+this._minPos,!0)}}ht(Co,"id","timeseries"),ht(Co,"defaults",Wn.defaults);var Sf=Object.freeze({__proto__:null,CategoryScale:wo,LinearScale:_o,LogarithmicScale:xo,RadialLinearScale:Tn,TimeScale:Wn,TimeSeriesScale:Co});const Cf=[Mc,ou,Qu,Sf];Le.register(...Cf);function Df(n){return n?(n=String(n).toLowerCase(),n==="ytd"||n==="ltm"?"mensile":n):""}function kf(n){var t=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),e=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-e);var i=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-i)/864e5+1)/7)}typeof window<"u"&&(typeof window.effectivePeriodType!="function"&&(window.effectivePeriodType=Df),typeof window.isoWeekNum!="function"&&(window.isoWeekNum=kf));(function(){const n=window.fetch.bind(window);function t(){try{const i=JSON.parse(localStorage.getItem("user")||"{}");if(i&&(i.token||i.jwt||i.accessToken))return i.token||i.jwt||i.accessToken}catch(i){}const e=["token","authToken","jwt","bp_token","accessToken","id_token"];for(const i of e){let o=localStorage.getItem(i)||sessionStorage.getItem(i);if(o){try{const s=JSON.parse(o);if(s&&(s.token||s.jwt||s.accessToken))return s.token||s.jwt||s.accessToken}catch(s){}if(o=String(o).replace(/^"+|"+$/g,""),/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$/.test(o))return o}}return null}window.fetch=function(e,i){const o=typeof e=="string"?e:e&&e.url||"";if(!(typeof o=="string"&&(o.startsWith("/api/")||o.startsWith(location.origin+"/api/"))))return n(e,i);const a=t(),r=Object.assign({},i);return r.headers=new Headers(r&&r.headers||{}),a&&!r.headers.has("Authorization")&&r.headers.set("Authorization","Bearer "+a),n(e,r)}})();(function(){function n(){const o=r=>String(r).replace(/^"+|"+$/g,""),s=r=>/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$/.test(r||""),a=["token","authToken","jwt","bp_token","accessToken","id_token"];for(const r of a){let l=localStorage.getItem(r)||sessionStorage.getItem(r);if(l){try{const c=JSON.parse(l);if(c&&(c.token||c.jwt||c.accessToken))return c.token||c.jwt||c.accessToken}catch(c){}if(l=o(l),s(l))return l}}try{const r=JSON.parse(localStorage.getItem("user")||"{}");if(r&&(r.token||r.jwt||r.accessToken))return r.token||r.jwt||r.accessToken}catch(r){}return null}typeof window.users>"u"&&(window.users=[]),(async function o(){try{if(window.GET){const r=await window.GET("/api/usernames");r&&Array.isArray(r.users)&&(window.users=r.users);return}const s=n(),a=await fetch("/api/usernames",{headers:{Accept:"application/json",...s?{Authorization:"Bearer "+s}:{}}});if(a.status===401){setTimeout(o,800);return}if(a.ok){const r=await a.json();r&&Array.isArray(r.users)&&(window.users=r.users)}}catch(s){setTimeout(o,1200)}})();function t(o,s,a){return new Date(Date.UTC(o,s,a))}function e(o){return new Date(o.getTime()+24*3600*1e3-1)}function i(o,s){return new Date(Date.UTC(o,s+1,0))}typeof window.buildBuckets!="function"&&(window.buildBuckets=function(o,s){var a=String(o||"mensile").toLowerCase(),r=effectivePeriodType(a),l=s?new Date(s):new Date,c=l.getUTCFullYear(),d=[];function u(H,j){d.push({s:H.getTime(),e:j.getTime()})}if(a==="ytd"){for(var f=0;f<=l.getUTCMonth();f++){var h=t(l.getUTCFullYear(),f,1),w=e(i(h.getUTCFullYear(),h.getUTCMonth()));u(h,w)}return d}if(a==="ltm"){for(var x=t(l.getUTCFullYear(),l.getUTCMonth(),1),S=11;S>=0;S--){var f=t(x.getUTCFullYear(),x.getUTCMonth()-S,1);u(f,e(i(f.getUTCFullYear(),f.getUTCMonth())))}return d}if(r==="settimanale"){var O=new Date(Date.UTC(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate())),N=(O.getUTCDay()+6)%7;O.setUTCDate(O.getUTCDate()-N);for(var J=52;J>=0;J--){var ot=new Date(O);ot.setUTCDate(O.getUTCDate()-J*7);var y=new Date(ot);y.setUTCDate(ot.getUTCDate()+6),y.setUTCHours(23,59,59,999),u(ot,y)}return d}if(r==="mensile"){for(var x=new Date(Date.UTC(l.getUTCFullYear(),l.getUTCMonth(),1)),S=23;S>=0;S--){var f=new Date(Date.UTC(x.getUTCFullYear(),x.getUTCMonth()-S,1));u(f,e(i(f.getUTCFullYear(),f.getUTCMonth())))}return d}if(r==="trimestrale"){for(var I=Math.floor(l.getUTCMonth()/3),R=11;R>=0;R--){var P=I-R,W=c+Math.floor(P/4),X=(P%4+4)%4,ot=t(W,X*3,1),y=e(new Date(Date.UTC(W,X*3+3,0)));u(ot,y)}return d}if(r==="semestrale"){for(var V=l.getUTCMonth()<6?0:1,G=5;G>=0;G--){var rt=V-G,$=c+Math.floor(rt/2),tt=(rt%2+2)%2,at=tt===0?0:6,C=t($,at,1),E=e(new Date(Date.UTC($,at+6,0)));u(C,E)}return d}for(var k=2;k>=0;k--){var U=c-k;u(t(U,0,1),e(new Date(Date.UTC(U,12,0))))}return d}),typeof window.labelsForBuckets!="function"&&(window.labelsForBuckets=function(o,s){var a=effectivePeriodType(o||"mensile");return(s||[]).map(function(r){var l=new Date(r.s);return a==="settimanale"?"W"+isoWeekNum(l)+" "+l.getUTCFullYear():a==="mensile"?String(l.getUTCMonth()+1).padStart(2,"0")+"/"+l.getUTCFullYear():a==="trimestrale"?"Q"+(Math.floor(l.getUTCMonth()/3)+1)+" "+l.getUTCFullYear():a==="semestrale"?(l.getUTCMonth()<6?"S1 ":"S2 ")+l.getUTCFullYear():String(l.getUTCFullYear())})}),typeof window.sumIndicator!="function"&&(window.sumIndicator=function(o,s,a){var c,d;var r=String(s).toLowerCase()==="previsionale"?o.indicatorsPrev||{}:o.indicatorsCons||{};if(a==="VSDTotale")return Number(r.VSDPersonale||0)+Number(r.VSDIndiretto||0);var l=Number((d=(c=r[a])!=null?c:r[a.toUpperCase()])!=null?d:0);return Number.isFinite(l)?l:0}),(function(){try{let a=function(r,l){try{if(this&&typeof this.getLabelForValue=="function")return String(this.getLabelForValue(r))}catch(f){}try{var c=typeof r=="number"?r:l,d=this&&this.chart&&this.chart.data&&this.chart.data.labels||[],u=Array.isArray(d)?d[c]:void 0;return String(u!=null?u:r)}catch(f){return String(r)}};if(typeof window.Chart>"u")return;try{Chart.defaults=Chart.defaults||{},Chart.defaults.scales=Chart.defaults.scales||{},Chart.defaults.scales.category=Chart.defaults.scales.category||{},Chart.defaults.scales.category.ticks=Object.assign({},Chart.defaults.scales.category.ticks||{},{callback:a})}catch(r){}var s={id:"bpAutoTicks",beforeUpdate:function(r){try{let h=function(w,x){try{var S=Array.isArray(w)?w.length:0;if(!S)return{autoSkip:!0,maxRotation:0,minRotation:0,callback:a};for(var O=0,N=0;N<w.length;N++){var J=""+(w[N]==null?"":w[N]);J.length>O&&(O=J.length)}var ot=Math.max(28,Math.min(90,Math.round(O*7))),y=S*ot;return y>(x||320)*1.2?{autoSkip:!0,maxRotation:45,minRotation:45,callback:a}:{autoSkip:!0,maxRotation:0,minRotation:0,callback:a}}catch(I){return{autoSkip:!0,maxRotation:0,minRotation:0,callback:a}}};if(!r||(r.config&&r.config.type)!=="line")return;var l=r.config&&r.config.data&&r.config.data.labels||[],c=r.canvas&&(r.canvas.clientWidth||r.canvas.width)||320,d=typeof window.computeTickOptions=="function"?window.computeTickOptions:h,u=d(l,c);r.options=r.options||{},r.options.scales=r.options.scales||{};var f=r.options.scales.x||(r.options.scales.x={display:!0});f.ticks=Object.assign({},f.ticks||{},u)}catch(h){}}};try{Chart.register?Chart.register(s):Chart.plugins&&Chart.plugins.register&&Chart.plugins.register(s)}catch(r){}}catch(a){}})()})();(function(n){const t=["localhost","127.0.0.1"].includes(n.location.hostname),e=n.pino?n.pino({level:t?"debug":"info"}):console,i={info:(...o)=>e.info?e.info(...o):console.log(...o),error:(...o)=>e.error?e.error(...o):console.error(...o),warn:(...o)=>e.warn?e.warn(...o):console.warn(...o),debug:(...o)=>e.debug?e.debug(...o):console.debug(...o)};n.logger=i})(window);window.BP_PHRASES=(function(){const n=["Ottimo, {name}! ","Ben fatto, {name}! ","Avanti cos, {name}! ","Perfetto, {name}! ","Bel colpo, {name}! ","Ci siamo, {name}! ","Grande {name}! ","Pezzo dopo pezzo, {name}! ","Molto bene, {name}! ","Stai andando bene, {name}! "],t=["Che figata, {name}! ","Ma cosa dico grande grandissimo, {name}! ","Super, {name}! ","Non ti ferma nessuno, {name}!! ","Stai andando alla grande, {name}! ","Gran progressione, {name}! ","Il ritmo  giusto, {name}! ","Questa spinge, {name}! ","Bello tosto, {name}! ","Gran focus, {name}! "],e=["BOOM! {name}, questo  livello PRO! ","Risultato pazzesco, {name}! ","Clamoroso {name}, cos si fa! "," ufficiale: {name} ON FIRE! ","Top di gamma, {name}! ","Mostruoso upgrade, {name}! ","Record personale in vista, {name}! ","Spacchi tutto, {name}! ","Da incorniciare, {name}! ","Questo alza lasticella, {name}! "],i={lite:n,mid:t,mega:e};return i.standard=n,i.rilevante=t,i.grande=e,i.pick=function(o,s){const a=i[o]||n,r=s||JSON.parse(localStorage.getItem("bp_user")||"{}").name||"campione";return(a[Math.floor(Math.random()*a.length)]||"Grande!").replace(/\{name\}/g,r)},i.random=function(o){const s=[n,t,e],a=s[Math.floor(Math.random()*s.length)];return i.pick(a===e?"mega":a===t?"rilevante":"standard",o)},i})();(function(){const n=window.BP=window.BP||{},t=n.Haptics=n.Haptics||{};function e(){const o=navigator.userAgent||navigator.vendor||"";return/android|iphone|ipad|ipod|mobile/i.test(o)}function i(o){if(e()&&"vibrate"in navigator)try{switch(o){case"light":navigator.vibrate(12);break;case"heavy":navigator.vibrate([10,30,10]);break;default:navigator.vibrate(18);break}}catch(s){}}t.impact=i})();(function(){const n=window.BP=window.BP||{},t=n.Undo=n.Undo||{},e=document.createElement("div");e.className="bp-undo-host",document.body.appendChild(e);const i="\n  .bp-undo-host{\n    position: fixed; left:50%; transform: translateX(-50%);\n    bottom: 20px; z-index: 1201; display:flex; flex-direction:column; gap:8px;\n  }\n  .bp-undo{\n    min-width: 280px; max-width: 540px;\n    background: rgba(15,19,28,.95);\n    border:1px solid rgba(255,255,255,.18);\n    border-radius: 12px; padding: 10px 12px;\n    box-shadow: 0 10px 24px rgba(0,0,0,.35);\n    display:flex; align-items:center; gap:10px;\n    animation: bpUndoPop .16s ease-out;\n  }\n  .bp-undo .lbl{ font-weight:700; }\n  .bp-undo .spacer{ flex:1; }\n  .bp-undo button{ white-space:nowrap; }\n  @keyframes bpUndoPop{ from{ transform: translate(-50%, 4px); opacity:0 } to{ transform: translate(-50%, 0); opacity:1 } }\n  ",o=document.createElement("style");o.textContent=i,document.head.appendChild(o);function s(a){const r=document.createElement("div");r.className="bp-undo",r.innerHTML='\n      <div class="lbl">'.concat(a&&a.label||"Operazione eseguita",'</div>\n      <div class="spacer"></div>\n      <button type="button" class="ghost" data-undo>Annulla</button>\n    '),e.appendChild(r);let l=!1;const c=setTimeout(()=>{l||(l=!0,r.remove())},a&&a.timeoutMs||5e3);r.querySelector("[data-undo]").addEventListener("click",()=>{if(!l){l=!0,clearTimeout(c);try{a&&a.onUndo&&a.onUndo()}catch(d){}r.remove()}})}t.push=s})();(function(){const n=window.BP=window.BP||{},t=n.ClientsHelpers=n.ClientsHelpers||{};function e(a){return String(a||"").trim().toLowerCase()}function i(a){const r={};return(a||[]).forEach(l=>{const c=e(l.client);if(!c)return;const d=l.start||l.end;if(!d)return;const u=r[c];(!u||new Date(d)>new Date(u))&&(r[c]=d)}),r}function o(a,r){const l=i(r);return(a||[]).map(c=>{const d=l[e(c.name)]||null;return{...c,lastAppointment:d}})}function s(a,{status:r,consultantId:l,consultantName:c}){const d=h=>String(h||"").trim().toLowerCase(),u=h=>{const w=d(h).replace(/\s+/g,"_").replace(/-/g,"_");return w==="lead_non_chiuso"||w==="lead_non-chiuso"?"lead_non_chiuso":w};let f=a||[];if(r&&r!=="tutti"&&(f=f.filter(h=>u(h.status)===u(r))),l)f=f.filter(h=>(h.consultantId||"")===String(l));else if(c){const h=d(c);f=f.filter(w=>d(w.consultantName)===h)}return f}t.withLastAppointment=o,t.filter=s})();(function(){const n=window.BP=window.BP||{},t=n.Targets=n.Targets||{},e=["VSS","VSDPersonale","VSDIndiretto","GI"],i=["NNCF","AppFatti","Telefonate"],o=e.concat(i),s={senior:{VSS:3e4,VSDPersonale:15e3,VSDIndiretto:5e3,GI:15e3,NNCF:1,AppFatti:4,Telefonate:0},junior:{VSS:15e3,VSDPersonale:5e3,VSDIndiretto:5e3,GI:1e4,NNCF:4,AppFatti:30,Telefonate:300}};function a(h,w){const x=Number(h||0),S=Number(w||0);return S?Math.ceil(x/S)*S:Math.ceil(x)}function r(h){switch(String(h||"mensile").toLowerCase()){case"settimanale":return 1/4;case"mensile":return 1;case"trimestrale":return 3;case"semestrale":return 6;case"annuale":return 12;default:return 1}}function l(h){return e.indexOf(h)>=0}function c(h){const w=String(h||"junior").toLowerCase()==="senior"?"senior":"junior";return{...s[w]}}function d(h,w){const x=r(w),S=c(h),O={};for(const N of o){const J=Number(S[N]||0)*x;l(N)?String(w).toLowerCase()==="settimanale"?O[N]=a(J,500):O[N]=a(J,5e3):O[N]=Math.ceil(J)}return O}function u(h,w){const x={};for(const S of o){const O=Number((h||{})[S]||0),N=Number((w||{})[S]||0),J=O-N,ot=N>0?Math.round(O/N*100):O>0?100:0;x[S]={value:O,target:N,delta:J,pct:Math.max(0,ot)}}return x}function f(h){const w=[];for(const S of o){const O=(h||{})[S];O&&O.target>0&&w.push(Number(O.pct||0))}if(!w.length)return 0;const x=w.reduce((S,O)=>S+O,0)/w.length;return Math.round(x)}t.MONEY_KEYS=e,t.COUNT_KEYS=i,t.ALL_KEYS=o,t.getMonthly=c,t.getForPeriod=d,t.compare=u,t.summarize=f})();(function(){const n=window.BP=window.BP||{},t=n.ICS=n.ICS||{};function e(i){try{logger.warn("[BP ICS bulk disabled] chiamata a:",i)}catch(o){}}t.createCalendarForRange=function(){return e("createCalendarForRange()"),null},t.downloadForRange=function(){return e("downloadForRange()"),!1}})();(function(){const n=window.BP=window.BP||{},t=n.ClientStatus=n.ClientStatus||{},e="bp_banner_seen";function i(){try{return JSON.parse(localStorage.getItem(e)||"{}")}catch(h){return{}}}function o(h){try{localStorage.setItem(e,JSON.stringify(h||{}))}catch(w){}}function s(h){return!!i()[h]}function a(h){const w=i();w[h]=!0,o(w)}async function r(h){const w=window.authToken||"",x=await fetch(h,{headers:w?{Authorization:"Bearer "+w}:{}});if(!x.ok)throw new Error("GET "+h+" failed");return x.json()}async function l(h,w){const x=window.authToken||"",S=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json",...x?{Authorization:"Bearer "+x}:{}},body:JSON.stringify(w||{})});if(!S.ok)throw new Error("POST "+h+" failed");return S.json()}async function c({clientId:h,status:w}){if(!h)throw new Error("missing clientId");return l("/api/clients",{id:h,status:String(w||"")})}t.setClientStatusByName=d;async function d({clientName:h,status:w}){const x=String(h||"").trim();if(!x)throw new Error("missing clientName");const O=((await r("/api/clients")).clients||[]).find(ot=>String(ot.name||"").toLowerCase()===x.toLowerCase());if(O)return c({clientId:O.id,status:w});await l("/api/clients",{name:x});const J=((await r("/api/clients")).clients||[]).find(ot=>String(ot.name||"").toLowerCase()===x.toLowerCase());if(!J)throw new Error("client creation failed");return c({clientId:J.id,status:w})}function u({appointment:h,clientName:w},x){const S=h||{},O=w||S.client||"Cliente",N=document.createElement("div");return N.className="bp-banner-client",N.innerHTML='\n      <div class="bp-banner-inner">\n        <div class="bp-banner-title"> diventato cliente?</div>\n        <div class="bp-banner-sub">Appuntamento con <b>'.concat(f(O),'</b></div>\n        <div class="bp-banner-actions">\n          <button type="button" data-yes>S</button>\n          <button type="button" class="ghost" data-no>No</button>\n        </div>\n      </div>\n    '),N.querySelector("[data-yes]").addEventListener("click",()=>x&&x(!0,S)),N.querySelector("[data-no]").addEventListener("click",()=>x&&x(!1,S)),N}function f(h){return String(h).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(function(){if(document.getElementById("bp-clientstatus-css"))return;const w="\n.bp-banner-client{\n  position: fixed; left:50%; transform:translateX(-50%);\n  top: 70px; z-index: 1200;\n  background: rgba(20,24,34,.95);\n  color: #fff;\n  border: 1px solid rgba(255,255,255,.18);\n  box-shadow: 0 10px 24px rgba(0,0,0,.35);\n  border-radius:14px; padding:10px; min-width:280px;\n  animation: bpBannerPop .18s ease-out;\n}\n.bp-banner-inner{ display:flex; flex-direction:column; gap:6px; }\n.bp-banner-title{ font-weight:800; }\n.bp-banner-sub{ font-size:12px; opacity:.92; }\n.bp-banner-actions{ display:flex; gap:8px; margin-top:6px; justify-content:flex-end; }\n@keyframes bpBannerPop{ from{ transform:translate(-50%, -6px); opacity:0 } to{ transform:translate(-50%, 0); opacity:1 } }\n",x=document.createElement("style");x.id="bp-clientstatus-css",x.textContent=w,document.head.appendChild(x)})(),t.hasSeen=s,t.markSeen=a,t.renderBecameClientBanner=u,t.setClientStatus=c,t.setClientStatusByName=d})();(function(){function n(t){try{fetch("/api/client_error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:location.href,info:{ua:navigator.userAgent},...t})})}catch(e){}}window.addEventListener("error",function(t){try{n({message:t.message,stack:t.error&&t.error.stack||null})}catch(e){}}),window.addEventListener("unhandledrejection",function(t){try{n({message:"unhandledrejection",stack:t.reason&&t.reason.stack||String(t.reason)})}catch(e){}})})();(function(){function n(t){return String(t||"event").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]+/g,"_").replace(/^_+|_+$/g,"").slice(0,80)||"event"}if(window.saveICS&&!window.__icsSanitized){const t=window.saveICS;window.saveICS=function(e,i){try{e=n(e)}catch(o){}return t(e,i)},window.__icsSanitized=!0}window.__icsSanitize=n})();(function(n){function t(e){const i=window.BANNERS_LOOKBACK_DAYS||7,o="nncf",s="sale",a=(C,E)=>"bp_snooze_".concat(E,"_").concat(C),r=(C,E)=>"bp_done_".concat(E,"_").concat(C),l=(C,E)=>{try{const k=localStorage.getItem(a(C,E));return k&&new Date(k).getTime()>Date.now()}catch(k){return!1}},c=(C,E)=>{try{const k=new Date;k.setDate(k.getDate()+1),localStorage.setItem(a(C,E),k.toISOString())}catch(k){}},d=(C,E)=>{try{return localStorage.getItem(r(C,E))==="1"}catch(k){return!1}},u=(C,E)=>{try{localStorage.setItem(r(C,E),"1")}catch(k){}},f=(C,E)=>"bp_push_".concat(E,"_").concat(C),h=(C,E)=>{try{return localStorage.getItem(f(C,E))==="1"}catch(k){return!1}},w=(C,E)=>{try{localStorage.setItem(f(C,E),"1")}catch(k){}},x=window.BPFinal&&BPFinal.GET||window.GET,S=window.BPFinal&&BPFinal.POST||window.POST,O=window.toast||(C=>alert(C));function N(C){return String(C||"").replace(/[&<>\"]/g,E=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[E])}async function J(C,E){try{if(!S||!E||!E.id||h(E.id,C))return;const k=new Date(E.end||E.start||Date.now()).toLocaleString("it-IT",{dateStyle:"short",timeStyle:"short"}),U="Battle Plan",H=C==="nncf"?" diventato cliente? ".concat(String(E.client||""),". Appuntamento del ").concat(k):"Hai venduto a ".concat(String(E.client||"Cliente"),"? Appuntamento del ").concat(k);await S("/api/push/test",{payload:{title:U,body:H,tag:C==="nncf"?"bp-nncf":"bp-sale",url:"/"}}),w(E.id,C)}catch(k){}}function ot(){if(document.getElementById("bp-banner-css"))return;const C="\n      #bp_banner_host{position:fixed;left:16px;right:16px;bottom:16px;z-index:9999;display:flex;justify-content:center;pointer-events:none}\n      .bp-banner-card{pointer-events:auto;width:100%;max-width:720px;background:var(--card,#fff);color:var(--text,#111);\n        border:1px solid rgba(0,0,0,.12);border-radius:14px;box-shadow:0 10px 28px rgba(0,0,0,.28);padding:12px;display:flex;gap:12px;align-items:center;opacity:0;transform:translateY(8px);transition:opacity .2s,transform .2s}\n      .bp-banner-card.show{opacity:1;transform:none}\n      .bp-banner-card .msg{flex:1}.bp-banner-card .row{display:flex;gap:8px;align-items:center}\n      .bp-banner-card .ghost{background:rgba(0,0,0,.06);border:1px solid rgba(0,0,0,.12)}\n      @media (prefers-color-scheme: dark){ .bp-banner-card{background:rgba(15,18,28,.96);color:#fff;border-color:rgba(255,255,255,.16)}\n        .bp-banner-card .ghost{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.18)}}\n    ",E=document.createElement("style");E.id="bp-banner-css",E.textContent=C,document.head.appendChild(E)}function y(){let C=document.getElementById("bp_banner_host");return C||(C=document.createElement("div"),C.id="bp_banner_host",document.body.appendChild(C)),C}let I=[],R=!1;function P(C){I.push(C),W()}function W(){if(R)return;const C=I.shift();if(!C)return;R=!0,ot();const E=y();E.innerHTML="";const k=C(U);E.appendChild(k),requestAnimationFrame(()=>k.classList.add("show"));function U(){E.innerHTML="",R=!1,setTimeout(W,40)}}async function X(C,E){if(!C)return;const k=await x("/api/clients"),H=(k&&k.clients||[]).find(j=>String(j.name||"").trim().toLowerCase()===String(C).trim().toLowerCase());H&&await S("/api/clients",{id:H.id,status:E})}function V(C){if(C)try{if(typeof window.openPaymentBuilderById=="function"){window.openPaymentBuilderById(C);return}if(typeof window.gotoGIAndOpenBuilder=="function"){window.gotoGIAndOpenBuilder(C);return}if(document.querySelector("#gi_rows")){document.dispatchEvent(new CustomEvent("gi:edit",{detail:{id:C}}));return}if(typeof window.viewGI=="function"){try{window.viewGI()}catch(k){}let E=0;(function k(){if(document.getElementById("gi_rows")||E>40){try{document.dispatchEvent(new CustomEvent("gi:edit",{detail:{id:C}}))}catch(H){}return}E++,setTimeout(k,100)})();return}document.dispatchEvent(new CustomEvent("gi:edit",{detail:{id:C}}))}catch(E){}}function G(C,E){const k=Number(C.vss||C.vsdPersonal||0)||0,U=C.client||"Cliente",H='\n      <div class="card" style="min-width:min(380px,96vw);max-width:480px">\n        <div style="display:flex;justify-content:space-between;align-items:center">\n          <b>VSS per '.concat(N(U),'</b>\n          <button class="ghost" id="vss_x">Chiudi</button>\n        </div>\n        <div class="row" style="margin-top:8px;gap:8px;align-items:flex-end;flex-wrap:wrap">\n          <div style="min-width:200px">\n            <label>Valore VSS</label>\n            <input id="vss_val" type="number" step="1" value="').concat(k,'">\n          </div>\n          <div class="muted small">Modifica consentita solo per VSS</div>\n        </div>\n        <div class="right" style="margin-top:12px">\n          <button id="vss_ok">Salva</button>\n        </div>\n      </div>');if(typeof window.showOverlay=="function"&&typeof window.hideOverlay=="function"){showOverlay(H);const et=document.getElementById("bp-overlay-panel")||document.body,Y=ct=>et.querySelector(ct),lt=()=>{try{hideOverlay()}catch(ct){}};Y("#vss_x").onclick=lt,Y("#vss_ok").onclick=async()=>{try{const ct=Math.max(0,Number(Y("#vss_val").value||0));if(await S("/api/appointments",{id:C.id,vss:ct}),e("medium"),O("Appuntamento aggiornato"),lt(),ct>0)try{const st=await rt(C,ct);if(st&&(st.id||st._id)){const m=st.id||st._id;V(m)}}catch(st){logger.error(st)}E&&E.onSaved}catch(ct){logger.error(ct),O("Errore salvataggio VSS")}};return}const j=document.createElement("div");j.className="modal",j.innerHTML=H,document.body.appendChild(j);const q=()=>{try{j.remove()}catch(et){}};j.querySelector("#vss_x").onclick=q,j.querySelector("#vss_ok").onclick=async()=>{try{const et=Math.max(0,Number(j.querySelector("#vss_val").value||0));if(await S("/api/appointments",{id:C.id,vss:et}),e("medium"),O("Appuntamento aggiornato"),q(),et>0)try{const Y=await rt(C,et);if(Y&&(Y.id||Y._id)){const lt=Y.id||Y._id;V(lt)}}catch(Y){logger.error(Y)}E&&E.onSaved}catch(et){logger.error(et),O("Errore salvataggio VSS")}}}async function rt(C,E){const k={apptId:C.id,date:new Date(C.end||C.start||Date.now()).toISOString(),clientName:C.client||"Cliente",vssTotal:Math.round(Number(E||0)),services:C.services||C.note||"",consultantId:C.userId||C.ownerId||null},U=await S("/api/gi",k);return U&&(U.sale||U.gi||U.data)||U}function $(C){return function(E){const k=document.createElement("div");k.className="bp-banner-card",k.setAttribute("role","alertdialog"),k.setAttribute("aria-live","assertive");const U=new Date(C.end||C.start||Date.now()).toLocaleString("it-IT",{dateStyle:"short",timeStyle:"short"});return k.innerHTML='<div class="msg"><b>Allora, hai venduto a '.concat(N(C.client||"Cliente"),'?</b>\n           <div class="small muted">Appuntamento del ').concat(N(U),'</div></div>\n         <div class="row">\n           <button class="ghost" data-act="later">Posticipa</button>\n           <button class="ghost" data-act="no">No</button>\n           <button data-act="yes">S</button>\n         </div>'),k.querySelector('[data-act="yes"]').onclick=function(){u(C.id,s),E(),G(C)},k.querySelector('[data-act="no"]').onclick=async function(){u(C.id,s),E();try{await S("/api/appointments",{id:C.id,vss:0}),O("Registrato: nessuna vendita")}catch(H){}},k.querySelector('[data-act="later"]').onclick=function(){c(C.id,s),O("Te lo ripropongo domani"),E()},k}}function tt(C){return function(E){const k=document.createElement("div");k.className="bp-banner-card",k.setAttribute("role","alertdialog"),k.setAttribute("aria-live","assertive");const U=new Date(C.end||C.start||Date.now()).toLocaleString("it-IT",{dateStyle:"short",timeStyle:"short"});return k.innerHTML='<div class="msg"><b> diventato cliente?</b> '.concat(N(C.client||""),'\n           <div class="small muted">Appuntamento del ').concat(N(U),'</div></div>\n         <div class="row">\n           <button class="ghost" data-act="later">Posticipa</button>\n           <button class="ghost" data-act="no">No</button>\n           <button data-act="yes">S</button>\n         </div>'),k.querySelector('[data-act="yes"]').onclick=async function(){u(C.id,o),E();try{await S("/api/appointments",{id:C.id,nncfPromptAnswered:!0}),await X(C.client,"attivo")}catch(H){}G(C)},k.querySelector('[data-act="no"]').onclick=async function(){u(C.id,o),E();try{await S("/api/appointments",{id:C.id,nncfPromptAnswered:!0}),await X(C.client,"lead non chiuso"),await S("/api/appointments",{id:C.id,vss:0}),O("Aggiornato: Lead non chiuso, VSS=0")}catch(H){}},k.querySelector('[data-act="later"]').onclick=function(){c(C.id,o),O("Te lo ripropongo domani"),E()},k}}async function at(){try{const C=await x("/api/appointments"),E=Date.now(),k=E-i*24*60*60*1e3,U=C&&C.appointments||[];U.sort((H,j)=>+new Date(j.end||j.start||0)-+new Date(H.end||H.start||0)),U.forEach(H=>{try{const j=+new Date(H.end||H.start||0);if(!j||j>E||j<k||!(String(H.type||"").toLowerCase()==="vendita"))return;if(H.nncf){if(H.nncfPromptAnswered||d(H.id,o)||l(H.id,o))return;J(o,H),P(tt(H))}else{if(d(H.id,s)||l(H.id,s))return;J(s,H),P($(H))}}catch(j){}})}catch(C){}}window.scanBanners=at,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",at,{once:!0}):at();try{document.addEventListener("appt:saved",function(){setTimeout(at,50)})}catch(C){}try{document.addEventListener("visibilitychange",function(){document.hidden||setTimeout(at,50)})}catch(C){}try{setInterval(function(){at()},60*1e3)}catch(C){}}typeof n<"u"&&(n.initPostSaleBanners=t)})(typeof window<"u"?window:void 0);const At=window.BP&&BP.Haptics&&BP.Haptics.impact?BP.Haptics.impact:()=>{};(function(){window.bpAuthToken||(window.bpAuthToken=function(){try{const p=localStorage.getItem("bp_user")||sessionStorage.getItem("bp_user");if(p)try{const g=JSON.parse(p);if(g&&(g.token||g.jwt||g.accessToken))return g.token||g.jwt||g.accessToken}catch(g){}}catch(p){}const m=["bp_token","authToken","token","jwt","accessToken","id_token","auth","authorization","session","user"];for(const p of m)try{const g=localStorage.getItem(p)||sessionStorage.getItem(p);if(!g)continue;try{const v=JSON.parse(g);if(v&&(v.token||v.jwt||v.accessToken))return v.token||v.jwt||v.accessToken}catch(v){}if(/^[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+$/.test(g))return g}catch(g){}try{for(let p=0;p<localStorage.length;p++){const g=localStorage.key(p),v=localStorage.getItem(g);if(v){try{const T=JSON.parse(v);if(T&&(T.token||T.jwt||T.accessToken))return T.token||T.jwt||T.accessToken}catch(T){}if(/^[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+$/.test(v))return v}}}catch(p){}try{const p=JSON.parse(localStorage.getItem("user")||"{}");if(p&&(p.token||p.jwt||p.accessToken))return p.token||p.jwt||p.accessToken}catch(p){}return null}),window.GET||(window.GET=async function(m){const p=window.bpAuthToken&&window.bpAuthToken()||null,g=await fetch(m,{headers:{Accept:"application/json",...p?{Authorization:"Bearer "+p}:{}}});return g.status===204?null:(g.headers.get("content-type")||"").includes("application/json")?g.json():{ok:g.ok,status:g.status,text:await g.text()}}),window.POST||(window.POST=async function(m,p){const g=window.bpAuthToken&&window.bpAuthToken()||null,v=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json",...g?{Authorization:"Bearer "+g}:{}},body:JSON.stringify(p||{})});return v.status===204?null:(v.headers.get("content-type")||"").includes("application/json")?v.json():{ok:v.ok,status:v.status,text:await v.text()}}),typeof window<"u"&&typeof window.initPostSaleBanners=="function"&&window.initPostSaleBanners(At),(function(){if(document.getElementById("bp-qvss-css"))return;const p=document.createElement("style");p.id="bp-qvss-css",p.textContent='\n    #bp_overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);\n      display:flex;align-items:center;justify-content:center;z-index:9999;padding:16px}\n    .bp-modal{max-width:620px;width:clamp(300px,92vw,620px);background:var(--card,#fff);\n      color:var(--text,#111);border-radius:14px;border:1px solid rgba(0,0,0,.12);\n      box-shadow:0 12px 34px rgba(0,0,0,.35)}\n    .bp-modal .hd{display:flex;align-items:center;justify-content:space-between;padding:12px 14px}\n    .bp-modal .bd{padding:10px 14px 14px}\n    .bp-modal .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}\n    .bp-modal .right{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}\n    .bp-modal input[type="number"], .bp-modal input[type="date"], .bp-modal select, .bp-modal textarea{\n      width:100%;padding:8px;border:1px solid rgba(0,0,0,.18);border-radius:10px}\n    @media (prefers-color-scheme:dark){\n      .bp-modal{background:rgba(15,18,28,.98);color:#fff;border-color:rgba(255,255,255,.14)}\n      .bp-modal input, .bp-modal select, .bp-modal textarea{background:rgba(255,255,255,.04);color:#fff;border-color:rgba(255,255,255,.18)}\n    }\n  ',document.head.appendChild(p)})();function n(m){return String(m||"").replace(/[&<>'"]/g,p=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[p])}function t(m){if(window.showOverlay)window.showOverlay(m);else{const p=document.createElement("div");p.id="bp_overlay",p.innerHTML=m,document.body.appendChild(p)}}function e(){if(window.hideOverlay)window.hideOverlay();else{const m=document.getElementById("bp_overlay");m&&m.remove()}}async function i(m){try{const p=await N("/api/clients"),g=p&&p.clients||[],v=String(m||"").trim().toLowerCase(),T=g.find(F=>String(F.name||"").trim().toLowerCase()===v);return T?T.id:null}catch(p){return null}}async function o(m,p){if(!(Number(p)>0))return null;const g=new Date(m.end||m.start||Date.now()).toISOString();let v=m.clientId||null;v||(v=await i(m.client));const T={date:g,vssTotal:Number(p)||0,services:m.services||"",consultantId:m.userId||(JSON.parse(localStorage.getItem("user")||"{}")||{}).id,clientId:v||void 0,clientName:m.client||void 0},F=await J("/api/gi",T);return F&&(F.id||F.sale&&F.sale.id)||null}async function s(m){if(typeof viewGI=="function"&&document.querySelector("#gi_rows")){document.dispatchEvent(new CustomEvent("gi:edit",{detail:{id:m}}));return}if(typeof viewGI=="function"){try{viewGI()}catch(p){}setTimeout(()=>document.dispatchEvent(new CustomEvent("gi:edit",{detail:{id:m}})),350);return}try{let F=function(B){const A=T("pb_rates");if(!B||!B.length){A.textContent="Nessuna rata",A._data=[];return}A.innerHTML=B.map(b=>{const _=new Date(b.dueDate).toLocaleDateString("it-IT");return"<div>".concat(_,"  ").concat(Number(b.amount||0).toLocaleString("it-IT"),' <span class="muted">').concat(n(b.note||""),"</span></div>")}).join(""),A._data=B};const p=await N("/api/gi?from=1900-01-01&to=2999-12-31"),g=(p&&p.sales||[]).find(B=>String(B.id)===String(m));if(!g){S("Vendita non trovata");return}const v=new Date().toISOString().slice(0,10);t('<div class="bp-modal"><div class="hd"><b>Builder pagamenti  '+n(g.clientName||"Cliente")+'</b><button class="ghost" id="pb_x">Chiudi</button></div><div class="bd"><div class="row"><div style="flex:1"><label>Totale VSS</label><input id="pb_vss" type="number" value="'+Number(g.vssTotal||0)+'"></div></div><div class="row" style="margin-top:8px;gap:12px"><div><label>Regola rapida</label><select id="pb_rule"><option value="0">Manuale</option><option value="50-25-25">50% + 25% / 30-60gg</option><option value="20+12">20% + 12 rate mensili</option></select></div><div><label>Prima scadenza</label><input id="pb_first" type="date" value="'+v+'"></div></div><div style="margin-top:8px"><label>Rate</label><div id="pb_rates" class="small muted">Nessuna rata</div></div><div class="right"><button class="ghost" id="pb_apply">Ricalcola</button><button id="pb_save">Salva</button></div></div></div>');const T=B=>document.getElementById(B);T("pb_apply").onclick=function(){const B=T("pb_rule").value||"0",A=Math.max(0,Number(T("pb_vss").value||0)),b=new Date(T("pb_first").value||new Date),_=[],D=(M,L,K)=>_.push({dueDate:new Date(M).toISOString(),amount:Math.round(L),note:K||""});if(B==="50-25-25"){D(b,A*.5,"Acconto 50%");const M=new Date(b);M.setDate(M.getDate()+30),D(M,A*.25,"Saldo 25% a 30gg");const L=new Date(b);L.setDate(L.getDate()+60),D(L,A*.25,"Saldo 25% a 60gg")}else if(B==="20+12"){D(b,A*.2,"Acconto 20%");const M=A*.8,L=12,K=M/L;for(let Z=0;Z<L;Z++){const ut=new Date(b);ut.setMonth(ut.getMonth()+Z+1),D(ut,K,"Rata "+(Z+1)+"/"+L)}}F(_)},T("pb_save").onclick=async function(){const B=Math.max(0,Number(T("pb_vss").value||0)),A=T("pb_rates")._data||[];try{await J("/api/gi",{id:g.id,vssTotal:B,schedule:A});try{document.dispatchEvent(new CustomEvent("payments:defined",{detail:{id:g.id,vssTotal:B,schedule:A}}))}catch(b){}S("Piano pagamenti salvato"),e()}catch(b){logger.error(b),S("Errore salvataggio")}},T("pb_x").onclick=e}catch(p){logger.error(p)}}function a(m){const p=m.client||"Cliente",g=Number(m.vss||m.vsdPersonal||0)||0;t('<div class="bp-modal"><div class="hd"><b>VSS per '+n(p)+'</b><button class="ghost" id="qvss_x">Chiudi</button></div><div class="bd"><div><label>Valore VSS</label><input id="qvss_val" type="number" step="1" value="'+g+'"></div><div class="small muted" style="margin-top:6px">Modifica consentita solo per VSS</div><div class="right"><button id="qvss_ok">Salva</button></div></div></div>'),document.getElementById("qvss_x").onclick=e,document.getElementById("qvss_ok").onclick=async function(){try{const v=Math.max(0,Number(document.getElementById("qvss_val").value||0));await J("/api/appointments",{id:m.id,vss:v});const T=await o(m,v);e(),S("VSS salvato"),T&&s(T);try{T&&document.dispatchEvent(new CustomEvent("gi:created",{detail:{id:T}}))}catch(F){}document.dispatchEvent(new Event("bp:saved"))}catch(v){logger.error(v),S("Errore salvataggio VSS")}}}async function r(m){try{m.nncf&&(await(async function(){try{const g=await N("/api/clients"),v=g&&g.clients||[],T=String(m.client||"").trim().toLowerCase(),F=v.find(B=>String(B.name||"").trim().toLowerCase()===T);F&&await J("/api/clients",{id:F.id,status:"attivo"})}catch(g){}})(),document.dispatchEvent(new Event("client:converted"))),a(m)}catch(p){logger.error(p)}}async function l(m){try{if(m.nncf)try{const p=await N("/api/clients"),g=p&&p.clients||[],v=String(m.client||"").trim().toLowerCase(),T=g.find(F=>String(F.name||"").trim().toLowerCase()===v);T&&await J("/api/clients",{id:T.id,status:"lead non chiuso"})}catch(p){}await J("/api/appointments",{id:m.id,vss:0}),S("Ok, segnato come non venduto")}catch(p){logger.error(p),S("Errore aggiornamento")}}window.pipelineYes=r,window.pipelineNo=l,(function(){function m(){if(document.getElementById("bp-center-css"))return;const _="\n      #bp_overlay{display:flex;align-items:center;justify-content:center}\n      .bp-modal-card{min-width:min(560px,96vw);max-width:680px;max-height:86vh;overflow:auto}\n      @media (max-width:640px){ .bp-modal-card{min-width:96vw} }\n      .bp-modal-foot{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}\n    ",D=document.createElement("style");D.id="bp-center-css",D.textContent=_,document.head.appendChild(D)}function p(_){try{document.documentElement.style.overflow=_?"hidden":""}catch(D){}}async function g(_){if(!_)return null;try{const D=await N("/api/clients"),M=D&&D.clients||[],L=String(_).trim().toLowerCase(),K=M.find(Z=>String(Z.name||"").trim().toLowerCase()===L);return K?K.id:null}catch(D){return null}}async function v(_,D){const M=await g(_);if(M)try{await J("/api/clients",{id:M,status:D})}catch(L){}}async function T(_,D){return J("/api/appointments",{id:_,vss:Math.max(0,Number(D||0))})}async function F(_,D){const M=await g(_.client||""),L={date:new Date(_.end||_.start||Date.now()).toISOString(),clientId:M||void 0,clientName:_.client||"",vssTotal:Math.max(0,Number(D||0)),services:_.services||"",schedule:[]},K=await J("/api/gi",L);return K&&(K.id||K.sale&&K.sale.id||Array.isArray(K.sales)&&K.sales[0]&&K.sales[0].id)||null}async function B(_){if(!_)return;try{typeof window.viewGI=="function"&&window.viewGI()}catch(M){}let D=0;(function M(){if(document.getElementById("gi_rows")||D>40){try{const K=new CustomEvent("gi:edit",{detail:{id:_}});document.dispatchEvent(K)}catch(K){}return}D++,setTimeout(M,100)})()}function A(_,D){m(),p(!0);const M=Math.max(0,Number(_.vss||0)),L='<div class="modal"><div class="card bp-modal-card"><div style="display:flex;justify-content:space-between;align-items:center;gap:8px"><b>VSS per '+(_.client?b(_.client):"appuntamento")+'</b><button class="ghost" id="qvss_x">Chiudi</button></div><div style="margin-top:8px"><label>Valore VSS</label><input id="qvss_val" type="number" step="1" value="'+M+'"><div class="small muted" style="margin-top:6px">Modifica consentita solo per VSS</div></div><div class="bp-modal-foot"><button id="qvss_ok">Salva</button></div></div></div>';showOverlay(L);function K(){p(!1),hideOverlay()}const Z=document.getElementById("qvss_val");document.getElementById("qvss_x").onclick=K,document.getElementById("qvss_ok").onclick=async function(){try{const ut=Math.max(0,Number(Z.value||0));await T(_.id,ut);const z=await F(_,ut);if(K(),z)try{document.dispatchEvent(new CustomEvent("gi:created",{detail:{id:z}}))}catch(Q){}typeof window.coachSay=="function"&&ct("medium"),B(z)}catch(ut){logger.error(ut),S("Errore salvataggio VSS")}}}function b(_){return String(_||"").replace(/[&<>'"]/g,D=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[D])}window.pipelineYes=async function(_){try{_.nncf&&await v(_.client,"cliente"),A(_)}catch(D){logger.error(D)}},window.pipelineNo=async function(_){try{_.nncf&&await v(_.client,"lead non chiuso"),await T(_.id,0),At("light"),S("Segnato VSS 0")}catch(D){logger.error(D)}}})(),(function(){function m(B){return encodeURIComponent(String(B||""))}function p(){try{const D=document.getElementById("rep_label");if(D&&D.textContent)return D.textContent.trim()}catch(D){}const B=(document.getElementById("rep_type")||{}).value||"mensile",A=new Date,b=String(A.getMonth()+1).padStart(2,"0"),_=A.getFullYear();return B==="settimanale"?"Settimana ISO "+(isoWeekNum?isoWeekNum(A):"corrente")+" "+_:B==="trimestrale"?"Q"+(Math.floor(A.getMonth()/3)+1)+" "+_:B==="semestrale"?"Semestre "+(A.getMonth()<6?"1":"2")+" "+_:B==="annuale"?"Anno "+_:"Mese "+b+"/"+_}async function g(){try{const B=await N("/api/usernames");return(B&&B.users||[]).map(b=>b.email).filter(Boolean).join(",")}catch(B){return""}}function v(){const B=document.getElementById("report_subject");return B&&B.value&&B.value.trim()?B.value.trim():"Report BP  "+p()}function T(){const B=document.getElementById("report_body");return B&&B.value&&B.value.trim()?B.value:"Ciao,\n\ndi seguito il report del periodo "+p()+".\n\n VSS\n VSD\n GI\n NNCF\n\nA presto."}async function F(){const B=document.getElementById("rep_gmail_web"),A=document.getElementById("rep_gmail_app");if(!B&&!A)return;const b=await g(),_=v(),D=T();try{await navigator.clipboard.writeText(D)}catch(M){}B&&(B.onclick=function(){const M="https://mail.google.com/mail/?view=cm&fs=1&tf=1&su="+m(_)+"&cc="+m(b)+"&body="+m(D);window.open(M,"_blank");try{document.dispatchEvent(new Event("report:composed"))}catch(L){}}),A&&(A.onclick=function(){const M="googlegmail:///co?subject="+m(_)+"&cc="+m(b)+"&body="+m(D);location.href=M;try{document.dispatchEvent(new Event("report:composed"))}catch(L){}setTimeout(function(){if(!document.hidden){location.href="mailto:?subject="+m(_)+"&cc="+m(b)+"&body="+m(D);try{document.dispatchEvent(new Event("report:composed"))}catch(L){}}},1200)})}window.wireReportButtons=F})(),(function(){function m(A){var b=A instanceof Date?A:new Date(A||Date.now()),_=b.getFullYear(),D=("0"+(b.getMonth()+1)).slice(-2),M=("0"+b.getDate()).slice(-2);return _+"-"+D+"-"+M}function p(A){for(var b=m(new Date),_=A.querySelectorAll("[data-date], [data-day]"),D=0;D<_.length;D++){var M=_[D],L=M.getAttribute("data-date")||M.getAttribute("data-day")||"";if(L){var K=String(L).slice(0,10);K===b&&M.classList.add("today")}}}function g(A){if(typeof window.attachICSButtons=="function"){try{window.attachICSButtons(A)}catch(ut){logger.error(ut)}return}for(var b=A.querySelectorAll("[data-appt], [data-start][data-title], .appt, .calendar-appt"),_=0;_<b.length;_++){var D=b[_];if(!D.querySelector(".bp-ics")){var M=D.getAttribute("data-start")||"",L=D.getAttribute("data-end")||"",K=D.getAttribute("data-title")||D.getAttribute("data-client")||"Appuntamento";if(M){var Z=document.createElement("a");Z.href="#",Z.className="bp-ics btn-ics",Z.textContent="",Z.style.marginLeft="6px",Z.onclick=function(ut){ut.preventDefault();try{var z=ut.currentTarget.parentElement||document.body,Q=z.getAttribute("data-start")||M,pt=z.getAttribute("data-end")||L||Q,dt=z.getAttribute("data-title")||z.getAttribute("data-client")||K,vt=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//BP//Calendar//IT","BEGIN:VEVENT","UID:"+Date.now()+"@bp","DTSTAMP:"+new Date().toISOString().replace(/[-:]/g,"").replace(/\.\d{3}Z$/,"Z"),"DTSTART:"+new Date(Q).toISOString().replace(/[-:]/g,"").replace(/\.\d{3}Z$/,"Z"),"DTEND:"+new Date(pt).toISOString().replace(/[-:]/g,"").replace(/\.\d{3}Z$/,"Z"),"SUMMARY:"+dt,"END:VEVENT","END:VCALENDAR"].join("\r\n"),bt=new Blob([vt],{type:"text/calendar"}),yt=URL.createObjectURL(bt),_t=document.createElement("a");_t.href=yt,_t.download=(dt||"appuntamento")+".ics",document.body.appendChild(_t),_t.click(),setTimeout(function(){URL.revokeObjectURL(yt);try{_t.remove()}catch(Ct){}},0)}catch(Ct){logger.error(Ct)}},D.appendChild(Z)}}}}function v(){var A=document.getElementById("calendar")||document.querySelector(".calendar")||document;p(A),g(A)}window.hookCalendar=v;function T(A){if(document.readyState==="complete"||document.readyState==="interactive")return A();document.addEventListener("DOMContentLoaded",A,{once:!0})}T(v);var F=document.getElementById("calendar")||document.querySelector(".calendar");if(F&&!F.__bpCalObs){F.__bpCalObs=!0;var B=new MutationObserver(function(){try{v()}catch(A){}});B.observe(F,{childList:!0,subtree:!0})}})(),(function(){var m=!1;function p(){if(!m){m=!0;var g='.today{outline:2px solid var(--accent, #5dd3ff); outline-offset:-2px; border-radius:8px; position:relative;}.today::after{content:"OGGI"; position:absolute; top:6px; right:8px; font-size:10px; font-weight:700; color:#fff; background:var(--accent, #5dd3ff); padding:2px 6px; border-radius:6px;}',v=document.createElement("style");v.setAttribute("data-bp-today","1"),v.textContent=g,document.head.appendChild(v)}}window.injectTodayCSS=p,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",p,{once:!0}):p()})(),(function(){function m(){try{return JSON.parse(localStorage.getItem("user")||"{}")}catch(_){return{}}}function p(){var _=m();return _&&_.role==="admin"}function g(_,D){return(D||document).querySelector(_)}function v(_,D){return Array.prototype.slice.call((D||document).querySelectorAll(_))}function T(_){var D=new Date(_);return!D||isNaN(D)?"":("0"+D.getDate()).slice(-2)+"/"+("0"+(D.getMonth()+1)).slice(-2)+"/"+D.getFullYear()}async function F(){try{for(var _=await N("/api/appointments"),D=_&&_.appointments||[],M={},L=0;L<D.length;L++){var K=D[L],Z=String(K.client||"").trim().toLowerCase();if(Z){var ut=new Date(K.start||K.end||0).getTime();(!M[Z]||ut>M[Z])&&(M[Z]=ut)}}return M}catch(z){return logger.error(z),{}}}async function B(){var _=document.getElementById("cl_list");if(_){var D=await F();v(".card",_).forEach(function(M){var L=g("b",M);if(L){var K=(L.textContent||"").trim().toLowerCase();if(K){var Z=D[K],ut=g(".bp-lastapp",M),z="Ultimo appuntamento: "+(Z?T(Z):"");if(ut)ut.textContent=z;else{var Q=document.createElement("div");Q.className="small muted bp-lastapp",Q.textContent=z,M.appendChild(Q)}}}})}}async function A(){if(!p())return;var _=document.getElementById("cl_list");if(!_)return;var[D,M]=await Promise.all([N("/api/clients"),N("/api/usernames")]),L=D&&D.clients||[],K=M&&M.users||[];function Z(ut){var z=g("b",ut),Q=(z&&z.textContent||"").trim().toLowerCase();return L.find(function(pt){return String(pt.name||"").trim().toLowerCase()===Q})}_.__bpInlineReady||(_.__bpInlineReady=!0,v(".card",_).forEach(function(ut){if(!ut.__bpInline){ut.__bpInline=!0;var z=Z(ut);if(z){var Q=document.createElement("div");Q.style.display="flex",Q.style.gap="8px",Q.style.marginTop="6px";var pt=document.createElement("button");pt.className="ghost",pt.textContent="Modifica",Q.appendChild(pt),ut.appendChild(Q);var dt=document.createElement("div");dt.style.display="none",dt.style.marginTop="8px",dt.innerHTML='<div class="row" style="gap:8px"><div><label>Nome</label><input class="bp-ed-name" type="text" value="'+(z.name||"")+'"></div><div><label>Stato</label><select class="bp-ed-state"><option value="prospect" '+(z.status==="prospect"?"selected":"")+'>Prospect</option><option value="attivo" '+(z.status==="attivo"?"selected":"")+'>Attivo</option><option value="cliente" '+(z.status==="cliente"?"selected":"")+'>Cliente</option></select></div><div><label>Consulente</label><select class="bp-ed-consulente"></select></div><div style="align-self:flex-end"><button class="ghost bp-ed-save">Salva</button></div></div>',ut.appendChild(dt);var vt=g(".bp-ed-consulente",dt);vt.innerHTML='<option value=""></option>'+K.map(function(bt){return'<option value="'+bt.id+'" '+(String(z.consultantId||"")===String(bt.id)?"selected":"")+">"+(bt.name||"User "+bt.id)+"</option>"}).join(""),pt.onclick=function(){dt.style.display=dt.style.display==="none"?"block":"none"},g(".bp-ed-save",dt).onclick=async function(bt){bt.preventDefault();try{var yt={id:z.id,name:g(".bp-ed-name",dt).value.trim(),status:g(".bp-ed-state",dt).value,consultantId:g(".bp-ed-consulente",dt).value||null};await J("/api/clients",yt);var _t=g("b",ut);_t&&(_t.textContent=yt.name);var Ct=g(".small",ut);Ct&&/Stato:/.test(Ct.textContent||"")&&(Ct.innerHTML="Stato: <b>"+yt.status+"</b>");var Ft=v(".small",ut).find(function(Ie){return/Consulente:/.test(Ie.textContent||"")});if(Ft){var Vt=K.find(function(Ie){return String(Ie.id)===String(yt.consultantId||"")});Ft.innerHTML="Consulente: <b>"+(Vt?Vt.name||"User "+Vt.id:"")+"</b>"}At("medium")}catch(Ie){logger.error(Ie),At("heavy")}}}}}))}window.applyClientsLastAppointment=B,window.ensureClientInlineEdit=A;function b(){var _=document.getElementById("cl_list");if(_&&(B(),A(),!_.__bpCliObs)){_.__bpCliObs=!0;var D=new MutationObserver(function(){B(),A()});D.observe(_,{childList:!0,subtree:!0})}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",b,{once:!0}):b()})();function c(m){const p=["#".concat(m,"_mode"),"#dash_mode","#comm_mode",'[data-scope="'.concat(m,'"] [name="mode"]'),"#".concat(m,' select[name="mode"]'),'#dashboard select[name="mode"]','select[name="mode"]'];for(const g of p){const v=document.querySelector(g);if(v&&v.value)return v.value}return"consuntivo"}if(window.__BP_FINAL_READY__)return;window.__BP_FINAL_READY__=!0;const d=(m,p)=>(p||document).querySelector(m),u=(m,p,g)=>m&&m.addEventListener(p,g,!1),f=m=>document.readyState!=="loading"?m():document.addEventListener("DOMContentLoaded",m),h=(m,p)=>{try{return JSON.parse(m)}catch(g){return p}},w=m=>m<10?"0"+m:""+m,x=()=>{const m=new Date;return"".concat(m.getFullYear(),"-").concat(w(m.getMonth()+1),"-").concat(w(m.getDate()))};function S(m){try{(window.showToast?window.showToast:alert)(m)}catch(p){alert(m)}}function O(){const m=g=>{if(!g)return null;g=String(g).replace(/^"+|"+$/g,"");try{const v=JSON.parse(g);if(v&&(v.token||v.jwt||v.accessToken))return v.token||v.jwt||v.accessToken}catch(v){}return/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$/.test(g)?g:null};for(let g=0;g<localStorage.length;g++){const v=m(localStorage.getItem(localStorage.key(g)));if(v)return v}const p=["token","authToken","jwt","bp_token","accessToken","id_token","auth","authorization","bp.jwt","_token","session","user"];for(const g of p){const v=m(localStorage.getItem(g)||sessionStorage.getItem(g));if(v)return v}try{const g=h(localStorage.getItem("user")||"{}",{});if(g&&(g.token||g.jwt||g.accessToken))return g.token||g.jwt||g.accessToken}catch(g){}return null}async function N(m,p={}){if(typeof window.GET=="function"&&!p.forceFetch)try{return await window.GET(m)}catch(T){}const g=O(),v=await fetch(m,{headers:{Accept:"application/json",...g?{Authorization:"Bearer "+g}:{}}});return v.status===401&&window.GET?window.GET(m):v.status===204?null:v.json()}async function J(m,p,g={}){if(typeof window.POST=="function"&&!g.forceFetch)try{return await window.POST(m,p)}catch(F){}const v=O(),T=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json",...v?{Authorization:"Bearer "+v}:{}},body:JSON.stringify(p||{})});return!T.ok&&T.status===401&&window.POST?window.POST(m,p):T.status===204?null:T.json()}function ot(m,p,g){const v=document.getElementById(m);if(!v)return;const T=v.getContext("2d"),F=window.devicePixelRatio||1,B=Math.max(220,v.clientWidth||320),A=Math.max(80,v.clientHeight||80);v.style.width=B+"px",v.style.height=A+"px",v.width=B*F,v.height=A*F,T.scale(F,F),T.clearRect(0,0,B,A);const b=Array.isArray(g)?g.map(Q=>+Q||0):[];if(!b.length)return;const _=Math.max(...b),D=Math.min(...b),M=_-D===0?(_||1)*.2:(_-D)*.2,L=_+M,K=Math.max(0,D-M),Z=b.length>1?(B-8)/(b.length-1):0,ut=Q=>4+Q*Z,z=Q=>{const pt=(Q-K)/(L-K||1);return A-6-pt*(A-12)};T.lineWidth=2,T.lineJoin=T.lineCap="round",T.strokeStyle="#2e6cff",T.beginPath(),T.moveTo(ut(0),z(b[0]));for(let Q=1;Q<b.length;Q++)T.lineTo(ut(Q),z(b[Q]));T.stroke(),T.fillStyle="#2e6cff";for(let Q=0;Q<b.length;Q++)T.beginPath(),T.arc(ut(Q),z(b[Q]),2,0,Math.PI*2),T.fill()}(function(){const p=function(g,v,T){const F=document.getElementById(g);if(F){if(window.Chart)try{F.__chart&&typeof F.__chart.destroy=="function"&&F.__chart.destroy();const B=typeof window.computeTickOptions=="function"?window.computeTickOptions(v,F.clientWidth||320):void 0,A={type:"line",data:{labels:v,datasets:[{data:T,tension:.35,pointRadius:2,borderWidth:2}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:Object.assign({display:!0},B?{ticks:B}:{}),y:{display:!0}}}};F.__chart=new Chart(F.getContext("2d"),A);return}catch(B){}ot(g,v,T)}};(!window.drawFullLine||!window.drawFullLine.__patched)&&(window.drawFullLine=p,window.drawFullLine.__patched=!0)})();function y(m,p){try{if(typeof window.labelsForBuckets=="function")return window.labelsForBuckets(m,p)}catch(v){}const g=typeof effectivePeriodType=="function"?effectivePeriodType(String(m||"mensile").toLowerCase()):String(m||"mensile").toLowerCase();return(p||[]).map(v=>{const T=new Date(v.s);return g==="settimanale"?"W"+(typeof isoWeekNum=="function"?isoWeekNum(T):"")+" "+T.getUTCFullYear():g==="mensile"?String(T.getUTCMonth()+1).padStart(2,"0")+"/"+T.getUTCFullYear():g==="trimestrale"?"Q"+(Math.floor(T.getUTCMonth()/3)+1)+" "+T.getUTCFullYear():g==="semestrale"?(T.getUTCMonth()<6?"S1 ":"S2 ")+T.getUTCFullYear():String(T.getUTCFullYear())})}const I=typeof window<"u"?window.__periodsCache||(window.__periodsCache={}):{};function R(m){try{const p=new Date(m),g=p.getUTCFullYear(),v=String(p.getUTCMonth()+1).padStart(2,"0"),T=String(p.getUTCDate()).padStart(2,"0");return g+"-"+v+"-"+T}catch(p){return""}}function P(m){try{return typeof effectivePeriodType=="function"?effectivePeriodType(String(m||"mensile").toLowerCase()):String(m||"mensile").toLowerCase()}catch(p){return String(m||"mensile").toLowerCase()}}async function W(m){if(!m){if(Array.isArray(window.periods)&&window.periods.length)return window.periods;try{const b=await N("/api/periods?global=1");if(b&&Array.isArray(b.periods))return window.periods=b.periods,b.periods}catch(b){}return window.periods||[]}let p,g,v,T=null;if(typeof m=="string"){const b=window.readUnifiedRange&&window.readUnifiedRange(m)||{type:"mensile",end:new Date};p=b.type||"mensile";const _=window.buildBuckets?window.buildBuckets(p,b.end):[];if(_&&_.length)g=R(new Date(_[0].s)),v=R(new Date(_[_.length-1].e));else if(b.start&&b.end)g=R(new Date(b.start)),v=R(new Date(b.end));else{const D=new Date;g=R(D),v=R(D)}}else{const b=m||{};p=b.type||"mensile",g=b.from||R(new Date),v=b.to||R(new Date),T=b.userId||null}const F=P(p),B=[F,g,v,T||""].join("|");if(I[B])return I[B];const A=["?global=1","type="+encodeURIComponent(F),"from="+encodeURIComponent(g),"to="+encodeURIComponent(v)].concat(T?["userId="+encodeURIComponent(T)]:[]).join("&").replace("?&","?");try{const b=await N("/api/periods"+A).catch(function(){return N("/api/periods"+A.replace("?global=1","?").replace("??","?"))}),_=b&&Array.isArray(b.periods)?b.periods:[];return I[B]=_,_}catch(b){return[]}}function X(m,p,g){const v=String(p).toLowerCase()==="previsionale"?m.indicatorsPrev||{}:m.indicatorsCons||{},T=Number(v[g]||0);return Number.isFinite(T)?T:0}function V(m,p,g){if(typeof window.drawFullLine=="function")return window.drawFullLine(m,p,g);ot(m,p,g)}async function G(){const m=window.readUnifiedRange&&window.readUnifiedRange("dash")||{type:"mensile",end:new Date},p=m.type||"mensile",g=c("dash"),v=window.buildBuckets?window.buildBuckets(p,m.end):[],T=await W("dash"),F=y(p,v);["VSS","VSDPersonale","GI","NNCF"].forEach(B=>{const A=v.map(b=>{let _=0;return T.forEach(D=>{if(D.type!==effectivePeriodType(p))return;const M=new Date(D.startDate).getTime(),L=new Date(D.endDate).getTime();M>=b.s&&L<=b.e&&(_+=X(D,g,B))}),Math.round(_)});V("d_mini_"+B.toLowerCase(),F,A)});try{if(window.BP&&BP.Targets&&typeof BP.Targets.getForPeriod=="function"){const B=JSON.parse(localStorage.getItem("user")||"{}")||{},A=String(B.grade||"junior").toLowerCase()==="senior"?"senior":"junior",b=BP.Targets.getForPeriod(A,effectivePeriodType(p))||{},_=["VSS","VSDPersonale","GI","NNCF"],D={};_.forEach(M=>{let L=0;const K=v[v.length-1];K&&(T.forEach(Z=>{if(Z.type!==effectivePeriodType(p))return;const ut=new Date(Z.startDate).getTime(),z=new Date(Z.endDate).getTime();ut>=K.s&&z<=K.e&&(L+=X(Z,g,M))}),D[M]=Math.round(L))}),window.__bpCoachKpiFired=window.__bpCoachKpiFired||{},_.forEach(M=>{const L=Number(b[M]||0);if(L<=0)return;const K=Number(D[M]||0),Z=Math.round(K/L*100),ut=effectivePeriodType(p)+"_"+M;if(Z>=100&&!window.__bpCoachKpiFired[ut+"_100"]){window.__bpCoachKpiFired[ut+"_100"]=!0;try{document.dispatchEvent(new CustomEvent("kpi:goal-reached",{detail:{key:M,value:K,target:L}}))}catch(z){}}else if(Z>=80&&!window.__bpCoachKpiFired[ut+"_80"]){window.__bpCoachKpiFired[ut+"_80"]=!0;try{document.dispatchEvent(new CustomEvent("kpi:goal-80",{detail:{key:M,value:K,target:L}}))}catch(z){}}})}}catch(B){}}async function rt(){const m="comm",p=window.readUnifiedRange&&(window.readUnifiedRange(m)||window.readUnifiedRange("cm"))||{type:"mensile",end:new Date},g=p.type||"mensile",v=c&&c(m)||c&&c("cm")||"cons",T=window.buildBuckets?window.buildBuckets(g,p.end):[],F=await W("comm"),B=y(g,T),A=T.map(b=>{let _=0;return F.forEach(D=>{if(D.type!==effectivePeriodType(g))return;const M=new Date(D.startDate).getTime(),L=new Date(D.endDate).getTime();M>=b.s&&L<=b.e&&(_+=X(D,v,"VSDPersonale"))}),Math.round(_)});V("cm_mini_vsd",B,A)}async function $(){const m=window.readUnifiedRange&&(window.readUnifiedRange("t")||window.readUnifiedRange("tg"))||{type:"mensile",end:new Date},p=m.type||"mensile",g=c&&c("t")||c&&c("tg")||"cons",v=(d("#tg_user")||{}).value||"",T=(d("#tg_ind")||{}).value||"VSS",F=window.buildBuckets?window.buildBuckets(p,m.end):[];function B(L){try{const K=new Date(L),Z=K.getUTCFullYear(),ut=String(K.getUTCMonth()+1).padStart(2,"0"),z=String(K.getUTCDate()).padStart(2,"0");return Z+"-"+ut+"-"+z}catch(K){return""}}const A=F.length?B(new Date(F[0].s)):B(new Date),b=F.length?B(new Date(F[F.length-1].e)):B(new Date),_=await W({type:p,from:A,to:b,userId:v||null}),D=y(p,F),M=F.map(L=>{let K=0;return _.forEach(Z=>{if(Z.type!==effectivePeriodType(p)||v&&String(Z.userId)!==String(v))return;const ut=new Date(Z.startDate).getTime(),z=new Date(Z.endDate).getTime();ut>=L.s&&z<=L.e&&(K+=X(Z,g,T))}),Math.round(K)});V("tg_chart",D,M)}function tt(){u(d("#dash_mode"),"change",()=>{At("light"),window.recomputeDashboard&&recomputeDashboard(),window.recomputeDashboardMini&&G()}),u(d("#d_mode"),"change",()=>{At("light"),window.recomputeDashboard&&recomputeDashboard(),window.recomputeDashboardMini&&G()}),u(d("#comm_mode"),"change",()=>{At("light"),window.recomputeCommsMini&&rt()}),u(d("#cm_mode"),"change",()=>{At("light"),window.recomputeCommsMini&&rt()});const m=d("#tg_user");m&&m.options.length<=1&&N("/api/usernames").then(v=>{(v&&v.users||[]).forEach(T=>{var F=document.createElement("option");F.value=T.id,F.textContent=(T.name||"User "+T.id)+(T.grade?"  "+T.grade:""),m.appendChild(F)})}).catch(v=>logger.error(v));const p=()=>{window.recomputeTeamChart&&$(),window.recomputeTeamAggChart&&recomputeTeamAggChart()};u(d("#t_mode"),"change",()=>{At("light"),p()}),["#t_y","#t_m","#t_q","#t_from","#t_to"].forEach(v=>{const T=d(v);T&&u(T,"change",p)}),m&&u(m,"change",()=>{At("light"),window.recomputeTeamChart&&$()});const g=d("#t_ind");g&&u(g,"change",()=>{At("light"),window.recomputeTeamAggChart&&recomputeTeamAggChart()}),d("#tg_chart")&&window.recomputeTeamChart&&$(),d("#t_chart")&&window.recomputeTeamAggChart&&recomputeTeamAggChart()}typeof window.todayKey!="function"&&(window.todayKey=function(){var p=new Date,g=p.getFullYear(),v=("0"+(p.getMonth()+1)).slice(-2),T=("0"+p.getDate()).slice(-2);return g+"-"+v+"-"+T});function at(){try{var m=x(),p=document.querySelector('.calendar .day[data-day="'+m+'"], .calendar .day[data-date="'+m+'"]');if(!p)for(var g=parseInt(m.slice(8,10),10),v=document.querySelectorAll(".calendar .day"),T=0;T<v.length;T++){var F=v[T],B=parseInt((F.getAttribute("data-day")||F.getAttribute("data-date")||"").slice(8,10)||F.textContent.trim(),10);if(B===g){p=F;break}}p&&p.classList.add("today")}catch(A){}}function C(){try{for(var m=x(),p=document.querySelectorAll(".calendar .day[data-day], .calendar .day[data-date]"),g=0;g<p.length;g++){var v=p[g],T=(v.getAttribute("data-day")||v.getAttribute("data-date")||"").slice(0,10);T&&T<m&&v.classList.remove("slot-free")}}catch(F){}}function E(){try{var m=document.getElementById("cal_day_box");if(!m)return;for(var p=m.querySelectorAll(".cal-app"),g=0;g<p.length;g++){var v=p[g];if(!v.querySelector("[data-ics-inline]")){var T=v.getAttribute("data-start")||"",F=v.getAttribute("data-end")||"",B=v.getAttribute("data-title")||(v.querySelector("b")?v.querySelector("b").textContent.trim():"Appuntamento");if(!(!T||!F)&&window.BP&&BP.ICS&&typeof BP.ICS.downloadIcsForAppointment=="function"){var A=document.createElement("button");A.className="ghost btn-ics",A.textContent="",A.setAttribute("data-ics-inline","1"),A.style.marginTop="6px",A.addEventListener("click",function(b){b.stopPropagation();var _=b.currentTarget.parentElement,D=_.getAttribute("data-start"),M=_.getAttribute("data-end"),L=_.getAttribute("data-title")||(_.querySelector("b")?_.querySelector("b").textContent.trim():"Appuntamento"),K={client:L,start:D,end:M,type:"manuale",vss:0,vsdPersonal:0,nncf:!1};try{BP.ICS.downloadIcsForAppointment(K),At("medium")}catch(Z){}}),v.appendChild(A)}}}}catch(b){}}window.markToday=window.markToday||at,window.clampSlotCounters=window.clampSlotCounters||C,window.wireICSInsideDayBox=window.wireICSInsideDayBox||E,(function(){function m(B){return encodeURIComponent(String(B||""))}function p(){return N("/api/users_emails").then(function(B){return B&&Array.isArray(B.emails)?B.emails.filter(Boolean):B&&Array.isArray(B.users)?B.users.map(A=>A.email).filter(Boolean):[]}).catch(function(){return N("/api/usernames").then(function(B){var A=B&&B.users||[];return A.map(b=>b.email).filter(Boolean)}).catch(function(){return[]})})}function g(){var B=document.getElementById("report_subject");return B&&B.value.trim()||"Report BP"}function v(){var B=document.getElementById("report_body");return B&&B.value||""}function T(){var B=document.getElementById("rep_gmail_web"),A=document.getElementById("rep_gmail_app");!B&&!A||p().then(function(b){var _=(b||[]).join(",");function D(){return"https://mail.google.com/mail/?view=cm&fs=1&tf=1&su="+m(g())+"&cc="+m(_)+"&body="+m(v())}function M(){return"googlegmail:///co?subject="+m(g())+"&cc="+m(_)+"&body="+m(v())}B&&(B.onclick=function(){try{navigator.clipboard&&navigator.clipboard.writeText(v())}catch(L){}window.open(D(),"_blank")}),A&&(A.onclick=function(){try{navigator.clipboard&&navigator.clipboard.writeText(v())}catch(L){}location.href=M(),setTimeout(function(){if(!document.hidden){var L="mailto:?subject="+m(g())+"&cc="+m(_)+"&body="+m(v());location.href=L}},1200)})})}var F=window.BPFinal=window.BPFinal||{};F.wireReportButtons=T,window.wireReportButtons||(window.wireReportButtons=T)})(),(function(){let m={ts:0,map:null},p=null;function g(v){const T=Object.create(null);for(const F of v||[]){const B=String(F.client||"").toLowerCase();if(!B)continue;const A=+new Date(F.end||F.start||0);(!T[B]||A>T[B])&&(T[B]=A)}return T}window.BPFinal=window.BPFinal||{},BPFinal.getLastApptMap=function(){const T=Date.now();return m.map&&T-m.ts<15e3?Promise.resolve(m.map):p||(p=N("/api/appointments?global=1").then(F=>g(F&&F.appointments||[])).then(F=>(m={ts:Date.now(),map:F},F)).catch(()=>({})).finally(()=>{p=null}),p)}})();function k(m){var v;if(!m)return;const p=m.getAttribute("data-clid")||"",g=(((v=m.querySelector("b"))==null?void 0:v.textContent)||"").trim();N("/api/appointments?global=1").then(T=>{const F=T&&T.appointments||[],B=g.toLowerCase(),A=F.filter(M=>String(M.clientId||"")===p||String(M.client||"").trim().toLowerCase()===B);A.sort((M,L)=>new Date(L.start)-new Date(M.start));const b=A.map(M=>{const L=new Date(M.start),K=("0"+L.getDate()).slice(-2)+"/"+("0"+(L.getMonth()+1)).slice(-2)+"/"+L.getFullYear(),Z=[];return Number(M.vss)>0&&Z.push("VSS "+Number(M.vss).toLocaleString("it-IT")+""),Number(M.vsdPersonal)>0&&Z.push("VSD "+Number(M.vsdPersonal).toLocaleString("it-IT")+""),Number(M.vsdIndiretto)>0&&Z.push("VSD ind "+Number(M.vsdIndiretto).toLocaleString("it-IT")+""),Number(M.telefonate)>0&&Z.push("Tel "+Number(M.telefonate)),Number(M.appFissati)>0&&Z.push("AppFiss "+Number(M.appFissati)),'<div class="small">'.concat(n(M.type||""),"  ").concat(K).concat(Z.length?"  "+Z.join("  "):"","</div>")}).join("")||'<div class="muted">Nessun appuntamento</div>',_=document.createElement("div");_.className="modal",_.innerHTML='<div class="card"><h3>Appuntamenti per '.concat(n(g),'</h3><div style="margin-top:8px">').concat(b,'</div><div class="row right"><button class="ghost" data-x>Chiudi</button></div></div>'),document.body.appendChild(_);const D=_.querySelector("[data-x]");D&&(D.onclick=()=>_.remove()),_.addEventListener("click",M=>{M.target===_&&_.remove()})}).catch(T=>{logger.error(T),S("Errore caricamento appuntamenti")})}BPFinal.showClientAppointments=k,BPFinal.enrichClientCards=function(){const p=document.getElementById("cl_list");p&&BPFinal.getLastApptMap().then(g=>{const v=p.querySelectorAll(".card[data-clid], .card");for(const T of v){const F=T.querySelector("b"),B=(F?F.textContent:T.getAttribute("data-name")||"").trim().toLowerCase(),A=g[B]||0,b=T.querySelector(".last-appt, .client-last");if(b)if(A){const _=new Date(A),D=("0"+_.getDate()).slice(-2),M=("0"+(_.getMonth()+1)).slice(-2),L=_.getFullYear();b.textContent="".concat(D,"/").concat(M,"/").concat(L)}else b.textContent="";T.setAttribute("data-last-ts",String(A||0)),!T.getAttribute("data-name-lower")&&B&&T.setAttribute("data-name-lower",B),T.__bp_appts||(T.__bp_appts=!0,T.addEventListener("click",_=>{_.target.closest("button,select,input,a")||k(T)}))}})},BPFinal.enableClientsInlineAdmin=function(){const p=document.getElementById("cl_list");if(!p||p.__bp_inline_admin_wired)return;p.__bp_inline_admin_wired=!0;let g=null;function v(){return g?Promise.resolve(g):N("/api/usernames").then(A=>g=A&&A.users||[]).catch(()=>[])}const T=["attivo","lead non chiuso","potenziale"];function F(A){if(!A||A.nodeType!==1||A.querySelector("[data-edit-client]"))return;A.style.position="relative";const b=document.createElement("button");b.className="ghost small",b.textContent="Modifica",b.title="Modifica cliente",b.setAttribute("data-edit-client","1"),b.style.position="absolute",b.style.right="8px",b.style.top="8px",b.style.zIndex="2",b.style.cursor="pointer",A.appendChild(b),b.addEventListener("click",function(){const _=A.getAttribute("data-clid")||A.dataset.clid||"",D=A.querySelector("b"),M=A.querySelector(".cl-status, .client-status"),L=A.querySelector(".cl-cons, .client-owner"),K={name:D?D.textContent.trim():"",status:String(M&&M.textContent||A.getAttribute("data-status")||"potenziale").toLowerCase(),consId:A.getAttribute("data-consultant-id")||"",consText:L?L.textContent:""},Z=document.createElement("input");Z.type="text",Z.value=K.name,Z.style.width="100%",D&&D.replaceWith(Z);const ut=document.createElement("select");ut.innerHTML=T.map(z=>'<option value="'.concat(z,'">').concat(z.charAt(0).toUpperCase()+z.slice(1),"</option>")).join(""),ut.value=T.includes(K.status)?K.status:"potenziale",M&&(M.textContent="",M.appendChild(ut)),v().then(z=>{const Q=document.createElement("select");Q.innerHTML='<option value=""></option>'+z.map(bt=>'<option value="'.concat(bt.id,'">').concat(bt.name||"User "+bt.id).concat(bt.grade?" ("+bt.grade+")":"","</option>")).join(""),K.consId&&(Q.value=String(K.consId)),L&&(L.textContent="",L.appendChild(Q));const pt=document.createElement("div");pt.className="row",pt.style.marginTop="8px";const dt=document.createElement("button");dt.textContent="Salva";const vt=document.createElement("button");vt.textContent="Annulla",vt.className="ghost",pt.appendChild(dt),pt.appendChild(vt),A.appendChild(pt),vt.addEventListener("click",function(){const bt=document.createElement("b");bt.textContent=K.name,Z.replaceWith(bt),M&&(M.textContent=K.status),L.textContent=K.consText||"",pt.remove()}),dt.addEventListener("click",function(){const bt={id:_,name:Z.value.trim(),status:ut.value},yt=Q.value?String(Q.value):"";yt&&(bt.consultantId=yt),J("/api/clients",bt).then(function(){S("Cliente aggiornato"),typeof addXP=="function"&&addXP(4);const _t=document.createElement("b");_t.textContent=bt.name||K.name,Z.replaceWith(_t),M&&(M.textContent=bt.status),yt?(L.textContent=Q.options[Q.selectedIndex].textContent||"#"+yt,A.setAttribute("data-consultant-id",yt)):(L.textContent="",A.setAttribute("data-consultant-id","")),A.setAttribute("data-status",bt.status),pt.remove()}).catch(function(_t){logger.error(_t),S("Errore aggiornamento cliente")})})})})}p.querySelectorAll(".card[data-clid], .card").forEach(F),new MutationObserver(A=>{for(const b of A)for(const _ of b.addedNodes)_.nodeType===1&&_.matches(".card[data-clid], .card")&&F(_),_.nodeType===1&&_.querySelectorAll&&_.querySelectorAll(".card[data-clid], .card").forEach(F)}).observe(p,{childList:!0,subtree:!0})},BPFinal.applyClientSort=function(){const p=document.getElementById("cl_list");if(!p)return;const g=document.getElementById("cl_order"),v=g?g.value:"az",T=Array.from(p.children).filter(F=>F.classList.contains("card"));if(T.length){v==="last_desc"?T.sort((F,B)=>(+B.getAttribute("data-last-ts")||0)-(+F.getAttribute("data-last-ts")||0)):T.sort((F,B)=>String(F.getAttribute("data-name-lower")||"").localeCompare(String(B.getAttribute("data-name-lower")||"")));for(const F of T)p.appendChild(F)}},BPFinal.ensureClientFilters=function(){const p=document.getElementById("cl_f_apply");p&&!p.__bp_wired&&(p.__bp_wired=!0,p.addEventListener("click",()=>{setTimeout(()=>{BPFinal.enrichClientCards(),BPFinal.applyClientSort()},0)}));const g=document.getElementById("cl_order");g&&!g.__bp_wired&&(g.__bp_wired=!0,g.addEventListener("change",()=>BPFinal.applyClientSort()))},BPFinal.wireCreateClientExtras=function(){const p=document.getElementById("cl_add");!p||p.__bp_wired||(p.__bp_wired=!0,p.addEventListener("click",g=>{const v=document.getElementById("cl_name"),T=document.getElementById("cl_new_state"),F=document.getElementById("cl_new_owner");if(!v)return;const B=(v.value||"").trim();if(!B||!T&&!F)return;g.stopPropagation(),g.preventDefault();const A={name:B};T&&(A.status=T.value),F&&F.value&&(A.consultantId=F.value),J("/api/clients",A).then(()=>{S("Cliente aggiunto"),addXP&&addXP(5),v.value="",setTimeout(()=>{BPFinal.enrichClientCards(),BPFinal.applyClientSort()},150)}).catch(()=>S("Errore creazione cliente"))},!0))},BPFinal.ensureClientSection=function(){BPFinal.ensureClientFilters(),BPFinal.wireCreateClientExtras(),BPFinal.enrichClientCards(),BPFinal.enableClientsInlineAdmin(),BPFinal.applyClientSort()};async function U(){const m=d("#tg_user");if(!m||m.options.length>1)return;const p=await N("/api/usernames").catch(()=>null);(p&&p.users||[]).forEach(g=>{const v=document.createElement("option");v.value=g.id,v.textContent=g.name+(g.grade?" ("+g.grade+")":""),m.appendChild(v)})}function H(){const m=d("#users, .users");if(!m||m.__userEditWired)return;m.__userEditWired=!0,m.addEventListener("click",g=>{var _,D;const v=g.target.closest("[data-edit-user]");if(!v)return;const T=v.closest("[data-user-id]"),F=T==null?void 0:T.getAttribute("data-user-id"),B=((_=T==null?void 0:T.querySelector(".u-name"))==null?void 0:_.textContent)||"",A=((D=T==null?void 0:T.querySelector(".u-email"))==null?void 0:D.textContent)||"",b=document.createElement("div");b.className="modal",b.innerHTML='<div class="card"><h3>Modifica utente</h3><label>Nome <input id="u_name" value="'+B+'"></label><label>Email <input id="u_email" value="'+A+'"></label><label>Password <input id="u_pass" type="password" placeholder="(lascia vuoto per non cambiare)"></label><div class="row right"><button id="u_ok" class="btn-ghost">Salva</button><button id="u_x" class="btn-ghost">Chiudi</button></div></div>',document.body.appendChild(b),d("#u_x",b).onclick=()=>b.remove(),d("#u_ok",b).onclick=async()=>{try{const M={id:F,name:d("#u_name",b).value,email:d("#u_email",b).value},L=d("#u_pass",b).value.trim();L&&(M.password=L),await J("/api/users",M),S("Utente aggiornato"),b.remove(),location.reload()}catch(M){S("Errore aggiornamento utente")}}});const p=d("#btnProfile")||d("[data-edit-self]");p&&!p.__wired&&(p.__wired=!0,p.onclick=()=>{const g=h(localStorage.getItem("user")||"{}",{}),v=document.createElement("div");v.className="modal",v.innerHTML='<div class="card"><h3>Profilo</h3><label>Nome <input id="me_name" value="'+(g.name||"")+'"></label><label>Email <input id="me_email" value="'+(g.email||"")+'"></label><label>Password <input id="me_pass" type="password" placeholder="(nuova password)"></label><div class="row right"><button id="me_ok" class="btn-ghost">Salva</button><button id="me_x" class="btn-ghost">Chiudi</button></div></div>',document.body.appendChild(v),d("#me_x",v).onclick=()=>v.remove(),d("#me_ok",v).onclick=async()=>{try{const T={id:g.id,name:d("#me_name",v).value,email:d("#me_email",v).value},F=d("#me_pass",v).value.trim();F&&(T.password=F),await J("/api/users",T),S("Profilo aggiornato"),v.remove(),location.reload()}catch(T){S("Errore aggiornamento profilo")}}})}const j=document.createElement("div");j.className="bp-coach-host",j.style.cssText="position:fixed;left:50%;transform:translateX(-50%);z-index:1200;display:flex;flex-direction:column;gap:6px;pointer-events:none;",document.documentElement.appendChild(j);const q="\n    /* Desktop default */\n    .bp-coach-host{ top:14px; }\n    /* Mobile: place below header + safe-area */\n    @media (max-width:980px){\n      .bp-coach-host{ top: calc(env(safe-area-inset-top) + 56px + 12px); }\n    }\n    .bp-coach{background:rgba(20,24,34,.92);color:#fff;border:1px solid rgba(255,255,255,.16);\n      border-radius:12px;padding:8px 10px;font-weight:700;box-shadow:0 12px 24px rgba(0,0,0,.35);opacity:.98;transform:translateY(0);transition:all .18s;}\n    @keyframes bpCoachPop{from{transform:translateY(-6px);opacity:0}to{transform:translateY(0);opacity:1}}\n  ",et=document.createElement("style");et.textContent=q,document.head.appendChild(et);function Y(){return h(localStorage.getItem("user")||"{}",{})}function lt(m){const p=Y().name||"campione",g=window.BP&&window.BP.Phrases?window.BP.Phrases:null;let v=[];return g?v=m==="high"?g.high||g.standard||[]:m==="low"?g.low||g.standard||[]:g.medium||g.standard||[]:v=["Grande {{name}}!","Che figata, {{name}}!","Super!","Non ti ferma nessuno!!","Grandissimo!"],v.length||(v=["Grande {{name}}!"]),v[Math.floor(Math.random()*v.length)].replace(/{{\s*name\s*}}/gi,p)}function ct(m){const p=document.createElement("div");p.className="bp-coach",p.textContent=lt(m||"medium"),j.appendChild(p),setTimeout(()=>{p.style.opacity="0",p.style.transform="translateY(-4px)"},2200),setTimeout(()=>{p.remove()},2420)}window.coachSay=window.coachSay||ct;try{window.BP=window.BP||{},window.BP.Coach=window.BP.Coach||{},window.BP.Coach.say=window.BP.Coach.say||function(m,p){try{const g=String(m||"").toLowerCase();let v=p&&p.intensity||(g==="low"||g==="medium"||g==="high"?g:void 0);v||(g==="bp_saved"||g==="client_converted"||g==="gi_created"?v="high":g==="appointment_created"||g==="payments_defined"||g==="report_composed"?v="medium":v="low"),ct(v)}catch(g){ct("medium")}}}catch(m){}(function(){var m="bp-nncf-banner",p="bp_seen_nncf_appt";function g(){if(!document.getElementById("bp-nncf-css")){var A="\n      #".concat(m,"{\n        position: fixed; left: 16px; right:16px; bottom: 16px; z-index: 9999;\n        background: var(--card, rgba(15,18,28,.96));\n        border: 1px solid var(--hair2, rgba(255,255,255,.12));\n        border-radius: 14px; box-shadow: 0 8px 28px rgba(0,0,0,.35);\n        padding: 12px; display:flex; align-items:center; gap:12px; backdrop-filter: blur(6px);\n      }\n      #").concat(m," .msg{ flex:1; }\n      #").concat(m," .row{ display:flex; gap:8px; align-items:center; }\n      #").concat(m," .ghost{ background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.18); }\n      @media (prefers-color-scheme: light){\n        #").concat(m,"{ background:#fff; border-color: rgba(0,0,0,.12); }\n        #").concat(m," .ghost{ background:rgba(0,0,0,.04); border-color: rgba(0,0,0,.12); }\n      }\n    "),b=document.createElement("style");b.id="bp-nncf-css",b.textContent=A,document.head.appendChild(b)}}function v(A,b){return A?(A=String(A).trim().toLowerCase(),N("/api/clients").then(function(_){var D=_&&_.clients||[],M=D.find(function(L){return String(L.name||"").trim().toLowerCase()===A});if(!M)throw new Error("Cliente non trovato: "+A);return J("/api/clients",{id:M.id,status:b})})):Promise.reject(new Error("Nome cliente mancante"))}function T(A){if(document.getElementById(m))return;g();var b=A.client||"Cliente",_=document.createElement("div");_.id=m,_.innerHTML='<div class="msg"><b> diventato cliente?</b> '+n(b)+'</div><div class="row"><button class="ghost" id="bp_nncf_yes">S</button><button class="ghost" id="bp_nncf_notyet">Non ancora</button><button id="bp_nncf_close">Chiudi</button></div>',document.body.appendChild(_);function D(){try{localStorage.setItem(p,String(A.id||A.end||Date.now()))}catch(L){}}function M(){try{_.remove()}catch(L){}}document.getElementById("bp_nncf_yes").onclick=function(){v(b,"cliente").then(function(){S("Stato cliente aggiornato")}).catch(function(){S("Impossibile aggiornare lo stato")}).finally(function(){D(),M()})},document.getElementById("bp_nncf_notyet").onclick=function(){v(b,"prospect").catch(function(){}).finally(function(){D(),M()})},document.getElementById("bp_nncf_close").onclick=function(){D(),M()}}function F(){var A=localStorage.getItem(p)||"";return N("/api/appointments").then(function(b){var _=Date.now(),D=b&&b.appointments||[],M=D.filter(function(Z){if(!Z||!Z.nncf)return!1;var ut=+new Date(Z.end||Z.start||0);return ut&&ut<_-60*1e3}).sort(function(Z,ut){return+new Date(ut.end||ut.start||0)-+new Date(Z.end||Z.start||0)});if(M.length){var L=M[0],K=String(L.id||L.end||"");K&&A&&String(A)===K||T(L)}}).catch(function(b){})}var B=window.BPFinal=window.BPFinal||{};B.injectBannerCSS=g,B.updateClientStatusByName=v,B.scanNNCF=F,window.scanNNCF||(window.scanNNCF=F)})(),(function(){window.showUndo=window.showUndo||function(m,p,g){try{var v=document.getElementById("bp_undo_bar");v||(v=document.createElement("div"),v.id="bp_undo_bar",v.style.position="fixed",v.style.left="16px",v.style.bottom="16px",v.style.zIndex="9999",v.style.background="rgba(20,22,28,0.95)",v.style.color="#fff",v.style.padding="10px 12px",v.style.borderRadius="10px",v.style.boxShadow="0 8px 24px rgba(0,0,0,.25)",v.style.display="flex",v.style.alignItems="center",v.style.gap="12px",document.body.appendChild(v)),v.innerHTML="<span>"+m+'</span><button id="bp_undo_btn" class="ghost" style="background:#fff;color:#111;border-radius:8px;padding:6px 10px">Annulla</button>';var T=document.getElementById("bp_undo_btn"),F=setTimeout(function(){try{v.remove()}catch(B){}},g||5e3);T.onclick=function(){clearTimeout(F);try{v.remove()}catch(B){}typeof p=="function"&&Promise.resolve(p()).then(function(){At("medium");try{document.dispatchEvent(new Event("undo:performed"))}catch(B){}}).catch(function(){At("heavy")})},At("light")}catch(B){logger.error(B)}},window.pushUndo=window.pushUndo||function(m){if(!(!m||typeof m.undo!="function")){var p=m.label||"Annulla ultima operazione";window.showUndo(p,m.undo,m.ttl||5e3)}},window.wireCoachUndoHaptics=function(){function m(){try{window.__periodsCache&&Object.keys(window.__periodsCache).forEach(function(g){delete window.__periodsCache[g]}),delete window.periods}catch(g){}}document.addEventListener("bp:saved",function(){window.coachSay&&ct("high"),At("heavy"),m()}),document.addEventListener("bp:deleted",function(){window.coachSay&&ct("medium"),At("medium"),m()}),document.addEventListener("appt:saved",function(){window.coachSay&&ct("medium"),At("medium")}),document.addEventListener("ics:exported",function(){window.coachSay&&ct("low"),At("light")}),document.addEventListener("report:composed",function(){window.coachSay&&ct("medium"),At("medium")}),document.addEventListener("client:converted",function(){window.coachSay&&ct("high"),At("heavy")}),document.addEventListener("gi:created",function(){window.coachSay&&ct("high"),At("heavy")}),document.addEventListener("payments:defined",function(){window.coachSay&&ct("medium"),At("medium")}),document.addEventListener("user:profile-updated",function(){window.coachSay&&ct("low"),At("light")}),document.addEventListener("appt:created",function(){window.coachSay&&ct("medium"),At("medium")}),document.addEventListener("undo:performed",function(){window.coachSay&&ct("low"),At("light")}),document.addEventListener("kpi:goal-80",function(){window.coachSay&&ct("medium"),At("medium")}),document.addEventListener("kpi:goal-reached",function(){window.coachSay&&ct("high"),At("heavy")}),document.addEventListener("click",function(g){try{for(var v=g.target,T=0;T<3&&v;T++){if(v.matches&&(v.matches('[data-close], [aria-label*="Chiudi" i], [aria-label*="Close" i]')||(v.id||"").toLowerCase().includes("close")||(v.className||"").toLowerCase().includes("close")||/^\s*(chiudi|close)\s*$/i.test(v.textContent||""))){window.coachSay&&ct("low"),At("light");break}v=v.parentElement}}catch(F){}},!0);var p=document.getElementById("app")||document.body;p&&!p.__undoWired&&(p.__undoWired=!0,p.addEventListener("click",function(g){var v=g.target.closest("[data-delete], .btn-delete");if(v){var T=v.getAttribute("href"),F=v.getAttribute("data-id");(T||F)&&(g.preventDefault(),showUndo("Eliminato  Annulla",async function(){try{if(T){var B=T+(T.indexOf("?")>=0?"&":"?")+"undo=1";await N(B)}else F&&await J("/api/restore",{id:F});location.reload()}catch(A){logger.error(A)}}))}},!0))},window.wireHapticsUI=function(){var m=document.body;if(!m.__hapticsWired){m.__hapticsWired=!0,m.addEventListener("click",function(g){var v=g.target.closest('button, .button, .btn, .ghost, [role="button"], a.button, a.btn, [data-action]');if(v){var T="light";v.classList.contains("danger")||v.getAttribute("data-danger")==="1"?T="heavy":(v.classList.contains("primary")||v.getAttribute("data-primary")==="1")&&(T="medium"),At(T)}},!0),m.addEventListener("change",function(g){var v=g.target;v&&v.matches('select, input[type="checkbox"], input[type="radio"], input[type="range"]')&&At("light")},!0);var p=document.querySelector("[data-drawer-toggle], #menuToggle, .menu-toggle");p&&!p.__hW&&(p.__hW=!0,p.addEventListener("click",function(){At("light")},!0))}}})(),window.recomputeDashboardMini=typeof G=="function"?G:()=>{},window.recomputeCommsMini=typeof rt=="function"?rt:()=>{},window.recomputeTeamChart=typeof $=="function"?$:()=>{},window.ensureTeamUserSelect=typeof U=="function"?U:()=>{},window.attachICSButtons=typeof attachICSButtons=="function"?attachICSButtons:()=>{},window.addSaveAndExport=typeof addSaveAndExport=="function"?addSaveAndExport:()=>{},window.BPFinal=window.BPFinal||{},(function(m){function p(g,v){typeof v=="function"&&(m[g]=v,window[g]||(window[g]=v))}typeof G<"u"&&p("recomputeDashboardMini",G),typeof rt<"u"&&p("recomputeCommsMini",rt),typeof $<"u"&&p("recomputeTeamChart",$),typeof viewGI<"u"&&p("viewGI",viewGI),typeof U<"u"&&p("ensureTeamUserSelect",U),typeof attachICSButtons<"u"&&p("attachICSButtons",attachICSButtons),typeof addSaveAndExport<"u"&&p("addSaveAndExport",addSaveAndExport),typeof ct<"u"&&p("coachSay",ct),typeof ensureClientFilters<"u"&&p("ensureClientFilters",ensureClientFilters),typeof enrichClientCards<"u"&&p("enrichClientCards",enrichClientCards),typeof k<"u"&&p("showClientAppointments",k),typeof wireReportButtons<"u"&&p("wireReportButtons",wireReportButtons),typeof scanNNCF<"u"&&p("scanNNCF",scanNNCF),typeof ensureNNCFChip<"u"&&p("ensureNNCFChip",ensureNNCFChip),typeof at<"u"&&p("markToday",at),typeof C<"u"&&p("clampSlotCounters",C),typeof filterPastAppointments<"u"&&p("filterPastAppointments",filterPastAppointments),typeof openWeb<"u"&&p("openWeb",openWeb),typeof openApp<"u"&&p("openApp",openApp),typeof notifyConversion<"u"&&p("notifyConversion",notifyConversion),typeof icsFromAppt<"u"&&p("icsFromAppt",icsFromAppt),typeof downloadICS<"u"&&p("downloadICS",downloadICS),typeof N<"u"&&p("GET",N),typeof J<"u"&&p("POST",J)})(window.BPFinal);const st=new MutationObserver(()=>{typeof ensureNNCFChip=="function"&&ensureNNCFChip(),typeof addSaveAndExport=="function"&&addSaveAndExport(),typeof attachICSButtons=="function"&&attachICSButtons(),typeof wireReportButtons=="function"&&wireReportButtons(),typeof ensureClientFilters=="function"&&ensureClientFilters(),typeof enrichClientCards=="function"&&enrichClientCards(),typeof U=="function"&&U(),typeof H=="function"&&H(),typeof filterPastAppointments=="function"&&filterPastAppointments(document.body),typeof at=="function"&&at()});f(async()=>{typeof injectTodayCSS=="function"&&injectTodayCSS(),typeof at=="function"&&at(),typeof C=="function"&&C(),typeof tt=="function"&&tt(),typeof G=="function"&&await G(),typeof rt=="function"&&await rt(),typeof $=="function"&&await $(),typeof wireHapticsUI=="function"&&wireHapticsUI(),typeof wireCoachUndoHaptics=="function"&&wireCoachUndoHaptics();try{const m="bpCoachGreetedDate",p=new Date().toISOString().slice(0,10);(localStorage.getItem(m)||"")!==p&&typeof window.coachSay=="function"&&(localStorage.setItem(m,p),ct("low"))}catch(m){}st.observe(document.body,{childList:!0,subtree:!0}),window.onUnifiedRangeChange&&window.onUnifiedRangeChange(m=>{const p=m==="d"?"dash":m==="cm"?"comm":m==="tg"?"t":m;p==="dash"&&typeof G=="function"&&(G(),typeof renderDashboard=="function"&&renderDashboard()),p==="comm"&&typeof rt=="function"&&rt(),(p==="t"||p==="team")&&typeof $=="function"&&$()})})})();(function(){if(!window.GET)return;const n=window.GET;window.GET=function(t){try{if(typeof t=="string"&&t.indexOf("/api/leaderboard")===0){if(!(t.indexOf("/api/leaderboard_overall")===0)&&t.indexOf("indicator=")===-1)return Promise.resolve({ranking:[]});if(window.readUnifiedRange){var e=window.readUnifiedRange("lb")||{},i=e.type==="ytd"||e.type==="ltm"?"mensile":e.type;i&&(t+=(t.includes("?")?"&":"?")+"type="+encodeURIComponent(i))}var o=document.getElementById("lb_mode"),s=o?o.value:"consuntivo";t+=(t.includes("?")?"&":"?")+"mode="+encodeURIComponent(s)}}catch(a){}return n.apply(this,arguments)}})();(function(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return;function n(){try{const s=JSON.parse(localStorage.getItem("bp_user")||"null")||{};if(s.token)return s.token}catch(s){}return localStorage.getItem("bp_token")||localStorage.getItem("authToken")||localStorage.getItem("token")||""}function t(s){const a="=".repeat((4-s.length%4)%4),r=(s+a).replace(/-/g,"+").replace(/_/g,"/"),l=atob(r),c=new Uint8Array(l.length);for(let d=0;d<l.length;d++)c[d]=l.charCodeAt(d);return c}async function e(s){const a=n();if(a)try{await fetch("/api/push/subscribe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify(s)})}catch(r){logger.warn("[BP] push subscribe error",r)}}async function i(){try{const s=await navigator.serviceWorker.ready;let a=await s.pushManager.getSubscription();if(!a){const l=await(await fetch("/api/push/publicKey")).json(),c=l.publicKey||l.key||"";if(!c)return;a=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t(c)})}await e(a.toJSON())}catch(s){logger.warn("[BP] push subscribe fail",s)}}async function o(){if(Notification.permission==="granted")return i();if(Notification.permission==="default")try{if(await Notification.requestPermission()==="granted")return i()}catch(s){}}window.BPPush={init:o,subscribe:i},window.addEventListener("load",o)})();function ze(n,t){localStorage.setItem(n,typeof t=="string"?t:JSON.stringify(t))}function yi(n,t){const e=localStorage.getItem(n);if(e==null)return t;try{return JSON.parse(e)}catch(i){return e}}function Fn(n){localStorage.removeItem(n)}function If(n,t){t?ze("bp_token",n):sessionStorage.setItem("bp_token",n)}function wi(){return localStorage.getItem("bp_token")||sessionStorage.getItem("bp_token")||""}function Mf(n){ze("bp_user",n)}function zt(){return yi("bp_user",null)||null}function Ef(){Fn("bp_token"),sessionStorage.removeItem("bp_token"),Fn("bp_user"),location.href="/?v=13"}function Ho(n,t={}){t.method=t.method||"GET";const e={...t.headers||{}},i=wi();return i&&(e.Authorization="Bearer "+i),t.body!=null&&typeof t.body!="string"&&(e["Content-Type"]="application/json; charset=utf-8",t.body=JSON.stringify(t.body)),t.headers=e,fetch(n,t).then(Tf)}async function Tf(n){const t=await n.text();if(!n.ok)throw Pf(t,n);return Af(t,n)}function Pf(n,t){try{const e=JSON.parse(n).error||"";return new Error(e||t.statusText||"HTTP "+t.status)}catch(e){return new Error(t.statusText||"HTTP "+t.status)}}function Af(n,t){try{if((t.headers.get("content-type")||"").toLowerCase().indexOf("application/json")!==-1)return n?JSON.parse(n):{}}catch(e){}return n}function It(n,t){return Ho(n,Object.assign({method:"GET"},{}))}function ue(n,t){return Ho(n,{method:"POST",body:t||{}})}function Bf(n){return Ho(n,{method:"DELETE"})}function be(n){return(n<10?"0":"")+n}function ri(n){const t=new Date(n);return be(t.getDate())+"/"+be(t.getMonth()+1)+"/"+t.getFullYear()}function ie(n){const t=new Date(n);return t.getFullYear()+"-"+be(t.getMonth()+1)+"-"+be(t.getDate())}function ua(n){const t=new Date(n);return be(t.getHours())+":"+be(t.getMinutes())}function Lf(n){const t=new Date(n);t.setHours(0,0,0,0);const e=(t.getDay()+6)%7;return t.setDate(t.getDate()-e),t}function io(n){const t=new Date(n);return new Date(t.getFullYear(),t.getMonth(),1)}function oo(n){const t=new Date(n);return new Date(t.getFullYear(),t.getMonth()+1,0,23,59,59,999)}function Qt(n){const t=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),e=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-e);const i=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-i)/864e5+1)/7)}function Ti(n){const t=new Date(n),e=Math.floor(t.getMonth()/3);return new Date(t.getFullYear(),e*3,1)}function so(n){const t=Ti(n);return new Date(t.getFullYear(),t.getMonth()+3,0,23,59,59,999)}function Pi(n){const t=new Date(n),e=t.getMonth()<6?0:6;return new Date(t.getFullYear(),e,1)}function ao(n){const t=Pi(n);return new Date(t.getFullYear(),t.getMonth()+6,0,23,59,59,999)}function Do(n){const t=new Date(n);return new Date(t.getFullYear(),0,1)}function _i(n){const t=new Date(n);return new Date(t.getFullYear(),11,31,23,59,59,999)}function Of(n,t){const e=new Date(n,0,1+(t-1)*7),i=e.getDay()||7,o=new Date(e);return o.setDate(e.getDate()-(i-1)),o.setHours(0,0,0,0),o}function en(n,t){const e=Of(n,t),i=new Date(e);return i.setDate(e.getDate()+6),i.setHours(23,59,59,999),{start:e,end:i}}function Ff(n){const t=Lf(n);t.setDate(t.getDate()+7);const e=new Date(t);return e.setDate(t.getDate()+6),e.setHours(23,59,59,999),{start:t,end:e}}function Nf(n){const t=new Date(n.getFullYear(),n.getMonth()+1,1);return{start:t,end:new Date(t.getFullYear(),t.getMonth()+1,0,23,59,59,999)}}function Rf(n){const t=Ti(new Date(n.getFullYear(),n.getMonth()+3,1));return{start:t,end:new Date(t.getFullYear(),t.getMonth()+3,0,23,59,59,999)}}function Vf(n){const t=Pi(new Date(n.getFullYear(),n.getMonth()+6,1));return{start:t,end:new Date(t.getFullYear(),t.getMonth()+6,0,23,59,59,999)}}function zf(n){const t=Do(new Date(n.getFullYear()+1,0,1));return{start:t,end:_i(t)}}function li(n,t){const e=new Date(t);return n==="settimanale"?"Sett. "+Qt(new Date(t))+" "+e.getFullYear():n==="mensile"?e.toLocaleString("it-IT",{month:"long",year:"numeric"}):n==="trimestrale"?"Trimestre "+(Math.floor(e.getMonth()/3)+1)+" "+e.getFullYear():n==="semestrale"?(e.getMonth()<6?"1":"2")+" semestre "+e.getFullYear():n==="annuale"?"Anno "+e.getFullYear():n==="ytd"?"YTD "+e.getFullYear():n==="ltm"?"Ultimi 12 mesi":n}let Ce;function Uf(){return Ce||(Ce=document.getElementById("toast-container"),Ce||(Ce=document.createElement("div"),Ce.id="toast-container",Ce.setAttribute("role","status"),Ce.setAttribute("aria-live","polite"),document.body.appendChild(Ce))),Ce}function wt(n){const t=Uf(),e=document.createElement("div");e.className="toast",e.setAttribute("role","alert"),e.textContent=n,t.appendChild(e),setTimeout(function(){try{e.remove(),t.children.length||(t.remove(),Ce=null)}catch(i){}},2200)}function ci(){if(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return;const n=document.createElement("div");n.className="confetti",document.body.appendChild(n);for(let t=0;t<26;t++){const e=document.createElement("span");e.style.position="absolute",e.style.left=2+t*4+"%",e.style.top="0",e.style.width="6px",e.style.height="10px",e.style.background="hsl("+t*14+",90%,60%)",e.style.opacity="0.95",n.appendChild(e),(function(i,o){setTimeout(function(){i.animate&&i.animate([{transform:"translateY(-20px) rotate(0deg)"},{transform:"translateY(110vh) rotate(540deg)"}],{duration:1200+Math.random()*800,easing:"cubic-bezier(.2,.6,.2,1)"})},o)})(e,t*35)}setTimeout(function(){try{n.remove()}catch(t){}},2500)}function Lt(n){return String(n).replace(/[&<>'"]/g,function(t){return{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"}[t]})}function Te(n){return(Number(n)||0).toLocaleString("it-IT")+""}function ne(n){const t=Number(n)||0;return String(Math.round(t))}function Hf(){if(document.getElementById("bp-mobile-drawer-fix"))return;const n="\n  @media (max-width:980px){\n    .topbar{\n      background: rgba(20,24,34,.90) !important;\n      border-bottom: 1px solid rgba(255,255,255,.08) !important;\n    }\n    .drawer{\n      background: rgba(20,24,34,.96) !important;\n      box-shadow: 14px 0 28px rgba(0,0,0,.45) !important;\n      width: 86vw !important;\n      overflow-y: auto !important;\n    }\n    .drawer .row{ gap:10px !important; }\n    .drawer button{\n      background: rgba(255,255,255,.10) !important;\n      border: 1px solid rgba(255,255,255,.22) !important;\n      color: #fff !important;\n      padding: 12px 14px !important;\n      font-weight: 700 !important;\n      border-radius: 12px !important;\n      -webkit-tap-highlight-color: transparent;\n    }\n    .drawer button:hover{\n      background: rgba(255,255,255,.14) !important;\n      border-color: rgba(255,255,255,.30) !important;\n    }\n    .drawer button.ghost{\n      background: rgba(255,255,255,.10) !important;\n      box-shadow: none !important;\n    }\n  }",t=document.createElement("style");t.id="bp-mobile-drawer-fix",t.textContent=n,document.head.appendChild(t)}function jf(){if(document.getElementById("bp-mobile-light-fix"))return;const n="\n    @media (max-width:980px) and (prefers-color-scheme: light){\n      .topbar{\n        background:#fff !important;\n        border-bottom:1px solid rgba(0,0,0,.08) !important;\n        box-shadow:none !important;\n      }\n      .topbar .brand .logo{\n        color:#0f172a !important;\n        font-weight:900 !important;\n        letter-spacing:.4px;\n        text-shadow:none !important;\n        opacity:1 !important;\n      }\n      .topbar .hamb span{ background:#0f172a !important; }\n      .card{\n        background:#fff !important;\n        background-image:none !important;\n        box-shadow:none !important;\n      }\n      .drawer{\n        background:#fff !important;\n        box-shadow:14px 0 28px rgba(0,0,0,.10) !important;\n      }\n      .drawer button{\n        color:#0f172a !important;\n        background:rgba(0,0,0,.04) !important;\n        border:1px solid rgba(0,0,0,.12) !important;\n      }\n      .drawer button:hover{\n        background:rgba(0,0,0,.08) !important;\n      }\n    }\n  ",t=document.createElement("style");t.id="bp-mobile-light-fix",t.textContent=n,document.head.appendChild(t)}function Wf(){if(document.getElementById("bp-badge-light-css"))return;const n="\n    @media (prefers-color-scheme: light){\n      .badge{\n        background: linear-gradient(180deg, #eef2ff, #f8fafc) !important;\n        border: 1px solid #c7d2fe !important;\n        color: #0f172a !important;\n        font-weight: 700 !important;\n        padding: 6px 10px !important;\n        border-radius: 9999px !important;\n        letter-spacing: .2px !important;\n        box-shadow: 0 1px 0 rgba(15,23,42,.05) inset !important;\n      }\n      .chip, .tag{\n        background: #ffffff !important;\n        border: 1px solid #cbd5e1 !important;\n        color: #0f172a !important;\n        font-weight: 600 !important;\n        border-radius: 9999px !important;\n      }\n      .card .badge{\n        background: #fff !important;\n      }\n    }\n  ",t=document.createElement("style");t.id="bp-badge-light-css",t.textContent=n,document.head.appendChild(t)}function he(){const n=zt();if(!n)return"";const t=n.role==="admin",e='<span class="badge">Lvl '+(window.level?window.level():"")+"  XP "+(window.getXP?window.getXP():"")+"</span>",i='<div id="drawer" class="drawer" role="dialog" aria-modal="true" aria-label="Menu"><div class="row"><button class="ghost" onclick="viewHome();toggleDrawer(false)">Dashboard</button><button class="ghost" onclick="viewCalendar();toggleDrawer(false)">Calendario</button><button class="ghost" onclick="viewPeriods();toggleDrawer(false)">BP</button><button class="ghost" onclick="viewAppointments();toggleDrawer(false)">Appuntamenti</button><button class="ghost" onclick="viewLeaderboard();toggleDrawer(false)">Classifiche</button><button class="ghost" onclick="viewCommissions();toggleDrawer(false)">Provvigioni</button><button class="ghost" onclick="viewVendite();toggleDrawer(false)">Vendite e Riordini</button><button class="ghost" onclick="viewGI();toggleDrawer(false)">GI &amp; Scadenzario</button><button class="ghost" onclick="viewReport();toggleDrawer(false)">Report</button><button class="ghost" onclick="viewClients();toggleDrawer(false)">Clienti</button><button class="ghost" onclick="viewTeam();toggleDrawer(false)">Squadra</button>'+(t?'<button class="ghost" onclick="viewUsers();toggleDrawer(false)">Utenti</button>':"")+'<button onclick="logout()">Logout</button></div></div>';return'<div class="topbar"><div class="brand"><button class="hamb" id="hamb" aria-label="Apri menu" aria-controls="drawer" aria-expanded="false"><span></span><span></span><span></span></button><div class="logo">BATTLE PLAN</div></div><div class="nav right">'+e+'<button class="ghost" onclick="viewHome()">Dashboard</button><button class="ghost" onclick="viewCalendar()">Calendario</button><button class="ghost" onclick="viewPeriods()">BP</button><button class="ghost" onclick="viewAppointments()">Appuntamenti</button><button class="ghost" onclick="viewLeaderboard()">Classifiche</button><button class="ghost" onclick="viewCommissions()">Provvigioni</button><button class="ghost" onclick="viewVendite()">Vendite e Riordini</button><button class="ghost" onclick="viewGI()">GI &amp; Scadenzario</button><button class="ghost" onclick="viewReport()">Report</button><button class="ghost" onclick="viewClients()">Clienti</button><button class="ghost" onclick="viewTeam()">Squadra</button>'+(t?'<button class="ghost" onclick="viewUsers()">Utenti</button>':"")+'<button onclick="logout()">Logout</button></div></div>'+i}function oe(){if(!zt())return;if(!document.getElementById("bp_nav_contrast_css")){const s="\n      @media (min-width: 1024px){\n        .topbar .nav .ghost{\n          background: rgba(255,255,255,.06);\n          border: 1px solid rgba(255,255,255,.18);\n        }\n        .topbar .nav .ghost:hover{\n          background: rgba(255,255,255,.12);\n        }\n      }\n    ",a=document.createElement("style");a.id="bp_nav_contrast_css",a.textContent=s,document.head.appendChild(a)}const n=document.getElementById("app"),t=document.querySelector(".topbar"),e=he();t?t.outerHTML=e:n&&n.insertAdjacentHTML("afterbegin",e);try{Hf()}catch(s){}try{jf()}catch(s){}try{Wf()}catch(s){}if(!document.getElementById("bp-unified-filters-css")){const s="\n      /* Nested inputs align in two columns inside unified filters */\n      .uf .row .row{ display:grid; grid-template-columns: 1fr 1fr; gap:8px; }\n\n      @media (max-width: 980px){\n        .uf input, .uf select{ min-width: 0; width: 100%; }\n        .uf .row > div{ flex: 1 1 180px; min-width: 0; }\n\n        /* Squadra admin bar: grid on small screens */\n        #t_adminbar{ display:grid !important; grid-template-columns: 1fr 1fr; align-items:end; gap:10px; }\n        #t_adminbar > div{ min-width: 0; }\n        #t_adminbar .row{ display:grid; grid-template-columns: 1fr 1fr; gap:8px; }\n      }\n\n      @media (max-width: 560px){\n        #t_adminbar{ grid-template-columns: 1fr; }\n      }\n    ",a=document.createElement("style");a.id="bp-unified-filters-css",a.textContent=s,document.head.appendChild(a)}const i=document.getElementById("hamb");i&&(i.onclick=function(){Ai()});const o=document.getElementById("drawer");o&&o.addEventListener("click",function(s){s.target.id==="drawer"&&Ai(!1)}),document.removeEventListener("keydown",fa,!1),document.addEventListener("keydown",fa,!1)}function fa(n){if(n&&n.key==="Escape"){const t=document.getElementById("drawer");t&&t.classList.contains("open")&&Ai(!1)}}function Ai(n){const t=document.getElementById("drawer");if(!t)return;const e=typeof n=="boolean"?n:!t.classList.contains("open");t.classList.toggle("open",e);const i=document.getElementById("hamb");i&&i.setAttribute("aria-expanded",String(e)),document.body.classList.toggle("no-scroll",e)}let ha=null;function Yf(){clearTimeout(ha),ha=setTimeout(oe,60)}function ye(n){return document.querySelector(n)}function ro(n){return Array.from(document.querySelectorAll(n))}(function(){const n=window.BP=window.BP||{},t=n.ICS=n.ICS||{};function e(l){if(!l)return"";if(/[Zz]|[+\-]\d{2}:\d{2}$/.test(String(l)))return new Date(l).toISOString().replace(/[-:]/g,"").replace(/\.\d{3}Z$/,"Z").slice(0,15)+"Z";const[c,d="00:00"]=String(l).split("T"),[u,f,h]=c.split("-").map(Number),[w,x]=d.split(":").map(Number);return new Date(u,f-1,h,w,x,0,0).toISOString().replace(/[-:]/g,"").replace(/\.\d{3}Z$/,"Z").slice(0,15)+"Z"}function i(l){return(l||"").replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n")}function o(l){if(l.length<=74)return[l];const d=[];let u=0;for(;u<l.length;){const f=l.slice(u,u+74);d.push(u===0?f:" "+f),u+=74}return d}function s(l){const c=(l&&l.id||"bp-"+Date.now())+"@bpapp",d=l&&l.client?"Appuntamento  "+l.client:"Appuntamento",u=e(l&&l.start),f=e(l&&l.end),h=e(new Date().toISOString().slice(0,16)),w=[];l&&l.type&&w.push("Tipo: "+l.type),l&&l.vss&&w.push("VSS: "+l.vss),l&&l.vsdPersonal&&w.push("VSD Personale: "+l.vsdPersonal),l&&l.notes&&w.push("Note: "+l.notes);const x=i(w.join("\n")),S=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//BPApp//Calendario//IT","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT","UID:"+c,"DTSTAMP:"+h,u?"DTSTART:"+u:"",f?"DTEND:"+f:"","SUMMARY:"+i(d),x?"DESCRIPTION:"+x:"","END:VEVENT","END:VCALENDAR"].filter(Boolean),O=[];return S.forEach(N=>O.push.apply(O,o(N))),O.join("\r\n")}function a(){try{const l=navigator.userAgent||navigator.vendor||"",c=/iP(ad|hone|od)/.test(l),d=/^((?!chrome|android|crios|fxios|edgi).)*safari/i.test(l);return c||d}catch(l){return!1}}function r(l){try{const c=s(l),d=l&&l.start?String(l.start).split("T")[0]:"evento",u=(l&&l.client||"appuntamento").trim().replace(/[^\w\-]+/g,"_").slice(0,40),f="bp_".concat(u,"_").concat(d,".ics");if(a())try{const x="data:text/calendar;charset=utf-8,"+encodeURIComponent(c),S=document.createElement("a");return S.href=x,S.setAttribute("target","_blank"),S.setAttribute("download",f),document.body.appendChild(S),S.click(),S.remove(),!0}catch(x){try{return window.location.assign("data:text/calendar;charset=utf-8,"+encodeURIComponent(c)),!0}catch(S){try{logger.error(S)}catch(O){}return!1}}const h=new Blob([c],{type:"text/calendar;charset=utf-8"}),w=document.createElement("a");return w.href=URL.createObjectURL(h),w.download=f,document.body.appendChild(w),w.click(),setTimeout(()=>{try{URL.revokeObjectURL(w.href)}catch(x){}w.remove()},50),!0}catch(c){try{logger.error(c)}catch(d){}return!1}}t.makeIcsForAppointment=s,t.downloadIcsForAppointment=r,window.icsFromAppt=window.icsFromAppt||function(l){return s(l)},window.downloadICS=window.downloadICS||function(l,c){try{var d=window.__icsSanitize?__icsSanitize(l):l||"evento";/\.ics$/i.test(d)||(d+=".ics");var u=new Blob([c],{type:"text/calendar;charset=utf-8"}),f=document.createElement("a");f.href=URL.createObjectURL(u),f.download=d,document.body.appendChild(f),f.click(),setTimeout(function(){URL.revokeObjectURL(f.href),f.remove()},50)}catch(h){logger.error(h)}}})();window.Chart=Le;(function(){var n=document.getElementById("app");window.$1=window.$1||ye,window.$all=window.$all||ro,window.addXP=window.addXP||function(){},typeof window.logger!="object"&&(window.logger=["debug","info","log","warn","error"].reduce((y,I)=>(y[I]=(console[I]||console.log).bind(console),y),{})),typeof window.haptic!="function"&&(window.haptic=window.BP&&BP.Haptics&&BP.Haptics.impact?BP.Haptics.impact:function(){}),(function(){const y=window.__miniCharts=window.__miniCharts||{};function I(V,G,rt){const $=V.getContext("2d"),tt=window.devicePixelRatio||1,at=V.clientWidth||320,C=V.clientHeight||80;V.width=Math.round(at*tt),V.height=Math.round(C*tt),$.save(),$.scale(tt,tt),$.clearRect(0,0,at,C);const E=Math.max(1,...rt),k=rt.length>1?(at-8)/(rt.length-1):0;$.strokeStyle="#2e6cff",$.lineWidth=2,$.beginPath();for(let U=0;U<rt.length;U++){const H=4+U*k,j=C-6-rt[U]/E*(C-12);U===0?$.moveTo(H,j):$.lineTo(H,j)}$.stroke(),$.fillStyle="#2e6cff";for(let U=0;U<rt.length;U++){const H=4+U*k,j=C-6-rt[U]/E*(C-12);$.beginPath(),$.arc(H,j,2,0,Math.PI*2),$.fill()}$.restore()}function R(V,G){try{let $=function(E,k){try{if(this&&typeof this.getLabelForValue=="function")return String(this.getLabelForValue(E))}catch(j){}const U=typeof E=="number"?E:k,H=Array.isArray(V)?V[U]:E;return String(H!=null?H:E)};const rt=Array.isArray(V)?V.length:0;if(!rt)return{autoSkip:!0,maxRotation:0,minRotation:0};const tt=Math.max(0,...V.map(E=>String(E||"").length)),at=Math.max(28,Math.min(90,Math.round(tt*7)));return rt*at>(G||320)*1.2?{autoSkip:!0,maxRotation:45,minRotation:45,callback:$}:{autoSkip:!0,maxRotation:0,minRotation:0,callback:$}}catch(rt){return{autoSkip:!0,maxRotation:0,minRotation:0}}}window.computeTickOptions=R,window.drawFullLine=function(V,G,rt){const $=document.getElementById(V);if(!$)return;if($.width=$.clientWidth||$.width||320,$.height=$.clientHeight||$.height||80,!Le){I($,G,rt),y[String(V)]={canvas:$,labels:G,data:rt,fallback:!0};return}const tt=String(V),at=R(G,$.width||320);if(y[tt]&&y[tt].canvas!==$){try{y[tt].destroy()}catch(C){}delete y[tt]}if(y[tt]){const C=y[tt];C.data.labels=G,C.data.datasets[0].data=rt,C.options.scales.x.ticks=R(G,$.width||320),C.update()}else{const C=$.getContext("2d");y[tt]=new Le(C,{type:"line",data:{labels:G,datasets:[{label:"",data:rt,borderColor:"#2e6cff",backgroundColor:"rgba(46,108,255,0.10)",borderWidth:2,tension:.3,pointRadius:3,pointHoverRadius:5,fill:!1}]},options:{responsive:!1,maintainAspectRatio:!1,animation:!1,animations:!1,plugins:{legend:{display:!1}},devicePixelRatio:window.devicePixelRatio||1,scales:{x:{grid:{display:!1},ticks:at},y:{beginAtZero:!0}}}})}};let P=window.devicePixelRatio||1;function W(){Object.keys(y).forEach(V=>{const G=y[V];if(G&&typeof G.resize=="function")try{G.resize()}catch(rt){}else if(G&&G.fallback)try{I(G.canvas,G.labels,G.data)}catch(rt){}})}function X(){const V=window.devicePixelRatio||1;V!==P&&(P=V,W())}window.addEventListener("pageshow",W),window.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&X()}),window.addEventListener("resize",X),window.addEventListener("orientationchange",()=>setTimeout(()=>{P=-1,X()},50))})();function t(){document.title="Battle Plan  Login";var y='<div class="hero" id="hero"><div class="layer glow"></div><div class="layer grid"></div><div class="title">Pianifica. Eroga. Vinci. <span class="small muted">BP  stile gaming</span></div></div><div class="wrap"><div class="grid"><div class="card"><h3>Accedi</h3><form id="loginForm" autocomplete="on"><div class="row"><div><label>Email</label><input id="li_email" name="email" type="email" autocomplete="username" required></div><div><label>Password</label><input id="li_password" name="password" type="password" autocomplete="current-password" required></div></div><div class="row"><label class="small"><input type="checkbox" id="li_remember" checked> Rimani collegato</label></div><div class="right" style="margin-top:8px"><button type="submit" id="btnLogin">Accedi</button></div></form></div><div class="card"><h3>Registrati</h3><form id="regForm" autocomplete="on"><div class="row"><div><label>Nome</label><input id="re_name" name="name" type="text" required></div><div><label>Email</label><input id="re_email" name="email" type="email" autocomplete="username" required></div><div><label>Password</label><input id="re_password" name="new-password" type="password" autocomplete="new-password" required></div></div><div class="right" style="margin-top:8px"><button type="submit" id="btnRegister">Registrati</button></div></form></div></div></div>';n.innerHTML=y;var I=document.getElementById("hero");I&&I.addEventListener("pointermove",function(W){var X=I.getBoundingClientRect();I.style.setProperty("--gx",(W.clientX-X.left)/X.width*100+"%"),I.style.setProperty("--gy",(W.clientY-X.top)/X.height*100+"%")});var R=document.getElementById("loginForm"),P=document.getElementById("regForm");R.addEventListener("submit",function(W){W.preventDefault();var X=document.getElementById("btnLogin");X.disabled=!0;var V=document.getElementById("li_email").value.trim().toLowerCase(),G=document.getElementById("li_password").value,rt=document.getElementById("li_remember").checked;ue("/api/login",{email:V,password:G}).then(function($){if(typeof $=="string")try{$=JSON.parse($)}catch(tt){}If($.token,rt),Mf($.user),wt("Bentornato "+$.user.name+"!"),window.addXP(10),c(),oe(),window.BPPush&&window.BPPush.subscribe()},function($){wt("Credenziali errate"),logger.error($)}).catch(function($){logger.error($)}).finally(function(){X.disabled=!1})}),P.addEventListener("submit",function(W){W.preventDefault();var X=document.getElementById("btnRegister");X.disabled=!0;var V=document.getElementById("re_name").value.trim(),G=document.getElementById("re_email").value.trim().toLowerCase(),rt=document.getElementById("re_password").value;ue("/api/register",{name:V,email:G,password:rt}).then(function(){wt("Registrazione ok. Ora accedi"),ci(),window.addXP(20),window.scrollTo({top:0,behavior:"smooth"})}).catch(function($){wt("Email gi registrata?"),logger.error($)}).finally(function(){X.disabled=!1})})}function e(y){const I=new Date,R=I.getFullYear(),P=I.getMonth()+1,W=Qt(I),X=Math.floor((P-1)/3)+1,V=2e3,G=2100,rt=(function(){let C="";for(let E=V;E<=G;E++)C+='<option value="'.concat(E,'" ').concat(E===R?"selected":"",">").concat(E,"</option>");return C})(),$=(function(){let C="";for(let E=1;E<=12;E++)C+='<option value="'.concat(E,'" ').concat(E===P?"selected":"",">").concat(E,"</option>");return C})(),tt=(function(){let C="";for(let E=1;E<=53;E++)C+='<option value="'.concat(E,'" ').concat(E===W?"selected":"",">").concat(E,"</option>");return C})(),at=(function(){let C="";for(let E=1;E<=4;E++)C+='<option value="'.concat(E,'" ').concat(E===X?"selected":"",">Q").concat(E,"</option>");return C})();return'<div class="uf"><div class="row"><div><label>Granularit</label><select id="'+y+'_gran"><option value="settimanale">Settimanale</option><option value="mensile" selected>Mensile</option><option value="trimestrale">Trimestrale</option><option value="semestrale">Semestrale</option><option value="annuale">Annuale</option><option value="ytd">Anno corrente (YTD)</option><option value="ltm">Ultimi 12 mesi (LTM)</option></select></div><div id="'+y+'_wrap_week" style="display:none"><label>Settimana ISO</label><div class="row"><select id="'+y+'_week">'+tt+'</select><select id="'+y+'_year_w">'+rt+'</select></div></div><div id="'+y+'_wrap_month"><label>Mese</label><div class="row"><select id="'+y+'_month">'+$+'</select><select id="'+y+'_year_m">'+rt+'</select></div></div><div id="'+y+'_wrap_quarter" style="display:none"><label>Trimestre</label><div class="row"><select id="'+y+'_quarter">'+at+'</select><select id="'+y+'_year_q">'+rt+'</select></div></div><div id="'+y+'_wrap_sem" style="display:none"><label>Semestre</label><div class="row"><select id="'+y+'_sem"><option value="1">1</option><option value="2">2</option></select><select id="'+y+'_year_s">'+rt+'</select></div></div><div id="'+y+'_wrap_year" style="display:none"><label>Anno</label><select id="'+y+'_year">'+rt+'</select></div><div class="actions"><button id="'+y+'_refresh" class="ghost">Aggiorna</button></div></div></div>'}(function(){const y=[];window.onUnifiedRangeChange=function(I){typeof I=="function"&&y.push(I)},window.emitUnifiedRangeChange=function(I){for(const R of y)try{R(I)}catch(P){logger.error(P)}}})();function i(y){return y==="d"||y==="dash"?"dash":y==="cm"||y==="comm"?"comm":y==="tg"||y==="t"||y==="team"?"t":y}function o(y,I){function R(){const W=document.getElementById(y+"_gran").value;["week","month","quarter","sem","year"].forEach(V=>{const G=document.getElementById(y+"_wrap_"+V);G&&(G.style.display="none")}),W==="settimanale"?document.getElementById(y+"_wrap_week").style.display="":W==="mensile"?document.getElementById(y+"_wrap_month").style.display="":W==="trimestrale"?document.getElementById(y+"_wrap_quarter").style.display="":W==="semestrale"?document.getElementById(y+"_wrap_sem").style.display="":W==="annuale"&&(document.getElementById(y+"_wrap_year").style.display="")}["gran","week","year_w","month","year_m","quarter","year_q","sem","year_s","year"].forEach(W=>{const X=document.getElementById(y+"_"+W);X&&(X.onchange=()=>{R(),I&&I(),window.emitUnifiedRangeChange(i(y))},X.oninput=()=>{R()})});const P=document.getElementById(y+"_refresh");P&&(P.onclick=()=>{I&&I(),window.emitUnifiedRangeChange(i(y))}),R()}function s(y){var I=new Date;function R(et,Y){var lt=document.getElementById(y+"_"+et),ct=lt?parseInt(lt.value,10):NaN;return isFinite(ct)?ct:Y}var P=document.getElementById(y+"_gran"),W=P?P.value:"mensile",X={type:W,start:null,end:null};if(W==="settimanale"){var V=R("year_w",I.getFullYear()),G=Math.max(1,Math.min(53,R("week",Qt(I)))),rt=en(V,G);return X.start=rt.start,X.end=rt.end,X}if(W==="mensile"){var $=R("year_m",I.getFullYear()),tt=Math.max(1,Math.min(12,R("month",I.getMonth()+1)));return X.start=new Date($,tt-1,1),X.end=new Date($,tt,0,23,59,59,999),X}if(W==="trimestrale"){var at=R("year_q",I.getFullYear()),C=Math.max(1,Math.min(4,R("quarter",Math.floor(I.getMonth()/3)+1)));return X.start=new Date(at,(C-1)*3,1),X.end=new Date(at,C*3,0,23,59,59,999),X}if(W==="semestrale"){var E=R("year_s",I.getFullYear()),k=R("sem",I.getMonth()<6?1:2);return X.start=new Date(E,k===1?0:6,1),X.end=new Date(E,k===1?6:12,0,23,59,59,999),X}if(W==="annuale"){var U=R("year",I.getFullYear());return X.start=new Date(U,0,1),X.end=new Date(U,11,31,23,59,59,999),X}if(W==="ytd"){var H=new Date(I.getFullYear(),I.getMonth()+1,0,23,59,59,999);return X.start=new Date(I.getFullYear(),0,1),X.end=H,X}if(W==="ltm"){var j=new Date(I.getFullYear(),I.getMonth()+1,0,23,59,59,999),q=new Date(j.getFullYear(),j.getMonth()-11,1);return X.start=q,X.end=j,X}return X.type="mensile",X.start=new Date(I.getFullYear(),I.getMonth(),1),X.end=new Date(I.getFullYear(),I.getMonth()+1,0,23,59,59,999),X}function a(y){return y==="ytd"||y==="ltm"?"mensile":y}window.effectivePeriodType=a;function r(y,I){var R=String(y||"mensile").toLowerCase(),P=a(R||"mensile"),W=I?new Date(I):new Date,X=W.getUTCFullYear(),V=[];function G(Z,ut){V.push({s:Z.getTime(),e:ut.getTime()})}function rt(Z,ut,z){return new Date(Date.UTC(Z,ut,z))}function $(Z){return new Date(Z.getTime()+24*3600*1e3-1)}function tt(Z,ut){return new Date(Date.UTC(Z,ut+1,0))}if(R==="ytd"){for(var at=0;at<=W.getUTCMonth();at++){var C=rt(W.getUTCFullYear(),at,1),E=$(tt(C.getUTCFullYear(),C.getUTCMonth()));V.push({s:C.getTime(),e:E.getTime()})}return V}if(R==="ltm"){for(var k=rt(W.getUTCFullYear(),W.getUTCMonth(),1),U=11;U>=0;U--){var H=rt(k.getUTCFullYear(),k.getUTCMonth()-U,1),j=$(tt(H.getUTCFullYear(),H.getUTCMonth()));V.push({s:H.getTime(),e:j.getTime()})}return V}if(P==="settimanale"){var q=new Date(Date.UTC(W.getUTCFullYear(),W.getUTCMonth(),W.getUTCDate())),et=(q.getUTCDay()+6)%7;q.setUTCDate(q.getUTCDate()-et);for(var Y=52;Y>=0;Y--){var lt=new Date(q);lt.setUTCDate(q.getUTCDate()-Y*7);var ct=new Date(lt);ct.setUTCDate(lt.getUTCDate()+6),ct.setUTCHours(23,59,59,999),G(lt,ct)}return V}if(P==="mensile"){for(var k=new Date(Date.UTC(W.getUTCFullYear(),W.getUTCMonth(),1)),U=23;U>=0;U--){var at=new Date(Date.UTC(k.getUTCFullYear(),k.getUTCMonth()-U,1));G(at,$(tt(at.getUTCFullYear(),at.getUTCMonth())))}return V}if(P==="trimestrale"){for(var st=Math.floor(W.getUTCMonth()/3),m=11;m>=0;m--){var p=st-m,g=X+Math.floor(p/4),v=(p%4+4)%4,lt=rt(g,v*3,1),ct=$(new Date(Date.UTC(g,v*3+3,0)));G(lt,ct)}return V}if(P==="semestrale"){for(var T=W.getUTCMonth()<6?0:1,F=5;F>=0;F--){var B=T-F,A=X+Math.floor(B/2),b=(B%2+2)%2,_=b===0?0:6,D=rt(A,_,1),M=$(new Date(Date.UTC(A,_+6,0)));G(D,M)}return V}for(var L=2;L>=0;L--){var K=X-L;G(rt(K,0,1),$(new Date(Date.UTC(K,12,0))))}return V}function l(y,I){var R=a(y||"mensile");return(I||[]).map(function(P){var W=new Date(P.s);return R==="settimanale"?"W"+Qt(W)+" "+W.getUTCFullYear():R==="mensile"?String(W.getUTCMonth()+1).padStart(2,"0")+"/"+W.getUTCFullYear():R==="trimestrale"?"Q"+(Math.floor(W.getUTCMonth()/3)+1)+" "+W.getUTCFullYear():R==="semestrale"?(W.getUTCMonth()<6?"S1 ":"S2 ")+W.getUTCFullYear():String(W.getUTCFullYear())})}function c(){if(!zt())return t();document.title="Battle Plan  Dashboard",n.innerHTML=he()+'<div class="wrap"><div class="card"><b>Filtro</b><div class="row uf-row" style="margin-top:6px;align-items:flex-end;gap:16px;flex-wrap:wrap"><div><label>Modalit</label><select id="dash_mode" name="mode"><option value="consuntivo">Consuntivo</option><option value="previsionale">Previsionale</option></select></div><div><label>Consulente</label><select id="dash_cons"><option value="">Tutti</option></select></div></div>'+e("dash")+'</div><div class="grid" id="kpiGrid"><div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><b>VSS</b><span id="kpi_vss" class="big"></span></div><canvas id="d_mini_vss" width="320" height="90"></canvas></div><div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><b>VSD personale</b><span id="kpi_vsd" class="big"></span></div><canvas id="d_mini_vsdpersonale" width="320" height="90"></canvas></div><div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><b>VSD indiretto</b><span id="kpi_vsd_ind" class="big"></span></div><canvas id="d_mini_vsdindiretto" width="320" height="90"></canvas></div><div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><b>GI</b><span id="kpi_gi" class="big"></span></div><canvas id="d_mini_gi" width="320" height="90"></canvas></div><div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><b>NNCF</b><span id="kpi_nncf" class="big"></span></div><canvas id="d_mini_nncf" width="320" height="90"></canvas></div><div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><b>Tot Provvigioni</b><span id="kpi_provv" class="big"></span></div><canvas id="d_mini_provv" width="320" height="90"></canvas></div></div><div class="card"><b>Ultimi appuntamenti</b><div id="lastApps" class="row" style="margin-top:8px"></div></div><div class="card"><b>Ultimi BP inviati</b><div id="lastBPs" class="row" style="margin-top:8px"></div></div></div>',oe(),(function(){try{var U=document.querySelector(".uf-row");if(!U)return;var H=document.getElementById("cal_prev");H&&(H.textContent="");var j=document.getElementById("cal_next");j&&(j.textContent="");var q=U.querySelector("#only_4h");q&&q.parentElement&&(q.parentElement.innerHTML='<input type="checkbox" id="only_4h"> Solo slot  4h');var et=document.getElementById("cal_add"),Y=U.querySelector(".right"),lt=Y?Y.querySelector("#cal_refresh"):null;if(et&&lt){var ct=document.createElement("div");ct.className="actions",Y.parentNode.insertBefore(ct,Y),ct.appendChild(et),ct.appendChild(lt),Y.remove()}}catch(st){logger&&logger.warn&&logger.warn("cal header fix fail",st)}})();function y(k,U){var H=document.getElementById(k);H&&(H.textContent=U)}function I(k){var U=Number(k)||0;return U.toLocaleString("it-IT")+""}function R(k){var U=Number(k)||0;return String(Math.round(U))}function P(k){return String(k).replace(/[&<>'"]/g,U=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[U])}(function(){It("/api/usernames").then(function(U){var H=U&&U.users||[],j=document.getElementById("dash_cons");j&&(j.innerHTML='<option value="">Tutti</option>'+H.map(function(q){return'<option value="'+P(String(q.id))+'">'+P(q.name||q.email||"User #"+q.id)+"</option>"}).join(""))}).catch(function(){})})();function W(k,U){return U==="settimanale"?window.isoWeekNum?window.isoWeekNum(k):Math.ceil(k.getDate()/7):U==="mensile"||U==="ytd"||U==="ltm"?k.getMonth()+1:U==="trimestrale"?Math.floor(k.getMonth()/3)+1:U==="semestrale"?k.getMonth()<6?1:2:k.getFullYear()}function X(k){if(typeof r=="function")return(r(k,new Date)||[]).map(function(z){return{s:z.s,e:z.e}});var U=new Date,H=[];function j(z,Q){H.push({s:z.getTime(),e:Q.getTime()})}function q(z){var Q=new Date(z);return Q.setHours(23,59,59,999),Q}function et(z,Q){return new Date(z,Q+1,0,23,59,59,999)}var Y=String(k||"mensile").toLowerCase();if(Y==="settimanale"){var lt=new Date(U),ct=(lt.getDay()+6)%7;lt.setDate(lt.getDate()-ct),lt.setHours(0,0,0,0);for(var st=52;st>=0;st--){var m=new Date(lt);m.setDate(m.getDate()-st*7);var p=new Date(m);p.setDate(m.getDate()+6),p.setHours(23,59,59,999),j(m,p)}return H}if(Y==="mensile"||Y==="ytd"||Y==="ltm"){if(Y==="ytd")for(var g=0;g<=U.getMonth();g++){var v=new Date(U.getFullYear(),g,1);j(v,et(U.getFullYear(),g))}else for(var T=Y==="ltm"?12:24,F=new Date(U.getFullYear(),U.getMonth(),1),B=T-1;B>=0;B--){var m=new Date(F.getFullYear(),F.getMonth()-B,1);j(m,et(m.getFullYear(),m.getMonth()))}return H}if(Y==="trimestrale"){for(var A=Math.floor(U.getMonth()/3)*3,b=new Date(U.getFullYear(),A,1),_=11;_>=0;_--){var D=new Date(b.getFullYear(),b.getMonth()-_*3,1);j(D,q(new Date(D.getFullYear(),D.getMonth()+3,0)))}return H}if(Y==="semestrale"){for(var M=U.getMonth()<6?0:6,L=new Date(U.getFullYear(),M,1),m=5;m>=0;m--){var K=new Date(L.getFullYear(),L.getMonth()-m*6,1);j(K,q(new Date(K.getFullYear(),K.getMonth()+6,0)))}return H}for(var Z=2;Z>=0;Z--){var ut=new Date(U.getFullYear()-Z,0,1);j(ut,q(new Date(ut.getFullYear(),12,0)))}return H}function V(k){switch(String(k)){case"provv_gi":return"ProvvGI";case"provv_vsd":return"ProvvVSD";case"tot_provv":return"TotProvvigioni";default:return k}}function G(k,U,H,j){var q=j||s("dash"),et=String(q.type||"mensile").toLowerCase(),Y=et==="ytd"||et==="ltm"?"mensile":et,lt=X(et);function ct(p,g){var v=new Date(g.startDate).getTime(),T=new Date(g.endDate).getTime();return v>=p.s&&T<=p.e}function st(p,g){if(!p)return 0;if(g==="VSDTotale")return Number(p.VSDPersonale||0)+Number(p.VSDIndiretto||0);if(g==="ProvvGI")return Number(p.ProvvGI||0);if(g==="ProvvVSD")return Number(p.ProvvVSD||0);if(g==="TotProvvigioni"){var v=p.TotProvvigioni;return Number(v!=null?v:Number(p.ProvvGI||0)+Number(p.ProvvVSD||0))}return Number(p[g]||0)}var m=(function(){var p=lt.length?ie(new Date(lt[0].s)):ie(new Date),g=lt.length?ie(new Date(lt[lt.length-1].e)):ie(new Date),v="?global=1&type="+encodeURIComponent(Y)+"&from="+encodeURIComponent(p)+"&to="+encodeURIComponent(g);return H&&(v+="&userId="+encodeURIComponent(H)),v})();return It("/api/periods"+m).catch(function(){return It("/api/periods"+m.replace("?global=1",""))}).then(function(p){var g=p&&p.periods||[],v=g.filter(function(B){return!(B.type!==Y||H&&String(B.userId||B.uid||"")!==String(H))}),T=V(k),F=lt.map(function(B){for(var A=0,b=0;b<v.length;b++){var _=v[b];if(ct(B,_)){var D=U==="previsionale"?_.indicatorsPrev||{}:_.indicatorsCons||{};A+=st(D,T)}}return{x:new Date(B.s),y:Math.round(A*100)/100}});return F})}function rt(k,U,H){var j=document.getElementById(k);if(j){if(typeof window.drawFullLine=="function"){window.drawFullLine(k,U,H);return}var q=j.getContext("2d");j.width=j.clientWidth||320,j.height=j.clientHeight||80,q.clearRect(0,0,j.width,j.height);var et=Math.max(1,...H),Y=H.length>1?(j.width-8)/(H.length-1):0;q.strokeStyle="#2e6cff",q.lineWidth=2,q.beginPath();for(var lt=0;lt<H.length;lt++){var ct=4+lt*Y,st=j.height-6-H[lt]/et*(j.height-12);lt===0?q.moveTo(ct,st):q.lineTo(ct,st)}q.stroke()}}function $(){var k=(document.getElementById("dash_mode")||{}).value||"consuntivo",U=s("dash"),H=a(U.type||"mensile"),j=new Date(U.start).getTime(),q=new Date(U.end).getTime(),et=(document.getElementById("dash_cons")||{}).value||"";function Y(m){return m=Number(m==null?"":m),isFinite(m)?m:0}function lt(m){if(!m)return 0;for(var p=["VSDIndiretto","vsdIndiretto","VSD_indiretto","VSDI"],g=0;g<p.length;g++)if(m[p[g]]!=null)return Y(m[p[g]]);return m.VSDTotale!=null&&m.VSDPersonale!=null?Y(m.VSDTotale)-Y(m.VSDPersonale):0}function ct(m){return m?m.TotProvvigioni!=null?Y(m.TotProvvigioni):Y(m.ProvvGI)+Y(m.ProvvVSD):0}var st=(function(){var m=ie(new Date(j)),p=ie(new Date(q)),g="?type="+encodeURIComponent(H)+"&from="+encodeURIComponent(m)+"&to="+encodeURIComponent(p);return et&&(g+="&userId="+encodeURIComponent(et)),g})();return It("/api/periods"+st).then(function(m){for(var p=m&&m.periods||[],g={VSS:0,VSDPersonale:0,VSDIndiretto:0,GI:0,NNCF:0,PROVV:0},v=0;v<p.length;v++){var T=p[v];if(String(T.type)===String(H)&&!(et&&String(T.userId||T.uid||"")!==String(et))){var F=new Date(T.startDate).getTime(),B=new Date(T.endDate).getTime();if(!(F<j||B>q)){var A=k==="previsionale"?T.indicatorsPrev||{}:T.indicatorsCons||{};g.VSS+=Y(A.VSS),g.VSDPersonale+=Y(A.VSDPersonale),g.VSDIndiretto+=lt(A),g.GI+=Y(A.GI),g.NNCF+=Y(A.NNCF),g.PROVV+=ct(A)}}}y("kpi_vss",I(g.VSS)),y("kpi_vsd",I(g.VSDPersonale)),y("kpi_vsd_ind",I(g.VSDIndiretto)),y("kpi_gi",I(g.GI)),y("kpi_nncf",R(g.NNCF)),y("kpi_provv",I(g.PROVV))})}function tt(){var k=(document.getElementById("dash_mode")||{}).value||"consuntivo",U=(document.getElementById("dash_cons")||{}).value||"",H=s("dash"),j=String(H.type||"mensile").toLowerCase(),q=X(j),et=typeof l=="function"?l(j,q):q.map(function(lt){return W(new Date(lt.s),j)});function Y(lt,ct){var st=lt.map(function(m){return m.y});rt(ct,et,st)}Promise.all([G("VSS",k,U||null,H),G("VSDPersonale",k,U||null,H),G("VSDIndiretto",k,U||null,H),G("GI",k,U||null,H),G("NNCF",k,U||null,H),G("TotProvvigioni",k,U||null,H)]).then(function(lt){Y(lt[0],"d_mini_vss"),Y(lt[1],"d_mini_vsdpersonale"),Y(lt[2],"d_mini_vsdindiretto"),Y(lt[3],"d_mini_gi"),Y(lt[4],"d_mini_nncf"),Y(lt[5],"d_mini_provv")}).catch(function(lt){logger.error(lt)})}function at(){var k=(document.getElementById("dash_cons")||{}).value||"",U=(typeof s=="function"?s("dash"):{})||{},H=typeof a=="function"?a(U.type||"mensile"):U.type||"mensile";(function(){var m=document.getElementById("lastApps");if(m){var p=m.parentElement;if(!document.getElementById("nextApps")){var g=document.createElement("div");g.className="card",g.innerHTML='<b>Prossimi appuntamenti (oggi + domani)</b><div id="nextApps" style="margin-top:8px"></div>',p.parentElement.insertBefore(g,p)}}})();function j(st){return'<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px">'+st+"</div>"}function q(st){return st=String(st||"").toLowerCase(),st.indexOf("mezza")>-1?240:st.indexOf("giorn")>-1||st.indexOf("formaz")>-1||st.indexOf("mbs")>-1?570:st.indexOf("sottoprod")>-1?240:(st.indexOf("vend")>-1,90)}function et(st){var m=new Date(st.start),p=new Date(st.end);(!(p instanceof Date)||isNaN(p)||p<m)&&(p=new Date(m.getTime()+q(st.type||"vendita")*6e4));var g=ri(m)+" "+ua(m)+""+(("0"+p.getHours()).slice(-2)+":"+("0"+p.getMinutes()).slice(-2)),v=st.nncf?"  NNCF ":"",T=String(st.type||"").toLowerCase(),F;return T.indexOf("mbs")>-1?F="VSD ind "+I(st.vsdIndiretto||0):T.indexOf("sottoprod")>-1?F="Tel "+R(st.telefonate||0)+"  AppFissati "+R(st.appFissati||0):T.indexOf("formaz")>-1?F="":F="VSS "+I(st.vss||0)+"  VSD "+I(st.vsdPersonal||0)+v,'<div class="card lastApp" data-aid="'+P(String(st.id||""))+'" style="cursor:pointer"><div class="small muted">'+P(g)+"  "+P(st.type||"manuale")+'</div><div style="display:flex;justify-content:space-between;align-items:center;gap:8px"><div><b>'+P(st.client||"")+'</b></div><div class="row" style="gap:6px"><button class="ghost btn-ics" title="Esporta .ics" data-ics="'+P(String(st.id||""))+'"></button></div></div>'+(F?'<div class="small">'+F+"</div>":"")+"</div>"}function Y(st){return st&&Object.keys(st).length>0}function lt(st){return st=Number(st||0),isFinite(st)?st:0}var ct=(function(){var st=ie(new Date(U.start)),m=ie(new Date(U.end)),p="?type="+encodeURIComponent(H)+"&from="+encodeURIComponent(st)+"&to="+encodeURIComponent(m);return k&&(p+="&userId="+encodeURIComponent(k)),p})();Promise.all([It("/api/appointments"),It("/api/periods"+ct)]).then(function(st){var m=st[0]&&st[0].appointments||[],p=st[1]&&st[1].periods||[];(function(){var v=document.getElementById("nextApps");if(v){var T=new Date,F=new Date(T.getFullYear(),T.getMonth(),T.getDate(),0,0,0,0),B=new Date(T.getFullYear(),T.getMonth(),T.getDate()+2,0,0,0,0),A=m.filter(function(b){var _=new Date(b.start).getTime(),D=_>=F.getTime()&&_<B.getTime(),M=k?String(b.userId||b.uid||"")===String(k):!0;return D&&M}).sort(function(b,_){return new Date(b.start)-new Date(_.start)});v.innerHTML=A.length?j(A.map(et).join("")):'<div class="muted">Nessun appuntamento tra oggi e domani</div>',v.querySelectorAll(".lastApp[data-aid]").forEach(function(b){b.addEventListener("click",function(){try{ze("bp_edit_aid",b.getAttribute("data-aid"))}catch(_){}f()})}),v.querySelectorAll("button[data-ics]").forEach(function(b){b.addEventListener("click",function(_){_.stopPropagation();var D=b.getAttribute("data-ics"),M=A.find(L=>String(L.id)===String(D))||m.find(L=>String(L.id)===String(D));if(!M){wt("Appuntamento non trovato");return}if(window.BP&&BP.ICS&&typeof BP.ICS.downloadIcsForAppointment=="function")if(BP.ICS.downloadIcsForAppointment(M)){typeof haptic=="function"&&haptic("medium");try{document.dispatchEvent(new Event("ics:exported"))}catch(K){}wt(".ics esportato")}else wt("Export .ics non disponibile");else wt("Export .ics non disponibile")})})}})(),(function(){var v=document.getElementById("lastApps");if(v){var T=m.filter(function(F){return k?String(F.userId||F.uid||"")===String(k):!0}).sort(function(F,B){return new Date(B.start)-new Date(F.start)}).slice(0,6);v.innerHTML=T.length?j(T.map(et).join("")):'<div class="muted">Nessun appuntamento</div>',v.querySelectorAll(".lastApp[data-aid]").forEach(function(F){F.addEventListener("click",function(){try{ze("bp_edit_aid",F.getAttribute("data-aid"))}catch(B){}f()})}),v.querySelectorAll("button[data-ics]").forEach(function(F){F.addEventListener("click",function(B){B.stopPropagation();var A=F.getAttribute("data-ics"),b=T.find(_=>String(_.id)===String(A))||m.find(_=>String(_.id)===String(A));if(!b){wt("Appuntamento non trovato");return}if(window.BP&&BP.ICS&&typeof BP.ICS.downloadIcsForAppointment=="function")if(BP.ICS.downloadIcsForAppointment(b)){typeof haptic=="function"&&haptic("medium");try{document.dispatchEvent(new Event("ics:exported"))}catch(D){}wt(".ics esportato")}else wt("Export .ics non disponibile");else wt("Export .ics non disponibile")})})}})(),(function(){var v=document.getElementById("lastBPs");if(v){var T=p.filter(function(B){return!(String(B.type)!==String(H)||k&&String(B.userId||B.uid||"")!==String(k))}).sort(function(B,A){return new Date(A.endDate)-new Date(B.endDate)}).slice(0,3),F=T.map(function(B){var A=li(B.type,B.startDate),b=B.indicatorsPrev||{},_=B.indicatorsCons||{},D=Y(_),M=D?_:b,L=lt(M.VSS),K=lt(M.VSDPersonale),Z=lt(M.VSDIndiretto),ut=lt(M.GI),z=lt(M.NNCF),Q=K+Z;return'<div class="card lastBP" data-pid="'+P(String(B.id||""))+'" style="cursor:pointer;flex:1 1 320px"><div style="display:flex;align-items:center;gap:8px"><div><b>'+P(A)+'</b></div><span class="chip small">'+(D?"Consuntivo":"Previsionale")+'</span></div><div class="row" style="margin-top:6px;gap:8px;flex-wrap:wrap"><span class="chip small">VSS <b>'+I(L)+'</b></span><span class="chip small">VSD <b>'+I(Q)+'</b> <span class="muted">(P '+I(K)+"  I "+I(Z)+')</span></span><span class="chip small">GI <b>'+I(ut)+'</b></span><span class="chip small">NNCF <b>'+R(z)+"</b></span></div></div>"}).join("");v.innerHTML=F?j(F):'<div class="muted">Nessun BP</div>',v.querySelectorAll(".lastBP[data-pid]").forEach(function(B){B.addEventListener("click",function(){try{ze("bp_open_period",{id:B.getAttribute("data-pid"),mode:!1})}catch(A){}u()})})}})()}).catch(function(st){logger.error(st)})}o("dash",function(){typeof haptic=="function"&&haptic("light"),$(),tt(),at()});var C=document.getElementById("dash_mode");C&&(C.onchange=function(){typeof haptic=="function"&&haptic("light"),$(),tt(),at()});var E=document.getElementById("dash_cons");E&&(E.onchange=function(){typeof haptic=="function"&&haptic("light"),$(),tt(),at()}),$(),tt(),at(),typeof kickFinal=="function"&&kickFinal("dashboard")}function d(){if(!zt())return t();document.title="Battle Plan  Calendario";function y(E){return ua(E)}if(!document.getElementById("cal_dynamic_css")){var I='\n      /* ============== CALENDAR ============== */\n      #cal_container{ overflow-x:auto; -webkit-overflow-scrolling:touch; }\n      #cal_container .calendar{ min-width: 860px; }\n\n      .calendar{ display:grid; grid-template-columns: 44px repeat(7, 1fr); gap:10px; }\n      .calendar .weekLabel{ color:var(--muted); font-size:12px; display:flex; align-items:center; justify-content:center; }\n\n      .calendar .day{\n        min-height:120px; background: var(--card);\n        border:2px solid var(--hair2); border-radius:14px; padding:8px;\n        display:flex; flex-direction:column; gap:3px; overflow:hidden;\n      }\n      .calendar .day.today{\n        outline: 2px solid var(--accent);\n        box-shadow: 0 0 0 2px rgba(0,0,0,.06) inset;\n      }\n      .calendar .day .dnum{ font-weight:800; }\n      .calendar .day .small{\n        font-size:12px; line-height:1.15;\n        white-space:nowrap; overflow:hidden; text-overflow:ellipsis; width:100%;\n      }\n      .calendar .day .tag{ padding:2px 6px; border-radius:999px; border:1px solid var(--hair2); font-size:11px; align-self:flex-start; }\n      .calendar .day.busy0{ border-color:#27ae60; background:rgba(39,174,96,.08); }\n      .calendar .day.busy1{ border-color:#ff9f1a; background:rgba(255,159,26,.10); }\n      .calendar .day.busy2{ border-color:#7d1731; background:rgba(125,23,49,.12); }\n      .calendar .day.dense .small{ font-size:11px; line-height:1.1; }\n      .calendar .day.dense .tag{ transform:scale(.9); transform-origin:left top; }\n\n      @media (max-width: 900px){\n        .calendar{ grid-template-columns: 36px repeat(7, 1fr); }\n        .calendar .weekLabel{ display:flex !important; font-size:11px; }\n        .calendar .day{ min-height:92px; padding:6px; }\n        .calendar .day .dnum{ font-size:16px; }\n        .calendar .day .small{ white-space: normal !important; overflow: visible !important; text-overflow: clip !important; }\n        .calendar .day.dense .small{ font-size:clamp(9px,2.4vw,11px); }\n        .calendar .day .tag{ font-size:10px; }\n      }\n\n      /* Header filters alignment (desktop + mobile) */\n      #cal_controls{\n        display:flex;\n        flex-direction:column;\n        gap:10px;\n      }\n      #cal_controls .cal-row{\n        display:flex;\n        gap:10px;\n        align-items:end;\n      }\n      #cal_controls .cal-row > *{ flex:1 1 0; }\n      #cal_controls button{ flex:0 0 auto; }\n      .cal-filters{ display:flex; align-items:flex-end; gap:8px; flex-wrap:wrap; }\n      .cal-filters .chip{\n        display:inline-flex; align-items:center; gap:6px;\n        padding:6px 10px; border-radius:999px; border:1px solid var(--hair2);\n      }\n      .cal-filters .chip input[type=checkbox]{ width:16px; height:16px; }\n      @media (max-width: 600px){\n        #cal_controls{\n          display:grid;\n          grid-template-columns:1fr 1fr;\n          grid-template-areas:\n            "consult consult"\n            "prev month next"\n            "add add"\n            "free free"\n            "fourh refresh";\n          align-items:end;\n        }\n        #cal_controls .cal-row{ display:contents; }\n        #cal_consultant_wrap{ grid-area:consult; }\n        #cal_prev{ grid-area:prev; justify-self:start; }\n        #cal_month_wrap{ grid-area:month; }\n        #cal_next{ grid-area:next; }\n        #cal_add{ grid-area:add; justify-self:start; }\n        #only_free{ grid-area:free; }\n        #only_4h{ grid-area:fourh; }\n        #cal_refresh{ grid-area:refresh; justify-self:end; }\n        .cal-filters{ align-items:center; }\n      }\n    ',R=document.createElement("style");R.id="cal_dynamic_css",R.textContent=I,document.head.appendChild(R)}var P=new Date,W=ie(io(P)).slice(0,7);n.innerHTML=he()+'<div class="wrap"><div class="card"><div id="cal_controls"><div class="cal-row"><div id="cal_consultant_wrap"><label>Consulente</label><select id="cal_consultant"></select></div><button id="cal_prev" class="ghost" title="Mese precedente"></button><div id="cal_month_wrap"><label>Mese</label><input type="month" id="cal_month" value="'+W+'"></div><button id="cal_next" class="ghost" title="Mese successivo"></button></div><div class="cal-row cal-filters"><button id="cal_add" class="ghost">Aggiungi appuntamento</button><label id="only_free" class="chip small"><input type="checkbox" id="only_free_cb"> Solo giorni liberi</label> <label id="only_4h" class="chip small"><input type="checkbox" id="only_4h_cb"> Solo slot  4h</label><button id="cal_refresh" class="ghost">Aggiorna</button></div></div></div><div id="cal_container"></div><div id="cal_results" class="card" style="margin-top:8px;display:none"></div><div id="cal_day_box" class="card" style="margin-top:8px;display:none"></div><div class="card" id="cal_free_slots" style="margin-top:8px;display:none"></div></div>',oe();var X=document.getElementById("cal_consultant");function V(){var E=zt()||{};X.innerHTML='<option value="'+Lt(E.id||"")+'">'+Lt(E.name||"")+"</option>",It("/api/users").then(function(k){for(var U=k.users||[],H='<option value="all">Tutti</option>',j=0;j<U.length;j++){var q=U[j];H+='<option value="'+Lt(q.id)+'">'+Lt(q.name||q.email||q.id)+"</option>"}X.innerHTML=H,X.value=E.id}).catch(function(){X.innerHTML='<option value="'+Lt(E.id||"")+'">'+Lt(E.name||"")+"</option>"})}V();function G(E,k,U,H){var j="/api/appointments",q="/api/availability?from="+E+"-"+be(k)+"-01&to="+E+"-"+be(k)+"-"+be(new Date(E,k,0).getDate());H==="all"?(j+="?global=1",q+="&global=1"):H&&H!==zt().id&&(j+="?user="+H,q+="&user="+H),Promise.all([It(j),It(q)]).then(function(et){var Y=et[0]&&et[0].appointments?et[0].appointments:[],lt=et[1]||{slots:[]},ct=lt.slots||[],st=new Date(E,k-1,1),m=new Date(E,k,0,23,59,59,999);function p(Et,Xt){for(var jt={vss:0,vsd:0,vsdI:0,telefonate:0,appFissati:0,nncf:0,count:0},$t=0;$t<Y.length;$t++){var Yt=Y[$t],ce=new Date(Yt.start);ce>=Et&&ce<=Xt&&(jt.vss+=Number(Yt.vss||0),jt.vsd+=Number(Yt.vsdPersonal||0),jt.vsdI+=Number(Yt.vsdIndiretto||0),jt.telefonate+=Number(Yt.telefonate||0),jt.appFissati+=Number(Yt.appFissati||0),jt.nncf+=Yt.nncf?1:0,jt.count+=1)}return jt}function g(Et,Xt,jt){var $t=document.getElementById("cal_results");if($t){var Yt=jt?'<div class="right"><button id="res_reset" class="ghost">Torna al mese</button></div>':"";if($t.innerHTML='<div style="display:flex;justify-content:space-between;align-items:center"><b>Risultati  '+Xt+"</b>"+Yt+'</div><div class="row" style="margin-top:8px;gap:8px;flex-wrap:wrap"><span class="chip small">VSS <b>'+Te(Et.vss)+'</b></span><span class="chip small">VSD <b>'+Te(Et.vsd)+'</b></span><span class="chip small">VSD ind <b>'+Te(Et.vsdI)+'</b></span><span class="chip small">Tel <b>'+ne(Et.telefonate)+'</b></span><span class="chip small">AppFiss <b>'+ne(Et.appFissati)+'</b></span><span class="chip small">NNCF <b>'+ne(Et.nncf)+'</b></span><span class="chip small">N. app <b>'+ne(Et.count)+"</b></span></div>",$t.style.display="block",jt){var ce=document.getElementById("res_reset");ce&&(ce.onclick=function(){g(p(st,m),_,!1)})}}}for(var v={},T=0;T<Y.length;T++){var F=Y[T],B=new Date(F.start);if(!(B<st||B>m)){var A=ie(B);v[A]||(v[A]={vss:0,vsd:0,vsdI:0,telefonate:0,appFissati:0,nncf:0,mins:0,count:0,items:[]}),v[A].vss+=Number(F.vss||0),v[A].vsd+=Number(F.vsdPersonal||0),v[A].vsdI+=Number(F.vsdIndiretto||0),v[A].telefonate+=Number(F.telefonate||0),v[A].appFissati+=Number(F.appFissati||0),v[A].nncf+=F.nncf?1:0,v[A].mins+=Number(F.durationMinutes||0),v[A].count+=1,v[A].items.push(F)}}var b=["Lun","Mar","Mer","Gio","Ven","Sab","Dom"],_=new Date(E,k-1,1).toLocaleString("it-IT",{month:"long",year:"numeric"}),D='<div class="card"><b class="neon">'+_+"</b></div>";D+='<div class="calendar">',D+='<div class="weekLabel">W</div>';for(var M=0;M<7;M++)D+='<div class="weekLabel">'+b[M]+"</div>";var L=new Date(E,k-1,1),K=(L.getDay()+6)%7,Z=new Date(L);Z.setDate(L.getDate()-K);for(var ut=0;ut<6;ut++){var z=new Date(Z),Q="W"+Qt(z);D+='<div class="weekLabel" data-ws="'+ie(z)+'" style="cursor:pointer">'+Q+"</div>";for(var pt=0;pt<7;pt++){var dt=Z.getMonth()===k-1,A=ie(Z),vt=v[A]||{vss:0,vsd:0,vsdI:0,telefonate:0,appFissati:0,nncf:0,mins:0,count:0,items:[]},bt=Z.getDay(),yt=bt===0||bt===6,_t=!yt&&ct.some(function(Xt){return Xt.date===A});if(dt&&U){if(U.only_free&&vt.count>0){D+="<div></div>",Z.setDate(Z.getDate()+1);continue}if(U.only_4h&&!_t){D+="<div></div>",Z.setDate(Z.getDate()+1);continue}}if(!dt)D+="<div></div>";else{var Ct="";yt?vt.count>0&&(Ct="busy2"):vt.count===0?Ct="busy0":_t?Ct="busy1":Ct="busy2";var Ft="",Vt=0;yt&&vt.count===0||(vt.vss>0&&(Ft+='<div class="small">VSS '+Te(vt.vss)+"</div>",Vt++),vt.vsd>0&&(Ft+='<div class="small">VSD '+Te(vt.vsd)+"</div>",Vt++),vt.vsdI>0&&(Ft+='<div class="small">VSD ind '+Te(vt.vsdI)+"</div>",Vt++),vt.telefonate>0&&(Ft+='<div class="small">Tel '+ne(vt.telefonate)+"</div>",Vt++),vt.appFissati>0&&(Ft+='<div class="small">AppFiss '+ne(vt.appFissati)+"</div>",Vt++),vt.nncf>0&&(Ft+='<div class="small">NNCF '+ne(vt.nncf)+"</div>",Vt++),vt.count>0&&(Ft+='<div class="small">App. '+ne(vt.count)+"</div>",Vt++),_t&&(Ft+='<div class="tag" style="margin-top:4px">slot 4h</div>',Vt++));var Ie=Vt>=3?" dense":"",nt=_t?" slot-free":"";D+='<div class="day '+Ct+Ie+nt+'" data-day="'+A+'" title="Settimana '+Qt(Z)+'"><div class="dnum">'+Z.getDate()+"</div>"+(Ft||"")+"</div>"}Z.setDate(Z.getDate()+1)}}D+="</div>",document.getElementById("cal_container").innerHTML=D,g(p(st,m),_,!1),document.querySelectorAll(".calendar .weekLabel[data-ws]").forEach(function(Et){Et.addEventListener("click",function(){var Xt=Et.getAttribute("data-ws"),jt=new Date(Xt),$t=new Date(jt);$t.setDate($t.getDate()+6),$t.setHours(23,59,59,999);var Yt="Settimana "+("W"+Qt(jt))+"  "+ri(jt)+""+ri($t);g(p(jt,$t),Yt,!0)})}),document.querySelectorAll(".day[data-day]").forEach(function(Et){Et.addEventListener("click",function(){var Xt=Et.getAttribute("data-day"),jt=v[Xt]&&v[Xt].items?v[Xt].items.slice():[];jt.sort(function(me,Ke){return new Date(me.start)-new Date(Ke.start)});var $t=document.getElementById("cal_day_box"),Yt="<b>Appuntamenti del "+Xt.split("-").reverse().join("/")+"</b>";if(!jt.length)Yt+='<div class="muted" style="margin-top:6px">Nessun appuntamento</div>';else{Yt+='<div class="row" style="margin-top:8px">';for(var ce=0;ce<jt.length;ce++){var Kt=jt[ce],zi=' data-start="'+Kt.start+'" data-end="'+Kt.end+'" data-title="'+Lt(Kt.client||"Appuntamento")+'" ',vn=String(Kt.type||"").toLowerCase(),Re;vn.indexOf("mbs")>-1?Re="VSD ind "+Te(Kt.vsdIndiretto||0):vn.indexOf("sottoprod")>-1?Re="Tel "+ne(Kt.telefonate||0)+"  AppFissati "+ne(Kt.appFissati||0):vn.indexOf("formaz")>-1?Re="":Re="VSS "+Te(Kt.vss)+"  VSD "+Te(Kt.vsdPersonal)+"  NNCF "+(Kt.nncf?"":""),Yt+='<div class="card cal-app" data-aid="'+Kt.id+'" '+zi+' style="flex:1 1 320px;cursor:pointer"><div class="small muted">'+y(Kt.start)+""+y(Kt.end)+"  "+Lt(Kt.type||"")+"</div><div><b>"+Lt(Kt.client||"")+"</b></div>"+(Re?'<div class="small">'+Re+"</div>":"")+(Kt.notes?'<div class="small muted">'+Lt(Kt.notes)+"</div>":"")+"</div>"}Yt+="</div>"}var bn=(ct||[]).filter(function(me){return me.date===Xt});if(bn.length){Yt+='<div class="row" style="margin-top:8px">';for(var yn=0;yn<bn.length;yn++){var Xe=bn[yn],Ui=Xe.part==="morning"?"mattina":"pomeriggio";Yt+='<div class="card slotBtn" data-start="'+Xe.start+'" data-end="'+Xe.end+'" style="flex:1 1 280px;cursor:pointer"><div class="small">'+Ui+"  "+y(Xe.start)+""+y(Xe.end)+"</div></div>"}Yt+="</div>"}if($t.style.display="block",$t.innerHTML=Yt,$t.querySelectorAll(".cal-app").forEach(function(me){me.addEventListener("click",function(Ke){Ke.stopPropagation(),ze("bp_edit_aid",me.getAttribute("data-aid")),f()})}),$t.querySelectorAll(".slotBtn").forEach(function(me){me.addEventListener("click",function(Ke){Ke.stopPropagation(),ze("bp_prefill_slot",{start:me.getAttribute("data-start"),end:me.getAttribute("data-end")}),f(),wt("Slot precompilato negli appuntamenti")})}),window.scrollTo({top:$t.getBoundingClientRect().top+window.scrollY-80,behavior:"smooth"}),typeof window.wireICSInsideDayBox=="function")try{window.wireICSInsideDayBox()}catch(me){}})});var it=document.getElementById("cal_free_slots"),mt=(function(){var Et=new Date;return Et.getFullYear()+"-"+be(Et.getMonth()+1)+"-"+be(Et.getDate())})(),ft=(ct||[]).filter(function(Et){return String(Et.date||"").slice(0,10)>=mt});if(H==="all"){var gt=lt.details||[],St="<b>Slot liberi  4h per consulente (da oggi in poi)</b>";St+='<div class="row" style="margin-top:8px;gap:8px;flex-wrap:wrap">';for(var xt=0;xt<gt.length;xt++){var Z=gt[xt];St+='<span class="chip small">'+Lt(Z.name||"")+" <b>"+ne(Z.total||0)+"</b></span>"}St+="</div>",it.style.display="block",it.innerHTML=St}else if(ft.length){var Pt='<b>Slot liberi  4h (da oggi in poi)</b>  <span class="badge">Tot: '+ft.length+"</span>";Pt+='<div class="row" style="margin-top:8px">';for(var kt=0;kt<ft.length&&kt<80;kt++){var B=ft[kt],Wt=B.part==="morning"?"mattina":"pomeriggio";Pt+='<div class="card slotBtn" data-start="'+B.start+'" data-end="'+B.end+'" style="flex:1 1 280px;cursor:pointer"><div class="small"><b>'+ri(B.start)+"</b>  "+Wt+'</div><div class="small">'+y(B.start)+""+y(B.end)+"</div></div>"}Pt+="</div>",it.style.display="block",it.innerHTML=Pt,it.querySelectorAll(".slotBtn").forEach(function(Et){Et.addEventListener("click",function(){ze("bp_prefill_slot",{start:Et.getAttribute("data-start"),end:Et.getAttribute("data-end")}),f(),wt("Slot precompilato negli appuntamenti")})})}else it.style.display="block",it.innerHTML='<b>Slot liberi  4h (da oggi in poi)</b>  <span class="badge">Tot: 0</span><div class="muted" style="margin-top:6px">Nessuno slot libero disponibile.</div>';try{window.injectTodayCSS&&window.injectTodayCSS()}catch(Et){}try{window.hookCalendar?window.hookCalendar():(window.markToday&&window.markToday(),window.clampSlotCounters&&window.clampSlotCounters())}catch(Et){}}).catch(function(et){logger.error(et),wt("Errore calendario")})}function rt(){var E=document.getElementById("cal_month").value,k=parseInt(E.split("-")[0],10),U=parseInt(E.split("-")[1],10),H={only_free:document.getElementById("only_free_cb").checked,only_4h:document.getElementById("only_4h_cb").checked},j=document.getElementById("cal_consultant").value;G(k,U,H,j)}document.getElementById("cal_refresh").onclick=rt;var $=document.getElementById("cal_add");$&&($.onclick=function(){f()}),document.getElementById("cal_month").onchange=rt;function tt(E){var k=document.getElementById("cal_month");if(k){var U=k.value.split("-"),H=+U[0],j=+U[1];j+=E,j<=0?(j=12,H--):j>12&&(j=1,H++),k.value=H+"-"+be(j),rt()}}var at=document.getElementById("cal_prev"),C=document.getElementById("cal_next");at&&(at.onclick=function(){tt(-1)}),C&&(C.onclick=function(){tt(1)}),document.getElementById("only_free_cb").onchange=rt,document.getElementById("only_4h_cb").onchange=rt,X.onchange=rt,rt()}function u(){if(!zt())return t();document.title="Battle Plan  BP",n.innerHTML=he()+'<div class="wrap"><div class="card"><b>Da inviare</b><div id="bp_to_send" class="grid" style="margin-top:8px"></div></div><div class="card" id="bp_sent_box" style="margin-top:8px"><div id="bp_sent_head" style="display:flex;align-items:center;justify-content:space-between;cursor:pointer"><b>BP inviati (periodi in essere)</b><span id="bp_sent_chev" class="chev"></span></div><div id="bp_sent" class="row" style="margin-top:8px;display:none"></div></div><div class="card" style="margin-top:8px"><b>Crea/Aggiorna BP</b><div class="row" style="margin-top:8px"><div><label>Tipo</label><select id="p_type"><option value="settimanale">Settimanale (lundom)</option><option value="mensile">Mensile</option><option value="trimestrale">Trimestrale</option><option value="semestrale">Semestrale</option><option value="annuale">Annuale</option></select></div><div id="wrap_week" style="display:none"><label>Settimana ISO (153)</label><input type="number" id="p_week" min="1" max="53" value="'+Qt(new Date)+'"></div><div id="wrap_month" style="display:none"><label>Mese</label><select id="p_month"><option value="1">Gennaio</option><option value="2">Febbraio</option><option value="3">Marzo</option><option value="4">Aprile</option><option value="5">Maggio</option><option value="6">Giugno</option><option value="7">Luglio</option><option value="8">Agosto</option><option value="9">Settembre</option><option value="10">Ottobre</option><option value="11">Novembre</option><option value="12">Dicembre</option></select></div><div id="wrap_quarter" style="display:none"><label>Trimestre</label><select id="p_quarter"><option value="1">T1</option><option value="2">T2</option><option value="3">T3</option><option value="4">T4</option></select></div><div id="wrap_semester" style="display:none"><label>Semestre</label><select id="p_sem"><option value="1">1 semestre</option><option value="2">2 semestre</option></select></div><div><label>Anno</label><input type="number" id="p_year" min="2000" max="2100" value="'+new Date().getFullYear()+'"></div></div><div class="row"><div class="small muted">Modalit: <b id="p_mode_lbl">Previsionale</b>  <button class="ghost" id="btnImport" style="padding:4px 8px">Importa da agenda</button></div></div><div class="row" style="align-items:center"><div class="small"><b>Periodo selezionato:</b> <span id="p_label" class="neon"></span></div><input type="hidden" id="p_start"><input type="hidden" id="p_end"></div><div class="row small" style="margin-top:6px;opacity:.9"><div><b>Previsionale</b></div><div><b>Consuntivo</b></div><div><b>Avanzamento</b></div></div><div class="row" id="p_rows" style="margin-top:4px"></div><div class="row" style="margin-top:8px;align-items:center;gap:8px;justify-content:space-between"><div id="p_delete_zone"></div><div class="right"><button id="btnSaveP">Salva BP</button></div></div></div><div class="card"><b>BP salvati</b><div id="p_list" class="row" style="margin-top:8px"></div></div></div>',oe();var y=!1,I=null,R=[],P=null,W=zt()||{};function X(nt){return String(nt).replace(/[&<>'"]/g,it=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[it])}function V(nt){if(!nt)return"";var it=new Date(nt);return it.getFullYear()+"-"+("0"+(it.getMonth()+1)).slice(-2)+"-"+("0"+it.getDate()).slice(-2)}function G(nt){var it=new Date(nt);return("0"+it.getDate()).slice(-2)+"/"+("0"+(it.getMonth()+1)).slice(-2)+"/"+it.getFullYear()}function rt(nt){var it=Number(nt)||0;return it.toLocaleString("it-IT")+""}function $(nt){var it=document.createElement("div");return it.innerHTML=nt.trim(),it.firstChild}function tt(nt){return!!(nt&&nt.indicatorsCons&&Object.keys(nt.indicatorsCons).length>0)}function at(){return W&&W.grade?Promise.resolve(W):It("/api/usernames").then(function(nt){var it=String((zt()||{}).id||""),mt=(nt&&nt.users||[]).find(function(ft){return String(ft.id)===it});return mt&&mt.grade&&(W.grade=mt.grade),W}).catch(function(){return W})}function C(){var nt=W&&W.grade||(zt()||{}).grade;return nt==="senior"?"senior":"junior"}at();var E=document.getElementById("p_type"),k=document.getElementById("p_year"),U=document.getElementById("wrap_week"),H=document.getElementById("wrap_month"),j=document.getElementById("wrap_quarter"),q=document.getElementById("wrap_semester"),et=document.getElementById("p_week"),Y=document.getElementById("p_month"),lt=document.getElementById("p_quarter"),ct=document.getElementById("p_sem"),st=document.getElementById("p_label"),m=document.getElementById("p_start"),p=document.getElementById("p_end"),g=document.getElementById("p_mode_lbl"),v=document.getElementById("btnImport");function T(nt){y=!!nt,g.textContent=y?"Consuntivo":"Previsionale",v.style.display=y?"none":"";var it=document.querySelectorAll("[data-row]");it.forEach(function(mt){var ft=mt.querySelector("[data-prev]"),gt=mt.querySelector("[data-cons]"),St=mt.querySelector("[data-bar]");if(y){if(ft){ft.removeAttribute("hidden");var xt=ft.querySelector("input");xt&&(xt.setAttribute("readonly","readonly"),xt.classList.add("disabled"))}if(gt){gt.removeAttribute("hidden");var Pt=gt.querySelector("input");Pt&&(Pt.removeAttribute("readonly"),Pt.classList.remove("disabled"))}St&&St.removeAttribute("hidden")}else{if(ft){ft.removeAttribute("hidden");var kt=ft.querySelector("input");kt&&(kt.removeAttribute("readonly"),kt.classList.remove("disabled"))}gt&&gt.setAttribute("hidden","hidden"),St&&St.setAttribute("hidden","hidden")}}),dt()}function F(){var nt=E.value;U.style.display=nt==="settimanale"?"":"none",H.style.display=nt==="mensile"?"":"none",j.style.display=nt==="trimestrale"?"":"none",q.style.display=nt==="semestrale"?"":"none",B()}function B(){var nt=E.value,it=parseInt(k.value,10),mt,ft,gt;if(nt==="settimanale"){var St=Math.max(1,Math.min(53,parseInt(et.value||"1",10))),xt=en(it,St);mt=xt.start,ft=xt.end,gt="Sett. "+St+"  "+G(mt)+"  "+G(ft)}else if(nt==="mensile"){var Pt=parseInt(Y.value,10);mt=new Date(it,Pt-1,1),ft=new Date(it,Pt,0),gt=mt.toLocaleString("it-IT",{month:"long",year:"numeric"})+"  "+G(mt)+"  "+G(ft)}else if(nt==="trimestrale"){var kt=parseInt(lt.value,10);mt=new Date(it,(kt-1)*3,1),ft=new Date(it,kt*3,0),gt="Trimestre "+kt+" "+it+"  "+G(mt)+"  "+G(ft)}else if(nt==="semestrale"){var Wt=parseInt(ct.value,10);mt=new Date(it,Wt===1?0:6,1),ft=new Date(it,Wt===1?6:12,0),gt=(Wt===1?"1":"2")+" semestre "+it+"  "+G(mt)+"  "+G(ft)}else mt=new Date(it,0,1),ft=new Date(it,11,31),gt="Anno "+it+"  "+G(mt)+"  "+G(ft);m.value=V(mt),p.value=V(ft),st.textContent=gt,T(!1),I=null,P=null,M(),dt()}function A(nt){for(var it="",mt=0;mt<nt.length;mt++){var ft=nt[mt],gt=/^(VSS|VSDPersonale|VSDIndiretto|GI)$/i.test(ft);it+='<div class="row" data-row="'+ft+'"><div data-prev><label>'+ft+' (Prev)</label><input type="number" step="1" id="prev_'+ft+'" placeholder="'+(gt?"":"n")+'"></div><div data-cons><label>'+ft+' (Cons)</label><input type="number" step="1" id="cons_'+ft+'" placeholder="'+(gt?"":"n")+'"></div><div data-bar class="small"><div style="height:10px;background:rgba(255,255,255,.12);border-radius:999px;overflow:hidden"><div id="bar_'+ft+'" style="height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2));"></div></div><div id="pct_'+ft+'" class="small muted">0%</div></div></div>'}document.getElementById("p_rows").innerHTML=it,T(!1),_(),b()}function b(){for(var nt=0;nt<R.length;nt++){var it=R[nt],mt=document.getElementById("prev_"+it),ft=document.getElementById("cons_"+it);if(!(!mt||!ft)){var gt=Number(mt.value||0),St=Number(ft.value||0),xt=gt>0?Math.round(St/gt*100):St>0?100:0;xt=Math.max(0,Math.min(200,xt));var Pt=document.getElementById("bar_"+it),kt=document.getElementById("pct_"+it);Pt&&(Pt.style.width=Math.min(xt,100)+"%"),kt&&(kt.textContent=xt+"%")}}}function _(){for(var nt=0;nt<R.length;nt++)(function(it){var mt=document.getElementById("prev_"+it),ft=document.getElementById("cons_"+it);mt&&(mt.oninput=b),ft&&(ft.oninput=b)})(R[nt])}function D(){for(var nt=0;nt<R.length;nt++){var it=document.getElementById("prev_"+R[nt]);it&&(it.value="")}b()}function M(){for(var nt=0;nt<R.length;nt++){var it=document.getElementById("cons_"+R[nt]);it&&(it.value="")}b()}function L(nt){for(var it in nt){var mt=document.getElementById("prev_"+it);mt&&(mt.value=String(nt[it]||0))}b()}function K(nt){for(var it in nt){var mt=document.getElementById("cons_"+it);mt&&(mt.value=String(nt[it]||0))}b()}function Z(){if(!y){var nt=m.value,it=p.value;if(!nt||!it){wt("Seleziona il periodo");return}It("/api/appointments").then(function(mt){for(var ft=mt.appointments||[],gt=new Date(nt),St=new Date(it),xt={VSS:0,VSDPersonale:0,VSDIndiretto:0,GI:0,Telefonate:0,AppFissati:0,AppFatti:0,CorsiLeadership:0,iProfile:0,MBS:0,NNCF:0},Pt=0;Pt<ft.length;Pt++){var kt=ft[Pt],Wt=new Date(kt.start);Wt>=gt&&Wt<=St&&(xt.VSS+=Number(kt.vss||0),xt.VSDPersonale+=Number(kt.vsdPersonal||0),xt.VSDIndiretto+=Number(kt.vsdIndiretto||0),xt.Telefonate+=Number(kt.telefonate||0),xt.AppFissati+=Number(kt.appFissati||0),kt.nncf&&(xt.AppFatti+=1,xt.NNCF+=1))}L(xt),wt("Previsionale compilato dalla tua agenda"),ci(),window.addXP(10)}).catch(function(){wt("Errore import agenda")})}}function ut(nt,it){nt=Object.assign({},nt||{});var mt=Number(nt.GI||0),ft=Number(nt.VSDPersonale||0),gt=mt*.15,St=ft*(String(it)==="senior"?.25:.2);return nt.ProvvGI=Math.round(gt*100)/100,nt.ProvvVSD=Math.round(St*100)/100,nt.TotProvvigioni=Math.round((nt.ProvvGI+nt.ProvvVSD)*100)/100,nt}function z(nt,it,mt){return fetch(it,{method:nt,headers:mt?{"Content-Type":"application/json"}:void 0,body:mt?JSON.stringify(mt):void 0}).then(function(ft){return ft.ok?ft.json().catch(function(){return{}}):Promise.reject(new Error("HTTP "+ft.status))})}function Q(nt){for(var it=encodeURIComponent(nt),mt=[function(){return z("POST","/api/periods/delete",{id:nt})},function(){return z("POST","/api/periods",{id:nt,_delete:!0})},function(){return z("POST","/api/periods/"+it,{_method:"DELETE"})},function(){return z("DELETE","/api/periods/"+it,null)},function(){return z("DELETE","/api/periods?id="+it,null)}],ft=Promise.reject(new Error("start")),gt=0;gt<mt.length;gt++)(function(St){ft=ft.catch(St)})(mt[gt]);return ft.catch(function(St){throw logger.warn("Delete fallback: tutte le route fallite",St),St})}function pt(nt){return P?{id:I||P.id,type:P.type,startDate:V(P.startDate),endDate:V(P.endDate),indicatorsPrev:Object.assign({},P.indicatorsPrev||{}),indicatorsCons:nt!=null?nt:Object.assign({},P.indicatorsCons||{})}:null}function dt(){var nt=document.getElementById("p_delete_zone");if(nt){if(!I){nt.innerHTML="";return}var it=!!(P&&tt(P)),mt="";it&&(mt+='<button id="btnDelCons" class="ghost" style="border-color:#7d1731;color:#7d1731">Elimina Consuntivo</button> '),mt+='<button id="btnDelBP" class="ghost" style="border-color:#7d1731;color:#7d1731">Elimina BP</button>',nt.innerHTML=mt;var ft=document.getElementById("btnDelBP");ft&&(ft.onclick=function(){if(confirm("Eliminare definitivamente questo BP?")){ft.disabled=!0;var St=P?JSON.parse(JSON.stringify(P)):null;Q(I).then(function(){wt("BP eliminato");try{document.dispatchEvent(new Event("bp:deleted"))}catch(Pt){}if(I=null,P=null,D(),M(),T(!1),B(),bt(),typeof showUndo=="function"&&St){var xt={type:St.type,startDate:V(St.startDate),endDate:V(St.endDate),indicatorsPrev:Object.assign({},St.indicatorsPrev||{}),indicatorsCons:Object.assign({},St.indicatorsCons||{})};showUndo("BP eliminato",function(){return ue("/api/periods",xt).then(function(){try{document.dispatchEvent(new Event("bp:saved"))}catch(Pt){}bt()})},5e3)}}).catch(function(){wt("Endpoint delete non disponibile")}).finally(function(){ft.disabled=!1})}});var gt=document.getElementById("btnDelCons");gt&&(gt.onclick=function(){if(confirm("Rimuovere solo il Consuntivo?")){gt.disabled=!0;var St=P?JSON.parse(JSON.stringify(P.indicatorsCons||{})):null,xt=pt({});if(!xt){gt.disabled=!1;return}var Pt=C();xt.indicatorsPrev=ut(xt.indicatorsPrev,Pt),xt.indicatorsCons={},ue("/api/periods",xt).then(function(){wt("Consuntivo eliminato");try{document.dispatchEvent(new Event("bp:saved"))}catch(Wt){}if(P&&(P.indicatorsCons={}),T(!0),bt(),dt(),typeof showUndo=="function"&&St){var kt=pt(St);showUndo("Consuntivo eliminato",function(){return ue("/api/periods",kt).then(function(){try{document.dispatchEvent(new Event("bp:saved"))}catch(Wt){}P&&(P.indicatorsCons=St),bt(),dt()})},5e3)}}).catch(function(){wt("Errore eliminazione Consuntivo")}).finally(function(){gt.disabled=!1})}})}}function vt(){var nt=E.value,it=m.value,mt=p.value;if(!it||!mt){wt("Seleziona il periodo");return}for(var ft={},gt={},St=0;St<R.length;St++){var xt=R[St];ft[xt]=Number(document.getElementById("prev_"+xt).value||0),y&&(gt[xt]=Number(document.getElementById("cons_"+xt).value||0))}var Pt=C();ft=ut(ft,Pt),y&&(gt=ut(gt,Pt));var kt={type:nt,startDate:it,endDate:mt,indicatorsPrev:ft};y&&(kt.indicatorsCons=gt),I&&(kt.id=I),ue("/api/periods",kt).then(function(Wt){wt("BP salvato"),y?window.addXP(20):window.addXP(10),ci();try{document.dispatchEvent(new Event("bp:saved"))}catch(Et){}bt(),!I&&Wt&&Wt.id&&(I=Wt.id),I&&P&&(P.indicatorsPrev=ft,y&&(P.indicatorsCons=gt)),dt()}).catch(function(){wt("Errore salvataggio BP")})}function bt(){It("/api/periods").then(function(nt){var it=nt.periods||[];it.sort(function(kt,Wt){return new Date(Wt.startDate)-new Date(kt.startDate)});for(var mt="",ft=0;ft<it.length;ft++){var gt=it[ft],St=li(gt.type,gt.startDate)+"  "+G(gt.startDate)+"  "+G(gt.endDate);mt+='<div class="card" style="flex:1 1 360px"><div><b>'+X(St)+'</b></div><div class="small">Prev VSS '+rt((gt.indicatorsPrev||{}).VSS||0)+"  Cons "+rt((gt.indicatorsCons||{}).VSS||0)+'</div><div class="right" style="margin-top:6px"><button class="ghost" data-edit="'+gt.id+'">Modifica previs.</button><button data-cons="'+gt.id+'">Consuntivo</button></div></div>'}document.getElementById("p_list").innerHTML=mt||'<div class="muted">Nessun BP</div>',document.querySelectorAll("[data-edit]").forEach(function(kt){kt.addEventListener("click",function(){var Wt=kt.getAttribute("data-edit"),Et=(nt.periods||[]).find(function(Xt){return Xt.id===Wt});Et&&yt(Et,!1)})}),document.querySelectorAll("[data-cons]").forEach(function(kt){kt.addEventListener("click",function(){var Wt=kt.getAttribute("data-cons"),Et=(nt.periods||[]).find(function(Xt){return Xt.id===Wt});Et&&yt(Et,!0)})}),Ie(it);var xt=yi("bp_open_period",null);if(xt){Fn("bp_open_period");var Pt=it.find(function(kt){return kt.id===xt.id});Pt&&yt(Pt,xt.mode===!0)}})}function yt(nt,it){P=nt||null,E.value=nt.type;var mt=new Date(nt.startDate),ft=mt.getFullYear();if(k.value=String(ft),nt.type==="settimanale")et.value=String(Qt(mt));else if(nt.type==="mensile")Y.value=String(mt.getMonth()+1);else if(nt.type==="trimestrale"){var gt=Math.floor(mt.getMonth()/3)+1;lt.value=String(gt)}else nt.type==="semestrale"&&(ct.value=mt.getMonth()<6?"1":"2");F(),D(),M(),L(nt.indicatorsPrev||{}),K(nt.indicatorsCons||{}),T(!!it),I=nt.id||null,dt(),wt(it?"Compila il consuntivo":"Modifica previsionale"),window.scrollTo({top:0,behavior:"smooth"})}function _t(nt,it){it=it||new Date;var mt=it.getFullYear();if(nt==="settimanale"){var ft=en(mt,Qt(it));return{start:ft.start,end:ft.end}}return nt==="mensile"?{start:io(it),end:oo(it)}:nt==="trimestrale"?{start:Ti(it),end:so(it)}:nt==="semestrale"?{start:Pi(it),end:ao(it)}:{start:Do(it),end:_i(it)}}function Ct(nt,it){return it=it||new Date,nt==="settimanale"?Ff(it):nt==="mensile"?Nf(it):nt==="trimestrale"?Rf(it):nt==="semestrale"?Vf(it):zf(it)}function Ft(nt){var it=en(new Date().getFullYear(),Qt(new Date)),mt=it.start,ft=Math.floor((new Date(nt)-mt)/(1e3*60*60*24));return ft<=13}function Vt(nt,it,mt,ft,gt,St){var xt=li(it,mt),Pt=$('<div class="card" style="position:relative"><div class="small muted">'+X(nt)+"</div><div><b>"+X(xt)+'</b></div><div class="small muted">'+G(mt)+"  "+G(ft)+'</div><div class="right" style="margin-top:6px"><button class="ghost" type="button" data-sug="1">'+X(gt)+"</button></div></div>");return Pt.querySelector("[data-sug]").addEventListener("click",St),Pt}function Ie(nt){var it=document.getElementById("bp_to_send"),mt=document.getElementById("bp_sent");it.innerHTML="",mt.innerHTML="";function ft(Jt,de,ee){return nt.find(function(Me){return Me.type===Jt&&V(Me.startDate)===V(de)&&V(Me.endDate)===V(ee)})}var gt=new Date,St=gt.getDay(),xt=St===5||St===6||St===0,Pt=oo(gt),kt=so(gt),Wt=ao(gt),Et=_i(gt),Xt=xt&&Ft(Pt),jt=xt&&Ft(kt),$t=xt&&Ft(Wt),Yt=xt&&Ft(Et);["settimanale","mensile","trimestrale","semestrale","annuale"].forEach(function(Jt){var de=_t(Jt,gt),ee=ft(Jt,de.start,de.end);if(ee){var Me=$('<div class="card" style="flex:1 1 360px"><div><b>'+X(li(Jt,de.start))+'</b></div><div class="small muted">'+G(de.start)+"  "+G(de.end)+'</div><div class="right" style="margin-top:6px"><button class="ghost" type="button" data-mid="'+ee.id+'">Modifica</button></div></div>');Me.querySelector("[data-mid]").addEventListener("click",function(){yt(ee,!1)}),mt.appendChild(Me)}});function ce(Jt,de,ee){var Me=ft(Jt,ee.start,ee.end),Hi=ft(Jt,de.start,de.end);Me?it.appendChild(Vt("Previsionale",Jt,ee.start,ee.end,"Modifica",function(){yt(Me,!1)})):it.appendChild(Vt("Previsionale",Jt,ee.start,ee.end,"Compila",function(){if(E.value=Jt,k.value=String(ee.start.getFullYear()),Jt==="settimanale")et.value=String(Qt(ee.start));else if(Jt==="mensile")Y.value=String(ee.start.getMonth()+1);else if(Jt==="trimestrale"){var hr=Math.floor(ee.start.getMonth()/3)+1;lt.value=String(hr)}else Jt==="semestrale"&&(ct.value=ee.start.getMonth()<6?"1":"2");F()})),Hi&&!tt(Hi)&&it.appendChild(Vt("Consuntivo",Jt,de.start,de.end,"Consuntivo",function(){yt(Hi,!0)}))}if(xt){var Kt=_t("settimanale",gt),zi=Ct("settimanale",gt);ce("settimanale",Kt,zi)}if(Xt){var vn=_t("mensile",gt),Re=Ct("mensile",gt);ce("mensile",vn,Re)}if(jt){var bn=_t("trimestrale",gt),yn=Ct("trimestrale",gt);ce("trimestrale",bn,yn)}if($t){var Xe=_t("semestrale",gt),Ui=Ct("semestrale",gt);ce("semestrale",Xe,Ui)}if(Yt){var me=_t("annuale",gt),Ke=Ct("annuale",gt);ce("annuale",me,Ke)}it.children.length||(it.innerHTML='<div class="muted">Nessun suggerimento attivo in questo momento</div>');var ur=document.getElementById("bp_sent_head"),fr=document.getElementById("bp_sent_chev");ur.onclick=function(){var Jt=document.getElementById("bp_sent"),de=Jt.style.display!=="none";Jt.style.display=de?"none":"",fr.textContent=de?"":""}}It("/api/settings").then(function(nt){R=nt&&nt.indicators||["VSS","VSDPersonale","VSDIndiretto","GI","Telefonate","AppFissati","AppFatti","CorsiLeadership","iProfile","MBS","NNCF"],A(R)}).catch(function(){R=["VSS","VSDPersonale","GI","NNCF"],A(R)}),E.onchange=F,k.oninput=B,et.oninput=B,Y.onchange=B,lt.onchange=B,ct.onchange=B,v.onclick=Z,document.getElementById("btnSaveP").onclick=vt,F(),bt()}function f(){if(!zt())return t();if(document.title="Battle Plan  Appuntamenti",!document.getElementById("appts_css")){const b=document.createElement("style");b.id="appts_css",b.textContent="\n      .appt-type .seg, #a_nncf.seg{\n        padding:8px 12px;border:1px solid #bcd7ff;border-radius:12px;\n        background:#eef5ff;color:#1463ff;cursor:pointer;user-select:none;\n        transition:.15s;\n      }\n      .appt-type .seg.active, #a_nncf.seg.active{\n        background:var(--accent);color:#fff;border-color:var(--accent);\n        box-shadow:0 0 0 2px rgba(20,99,255,.08) inset;\n      }\n      .appt-type > div{display:flex;flex-wrap:wrap;gap:8px;margin-top:4px}\n      .appt-row-end-dur{display:flex;gap:8px;align-items:flex-end}\n      #a_desc{width:100%;min-height:3.2em}\n      #a_list .grid3{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}\n    ",document.head.appendChild(b)}n.innerHTML=he()+'<div class="wrap"><div class="card"><b id="a_form_title">Nuovo appuntamento</b><div class="row" style="margin-top:8px;align-items:flex-end;gap:12px;flex-wrap:wrap"><div style="min-width:320px"><label>Cliente *</label><div style="display:flex;gap:8px;align-items:center"><input id="a_client" list="clientList" placeholder="Denominazione" style="flex:1"><datalist id="clientList"></datalist><button id="a_nncf" class="seg" data-active="0" aria-pressed="false">NNCF</button></div></div><div><label>Data/ora inizio</label><input id="a_start" type="datetime-local"></div><div class="appt-row-end-dur"><div><label>Ora fine</label><input id="a_end" type="time"></div><div><label>Durata (min)</label><input id="a_dur" type="number" placeholder="60" min="1" style="width:80px"></div></div></div><div style="margin-top:8px"><label>Descrizione appuntamento</label><textarea id="a_desc" rows="2" style="width:100%;min-height:3.2em"></textarea></div><div class="row" style="align-items:flex-end;gap:12px;flex-wrap:wrap"><div class="appt-type"><label>Tipo</label><div><button type="button" id="t_vendita" class="seg">Vendita</button><button type="button" id="t_mezza"   class="seg" data-vsd="1000">Mezza giornata</button><button type="button" id="t_full"    class="seg" data-vsd="2000">Giornata intera</button><button type="button" id="t_form"    class="seg">Formazione</button><button type="button" id="t_mbs"     class="seg">MBS</button><button type="button" id="t_sotto"   class="seg">Sottoprodotti</button></div><input id="a_type" type="hidden" value="vendita"></div><div id="row_vss"><label>VSS</label><input id="a_vss" type="number" step="1" placeholder="0"></div><div id="row_vsd_p"><label>VSD personale</label><input id="a_vsd" type="number" step="1" placeholder="0"></div><div id="row_vsd_i" style="display:none"><label>VSD indiretto</label><input id="a_vsd_i" type="number" step="1" placeholder="0"></div><div id="row_tel" style="display:none"><label>Telefonate</label><input id="a_tel" type="number" step="1" placeholder="0"></div><div id="row_app" style="display:none"><label>Appunt. fissati</label><input id="a_app" type="number" step="1" placeholder="0"></div></div><div class="row" style="margin-top:8px;gap:8px;align-items:center"><div><button id="btnSaveA">Salva</button></div><div><button id="btnSaveExportA" class="ghost">Salva ed esporta</button></div><div class="right" style="margin-left:auto"><button id="btnDeleteA" class="danger" style="display:none">Elimina</button></div></div></div><div class="card"><b>Elenco appuntamenti</b><div class="row" style="margin-top:8px;align-items:flex-end;gap:12px;flex-wrap:wrap"><div><label>Vista</label><select id="af_type"><option value="sett">Settimana</option><option value="mese">Mese</option></select></div><div id="af_week_wrap"><label>Settimana ISO</label><input id="af_week" type="number" min="1" max="53" value="'+Qt(new Date)+'"></div><div id="af_month_wrap" style="display:none"><label>Mese</label><select id="af_month"><option value="1">Gennaio</option><option value="2">Febbraio</option><option value="3">Marzo</option><option value="4">Aprile</option><option value="5">Maggio</option><option value="6">Giugno</option><option value="7">Luglio</option><option value="8">Agosto</option><option value="9">Settembre</option><option value="10">Ottobre</option><option value="11">Novembre</option><option value="12">Dicembre</option></select></div><div><label>Anno</label><input id="af_year" type="number" min="2000" max="2100" value="'+new Date().getFullYear()+'"></div><div class="right" style="margin-left:auto;display:flex;gap:8px"><button id="af_prev" class="ghost"></button><button id="af_next" class="ghost"></button></div></div><div id="a_list" style="margin-top:8px"></div></div></div>',oe();function y(b){return String(b).replace(/[&<>'"]/g,_=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[_])}function I(b){var _=Number(b)||0;return _.toLocaleString("it-IT")+""}function R(b){var _=new Date(b);return("0"+_.getDate()).slice(-2)+"/"+("0"+(_.getMonth()+1)).slice(-2)+"/"+_.getFullYear()}function P(b){if(!b)return"";const _=new Date(b);return isNaN(_)?"":_.toISOString()}function W(b){if(!b)return"";const _=new Date(b);return isNaN(_)?"":new Date(_.getTime()-_.getTimezoneOffset()*6e4).toISOString().slice(0,16)}function X(b){return b=String(b||"").toLowerCase(),b.indexOf("mezza")>-1?240:b.indexOf("giorn")>-1||b.indexOf("formaz")>-1||b.indexOf("mbs")>-1?570:b.indexOf("sottoprod")>-1?240:90}const V=document.getElementById("a_nncf");V.addEventListener("click",()=>{const b=V.getAttribute("data-active")!=="1";V.setAttribute("data-active",b?"1":"0"),V.setAttribute("aria-pressed",b?"true":"false"),V.classList.toggle("active",b),b&&k(document.getElementById("t_vendita"))});const G=document.getElementById("t_vendita"),rt=document.getElementById("t_mezza"),$=document.getElementById("t_full"),tt=document.getElementById("t_form"),at=document.getElementById("t_mbs"),C=document.getElementById("t_sotto"),E=[G,rt,$,tt,at,C];function k(b){E.forEach(z=>z.classList.toggle("active",z===b));const _=document.getElementById("a_type"),D=document.getElementById("a_client"),M=document.getElementById("row_vss"),L=document.getElementById("row_vsd_p"),K=document.getElementById("row_vsd_i"),Z=document.getElementById("row_tel"),ut=document.getElementById("row_app");document.getElementById("a_vss").value="",document.getElementById("a_vsd").value="",document.getElementById("a_vsd_i").value="",document.getElementById("a_tel").value="",document.getElementById("a_app").value="",M.style.display="",L.style.display="",K.style.display="none",Z.style.display="none",ut.style.display="none",D.disabled=!1,V.style.display="",V.setAttribute("data-active","0"),V.setAttribute("aria-pressed","false"),V.classList.remove("active"),(D.value==="Formazione"||D.value==="MBS"||D.value==="Sottoprodotti")&&(D.value=""),b===G?(_.value="vendita",U(90)):b===rt?(_.value="mezza",U(240),document.getElementById("a_vsd").value="1000"):b===$?(_.value="giornata",U(570),document.getElementById("a_vsd").value="2000"):b===tt?(_.value="formazione",U(570),D.value="Formazione",D.disabled=!0,M.style.display="none",L.style.display="none",V.style.display="none"):b===at?(_.value="MBS",U(570),D.value="MBS",D.disabled=!0,M.style.display="none",L.style.display="none",K.style.display="",document.getElementById("a_vsd_i").value="2000",V.style.display="none"):b===C&&(_.value="sottoprodotti",U(240),D.value="Sottoprodotti",D.disabled=!0,M.style.display="none",L.style.display="none",Z.style.display="",ut.style.display="",V.style.display="none")}function U(b){const _=document.getElementById("a_dur");_.value=String(b),H()}E.forEach(b=>b.addEventListener("click",_=>{_.preventDefault(),k(b)})),k(G);function H(){const b=document.getElementById("a_start").value,_=parseInt(document.getElementById("a_dur").value||"0",10);if(!b||!isFinite(_)||_<=0){document.getElementById("a_end").value="";return}const D=new Date(b),M=new Date(D.getTime()+_*6e4);document.getElementById("a_end").value=("0"+M.getHours()).slice(-2)+":"+("0"+M.getMinutes()).slice(-2)}function j(){const b=document.getElementById("a_start").value,_=document.getElementById("a_end").value;if(!b||!_)return;const D=new Date(b),M=_.split(":");if(M.length<2)return;const L=new Date(D);L.setHours(parseInt(M[0],10)||0,parseInt(M[1],10)||0,0,0),L<D&&L.setDate(L.getDate()+1);let K=Math.round((L-D)/6e4);document.getElementById("a_dur").value=String(Math.max(1,K))}document.getElementById("a_start").addEventListener("change",H),document.getElementById("a_dur").addEventListener("input",H),document.getElementById("a_end").addEventListener("change",j),It("/api/clients").then(b=>{const _=b&&b.clients||[],D=document.getElementById("clientList");D&&(D.innerHTML=_.map(M=>'<option value="'+y(M.name)+'"></option>').join(""))});let q=null;function et(){q=null,document.getElementById("a_form_title").textContent="Nuovo appuntamento",document.getElementById("a_client").value="",document.getElementById("a_start").value="",document.getElementById("a_end").value="",document.getElementById("a_dur").value="",document.getElementById("a_vss").value="",document.getElementById("a_vsd").value="",document.getElementById("a_vsd_i").value="",document.getElementById("a_tel").value="",document.getElementById("a_app").value="",document.getElementById("a_desc").value="",document.getElementById("a_client").disabled=!1,V.style.display="",V.setAttribute("data-active","0"),V.setAttribute("aria-pressed","false"),V.classList.remove("active"),k(G),document.getElementById("btnDeleteA").style.display="none"}function Y(b){q=b.id,document.getElementById("a_form_title").textContent="Modifica appuntamento";var _=String(b.type||"vendita").toLowerCase();_.indexOf("mezza")>-1?k(rt):_.indexOf("giorn")>-1?k($):_.indexOf("formaz")>-1?k(tt):_.indexOf("mbs")>-1?k(at):_.indexOf("sottoprod")>-1?k(C):k(G),document.getElementById("a_client").value=b.client||"",document.getElementById("a_start").value=W(b.start);const D=new Date(b.start);let M=b.end?new Date(b.end):null,L=Number(b.durationMinutes);M instanceof Date&&!isNaN(M)&&M>=D?L=Math.max(1,Math.round((M-D)/6e4)):isFinite(L)&&L>0?M=new Date(D.getTime()+L*6e4):(L=X(b.type||"vendita"),M=new Date(D.getTime()+L*6e4)),document.getElementById("a_dur").value=String(L),document.getElementById("a_end").value=("0"+M.getHours()).slice(-2)+":"+("0"+M.getMinutes()).slice(-2),document.getElementById("a_vss").value=b.vss||"",document.getElementById("a_vsd").value=b.vsdPersonal||b.vsd||"",document.getElementById("a_vsd_i").value=b.vsdIndiretto||"",document.getElementById("a_tel").value=b.telefonate||"",document.getElementById("a_app").value=b.appFissati||"",document.getElementById("a_desc").value=b.notes||"";const K=!!b.nncf;V.setAttribute("data-active",K?"1":"0"),V.setAttribute("aria-pressed",K?"true":"false"),V.classList.toggle("active",K),document.getElementById("btnDeleteA").style.display=""}function lt(){let b=(document.getElementById("a_client").value||"").trim();const _=document.getElementById("a_type").value;if(!b){const ut=String(_||"").toLowerCase();if(ut==="formazione"||ut==="mbs"||ut==="sottoprodotti")b=_;else return wt("Cliente obbligatorio"),null}const D=document.getElementById("a_start").value;if(!D)return wt("Data/ora obbligatorie"),null;let M=parseInt(document.getElementById("a_dur").value||"60",10);(!isFinite(M)||M<=0)&&(M=60);const L=document.getElementById("a_end").value;let K;if(L){const ut=new Date(D),z=L.split(":"),Q=new Date(ut);Q.setHours(parseInt(z[0],10)||0,parseInt(z[1],10)||0,0,0),Q<ut&&Q.setDate(Q.getDate()+1),K=Q.toISOString(),M=Math.max(1,Math.round((Q-ut)/6e4)),document.getElementById("a_dur").value=String(M)}else K=new Date(new Date(D).getTime()+M*6e4).toISOString();const Z=document.getElementById("a_desc").value||"";return{id:q||void 0,client:b,start:P(D),end:K,durationMinutes:M,type:_,vss:Number(document.getElementById("a_vss").value||0),vsdPersonal:Number(document.getElementById("a_vsd").value||0),vsdIndiretto:Number(document.getElementById("a_vsd_i").value||0),telefonate:Number(document.getElementById("a_tel").value||0),appFissati:Number(document.getElementById("a_app").value||0),notes:Z,nncf:V.getAttribute("data-active")==="1"}}function ct(b){const _=lt();if(!_)return;const D=!q;ue("/api/appointments",_).then(()=>{if(wt("Appuntamento salvato"),typeof haptics<"u"&&haptics.try("success"),document.dispatchEvent(new Event("appt:saved")),D)try{document.dispatchEvent(new Event("appt:created"))}catch(M){}if(b&&window.BP&&BP.ICS&&typeof BP.ICS.downloadIcsForAppointment=="function")if(BP.ICS.downloadIcsForAppointment(_)){typeof haptics<"u"&&haptics.try("medium");try{document.dispatchEvent(new Event("ics:exported"))}catch(L){}wt(".ics esportato")}else wt("Export .ics non disponibile");et(),A()}).catch(()=>wt("Errore salvataggio"))}function st(){if(!q||!confirm("Eliminare l'appuntamento?"))return;const b=lt();fetch("/api/appointments?id="+encodeURIComponent(q),{method:"DELETE",headers:{Authorization:"Bearer "+wi()}}).then(_=>{if(!_.ok)throw new Error("HTTP "+_.status);return _.json()}).then(()=>{wt("Eliminato"),typeof showUndo=="function"&&b&&showUndo("Appuntamento eliminato",function(){return ue("/api/appointments",b)},5e3),et(),A()}).catch(()=>wt("Errore eliminazione"))}document.getElementById("btnSaveA").onclick=()=>ct(!1),document.getElementById("btnSaveExportA").onclick=()=>ct(!0),document.getElementById("btnDeleteA").onclick=st;function m(){const b=document.getElementById("af_type").value,_=parseInt(document.getElementById("af_year").value,10);if(b==="sett"){const D=Math.max(1,Math.min(53,parseInt(document.getElementById("af_week").value||Qt(new Date),10))),M=en(_,D);return{s:new Date(M.start),e:new Date(M.end)}}else{const D=parseInt(document.getElementById("af_month").value||new Date().getMonth()+1,10);return{s:new Date(_,D-1,1),e:new Date(_,D,0,23,59,59,999)}}}function p(b){const _=document.getElementById("af_type").value,D=parseInt(document.getElementById("af_year").value,10);if(_==="sett"){const M=parseInt(document.getElementById("af_week").value,10),L=new Date(en(D,M).start);L.setDate(L.getDate()+7*b),document.getElementById("af_year").value=L.getFullYear(),document.getElementById("af_week").value=Qt(L)}else{const M=parseInt(document.getElementById("af_month").value,10),L=new Date(D,M-1,1);L.setMonth(L.getMonth()+b),document.getElementById("af_year").value=L.getFullYear(),document.getElementById("af_month").value=L.getMonth()+1}A()}document.getElementById("af_prev").onclick=()=>p(-1),document.getElementById("af_next").onclick=()=>p(1);const g=document.getElementById("af_type"),v=document.getElementById("af_week"),T=document.getElementById("af_month"),F=document.getElementById("af_year");g.onchange=function(){const b=g.value;document.getElementById("af_week_wrap").style.display=b==="sett"?"":"none",document.getElementById("af_month_wrap").style.display=b==="mese"?"":"none",A()},[v,T,F].forEach(b=>{b&&(b.onchange=A)});function B(b){const _=new Date(b.start);let D=b.end?new Date(b.end):null;if(!(D instanceof Date)||isNaN(D)||D<_){const Z=isFinite(b.durationMinutes)?Number(b.durationMinutes):X(b.type||"vendita");D=new Date(_.getTime()+Z*6e4)}const M=R(_)+" "+("0"+_.getHours()).slice(-2)+":"+("0"+_.getMinutes()).slice(-2)+""+("0"+D.getHours()).slice(-2)+":"+("0"+D.getMinutes()).slice(-2);var L,K=String(b.type||"").toLowerCase();return K.indexOf("mbs")>-1?L="VSD ind "+I(b.vsdIndiretto||0):K.indexOf("sottoprod")>-1?L="Tel "+ne(b.telefonate||0)+"  AppFissati "+ne(b.appFissati||0):K.indexOf("formaz")>-1?L="":L="VSS "+I(b.vss||0)+"  VSD "+I(b.vsdPersonal||0)+"  NNCF "+(b.nncf?"":""),'<div class="card" data-aid="'+y(String(b.id||""))+'" style="flex:1 1 320px;cursor:pointer"><div class="small muted">'+y(M)+"  "+y(b.type||"vendita")+'</div><div style="display:flex;justify-content:space-between;align-items:center;gap:8px"><div><b>'+y(b.client||"")+'</b></div><button class="ghost btn-ics" title="Esporta" data-ics="'+y(String(b.id||""))+'"></button></div>'+(L?'<div class="small">'+L+"</div>":"")+"</div>"}function A(){It("/api/appointments").then(b=>{const _=b&&b.appointments||[],D=m(),M=D.s.getTime(),L=D.e.getTime(),K=_.filter(bt=>{const yt=new Date(bt.start).getTime();return yt>=M&&yt<=L}).sort((bt,yt)=>new Date(bt.start)-new Date(yt.start)),Z=new Date,ut=K.filter(bt=>new Date(bt.start)>=Z),z=K.filter(bt=>new Date(bt.start)<Z),Q=document.getElementById("a_list");let pt="";pt+="<div><b>Prossimi</b></div>",pt+=ut.length?'<div class="grid3">'+ut.map(B).join("")+"</div>":'<div class="muted" style="margin:6px 0 12px">Nessun appuntamento futuro</div>';const dt="past_"+Math.random().toString(36).slice(2,8);pt+='<div id="'+dt+'_head" style="margin-top:12px;display:flex;align-items:center;justify-content:space-between;cursor:pointer"><b>Passati</b><span class="chev"></span></div><div id="'+dt+'_box" style="display:none;margin-top:8px">'+(z.length?'<div class="grid3">'+z.map(B).join("")+"</div>":'<div class="muted">Nessun appuntamento passato</div>')+"</div>",Q.innerHTML=pt,(function(){const bt=document.getElementById(dt+"_head"),yt=document.getElementById(dt+"_box"),_t=bt.querySelector(".chev");bt.onclick=function(){const Ct=yt.style.display==="none";yt.style.display=Ct?"":"none",_t.textContent=Ct?"":""}})();const vt=K;Q.querySelectorAll("[data-ics]").forEach(bt=>{bt.addEventListener("click",yt=>{yt.stopPropagation();const _t=bt.getAttribute("data-ics"),Ct=vt.find(Ft=>String(Ft.id)===String(_t));if(!Ct){wt("Appuntamento non trovato");return}if(window.BP&&BP.ICS&&typeof BP.ICS.downloadIcsForAppointment=="function")if(BP.ICS.downloadIcsForAppointment(Ct)){typeof haptics<"u"&&haptics.try("medium");try{document.dispatchEvent(new Event("ics:exported"))}catch(Vt){}wt("Esportato")}else wt("Export .ics non disponibile");else wt("Export .ics non disponibile")})}),Q.querySelectorAll(".card[data-aid]").forEach(bt=>{bt.addEventListener("click",()=>{const yt=bt.getAttribute("data-aid"),_t=vt.find(Ct=>String(Ct.id)===String(yt));_t&&(Y(_t),window.scrollTo({top:0,behavior:"smooth"}))})})})}try{const b=yi("bp_prefill_slot",null);if(b&&b.start){const _=new Date(b.start),D=new Date(b.end||b.start),M=new Date(_.getTime()-_.getTimezoneOffset()*6e4).toISOString().slice(0,16);document.getElementById("a_start").value=M,document.getElementById("a_dur").value=String(Math.max(1,Math.round((D-_)/6e4))),H(),wt("Slot precompilato negli appuntamenti")}Fn("bp_prefill_slot")}catch(b){}try{const b=yi("bp_edit_aid",null);b&&It("/api/appointments").then(_=>{const M=(_&&_.appointments||[]).find(L=>String(L.id)===String(b));M&&(Y(M),window.scrollTo({top:0,behavior:"smooth"}))}).finally(()=>{try{Fn("bp_edit_aid")}catch(_){}})}catch(b){}document.getElementById("btnSaveA").onclick=()=>ct(!1),document.getElementById("btnSaveExportA").onclick=()=>ct(!0),document.getElementById("btnDeleteA").onclick=st,It("/api/clients").then(()=>{}),A()}function h(){if(!zt())return t();document.title="Battle Plan  Classifiche",n.innerHTML=he()+('<div class="wrap"><div class="card"><div class="row"><div><label>Vista</label><select id="lb_tab"><option value="per_indicator">Per indicatore</option><option value="overall">Generale (score)</option></select></div><div><label>Modalit</label><select id="lb_mode"><option value="consuntivo">Consuntivo</option><option value="previsionale">Previsionale</option></select></div><div id="lb_ind_wrap"><label>Indicatore</label><select id="lb_indicator"><option value="VSS">VSS</option><option value="VSDPersonale">VSD</option><option value="GI">GI</option><option value="NNCF">NNCF</option></select></div></div>'+e("lb")+'</div><div class="card"><b id="lb_title">Classifica</b><div id="lb_podium" style="margin:10px 0"></div><div id="lb_table"></div></div></div>'),oe();function y($){if(!$)return"";var tt=new Date($);return tt.getFullYear()+"-"+("0"+(tt.getMonth()+1)).slice(-2)+"-"+("0"+tt.getDate()).slice(-2)}function I($){return $==="ytd"||$==="ltm"?"mensile":$}document.getElementById("lb_tab").onchange=function(){var $=this.value;document.getElementById("lb_ind_wrap").style.display=$==="per_indicator"?"":"none",P()},o("lb",P),document.getElementById("lb_mode").onchange=P,document.getElementById("lb_indicator").onchange=P;function R(){var $=s("lb"),tt=y($.start),at=y($.end),C=I($.type||"mensile");return"&from="+encodeURIComponent(tt)+"&to="+encodeURIComponent(at)+"&type="+encodeURIComponent(C)}function P(){var $=document.getElementById("lb_tab").value,tt=R(),at=document.getElementById("lb_mode").value;if($==="overall")It("/api/leaderboard_overall?mode="+encodeURIComponent(at)+tt).then(rt);else{var C=document.getElementById("lb_indicator").value;It("/api/leaderboard?indicator="+encodeURIComponent(C)+"&mode="+encodeURIComponent(at)+tt).then(function(E){G(E,C)})}}function W($){return $===0?"":$===1?"":$===2?"":$+1+"."}function X($){var tt=document.getElementById("lb_podium");if(!$||!$.length){tt.innerHTML="";return}for(var at=$.slice(0,3),C='<div class="row" style="align-items:flex-end">',E=0;E<at.length;E++){var k=80-E*15;C+='<div class="card" style="flex:1 1 120px;height:'+k+'px;display:flex;align-items:flex-end;justify-content:center"><div>'+Lt(W(E)+" "+at[E].name)+"</div></div>"}C+="</div>",tt.innerHTML=C}function V($,tt,at){var C=Math.min(100,Math.max(0,Math.round(at)));return'<div class="card lb-card" style="flex:1 1 280px"><div class="big">'+Lt($)+'</div><div class="small muted">'+Lt(tt)+'</div><div class="lb-bar"><div style="width:'+C+'%"></div></div></div>'}function G($,tt){document.getElementById("lb_title").textContent="Classifica  "+tt;var at=$.ranking||[];if(X(at),!at.length){document.getElementById("lb_table").innerHTML='<div class="muted">Nessun dato</div>';return}for(var C='<div class="row">',E=at[0].total||1,k=0;k<at.length;k++){var U=at[k];C+=V(W(k)+" "+U.name,"Totale: "+ne(U.total),U.total/E*100)}C+="</div>",document.getElementById("lb_table").innerHTML=C}function rt($){document.getElementById("lb_title").textContent="Classifica generale";var tt=$.ranking||[];if(X(tt),!tt.length){document.getElementById("lb_table").innerHTML='<div class="muted">Nessun dato</div>';return}for(var at=tt[0].score||0,C='<div class="row">',E=0;E<tt.length;E++){var k=tt[E];C+=V(W(E)+" "+k.name,"Score: "+ne(k.score)+"/100",at?k.score/at*100:0)}C+="</div>",document.getElementById("lb_table").innerHTML=C}P()}(function(){function y(){var I=document.getElementById("bp-overlay");return I||(I=document.createElement("div"),I.id="bp-overlay",I.className="hidden",I.setAttribute("role","dialog"),I.setAttribute("aria-modal","true"),I.innerHTML='<div class="bp-overlay-backdrop" id="bp-overlay-backdrop"></div><div class="bp-overlay-panel" id="bp-overlay-panel"></div>',document.body.appendChild(I),document.getElementById("bp-overlay-backdrop").addEventListener("click",hideOverlay)),I}window.showOverlay=function(I){var R=y(),P=document.getElementById("bp-overlay-panel");P.innerHTML=I||"",R.classList.remove("hidden");var W=P.querySelector("input, textarea, select, button");W&&setTimeout(function(){try{W.focus()}catch(X){}},0)},window.hideOverlay=function(){var I=document.getElementById("bp-overlay");I&&I.classList.add("hidden")}})();function w(){if(!zt())return t();document.title="Battle Plan  Clienti",n.innerHTML=he()+'<div class="wrap"><div class="card"><b>Nuovo cliente</b><div class="row" style="margin-top:8px"><div><label>Ragione sociale</label><input id="cl_name" type="text" placeholder="Es. Rossi S.r.l."></div><div><label>Stato</label><select id="cl_new_state"><option value="potenziale">Potenziale</option><option value="lead non chiuso">Lead non chiuso</option><option value="attivo">Attivo</option></select></div><div><label>Consulente</label><select id="cl_new_owner"><option value=""></option></select></div><div class="right"><button id="cl_add">Aggiungi</button></div></div></div><div class="card"><b>Filtri elenco</b><div class="row" style="margin-top:8px"><div><label>Stato</label><select id="cl_f_state"><option value="">Tutti</option><option value="attivo">Attivo</option><option value="lead non chiuso">Lead non chiuso</option><option value="potenziale">Potenziale</option></select></div><div><label>Consulente</label><select id="cl_f_cons"><option value="">Tutti</option></select></div><div><label>Ordina per</label><select id="cl_order"><option value="az">Ragione sociale (AZ)</option><option value="last_desc">Ultimo appuntamento (recenti prima)</option></select></div><div class="right"><button class="ghost" id="cl_f_apply">Applica</button></div></div></div><div class="card"><b>Elenco clienti</b><div id="cl_list" class="row" style="margin-top:8px"></div></div></div>',oe();function y(){const P=(document.getElementById("cl_name").value||"").trim();if(!P){wt("Nome obbligatorio");return}const W=document.getElementById("cl_new_state"),X=document.getElementById("cl_new_owner"),V={name:P};W&&(V.status=W.value),X&&X.value&&(V.consultantId=X.value),ue("/api/clients",V).then(function(){document.getElementById("cl_name").value="",R(),ci(),window.addXP(5)}).catch(function(G){logger.error(G),wt("Errore creazione cliente")})}function I(){It("/api/usernames").then(function(P){const W=P&&P.users||[],X=document.getElementById("cl_f_cons"),V=document.getElementById("cl_new_owner");X&&(X.innerHTML='<option value="">Tutti</option>'+W.map(function(G){return'<option value="'+G.id+'">'+Lt(G.name)+(G.grade?" ("+G.grade+")":"")+"</option>"}).join("")),V&&(V.innerHTML='<option value=""></option>'+W.map(function(G){return'<option value="'+G.id+'">'+Lt(G.name)+(G.grade?" ("+G.grade+")":"")+"</option>"}).join(""))}).catch(function(P){logger.error(P)})}function R(){It("/api/clients").then(function(P){const W=P&&P.clients||[],X=document.getElementById("cl_f_state").value,V=document.getElementById("cl_f_cons").value;function G(tt){return String(tt||"").trim().toLowerCase()}const $=W.filter(function(tt){return!(X&&G(tt.status)!==G(X)||V&&String(tt.consultantId||"")!==String(V))}).map(function(tt){const at=Lt(tt.name||""),C=Lt(tt.status||"potenziale"),E=tt.consultantName?Lt(tt.consultantName):"unknown",k=String(tt.id||"");return'<div class="card" data-clid="'+k+'" data-name-lower="'+at.toLowerCase()+'" data-status="'+C+'" data-consultant-id="'+Lt(String(tt.consultantId||""))+'" style="flex:1 1 380px"><div><b>'+at+'</b></div><div class="small">Stato: <b class="cl-status">'+C+'</b></div><div class="small">Consulente: <b class="cl-cons">'+E+'</b></div><div class="small muted">Ultimo appuntamento: <span class="last-appt"></span></div><div class="right" style="margin-top:6px"><button class="ghost" data-del="'+k+'">Rimuovi</button></div></div>'}).join("");document.getElementById("cl_list").innerHTML=$||'<div class="muted">Nessun cliente</div>',document.querySelectorAll("[data-del]").forEach(function(tt){tt.addEventListener("click",function(){const at=tt.getAttribute("data-del");confirm("Rimuovere il cliente?")&&fetch("/api/clients?id="+encodeURIComponent(at),{method:"DELETE",headers:{Authorization:"Bearer "+wi()}}).then(function(C){if(!C.ok)throw new Error("HTTP "+C.status);return C.json()}).then(function(){wt("Cliente rimosso"),R()}).catch(function(C){logger.error(C),wt("Errore rimozione")})})}),window.BPFinal&&typeof BPFinal.ensureClientSection=="function"?BPFinal.ensureClientSection():setTimeout(function(){const tt=document.getElementById("cl_list"),at=Array.from(tt.children).filter(C=>C.classList.contains("card"));at.sort((C,E)=>String(C.getAttribute("data-name-lower")||"").localeCompare(String(E.getAttribute("data-name-lower")||"")));for(const C of at)tt.appendChild(C)},0)})}document.getElementById("cl_add").onclick=y,document.getElementById("cl_f_apply").onclick=R,I(),R(),typeof kickFinal=="function"&&kickFinal("clients")}function x(){if(!zt())return t();document.title="Battle Plan  Squadra";var y=he()+'<div class="wrap">'+('<div class="card"><b>Vista Amministratore</b><div id="t_adminbar" class="row" style="margin-top:8px;display:flex;align-items:flex-end;gap:16px;flex-wrap:wrap"><div><label>Modalit</label><select id="t_mode" name="mode"><option value="consuntivo">Consuntivo</option><option value="previsionale">Previsionale</option></select></div><div id="t_unified_wrap">'+e("t")+'</div></div></div><div class="card"><b>Riepilogo per utente</b><div id="t_users" class="row" style="margin-top:8px"></div></div><div class="card"><b>Aggregato Squadra</b><div id="t_agg" class="row" style="margin-top:8px"></div><div class="row" style="margin-top:12px;align-items:flex-end;gap:16px;flex-wrap:wrap"><div><label>Indicatore grafico</label><select id="t_ind"><option value="VSS">VSS</option><option value="VSDPersonale">VSD Personale</option><option value="VSDIndiretto">VSD Indiretto</option><option value="VSDTotale">VSD Totale</option><option value="GI">GI</option><option value="NNCF">NNCF</option><option value="provv_gi">Provv GI</option><option value="provv_vsd">Provv VSD</option><option value="tot_provv" selected>Tot Provvigioni</option></select></div><div><label>Consulente</label><select id="t_cons"><option value="">Tutti</option></select></div></div><div style="margin-top:8px"><canvas id="t_chart" height="160"></canvas></div></div>')+"</div>";n.innerHTML=y,oe(),(function(){var et=document.getElementById("t_adminbar"),Y=document.getElementById("t_unified_wrap");if(!(!et||!Y)){var lt=Y.querySelector(".row");lt&&(Array.from(lt.children).forEach(function(ct){ct.classList.remove("right"),ct.style.marginTop="0",et.appendChild(ct)}),Y.remove())}})();function I(q){return q=Number(q||0),isFinite(q)?q:0}function R(q){if(!q)return"";var et=new Date(q);return et.getFullYear()+"-"+("0"+(et.getMonth()+1)).slice(-2)+"-"+("0"+et.getDate()).slice(-2)}function P(q){return q=String(q||"mensile").toLowerCase(),q.indexOf("sett")===0?"settimanale":q.indexOf("mes")===0?"mensile":q.indexOf("tri")===0?"trimestrale":q.indexOf("sem")===0?"semestrale":q.indexOf("ann")===0?"annuale":"mensile"}function W(){var q=s("t"),et=R(q.start),Y=R(q.end),lt=P(q.type);return"&from="+encodeURIComponent(et)+"&to="+encodeURIComponent(Y)+"&type="+encodeURIComponent(lt)}function X(q){switch(String(q)){case"provv_gi":return"ProvvGI";case"provv_vsd":return"ProvvVSD";case"tot_provv":return"TotProvvigioni";default:return q}}function V(q){var et=Number(q)||0;return et.toLocaleString("it-IT")+""}function G(q){var et=Number(q)||0;return String(Math.round(et))}function rt(q){return String(q).replace(/[&<>'"]/g,et=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[et])}var $=null;function tt(q,et){return et==="settimanale"?window.isoWeekNum?window.isoWeekNum(q):Math.ceil(q.getDate()/7):et==="mensile"||et==="ytd"||et==="ltm"?q.getMonth()+1:et==="trimestrale"?Math.floor(q.getMonth()/3)+1:et==="semestrale"?q.getMonth()<6?1:2:q.getFullYear()}function at(q,et){var Y=document.getElementById("t_chart");if(Y){var lt=U(et),ct=typeof l=="function"?l(et,lt):q.map(function(F){return tt(F.x,et)}),st=q.map(function(F){return F.y});if(!Le){var g=Y.getContext("2d");Y.width=Y.clientWidth||600,Y.height=Y.clientHeight||160,g.clearRect(0,0,Y.width,Y.height);var m=Math.max(1,...st),p=st.length>1?(Y.width-8)/(st.length-1):0;g.beginPath(),g.lineWidth=2,g.strokeStyle="#2e6cff",st.forEach(function(B,A){var b=4+A*p,_=Y.height-6-B/m*(Y.height-12);A?g.lineTo(b,_):g.moveTo(b,_)}),g.stroke(),g.fillStyle="#2e6cff",st.forEach(function(B,A){var b=4+A*p,_=Y.height-6-B/m*(Y.height-12);g.beginPath(),g.arc(b,_,2,0,Math.PI*2),g.fill()});return}var g=Y.getContext("2d"),v=typeof window.computeTickOptions=="function"?window.computeTickOptions(ct,Y.width||600):{autoSkip:!0,maxRotation:0,minRotation:0};if($)$.data.labels=ct,$.data.datasets[0].data=st,$.options.scales.x.ticks=v,$.update();else{var T=typeof Le.getChart=="function"?Le.getChart(Y):null;T&&T.destroy(),$=new Le(g,{type:"line",data:{labels:ct,datasets:[{label:"",data:st,tension:.3,pointRadius:3,pointHoverRadius:5}]},options:{responsive:!1,maintainAspectRatio:!1,animation:!1,animations:!1,plugins:{legend:{display:!1}},scales:{x:{grid:{display:!1},ticks:v},y:{beginAtZero:!0}}}})}}}function C(q){return'<div class="card" style="flex:1 1 360px"><div style="display:flex;align-items:center;gap:8px"><div><b>'+rt(q.name||"User #"+q.userId)+"</b></div>"+(q.grade?'<span class="chip small">'+rt(q.grade)+"</span>":"")+'</div><div class="small" style="margin-top:6px">VSS '+V(q.vss||0)+'</div><div class="small">VSD Pers. '+V(q.vsdP||0)+'</div><div class="small">VSD Ind. '+V(q.vsdI||0)+'</div><div class="small">VSD Tot. '+V((q.vsdP||0)+(q.vsdI||0))+'</div><div class="small">GI '+V(q.gi||0)+'</div><div class="small">NNCF '+G(q.nncf||0)+'</div><div class="small muted" style="margin-top:6px">Provv GI '+V(q.provvGi||0)+'</div><div class="small muted">Provv VSD '+V(q.provvVsd||0)+'</div><div class="small"><b>Tot Provvigioni '+V(q.provvTot||0)+"</b></div></div>"}function E(q){return'<div class="card" style="flex:1 1 460px"><div class="neon" style="font-weight:900">Totali squadra</div><div class="small" style="margin-top:6px">VSS '+V(q.vss)+'</div><div class="small">VSD Pers. '+V(q.vsdP)+'</div><div class="small">VSD Ind. '+V(q.vsdI)+'</div><div class="small">VSD Tot. '+V(q.vsdP+q.vsdI)+'</div><div class="small">GI '+V(q.gi)+'</div><div class="small">NNCF '+G(q.nncf)+'</div><div class="small muted" style="margin-top:6px">Provv GI '+V(q.provvGi)+'</div><div class="small muted">Provv VSD '+V(q.provvVsd)+'</div><div class="small"><b>Tot Provvigioni '+V(q.provvTot)+"</b></div></div>"}function k(){var q=(document.getElementById("t_mode")||{}).value||"consuntivo",et=W();Promise.all([It("/api/usernames"),It("/api/leaderboard?indicator="+encodeURIComponent("VSS")+et+"&mode="+encodeURIComponent(q)),It("/api/leaderboard?indicator="+encodeURIComponent("VSDPersonale")+et+"&mode="+encodeURIComponent(q)),It("/api/leaderboard?indicator="+encodeURIComponent("VSDIndiretto")+et+"&mode="+encodeURIComponent(q)),It("/api/leaderboard?indicator="+encodeURIComponent("GI")+et+"&mode="+encodeURIComponent(q)),It("/api/leaderboard?indicator="+encodeURIComponent("NNCF")+et+"&mode="+encodeURIComponent(q)),It("/api/leaderboard?indicator="+encodeURIComponent("ProvvGI")+et+"&mode="+encodeURIComponent(q)),It("/api/leaderboard?indicator="+encodeURIComponent("ProvvVSD")+et+"&mode="+encodeURIComponent(q))]).then(function(Y){var lt=Y[0]||{},ct=Y[1]&&(Y[1].rows||Y[1].ranking)||[],st=Y[2]&&(Y[2].rows||Y[2].ranking)||[],m=Y[3]&&(Y[3].rows||Y[3].ranking)||[],p=Y[4]&&(Y[4].rows||Y[4].ranking)||[],g=Y[5]&&(Y[5].rows||Y[5].ranking)||[],v=Y[6]&&(Y[6].rows||Y[6].ranking)||[],T=Y[7]&&(Y[7].rows||Y[7].ranking)||[],F=(lt.users||[]).map(function(dt){return{id:String(dt.id),name:dt.name||dt.email||"User #"+dt.id,grade:dt.grade==="senior"?"senior":"junior"}}),B=document.getElementById("t_cons");B&&(B.innerHTML='<option value="">Tutti</option>'+F.map(function(dt){return'<option value="'+dt.id+'">'+rt(dt.name)+"</option>"}).join(""));function A(dt){for(var vt={},bt=0;bt<dt.length;bt++){var yt=dt[bt],_t=String(yt.userId||yt.id||yt.uid||""),Ct=I(yt.total||yt.value||yt.sum||0);_t&&(vt[_t]=Ct)}return vt}var b=A(ct),_=A(st),D=A(m),M=A(p),L=A(g),K=A(v),Z=A(T),ut=F.map(function(dt){var vt=I(b[dt.id]),bt=I(_[dt.id]),yt=I(D[dt.id]),_t=I(M[dt.id]),Ct=I(L[dt.id]),Ft=I(K[dt.id]),Vt=I(Z[dt.id]);return{userId:dt.id,name:dt.name,grade:dt.grade,vss:vt,vsdP:bt,vsdI:yt,gi:_t,nncf:Ct,provvGi:Ft,provvVsd:Vt,provvTot:Ft+Vt}}),z=document.getElementById("t_users");z&&(z.innerHTML=ut.length?ut.map(C).join(""):'<div class="muted">Nessun dato</div>');var Q=ut.reduce(function(dt,vt){return dt.vss+=vt.vss,dt.vsdP+=vt.vsdP,dt.vsdI+=vt.vsdI,dt.gi+=vt.gi,dt.nncf+=vt.nncf,dt.provvGi+=vt.provvGi,dt.provvVsd+=vt.provvVsd,dt.provvTot+=vt.provvTot,dt},{vss:0,vsdP:0,vsdI:0,gi:0,nncf:0,provvGi:0,provvVsd:0,provvTot:0}),pt=document.getElementById("t_agg");pt&&(pt.innerHTML=E(Q)),j()}).catch(function(Y){logger.error(Y),wt("Errore caricamento squadra")})}function U(q){return(typeof r=="function"?r(q,new Date):[]).map(function(et){return{s:et.s,e:et.e}})}function H(q,et,Y,lt){var ct=lt||s("t"),st=String(ct.type||"mensile").toLowerCase(),m=st==="ytd"||st==="ltm"?"mensile":st,p=U(st);function g(F,B){var A=new Date(B.startDate).getTime(),b=new Date(B.endDate).getTime();return A>=F.s&&b<=F.e}function v(F,B){if(!F)return 0;if(B==="VSDTotale")return Number(F.VSDPersonale||0)+Number(F.VSDIndiretto||0);if(B==="ProvvGI")return Number(F.ProvvGI||0);if(B==="ProvvVSD")return Number(F.ProvvVSD||0);if(B==="TotProvvigioni"){var A=F.TotProvvigioni;return Number(A!=null?A:Number(F.ProvvGI||0)+Number(F.ProvvVSD||0))}return Number(F[B]||0)}var T=(function(){var F=p.length?R(new Date(p[0].s)):R(new Date),B=p.length?R(new Date(p[p.length-1].e)):R(new Date),A="?global=1&type="+encodeURIComponent(m)+"&from="+encodeURIComponent(F)+"&to="+encodeURIComponent(B);return Y&&(A+="&userId="+encodeURIComponent(Y)),A})();return It("/api/periods"+T).catch(function(){return It("/api/periods"+T.replace("?global=1",""))}).then(function(F){var B=F&&F.periods||[],A=B.filter(function(_){return!(_.type!==m||Y&&String(_.userId||_.uid||"")!==String(Y))}),b=p.map(function(_){for(var D=0,M=0;M<A.length;M++){var L=A[M];if(g(_,L)){var K=et==="previsionale"?L.indicatorsPrev||{}:L.indicatorsCons||{};D+=v(K,X(q))}}return{x:new Date(_.s),y:Math.round(D*100)/100}});return b})}function j(){var q=document.getElementById("t_ind").value,et=document.getElementById("t_mode").value||"consuntivo",Y=document.getElementById("t_cons").value||"",lt=s("t"),ct=lt.type,st=X(q);W()+(Y?"&userId="+encodeURIComponent(Y):"")+("&indicator="+encodeURIComponent(st))+("&mode="+encodeURIComponent(et));var m=H(st,et,Y||null,lt);m.then(function(p){at(p,ct)}).catch(function(p){logger.error(p),at([],ct)})}o("t",function(){typeof haptic=="function"&&haptic("light"),k()}),document.getElementById("t_mode").onchange=function(){typeof haptic=="function"&&haptic("light"),k()},document.getElementById("t_ind").onchange=function(){typeof haptic=="function"&&haptic("light"),j()},document.getElementById("t_cons").onchange=function(){typeof haptic=="function"&&haptic("light"),j()},k()}function S(){if(!zt())return t();var y=zt().role==="admin";document.title="Battle Plan  Provvigioni",n.innerHTML=he()+'<div class="wrap"><div class="card"><b>Calcolo provvigioni</b><div class="row" style="margin-top:8px; gap:12px; flex-wrap:wrap">'+(y?'<div><label>Utente</label><select id="comm_user"><option value="__all">Tutta la squadra</option></select></div>':"")+'<div><label>Modalit</label><select id="comm_mode" name="mode"><option value="consuntivo">Consuntivo</option><option value="previsionale">Previsionale</option></select></div></div>'+e("comm")+'</div><div class="card"><b>Indicatori periodo</b><div id="comm_total" style="margin-top:8px"></div></div><div class="card"><b>Provvigioni  ripartizione</b><div class="small muted">Confronto tra Provvigioni GI e Provvigioni VSD sul periodo selezionato</div><div class="row" style="margin-top:8px; align-items:center; gap:16px; flex-wrap:wrap"><canvas id="cm_pie_provv" width="260" height="260" style="max-width:260px; max-height:260px"></canvas><div id="cm_pie_legend" class="small"></div></div></div><div class="card"><b>Dettaglio</b><div id="comm_rows" class="row" style="margin-top:8px; gap:12px; flex-wrap:wrap"></div></div></div>',oe();function I(C){return document.getElementById(C)}function R(C){if(!C)return"";var E=new Date(C);return E.getFullYear()+"-"+("0"+(E.getMonth()+1)).slice(-2)+"-"+("0"+E.getDate()).slice(-2)}function P(C){var E=Number(C)||0;return E.toLocaleString("it-IT")+""}function W(C){return C=Number(C==null?"":C),isFinite(C)?C:0}function X(C){return C?C.TotProvvigioni!=null?W(C.TotProvvigioni):W(C.ProvvGI)+W(C.ProvvVSD):0}function V(C,E){return'<div class="card" style="flex:1 1 100px"><div class="small muted">'+Lt(C)+'</div><div style="font-weight:700; font-size:20px; margin-top:4px">'+E+"</div></div>"}function G(C){return'<div class="row" style="gap:12px; flex-wrap:wrap">'+V("VSD personale",P(C.vsd||0))+V("GI",P(C.gi||0))+'</div><div class="row" style="gap:12px; flex-wrap:wrap; margin-top:8px">'+V("Provv. VSD",P(C.provv_vsd||0))+V("Provv. GI",P(C.provv_gi||0))+V("Totale Provvigioni",P(C.provv_total||0))+"</div>"}function rt(C){return C.length?C.map(function(E){return'<div class="card" style="flex:1 1 320px"><div><b>'+Lt(E.name)+'</b></div><div class="small" style="margin-top:4px">GI '+P(E.gi||0)+"  VSD "+P(E.vsd||0)+'</div><div class="small muted" style="margin-top:2px">Provv. GI '+P(E.provv_gi||0)+"  Provv. VSD "+P(E.provv_vsd||0)+'</div><div class="small" style="margin-top:6px"><b>Totale: '+P(E.provv_total||0)+"</b></div></div>"}).join(""):'<div class="muted">Nessun dato</div>'}function $(C,E,k){var U=document.getElementById("cm_pie_provv"),H=document.getElementById("cm_pie_legend");if(!U||!U.getContext){H&&(H.innerHTML="");return}var j=U.getContext("2d"),q=U.width,et=U.height,Y=q/2,lt=et/2,ct=Math.min(q,et)/2-8;j.clearRect(0,0,q,et);var st=Math.max(0,C||0),m=Math.max(0,E||0),p=st+m,g=k>0?Math.round(p/k*100):null;if(p<=0){j.beginPath(),j.arc(Y,lt,ct,0,Math.PI*2),j.strokeStyle="#ccd0d5",j.lineWidth=10,j.setLineDash([6,6]),j.stroke(),j.setLineDash([]),j.globalCompositeOperation="destination-out",j.beginPath(),j.arc(Y,lt,ct*.55,0,Math.PI*2),j.fill(),j.globalCompositeOperation="source-over",j.fillStyle="#111",j.textAlign="center",j.textBaseline="middle",j.font="bold 20px system-ui, -apple-system, Segoe UI, Roboto, sans-serif",j.fillText(g==null?"":g+"%",Y,lt),H&&(H.innerHTML='<div class="muted">Nessuna provvigione nel periodo</div>');return}var v=[{label:"Provv. GI",value:st,color:"#4F8EF7"},{label:"Provv. VSD",value:m,color:"#F79F4F"}],T=-Math.PI/2;v.forEach(function(A){var b=A.value/p*Math.PI*2;j.beginPath(),j.moveTo(Y,lt),j.arc(Y,lt,ct,T,T+b),j.closePath(),j.fillStyle=A.color,j.fill(),T+=b}),j.globalCompositeOperation="destination-out",j.beginPath(),j.arc(Y,lt,ct*.55,0,Math.PI*2),j.fill(),j.globalCompositeOperation="source-over",j.fillStyle="#111",j.textAlign="center",j.textBaseline="middle",j.font="bold 20px system-ui, -apple-system, Segoe UI, Roboto, sans-serif",j.fillText(g==null?"":g+"%",Y,lt);var F=Math.round(st/p*100),B=Math.round(m/p*100);H&&(H.innerHTML='<div class="row" style="gap:16px; flex-wrap:wrap"><div class="row" style="gap:8px; align-items:center"><span style="display:inline-block;width:12px;height:12px;background:#4F8EF7;border-radius:3px"></span><span><b>Provv. GI</b> '+P(st)+"  "+F+'%</span></div><div class="row" style="gap:8px; align-items:center"><span style="display:inline-block;width:12px;height:12px;background:#F79F4F;border-radius:3px"></span><span><b>Provv. VSD</b> '+P(m)+"  "+B+"%</span></div></div>")}function tt(){var C=s("comm"),E=I("comm_mode").value||"consuntivo",k=y?I("comm_user").value||"__all":String(zt().id),U=new Date(C.start).getTime(),H=new Date(C.end).getTime(),j=a(C.type||"mensile"),q=(function(){var et=R(new Date(U)),Y=R(new Date(H)),lt="?type="+encodeURIComponent(j)+"&from="+encodeURIComponent(et)+"&to="+encodeURIComponent(Y);return y&&k&&k!=="__all"&&(lt+="&userId="+encodeURIComponent(k)),lt})();It("/api/periods"+q).then(function(et){var Y=et&&et.periods||[],lt=Y.filter(function(m){if(m.type!==j)return!1;var p=new Date(m.startDate).getTime(),g=new Date(m.endDate).getTime();return!(p<U||g>H||y&&k!=="__all"&&String(m.userId||m.uid||"")!==String(k)||!y&&String(m.userId||m.uid||"")!==String(zt().id))}),ct={gi:0,vsd:0,provv_gi:0,provv_vsd:0,provv_total:0},st={};lt.forEach(function(m){var p=E==="previsionale"?m.indicatorsPrev||{}:m.indicatorsCons||{},g=String(m.userId||m.uid||""),v=m.userName||m.name||"User "+g,T=W(p.GI),F=W(p.VSDPersonale),B=W(p.ProvvGI),A=W(p.ProvvVSD),b=X(p);ct.gi+=T,ct.vsd+=F,ct.provv_gi+=B,ct.provv_vsd+=A,ct.provv_total+=b,st[g]||(st[g]={userId:g,name:v,gi:0,vsd:0,provv_gi:0,provv_vsd:0,provv_total:0}),st[g].gi+=T,st[g].vsd+=F,st[g].provv_gi+=B,st[g].provv_vsd+=A,st[g].provv_total+=b}),I("comm_total").innerHTML=G(ct),I("comm_rows").innerHTML=rt(Object.values(st).sort(function(m,p){return(p.provv_total||0)-(m.provv_total||0)})),$(ct.provv_gi||0,ct.provv_vsd||0,ct.gi||0)}).catch(function(et){logger.error(et),wt("Errore nel caricamento dati")})}function at(){y&&It("/api/usernames").then(function(C){var E=I("comm_user");if(E){for(var k='<option value="__all">Tutta la squadra</option>',U=C&&C.users||[],H=0;H<U.length;H++){var j=U[H];k+='<option value="'+j.id+'">'+Lt(j.name||"User "+j.id)+"</option>"}E.innerHTML=k}})}o("comm",function(){tt()}),I("comm_mode").onchange=function(){haptic("light"),tt()},y&&(I("comm_user").onchange=function(){haptic("light"),tt()}),at(),tt()}function O(){if(!zt())return t();document.title="Battle Plan  Vendite e Riordini",n.innerHTML=he()+'\n    <div class="wrap">\n\n      <div class="card">\n        <b>Filtro</b>\n        <div class="row" style="margin-top:6px;align-items:flex-end;gap:16px;flex-wrap:wrap">\n          <div>\n            <label>Consulente</label>\n            <select id="vr_cons"><option value="">Tutti</option></select>\n          </div>\n        </div>\n        '.concat(e("vr"),'\n      </div>\n\n      <div class="card">\n        <b>Vendite e Riordini</b>\n        <div class="table" style="overflow:auto">\n          <table class="simple" style="min-width:980px">\n            <thead>\n              <tr>\n                <th>Data</th>\n                <th>Cliente</th>\n                <th>Consulente</th>\n              </tr>\n            </thead>\n            <tbody id="vr_rows">\n              <tr><td colspan="3" class="muted">Nessun dato</td></tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n    </div>'),oe(),o("vr",()=>{})}function N(){if(!zt())return t();document.title="Battle Plan  GI & Scadenzario",n.innerHTML=he()+'\n  <div class="wrap">\n\n    <div class="card">\n      <b>Filtro</b>\n      <div class="row" style="margin-top:6px;align-items:flex-end;gap:16px;flex-wrap:wrap">\n        <div>\n          <label>Consulente</label>\n          <select id="gi_cons"><option value="">Tutti</option></select>\n        </div>\n      </div>\n      '.concat(e("gi"),'\n    </div>\n\n    <div class="card">\n      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">\n        <b>Vendite (GI)</b>\n        <button class="ghost" id="gi_add">Nuova vendita</button>\n      </div>\n      <div class="table" style="overflow:auto">\n        <table class="simple" style="min-width:980px">\n          <thead>\n            <tr>\n              <th>Data vendita</th>\n              <th>Cliente</th>\n              <th>Consulente</th>\n              <th>Servizi</th>\n              <th style="text-align:right">Tot. VSS</th>\n              <th>Piano pagamenti</th>\n              <th></th>\n            </tr>\n          </thead>\n          <tbody id="gi_rows"></tbody>\n        </table>\n      </div>\n    </div>\n\n  </div>'),oe();const y=E=>document.getElementById(E),I=E=>String(E||"").replace(/[&<>'"]/g,k=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[k]),R=E=>(Number(E)||0).toLocaleString("it-IT")+"",P=E=>{const k=new Date(E);return k.getFullYear()+"-"+("0"+(k.getMonth()+1)).slice(-2)+"-"+("0"+k.getDate()).slice(-2)};function W(){const E=window.readUnifiedRange&&window.readUnifiedRange("gi")||{};if(!E||!E.start||!E.end){const k=new Date,U=new Date(k.getFullYear(),0,1),H=new Date(k.getFullYear(),11,31,23,59,59);return{from:P(U),to:P(H)}}return{from:P(E.start),to:P(E.end)}}let X=[];function V(){return It("/api/clients").then(E=>(X=E&&E.clients||[],It("/api/usernames"))).then(E=>{const k=E&&E.users||[],U=y("gi_cons");U&&(U.innerHTML='<option value="">Tutti</option>'+k.map(H=>'<option value="'+I(String(H.id))+'">'+I(H.name)+"</option>").join(""))})}function G(E){const k=Array.isArray(E.schedule)?E.schedule.slice():[];if(!k.length)return'<span class="muted"></span>';const U=k.find(Y=>Y.kind==="deposit"||/acconto/i.test(Y.note||"")),H=k.filter(Y=>Y!==U),j=U?"Acconto: "+R(U.amount):"";if(!H.length)return j||'<span class="muted"></span>';const q=Math.round(H[0].amount||0),et=H.every(Y=>Math.abs(Math.round(Y.amount||0)-q)<=1);return(j?j+" + ":"")+(et?H.length+" rate da "+R(q):"piano personalizzato")}function rt(E){return'<tr data-id="'+I(String(E.id))+'"><td>'+new Date(E.date||E.createdAt).toLocaleDateString("it-IT")+"</td><td>"+I(E.clientName||"")+"</td><td>"+I(E.consultantName||"")+"</td><td>"+I(E.services||"")+'</td><td style="text-align:right"><b>'+R(E.vssTotal||0)+"</b></td><td>"+G(E)+'</td><td class="right"><button class="ghost" data-edit="'+I(String(E.id))+'">Modifica</button></td></tr>'}function $(){const E=W(),k=(y("gi_cons")||{}).value||"",U="?from="+encodeURIComponent(E.from)+"&to="+encodeURIComponent(E.to)+(k?"&userId="+encodeURIComponent(k):"");It("/api/gi"+U).then(H=>{let j=H&&H.sales||[];j.sort((q,et)=>+new Date(et.date||et.createdAt||0)-+new Date(q.date||q.createdAt||0)),y("gi_rows").innerHTML=j.length?j.map(rt).join(""):'<tr><td colspan="7" class="muted">Nessuna vendita</td></tr>',at()}).catch(H=>{logger.error(H),wt("Errore caricamento GI")})}function tt(E){const k=E.sale||{},U=Array.isArray(k.schedule)?k.schedule.slice():[],H=U.find(D=>D.kind==="deposit"||/acconto/i.test(D.note||"")),j=U.filter(D=>D!==H),q=j.length>0?j.every(D=>Math.abs((+D.amount||0)-(+j[0].amount||0))<=1):!0,et=j.length&&q?"rate":"manual",Y=P(new Date),lt='<div class="modal"><div class="card gi-modal"><style>.gi-modal{min-width:min(760px,96vw);max-width:980px;max-height:86vh;overflow:auto}@media (max-width:740px){ .gi-grid{display:block} .gi-col{width:100%} .gi-modal{min-width:96vw} }.gi-grid{display:flex; gap:12px; flex-wrap:wrap} .gi-col{flex:1; min-width:240px}.gi-col input, .gi-col select, .gi-col textarea{width:100%; min-width:0}.gi-section{border-top:1px solid var(--hair, rgba(0,0,0,.12)); padding-top:10px; margin-top:10px}.pilltabs{display:flex; gap:12px; align-items:center} .pilltabs label{display:flex; align-items:center; gap:6px; cursor:pointer; padding:6px 10px; border:1px solid var(--hair, rgba(0,0,0,.15)); border-radius:999px}.mrow{display:flex; gap:8px; align-items:center; flex-wrap:wrap}.mrow label{min-width:96px}.mrow input[type=date], .mrow select{min-width:160px; max-width:100%}.mrow input[type=text]{flex:1; min-width:220px; max-width:100%}.mini input[type=number]{width:120px}.gi-rlist{margin-top:6px; max-height:200px; overflow:auto; border:1px dashed rgba(0,0,0,.15); border-radius:8px; padding:6px}.gi-r{display:flex; gap:6px; align-items:center; padding:4px 0}.gi-r input[type=date]{min-width:160px} .gi-r input[type=number]{width:120px} .gi-r input[type=text]{flex:1; min-width:220px; max-width:100%}.gi-foot{display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:12px}</style><div style="display:flex;justify-content:space-between;align-items:center"><b>'+(E.title||(k.id?"Modifica vendita":"Nuova vendita"))+'</b><button class="ghost" id="m_close">Chiudi</button></div><div class="gi-grid"><div class="gi-col"><label>Data</label><input id="m_date" type="date" value="'+I(P(k.date||Y))+'"></div><div class="gi-col"><label>Cliente</label><select id="gi_client_select"><option value="">Caricamento</option></select></div><div class="gi-col"><label>Totale VSS</label><input id="m_vss" type="number" step="1" value="'+I(Number(k.vssTotal||0))+'"></div></div><div class="gi-section"><label>Servizi</label><textarea id="m_srv" rows="2">'+I(k.services||"")+'</textarea></div><div class="gi-section"><b>Acconto</b><div class="mrow mini" style="margin-top:6px"><label><input id="acc_enable" type="checkbox" '+(H?"checked":"")+'> Abilita</label><label>Tipo</label><select id="acc_type"><option value="abs">Valore assoluto</option><option value="perc">Percentuale</option></select><label>Valore</label><input id="acc_value" type="number" step="1" value="'+(H?I(Number(H._fromPerc?H._rawPerc:H.amount)):"0")+'"><label>Scadenza</label><input id="acc_date" type="date" value="'+I(P(H?H.dueDate:k.date||Y))+'"><label>Nota</label><input id="acc_note" placeholder="es. Acconto" value="'+I(H&&H.note||"Acconto")+'"></div></div><div class="gi-section"><b>Modalit pagamenti</b><div class="pilltabs" style="margin:6px 0 8px"><label><input type="radio" name="pmode" value="rate" '+(et==="rate"?"checked":"")+'> Rateale</label><label><input type="radio" name="pmode" value="manual" '+(et!=="rate"?"checked":"")+'> Scaglioni manuali</label></div><div id="p_rate" style="display:'+(et==="rate"?"block":"none")+'"><div class="mrow mini"><label>N rate</label><input id="rt_n" type="number" value="'+I(j.length||12)+'"><label>Frequenza</label><select id="rt_freq"><option value="M">Mensile</option><option value="Q">Trimestrale</option><option value="W">Settimanale</option><option value="Y">Annuale</option></select><label>Prima scadenza</label><input id="rt_first" type="date" value="'+I(j[0]?P(j[0].dueDate):P(k.date||Y))+'"><button class="ghost" id="rt_build">Ricalcola rate</button></div><div id="rt_preview" class="gi-rlist muted small"></div></div><div id="p_manual" style="display:'+(et!=="rate"?"block":"none")+'"><div class="mrow mini"><button class="ghost" id="mn_add">Aggiungi scaglione</button></div><div id="mn_list" class="gi-rlist"></div></div></div><div class="gi-foot"><div><div id="tot_prog" class="small muted">Programmato: 0</div><div id="tot_chk"  class="small muted">Totale VSS: 0</div></div><div style="display:flex;gap:8px">'+(k.id?'<button class="ghost danger" id="m_del">Elimina</button>':"")+'<button id="m_save">Salva</button></div></div></div></div>';showOverlay(lt);const ct=document.documentElement.style.overflow;document.documentElement.style.overflow="hidden";function st(){document.documentElement.style.overflow=ct,hideOverlay()}(function(){const M=y("gi_client_select");M.innerHTML='<option value=""> seleziona cliente </option>'+X.map(K=>'<option value="'+I(K.id)+'">'+I(K.name)+"</option>").join("");const L=k.clientId||k.client_id||"";if(L&&(M.value=String(L)),!M.value&&k.clientName){const K=X.find(Z=>String(Z.name).trim().toLowerCase()===String(k.clientName).trim().toLowerCase());K&&(M.value=String(K.id))}})(),H&&H._fromPerc&&(y("acc_type").value="perc"),Array.from(document.querySelectorAll('input[name="pmode"]')).forEach(D=>{D.addEventListener("change",()=>{const M=document.querySelector('input[name="pmode"]:checked').value==="rate";y("p_rate").style.display=M?"block":"none",y("p_manual").style.display=M?"none":"block",_()})});function m(D,M){const L=new Date(D);return L.setMonth(L.getMonth()+M),L}function p(D,M){const L=new Date(D);return L.setDate(L.getDate()+M*7),L}function g(D,M){const L=new Date(D);return L.setMonth(L.getMonth()+M*3),L}function v(D,M){const L=new Date(D);return L.setFullYear(L.getFullYear()+M),L}function T(){const D=Math.max(1,Number(y("rt_n").value||0)),M=y("rt_freq").value,L=new Date(y("rt_first").value||Y),K=Math.max(0,Number(y("m_vss").value||0)),Z=A(),ut=Math.max(0,K-Z),z=Math.round(ut/D),Q=[];for(let pt=0;pt<D;pt++){let dt;M==="M"?dt=m(L,pt):M==="Q"?dt=g(L,pt):M==="W"?dt=p(L,pt):dt=v(L,pt),Q.push({dueDate:dt.toISOString(),amount:z,note:"Rata "+(pt+1)+"/"+D,kind:"installment"})}return F(Q),Q}function F(D){y("rt_preview").innerHTML=D.map(M=>"<div>"+new Date(M.dueDate).toLocaleDateString("it-IT")+"  "+R(M.amount)+' <span class="muted">'+I(M.note||"")+"</span></div>").join(""),y("rt_preview")._data=D,_()}function B(D){const M=y("mn_list");M.innerHTML="",D.forEach((L,K)=>{const Z=document.createElement("div");Z.className="gi-r",Z.innerHTML='<input type="date" data-k="dueDate" value="'+I(P(L.dueDate))+'"><input type="number" step="1" data-k="amount" value="'+I(Number(L.amount||0))+'" style="width:120px"><input type="text" data-k="note"   value="'+I(L.note||"")+'" placeholder="nota" style="flex:1"><button class="ghost" data-del="'+K+'"></button>',M.appendChild(Z)}),M.querySelectorAll("[data-del]").forEach(L=>{L.onclick=()=>{const K=Number(L.getAttribute("data-del")),Z=M._data||[];Z.splice(K,1),B(Z)}}),M.oninput=()=>{const L=M._data||[];Array.from(M.children).forEach((Z,ut)=>{const z=L[ut];if(!z)return;const Q=Z.querySelector('[data-k="dueDate"]').value,pt=Number(Z.querySelector('[data-k="amount"]').value||0),dt=Z.querySelector('[data-k="note"]').value;z.dueDate=new Date(Q).toISOString(),z.amount=Math.round(pt),z.note=dt}),_()},M._data=D,_()}if(y("m_date").value=I(P(k.date||Y)),y("m_vss").value=I(Number(k.vssTotal||0)),y("m_srv").value=I(k.services||""),y("acc_type").value=H&&H._fromPerc?"perc":"abs",y("acc_value").value=H?H._fromPerc?H._rawPerc:H.amount:0,y("acc_date").value=I(P(H?H.dueDate:k.date||Y)),y("acc_note").value=H?I(H.note||"Acconto"):"Acconto",et==="rate"){const D=j.length||12;y("rt_n").value=D,y("rt_first").value=j[0]?I(P(j[0].dueDate)):I(P(k.date||Y)),F(j.length?j:T())}else B(j);y("rt_build").onclick=()=>F(T()),y("mn_add").onclick=()=>{const M=y("mn_list")._data||[];M.push({dueDate:new Date().toISOString(),amount:0,note:"",kind:"manual"}),B(M)},y("m_close").onclick=st;function A(){if(!y("acc_enable").checked)return 0;const D=Math.max(0,Number(y("m_vss").value||0)),M=y("acc_type").value,L=Number(y("acc_value").value||0);return Math.round(M==="perc"?D*(L/100):L)}function b(){const D=[];if(y("acc_enable").checked){const L=A();D.push({dueDate:new Date(y("acc_date").value||Y).toISOString(),amount:L,note:y("acc_note").value||"Acconto",kind:"deposit",_fromPerc:y("acc_type").value==="perc",_rawPerc:Number(y("acc_value").value||0)})}if(document.querySelector('input[name="pmode"]:checked').value==="rate"){const L=(y("rt_preview")._data||[]).map(K=>Object.assign({},K));return D.concat(L)}else{const L=(y("mn_list")._data||[]).map(K=>Object.assign({kind:"manual"},K));return D.concat(L)}}function _(){const D=Math.max(0,Number(y("m_vss").value||0)),M=b(),L=Math.round(M.reduce((K,Z)=>K+Number(Z.amount||0),0));y("tot_prog").textContent="Programmato: "+R(L),y("tot_chk").textContent="Totale VSS: "+R(D)+(L===D?" OK":" (manca "+R(D-L)+")"),y("m_save").disabled=L!==D||!y("gi_client_select").value}if(["m_vss","acc_enable","acc_type","acc_value","acc_date","rt_n","rt_freq","rt_first"].forEach(D=>{const M=y(D);M&&M.addEventListener("input",_)}),y("gi_client_select").addEventListener("change",_),_(),y("m_save").onclick=()=>{const D=y("gi_client_select").value||"",M=X.find(K=>String(K.id)===String(D));if(!M){wt("Seleziona un cliente");return}const L={id:k.id||void 0,date:new Date(y("m_date").value||Y).toISOString(),clientId:M.id,clientName:M.name,vssTotal:Math.round(Number(y("m_vss").value||0)),services:y("m_srv").value||"",schedule:b()};Promise.resolve(ue("/api/gi",L)).then(()=>{st(),haptic("light"),$()}).catch(K=>{logger.error(K),wt("Errore salvataggio")})},k.id){const D=y("m_del");D&&(D.onclick=async()=>{if(!confirm("Eliminare definitivamente questa vendita?"))return;const M=k?JSON.parse(JSON.stringify(k)):null;try{if(await Bf("/api/gi?id="+encodeURIComponent(k.id)).catch(()=>ue("/api/gi/delete",{id:k.id})),st(),wt("Vendita eliminata"),$(),typeof showUndo=="function"&&M){const L={date:new Date(M.date||M.createdAt||new Date).toISOString(),clientId:M.clientId,clientName:M.clientName,vssTotal:Math.round(Number(M.vssTotal||0)),services:M.services||"",schedule:Array.isArray(M.schedule)?M.schedule:[]};showUndo("Vendita eliminata",function(){return ue("/api/gi",L).then(function(){$()})},5e3)}}catch(L){logger.error(L),wt("Errore eliminazione")}})}}function at(){document.querySelectorAll("[data-edit]").forEach(E=>{E.addEventListener("click",()=>{const k=E.getAttribute("data-edit");C(k)})})}document.addEventListener("gi:edit",function(E){const k=E&&E.detail&&E.detail.id;k&&C(k)}),y("gi_add").onclick=()=>{tt({title:"Nuova vendita"})};function C(E){It("/api/gi?from=1900-01-01&to=2999-12-31").then(k=>{const U=(k&&k.sales||[]).find(H=>String(H.id)===String(E));if(!U){wt("Vendita non trovata");return}tt({title:"Modifica vendita",sale:U})})}o("gi",()=>{haptic("light"),$()}),(y("gi_cons")||{}).onchange=()=>{haptic("light"),$()},V().then($)}window.viewGI=window.viewGI||N;function J(){if(!zt())return t();document.title="Battle Plan  Report",n.innerHTML=he()+'<div class="wrap"><div class="card"><b>Sezioni da includere</b><div id="rep_toggles" class="row" style="margin-top:8px; gap:8px; flex-wrap:wrap"><button class="pill" data-type="mensile" id="tog_mese">Mese</button><button class="pill" data-type="trimestrale" id="tog_trimestre">Trimestre</button><button class="pill" data-type="semestrale" id="tog_semestre">Semestre</button><button class="pill" data-type="annuale" id="tog_anno">Anno</button></div></div><div class="card"><b>Report</b><div class="row" style="margin-top:8px"><div style="min-width:320px"><label>Oggetto email</label><input id="report_subject" placeholder="Report BP"></div></div><div class="row" style="margin-top:8px; flex-wrap:wrap"><div style="flex:1 1 100%; min-width:0"><label>Corpo email</label><textarea id="report_body" rows="12" placeholder="Testo del report" style="width:100%; box-sizing:border-box; overflow:auto; resize:vertical; max-height:70vh; white-space:pre-wrap; word-break:break-word"></textarea></div></div><div class="row" id="report-actions" style="gap:8px;margin-top:8px;flex-wrap:wrap"><button class="ghost" id="rep_copy">Copia report</button><span style="flex:0 0 8px"></span><button class="ghost" id="rep_gmail_web">Gmail Web</button><button class="ghost" id="rep_gmail_app">Gmail App</button></div></div></div>',oe();var y=[],I={mensile:!1,trimestrale:!1,semestrale:!1,annuale:!1},R=[{k:"VSS",money:!0,label:"VSS"},{k:"VSDPersonale",money:!0,label:"VSDPersonale"},{k:"VSDIndiretto",money:!0,label:"VSDIndiretto"},{k:"GI",money:!0,label:"GI"},{k:"Telefonate",money:!1,label:"Telefonate"},{k:"AppFissati",money:!1,label:"AppFissati"},{k:"AppFatti",money:!1,label:"AppFatti"},{k:"CorsiLeadership",money:!1,label:"CorsiLeadership"},{k:"iProfile",money:!1,label:"iProfile"},{k:"MBS",money:!1,label:"MBS"},{k:"NNCF",money:!1,label:"NNCF"}];function P(z){return document.getElementById(z)}var W=P("report_body");function X(z,Q){var pt=new Date(z.getTime());return pt.setDate(pt.getDate()+Q),pt}function V(z){return en(z.getFullYear(),Qt(z))}function G(z){var Q=V(z);return V(X(Q.start,7))}function rt(z){var Q=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];return Q[z.getMonth()]}function $(z){return Math.floor(z.getMonth()/3)+1}function tt(z){return z.getMonth()<6?1:2}function at(z){var Q=z.getDay();return Q===5||Q===6||Q===0}function C(z,Q){return z==="mensile"?{start:io(Q),end:oo(Q)}:z==="trimestrale"?{start:Ti(Q),end:so(Q)}:z==="semestrale"?{start:Pi(Q),end:ao(Q)}:{start:Do(Q),end:_i(Q)}}function E(z,Q){return Q>=X(z,-7)&&Q<=X(z,5)}function k(z,Q){var pt=C(z,Q),dt=C(z,X(pt.start,-1)),vt=C(z,X(pt.end,1)),bt=E(dt.end,Q),yt=E(pt.end,Q);return bt&&!yt?{closing:dt,next:pt}:{closing:pt,next:vt}}function U(z,Q,pt){for(var dt=0;dt<y.length;dt++){var vt=y[dt];if(vt.type===z&&ie(vt.startDate)===ie(Q)&&ie(vt.endDate)===ie(pt))return vt}return null}function H(z,Q){var pt=z&&z[Q];return Number(pt||0)}function j(z){return ne(z)+""}function q(z,Q){var pt=R.some(function(dt){return dt.k===z&&dt.money});return pt?j(Q):ne(Q)}function et(z,Q){return z>Q?"":z<Q?"":"="}function Y(z,Q,pt,dt){var vt=U(Q,pt,dt)||{},bt=vt.indicatorsPrev||{},yt=vt.indicatorsCons||{},_t=[z,""];return R.forEach(function(Ct){var Ft=H(bt,Ct.k),Vt=H(yt,Ct.k);_t.push(Ct.label+" "+q(Ct.k,Vt)+" vs "+q(Ct.k,Ft)+" di previsionali ("+et(Vt,Ft)+")")}),_t.push("Note:"),_t.join("\n")}function lt(z,Q,pt,dt){var vt=U(Q,pt,dt)||{},bt=vt.indicatorsPrev||{},yt=[z,""];return R.forEach(function(_t){yt.push(_t.label+" "+q(_t.k,H(bt,_t.k)))}),yt.push("Possibili note:"),yt.join("\n")}function ct(z){return"BP CONSUNTIVO SETT. "+Qt(z)+" "+z.getFullYear()}function st(z){return"BP PREVISIONALE SETT. "+Qt(z)+" "+z.getFullYear()}function m(z){return"BP CONSUNTIVO "+rt(z)+" "+z.getFullYear()}function p(z){var Q=rt(z);return"BP PREVISIONALE "+Q+" "+z.getFullYear()}function g(z){return"BP CONSUNTIVO T"+$(z)+" "+z.getFullYear()}function v(z){return"BP PREVISIONALE T"+$(z)+" "+z.getFullYear()}function T(z){return"BP CONSUNTIVO S"+tt(z)+" "+z.getFullYear()}function F(z){return"BP PREVISIONALE S"+tt(z)+" "+z.getFullYear()}function B(z){return"BP CONSUNTIVO "+z.getFullYear()}function A(z){return"BP PREVISIONALE "+z.getFullYear()}function b(){var z=new Date,Q=[];if(at(z)){var pt=V(z),dt=G(z);Q.push(Y(ct(pt.start),"settimanale",pt.start,pt.end)),Q.push(lt(st(dt.start),"settimanale",dt.start,dt.end))}function vt(bt,yt,_t){var Ct=k(bt,z);Q.push(Y(yt(Ct.closing.start),bt,Ct.closing.start,Ct.closing.end)),Q.push(lt(_t(Ct.next.start),bt,Ct.next.start,Ct.next.end))}I.mensile&&vt("mensile",m,p),I.trimestrale&&vt("trimestrale",g,v),I.semestrale&&vt("semestrale",T,F),I.annuale&&vt("annuale",B,A),W.value=Q.join("\n\n")+(Q.length?"\n":"")}function _(z,Q){z.classList.toggle("active",!!Q),z.style.opacity=Q?"1":"0.65"}function D(){_(P("tog_mese"),I.mensile),_(P("tog_trimestre"),I.trimestrale),_(P("tog_semestre"),I.semestrale),_(P("tog_anno"),I.annuale)}function M(){var z=new Date;function Q(pt){var dt=C(pt,z),vt=C(pt,X(dt.start,-1));return E(dt.end,z)||E(vt.end,z)}I.mensile=Q("mensile"),I.trimestrale=Q("trimestrale"),I.semestrale=Q("semestrale"),I.annuale=Q("annuale"),D()}function L(){function z(Q){var pt=Q.currentTarget.getAttribute("data-type");I[pt]=!I[pt],D(),b()}P("tog_mese").onclick=z,P("tog_trimestre").onclick=z,P("tog_semestre").onclick=z,P("tog_anno").onclick=z}function K(z){return encodeURIComponent(String(z||""))}function Z(){var z=P("rep_gmail_web"),Q=P("rep_gmail_app"),pt=P("rep_copy");pt&&(pt.onclick=function(){try{navigator.clipboard.writeText(W.value||"");var dt=pt.textContent;pt.textContent="Copiato!",setTimeout(function(){pt.textContent=dt},1200)}catch(vt){}}),!(!z||!Q)&&It("/api/users_emails").then(function(dt){var vt=(dt&&dt.emails||(dt&&dt.users||[]).map(function(_t){return _t.email})).filter(Boolean).join(",");function bt(){return P("report_subject").value||"Report BP"}function yt(){return W.value||""}z.onclick=function(){try{navigator.clipboard.writeText(yt())}catch(Ct){}var _t="https://mail.google.com/mail/?view=cm&fs=1&tf=1&su="+K(bt())+"&cc="+K(vt)+"&body="+K(yt());window.open(_t,"_blank"),document.dispatchEvent(new Event("report:composed"))},Q.onclick=function(){try{navigator.clipboard.writeText(yt())}catch(Ct){}var _t="googlegmail:///co?subject="+K(bt())+"&cc="+K(vt)+"&body="+K(yt());location.href=_t,document.dispatchEvent(new Event("report:composed")),setTimeout(function(){document.hidden||(location.href="mailto:?subject="+K(bt())+"&cc="+K(vt)+"&body="+K(yt()),document.dispatchEvent(new Event("report:composed")))},1200)}})}function ut(){It("/api/periods").then(function(z){y=z&&z.periods||[],M(),L(),b(),Z()})}ut()}function ot(){var y=zt();if(!y)return t();if(document.title="Battle Plan  Utenti",y.role!=="admin"){n.innerHTML=he()+'<div class="wrap"><div class="card"><b>Il mio profilo</b><div class="row" style="margin-top:8px"><div><label>Nome</label><input id="p_name" type="text" value="'+Lt(y.name||"")+'"></div><div><label>Email</label><input id="p_email" type="email" value="'+Lt(y.email||"")+'"></div></div><div class="row"><div><label>Nuova password</label><input id="p_pwd" type="password" placeholder="Lascia vuoto per non cambiare"></div><div class="right" style="align-self:flex-end"><button id="p_save">Aggiorna</button></div></div><div class="row"><div><label>Ruolo</label><input value="'+Lt(y.role||"consultant")+'" disabled></div><div><label>Grade</label><input value="'+Lt(y.grade||"junior")+'" disabled></div></div></div></div>',oe(),ye("#p_save").onclick=function(){var P=ye("#p_name").value.trim(),W=ye("#p_email").value.trim(),X=ye("#p_pwd").value,V={id:y.id,name:P,email:W};X&&(V.password=X),ue("/api/users",V).then(function(){wt("Profilo aggiornato"),window.addXP(3);var G=zt();G&&(G.name=P,G.email=W,localStorage.setItem("user",JSON.stringify(G)));try{document.dispatchEvent(new Event("user:profile-updated"))}catch(rt){}}).catch(function(G){logger.error(G),wt("Errore aggiornamento")})};return}n.innerHTML=he()+'<div class="wrap"><div class="card"><b>Gestione utenti</b><div id="users_list" class="row" style="margin-top:8px"></div></div></div>',oe();function I(P){var W=Lt(P.name||P.email||"user_"+P.id),X=P.grade==="senior"?"senior":"junior",V=P.role==="admin"?"admin":"consultant";return'<div class="card" style="flex:1 1 380px"><div><b>'+W+'</b> <span class="small muted">('+Lt(V)+')</span></div><div class="row" style="margin-top:6px"><div><label>Nome</label><input data-nfor="'+P.id+'" type="text" value="'+Lt(P.name||"")+'"></div><div><label>Email</label><input data-efor="'+P.id+'" type="email" value="'+Lt(P.email||"")+'"></div></div><div class="row"><div><label>Nuova password</label><input data-pfor="'+P.id+'" type="password" placeholder="(opzionale)"></div><div><label>Grade</label><select data-gfor="'+P.id+'"><option value="junior"'+(X==="junior"?" selected":"")+'>Junior</option><option value="senior"'+(X==="senior"?" selected":"")+'>Senior</option></select></div><div><label>Ruolo</label><select data-rfor="'+P.id+'"><option value="consultant"'+(V==="consultant"?" selected":"")+'>Consulente</option><option value="admin"'+(V==="admin"?" selected":"")+'>Admin</option></select></div><div class="right" style="align-self:flex-end"><button class="ghost" data-save="'+P.id+'">Aggiorna</button> <button class="danger" data-del="'+P.id+'" title="Elimina utente">Elimina</button></div></div></div>'}function R(){It("/api/users").then(function(P){var W=P&&P.users||[],X=ye("#users_list");X&&(X.innerHTML=W.map(I).join(""),ro("[data-save]").forEach(function(V){V.addEventListener("click",function(){var G=V.getAttribute("data-save"),rt=(ye('input[data-nfor="'+G+'"]')||{}).value||"",$=(ye('input[data-efor="'+G+'"]')||{}).value||"",tt=(ye('select[data-gfor="'+G+'"]')||{}).value||"junior",at=(ye('select[data-rfor="'+G+'"]')||{}).value||"consultant",C=ye('input[data-pfor="'+G+'"]'),E=C?C.value:"",k={id:G,name:rt,email:$,grade:tt,role:at};E&&(k.password=E),ue("/api/users",k).then(function(){wt("Aggiornato"),window.addXP(5),C&&(C.value="")}).catch(function(U){logger.error(U),wt("Errore aggiornamento")})})}),ro("[data-del]").forEach(function(V){V.addEventListener("click",function(){var G=V.getAttribute("data-del");if(confirm("Eliminare definitivamente questo utente?")){var rt=(Array.isArray(W)?W:[]).find(function($){return String($.id)===String(G)});fetch("/api/users?id="+encodeURIComponent(G),{method:"DELETE",headers:{Authorization:"Bearer "+wi()}}).then(function($){if(!$.ok)throw new Error("HTTP "+$.status);return $.json()}).then(function(){if(wt("Utente eliminato"),R(),typeof showUndo=="function"&&rt){var $={id:rt.id,name:rt.name,email:rt.email,grade:rt.grade,role:rt.role};showUndo("Utente eliminato",function(){return ue("/api/users",$).then(function(){R()})},5e3)}}).catch(function($){logger.error($),wt("Errore eliminazione")})}})}))})}R()}window.viewHome=c,window.viewCalendar=d,window.viewPeriods=u,window.viewAppointments=f,window.viewLeaderboard=h,window.viewClients=w,window.viewTeam=x,window.viewCommissions=S,window.viewVendite=O,window.viewReport=J,window.viewUsers=ot,window.toggleDrawer=Ai,window.logout=Ef,window.rerenderTopbarSoon=Yf,document.addEventListener("DOMContentLoaded",function(){zt()?(oe(),c()):t()})})();export{$f as __vite_legacy_guard};
