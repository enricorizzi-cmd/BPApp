var pr=Object.defineProperty;var mr=(n,t,e)=>t in n?pr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var mt=(n,t,e)=>mr(n,typeof t!="symbol"?t+"":t,e);function qf(){import.meta.url,import("_").catch(()=>1),(async function*(){})().next()}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=e(o);fetch(o.href,s)}})();/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Yn(n){return n+.5|0}const Ue=(n,t,e)=>Math.max(Math.min(n,e),t);function Dn(n){return Ue(Yn(n*2.55),0,255)}function Ye(n){return Ue(Yn(n*255),0,255)}function Be(n){return Ue(Yn(n/2.55)/100,0,1)}function jo(n){return Ue(Yn(n*100),0,100)}const be={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},lo=[..."0123456789ABCDEF"],gr=n=>lo[n&15],vr=n=>lo[(n&240)>>4]+lo[n&15],qn=n=>(n&240)>>4===(n&15),br=n=>qn(n.r)&&qn(n.g)&&qn(n.b)&&qn(n.a);function yr(n){var t=n.length,e;return n[0]==="#"&&(t===4||t===5?e={r:255&be[n[1]]*17,g:255&be[n[2]]*17,b:255&be[n[3]]*17,a:t===5?be[n[4]]*17:255}:(t===7||t===9)&&(e={r:be[n[1]]<<4|be[n[2]],g:be[n[3]]<<4|be[n[4]],b:be[n[5]]<<4|be[n[6]],a:t===9?be[n[7]]<<4|be[n[8]]:255})),e}const wr=(n,t)=>n<255?t(n):"";function _r(n){var t=br(n)?gr:vr;return n?"#"+t(n.r)+t(n.g)+t(n.b)+wr(n.a,t):void 0}const xr=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function pa(n,t,e){const i=t*Math.min(e,1-e),o=(s,a=(s+n/30)%12)=>e-i*Math.max(Math.min(a-3,9-a,1),-1);return[o(0),o(8),o(4)]}function Sr(n,t,e){const i=(o,s=(o+n/60)%6)=>e-e*t*Math.max(Math.min(s,4-s,1),0);return[i(5),i(3),i(1)]}function Cr(n,t,e){const i=pa(n,1,.5);let o;for(t+e>1&&(o=1/(t+e),t*=o,e*=o),o=0;o<3;o++)i[o]*=1-t-e,i[o]+=t;return i}function Dr(n,t,e,i,o){return n===o?(t-e)/i+(t<e?6:0):t===o?(e-n)/i+2:(n-t)/i+4}function ko(n){const e=n.r/255,i=n.g/255,o=n.b/255,s=Math.max(e,i,o),a=Math.min(e,i,o),r=(s+a)/2;let l,c,d;return s!==a&&(d=s-a,c=r>.5?d/(2-s-a):d/(s+a),l=Dr(e,i,o,d,s),l=l*60+.5),[l|0,c||0,r]}function Io(n,t,e,i){return(Array.isArray(t)?n(t[0],t[1],t[2]):n(t,e,i)).map(Ye)}function Mo(n,t,e){return Io(pa,n,t,e)}function kr(n,t,e){return Io(Cr,n,t,e)}function Ir(n,t,e){return Io(Sr,n,t,e)}function ma(n){return(n%360+360)%360}function Mr(n){const t=xr.exec(n);let e=255,i;if(!t)return;t[5]!==i&&(e=t[6]?Dn(+t[5]):Ye(+t[5]));const o=ma(+t[2]),s=+t[3]/100,a=+t[4]/100;return t[1]==="hwb"?i=kr(o,s,a):t[1]==="hsv"?i=Ir(o,s,a):i=Mo(o,s,a),{r:i[0],g:i[1],b:i[2],a:e}}function Er(n,t){var e=ko(n);e[0]=ma(e[0]+t),e=Mo(e),n.r=e[0],n.g=e[1],n.b=e[2]}function Tr(n){if(!n)return;const t=ko(n),e=t[0],i=jo(t[1]),o=jo(t[2]);return n.a<255?"hsla(".concat(e,", ").concat(i,"%, ").concat(o,"%, ").concat(Be(n.a),")"):"hsl(".concat(e,", ").concat(i,"%, ").concat(o,"%)")}const Wo={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Yo={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Pr(){const n={},t=Object.keys(Yo),e=Object.keys(Wo);let i,o,s,a,r;for(i=0;i<t.length;i++){for(a=r=t[i],o=0;o<e.length;o++)s=e[o],r=r.replace(s,Wo[s]);s=parseInt(Yo[a],16),n[r]=[s>>16&255,s>>8&255,s&255]}return n}let Gn;function Ar(n){Gn||(Gn=Pr(),Gn.transparent=[0,0,0,0]);const t=Gn[n.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const Br=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Lr(n){const t=Br.exec(n);let e=255,i,o,s;if(t){if(t[7]!==i){const a=+t[7];e=t[8]?Dn(a):Ue(a*255,0,255)}return i=+t[1],o=+t[3],s=+t[5],i=255&(t[2]?Dn(i):Ue(i,0,255)),o=255&(t[4]?Dn(o):Ue(o,0,255)),s=255&(t[6]?Dn(s):Ue(s,0,255)),{r:i,g:o,b:s,a:e}}}function Or(n){return n&&(n.a<255?"rgba(".concat(n.r,", ").concat(n.g,", ").concat(n.b,", ").concat(Be(n.a),")"):"rgb(".concat(n.r,", ").concat(n.g,", ").concat(n.b,")"))}const ji=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,un=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function Fr(n,t,e){const i=un(Be(n.r)),o=un(Be(n.g)),s=un(Be(n.b));return{r:Ye(ji(i+e*(un(Be(t.r))-i))),g:Ye(ji(o+e*(un(Be(t.g))-o))),b:Ye(ji(s+e*(un(Be(t.b))-s))),a:n.a+e*(t.a-n.a)}}function Xn(n,t,e){if(n){let i=ko(n);i[t]=Math.max(0,Math.min(i[t]+i[t]*e,t===0?360:1)),i=Mo(i),n.r=i[0],n.g=i[1],n.b=i[2]}}function ga(n,t){return n&&Object.assign(t||{},n)}function $o(n){var t={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(t={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(t.a=Ye(n[3]))):(t=ga(n,{r:0,g:0,b:0,a:1}),t.a=Ye(t.a)),t}function Nr(n){return n.charAt(0)==="r"?Lr(n):Mr(n)}class Nn{constructor(t){if(t instanceof Nn)return t;const e=typeof t;let i;e==="object"?i=$o(t):e==="string"&&(i=yr(t)||Ar(t)||Nr(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=ga(this._rgb);return t&&(t.a=Be(t.a)),t}set rgb(t){this._rgb=$o(t)}rgbString(){return this._valid?Or(this._rgb):void 0}hexString(){return this._valid?_r(this._rgb):void 0}hslString(){return this._valid?Tr(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,o=t.rgb;let s;const a=e===s?.5:e,r=2*a-1,l=i.a-o.a,c=((r*l===-1?r:(r+l)/(1+r*l))+1)/2;s=1-c,i.r=255&c*i.r+s*o.r+.5,i.g=255&c*i.g+s*o.g+.5,i.b=255&c*i.b+s*o.b+.5,i.a=a*i.a+(1-a)*o.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=Fr(this._rgb,t._rgb,e)),this}clone(){return new Nn(this.rgb)}alpha(t){return this._rgb.a=Ye(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=Yn(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Xn(this._rgb,2,t),this}darken(t){return Xn(this._rgb,2,-t),this}saturate(t){return Xn(this._rgb,1,t),this}desaturate(t){return Xn(this._rgb,1,-t),this}rotate(t){return Er(this._rgb,t),this}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Ee(){}const Rr=(()=>{let n=0;return()=>n++})();function Tt(n){return n==null}function Ht(n){if(Array.isArray&&Array.isArray(n))return!0;const t=Object.prototype.toString.call(n);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function At(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function qt(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function ve(n,t){return qt(n)?n:t}function Dt(n,t){return typeof n>"u"?t:n}const Vr=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/t,va=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*t:+n;function Vt(n,t,e){if(n&&typeof n.call=="function")return n.apply(e,t)}function Nt(n,t,e,i){let o,s,a;if(Ht(n))for(s=n.length,o=0;o<s;o++)t.call(e,n[o],o);else if(At(n))for(a=Object.keys(n),s=a.length,o=0;o<s;o++)t.call(e,n[a[o]],a[o])}function xi(n,t){let e,i,o,s;if(!n||!t||n.length!==t.length)return!1;for(e=0,i=n.length;e<i;++e)if(o=n[e],s=t[e],o.datasetIndex!==s.datasetIndex||o.index!==s.index)return!1;return!0}function Si(n){if(Ht(n))return n.map(Si);if(At(n)){const t=Object.create(null),e=Object.keys(n),i=e.length;let o=0;for(;o<i;++o)t[e[o]]=Si(n[e[o]]);return t}return n}function ba(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function zr(n,t,e,i){if(!ba(n))return;const o=t[n],s=e[n];At(o)&&At(s)?Rn(o,s,i):t[n]=Si(s)}function Rn(n,t,e){const i=Ht(t)?t:[t],o=i.length;if(!At(n))return n;e=e||{};const s=e.merger||zr;let a;for(let r=0;r<o;++r){if(a=i[r],!At(a))continue;const l=Object.keys(a);for(let c=0,d=l.length;c<d;++c)s(l[c],n,a,e)}return n}function Pn(n,t){return Rn(n,t,{merger:Ur})}function Ur(n,t,e){if(!ba(n))return;const i=t[n],o=e[n];At(i)&&At(o)?Pn(i,o):Object.prototype.hasOwnProperty.call(t,n)||(t[n]=Si(o))}const qo={"":n=>n,x:n=>n.x,y:n=>n.y};function Hr(n){const t=n.split("."),e=[];let i="";for(const o of t)i+=o,i.endsWith("\\")?i=i.slice(0,-1)+".":(e.push(i),i="");return e}function jr(n){const t=Hr(n);return e=>{for(const i of t){if(i==="")break;e=e&&e[i]}return e}}function $e(n,t){return(qo[t]||(qo[t]=jr(t)))(n)}function Eo(n){return n.charAt(0).toUpperCase()+n.slice(1)}const Vn=n=>typeof n<"u",qe=n=>typeof n=="function",Go=(n,t)=>{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0};function Wr(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const Ot=Math.PI,zt=2*Ot,Yr=zt+Ot,Ci=Number.POSITIVE_INFINITY,$r=Ot/180,Xt=Ot/2,Je=Ot/4,Xo=Ot*2/3,He=Math.log10,Ie=Math.sign;function An(n,t,e){return Math.abs(n-t)<e}function Ko(n){const t=Math.round(n);n=An(n,t,n/1e3)?t:n;const e=Math.pow(10,Math.floor(He(n))),i=n/e;return(i<=1?1:i<=2?2:i<=5?5:10)*e}function qr(n){const t=[],e=Math.sqrt(n);let i;for(i=1;i<e;i++)n%i===0&&(t.push(i),t.push(n/i));return e===(e|0)&&t.push(e),t.sort((o,s)=>o-s).pop(),t}function Gr(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function pn(n){return!Gr(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function Xr(n,t){const e=Math.round(n);return e-t<=n&&e+t>=n}function ya(n,t,e){let i,o,s;for(i=0,o=n.length;i<o;i++)s=n[i][e],isNaN(s)||(t.min=Math.min(t.min,s),t.max=Math.max(t.max,s))}function _e(n){return n*(Ot/180)}function To(n){return n*(180/Ot)}function Jo(n){if(!qt(n))return;let t=1,e=0;for(;Math.round(n*t)/t!==n;)t*=10,e++;return e}function wa(n,t){const e=t.x-n.x,i=t.y-n.y,o=Math.sqrt(e*e+i*i);let s=Math.atan2(i,e);return s<-.5*Ot&&(s+=zt),{angle:s,distance:o}}function co(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function Kr(n,t){return(n-t+Yr)%zt-Ot}function re(n){return(n%zt+zt)%zt}function zn(n,t,e,i){const o=re(n),s=re(t),a=re(e),r=re(s-o),l=re(a-o),c=re(o-s),d=re(o-a);return o===s||o===a||i&&s===a||r>l&&c<d}function ee(n,t,e){return Math.max(t,Math.min(e,n))}function Jr(n){return ee(n,-32768,32767)}function Oe(n,t,e,i=1e-6){return n>=Math.min(t,e)-i&&n<=Math.max(t,e)+i}function Po(n,t,e){e=e||(a=>n[a]<t);let i=n.length-1,o=0,s;for(;i-o>1;)s=o+i>>1,e(s)?o=s:i=s;return{lo:o,hi:i}}const Fe=(n,t,e,i)=>Po(n,e,i?o=>{const s=n[o][t];return s<e||s===e&&n[o+1][t]===e}:o=>n[o][t]<e),Zr=(n,t,e)=>Po(n,e,i=>n[i][t]>=e);function Qr(n,t,e){let i=0,o=n.length;for(;i<o&&n[i]<t;)i++;for(;o>i&&n[o-1]>e;)o--;return i>0||o<n.length?n.slice(i,o):n}const _a=["push","pop","shift","splice","unshift"];function tl(n,t){if(n._chartjs){n._chartjs.listeners.push(t);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),_a.forEach(e=>{const i="_onData"+Eo(e),o=n[e];Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value(...s){const a=o.apply(this,s);return n._chartjs.listeners.forEach(r=>{typeof r[i]=="function"&&r[i](...s)}),a}})})}function Zo(n,t){const e=n._chartjs;if(!e)return;const i=e.listeners,o=i.indexOf(t);o!==-1&&i.splice(o,1),!(i.length>0)&&(_a.forEach(s=>{delete n[s]}),delete n._chartjs)}function xa(n){const t=new Set(n);return t.size===n.length?n:Array.from(t)}const Sa=(function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame})();function Ca(n,t){let e=[],i=!1;return function(...o){e=o,i||(i=!0,Sa.call(window,()=>{i=!1,n.apply(t,e)}))}}function el(n,t){let e;return function(...i){return t?(clearTimeout(e),e=setTimeout(n,t,i)):n.apply(this,i),t}}const Ao=n=>n==="start"?"left":n==="end"?"right":"center",ae=(n,t,e)=>n==="start"?t:n==="end"?e:(t+e)/2,nl=(n,t,e,i)=>n===(i?"left":"right")?e:n==="center"?(t+e)/2:t;function Da(n,t,e){const i=t.length;let o=0,s=i;if(n._sorted){const{iScale:a,vScale:r,_parsed:l}=n,c=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,d=a.axis,{min:u,max:f,minDefined:h,maxDefined:w}=a.getUserBounds();if(h){if(o=Math.min(Fe(l,d,u).lo,e?i:Fe(t,d,a.getPixelForValue(u)).lo),c){const _=l.slice(0,o+1).reverse().findIndex(S=>!Tt(S[r.axis]));o-=Math.max(0,_)}o=ee(o,0,i-1)}if(w){let _=Math.max(Fe(l,a.axis,f,!0).hi+1,e?0:Fe(t,d,a.getPixelForValue(f),!0).hi+1);if(c){const S=l.slice(_-1).findIndex(F=>!Tt(F[r.axis]));_+=Math.max(0,S)}s=ee(_,o,i)-o}else s=i-o}return{start:o,count:s}}function ka(n){const{xScale:t,yScale:e,_scaleRanges:i}=n,o={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!i)return n._scaleRanges=o,!0;const s=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==e.min||i.ymax!==e.max;return Object.assign(i,o),s}const Kn=n=>n===0||n===1,Qo=(n,t,e)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-t)*zt/e)),ts=(n,t,e)=>Math.pow(2,-10*n)*Math.sin((n-t)*zt/e)+1,Bn={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*Xt)+1,easeOutSine:n=>Math.sin(n*Xt),easeInOutSine:n=>-.5*(Math.cos(Ot*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>Kn(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>Kn(n)?n:Qo(n,.075,.3),easeOutElastic:n=>Kn(n)?n:ts(n,.075,.3),easeInOutElastic(n){return Kn(n)?n:n<.5?.5*Qo(n*2,.1125,.45):.5+.5*ts(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let t=1.70158;return(n/=.5)<1?.5*(n*n*(((t*=1.525)+1)*n-t)):.5*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)},easeInBounce:n=>1-Bn.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?Bn.easeInBounce(n*2)*.5:Bn.easeOutBounce(n*2-1)*.5+.5};function Bo(n){if(n&&typeof n=="object"){const t=n.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function es(n){return Bo(n)?n:new Nn(n)}function Wi(n){return Bo(n)?n:new Nn(n).saturate(.5).darken(.1).hexString()}const il=["x","y","borderWidth","radius","tension"],ol=["color","borderColor","backgroundColor"];function sl(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),n.set("animations",{colors:{type:"color",properties:ol},numbers:{type:"number",properties:il}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function al(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const ns=new Map;function rl(n,t){t=t||{};const e=n+JSON.stringify(t);let i=ns.get(e);return i||(i=new Intl.NumberFormat(n,t),ns.set(e,i)),i}function $n(n,t,e){return rl(t,e).format(n)}const Ia={values(n){return Ht(n)?n:""+n},numeric(n,t,e){if(n===0)return"0";const i=this.chart.options.locale;let o,s=n;if(e.length>1){const c=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(c<1e-4||c>1e15)&&(o="scientific"),s=ll(n,e)}const a=He(Math.abs(s)),r=isNaN(a)?1:Math.max(Math.min(-1*Math.floor(a),20),0),l={notation:o,minimumFractionDigits:r,maximumFractionDigits:r};return Object.assign(l,this.options.ticks.format),$n(n,i,l)},logarithmic(n,t,e){if(n===0)return"0";const i=e[t].significand||n/Math.pow(10,Math.floor(He(n)));return[1,2,3,5,10,15].includes(i)||t>.8*e.length?Ia.numeric.call(this,n,t,e):""}};function ll(n,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&n!==Math.floor(n)&&(e=n-Math.floor(n)),e}var Bi={formatters:Ia};function cl(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Bi.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const ln=Object.create(null),uo=Object.create(null);function Ln(n,t){if(!t)return n;const e=t.split(".");for(let i=0,o=e.length;i<o;++i){const s=e[i];n=n[s]||(n[s]=Object.create(null))}return n}function Yi(n,t,e){return typeof t=="string"?Rn(Ln(n,t),e):Rn(Ln(n,""),t)}class dl{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,o)=>Wi(o.backgroundColor),this.hoverBorderColor=(i,o)=>Wi(o.borderColor),this.hoverColor=(i,o)=>Wi(o.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return Yi(this,t,e)}get(t){return Ln(this,t)}describe(t,e){return Yi(uo,t,e)}override(t,e){return Yi(ln,t,e)}route(t,e,i,o){const s=Ln(this,t),a=Ln(this,i),r="_"+e;Object.defineProperties(s,{[r]:{value:s[e],writable:!0},[e]:{enumerable:!0,get(){const l=this[r],c=a[o];return At(l)?Object.assign({},c,l):Dt(l,c)},set(l){this[r]=l}}})}apply(t){t.forEach(e=>e(this))}}var jt=new dl({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[sl,al,cl]);function ul(n){return!n||Tt(n.size)||Tt(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function Di(n,t,e,i,o){let s=t[o];return s||(s=t[o]=n.measureText(o).width,e.push(o)),s>i&&(i=s),i}function fl(n,t,e,i){i=i||{};let o=i.data=i.data||{},s=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(o=i.data={},s=i.garbageCollect=[],i.font=t),n.save(),n.font=t;let a=0;const r=e.length;let l,c,d,u,f;for(l=0;l<r;l++)if(u=e[l],u!=null&&!Ht(u))a=Di(n,o,s,a,u);else if(Ht(u))for(c=0,d=u.length;c<d;c++)f=u[c],f!=null&&!Ht(f)&&(a=Di(n,o,s,a,f));n.restore();const h=s.length/2;if(h>e.length){for(l=0;l<h;l++)delete o[s[l]];s.splice(0,h)}return a}function Ze(n,t,e){const i=n.currentDevicePixelRatio,o=e!==0?Math.max(e/2,.5):0;return Math.round((t-o)*i)/i+o}function is(n,t){!t&&!n||(t=t||n.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,n.width,n.height),t.restore())}function fo(n,t,e,i){Ma(n,t,e,i,null)}function Ma(n,t,e,i,o){let s,a,r,l,c,d,u,f;const h=t.pointStyle,w=t.rotation,_=t.radius;let S=(w||0)*$r;if(h&&typeof h=="object"&&(s=h.toString(),s==="[object HTMLImageElement]"||s==="[object HTMLCanvasElement]")){n.save(),n.translate(e,i),n.rotate(S),n.drawImage(h,-h.width/2,-h.height/2,h.width,h.height),n.restore();return}if(!(isNaN(_)||_<=0)){switch(n.beginPath(),h){default:o?n.ellipse(e,i,o/2,_,0,0,zt):n.arc(e,i,_,0,zt),n.closePath();break;case"triangle":d=o?o/2:_,n.moveTo(e+Math.sin(S)*d,i-Math.cos(S)*_),S+=Xo,n.lineTo(e+Math.sin(S)*d,i-Math.cos(S)*_),S+=Xo,n.lineTo(e+Math.sin(S)*d,i-Math.cos(S)*_),n.closePath();break;case"rectRounded":c=_*.516,l=_-c,a=Math.cos(S+Je)*l,u=Math.cos(S+Je)*(o?o/2-c:l),r=Math.sin(S+Je)*l,f=Math.sin(S+Je)*(o?o/2-c:l),n.arc(e-u,i-r,c,S-Ot,S-Xt),n.arc(e+f,i-a,c,S-Xt,S),n.arc(e+u,i+r,c,S,S+Xt),n.arc(e-f,i+a,c,S+Xt,S+Ot),n.closePath();break;case"rect":if(!w){l=Math.SQRT1_2*_,d=o?o/2:l,n.rect(e-d,i-l,2*d,2*l);break}S+=Je;case"rectRot":u=Math.cos(S)*(o?o/2:_),a=Math.cos(S)*_,r=Math.sin(S)*_,f=Math.sin(S)*(o?o/2:_),n.moveTo(e-u,i-r),n.lineTo(e+f,i-a),n.lineTo(e+u,i+r),n.lineTo(e-f,i+a),n.closePath();break;case"crossRot":S+=Je;case"cross":u=Math.cos(S)*(o?o/2:_),a=Math.cos(S)*_,r=Math.sin(S)*_,f=Math.sin(S)*(o?o/2:_),n.moveTo(e-u,i-r),n.lineTo(e+u,i+r),n.moveTo(e+f,i-a),n.lineTo(e-f,i+a);break;case"star":u=Math.cos(S)*(o?o/2:_),a=Math.cos(S)*_,r=Math.sin(S)*_,f=Math.sin(S)*(o?o/2:_),n.moveTo(e-u,i-r),n.lineTo(e+u,i+r),n.moveTo(e+f,i-a),n.lineTo(e-f,i+a),S+=Je,u=Math.cos(S)*(o?o/2:_),a=Math.cos(S)*_,r=Math.sin(S)*_,f=Math.sin(S)*(o?o/2:_),n.moveTo(e-u,i-r),n.lineTo(e+u,i+r),n.moveTo(e+f,i-a),n.lineTo(e-f,i+a);break;case"line":a=o?o/2:Math.cos(S)*_,r=Math.sin(S)*_,n.moveTo(e-a,i-r),n.lineTo(e+a,i+r);break;case"dash":n.moveTo(e,i),n.lineTo(e+Math.cos(S)*(o?o/2:_),i+Math.sin(S)*_);break;case!1:n.closePath();break}n.fill(),t.borderWidth>0&&n.stroke()}}function Ne(n,t,e){return e=e||.5,!t||n&&n.x>t.left-e&&n.x<t.right+e&&n.y>t.top-e&&n.y<t.bottom+e}function Li(n,t){n.save(),n.beginPath(),n.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),n.clip()}function Oi(n){n.restore()}function hl(n,t,e,i,o){if(!t)return n.lineTo(e.x,e.y);if(o==="middle"){const s=(t.x+e.x)/2;n.lineTo(s,t.y),n.lineTo(s,e.y)}else o==="after"!=!!i?n.lineTo(t.x,e.y):n.lineTo(e.x,t.y);n.lineTo(e.x,e.y)}function pl(n,t,e,i){if(!t)return n.lineTo(e.x,e.y);n.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?e.cp2x:e.cp1x,i?e.cp2y:e.cp1y,e.x,e.y)}function ml(n,t){t.translation&&n.translate(t.translation[0],t.translation[1]),Tt(t.rotation)||n.rotate(t.rotation),t.color&&(n.fillStyle=t.color),t.textAlign&&(n.textAlign=t.textAlign),t.textBaseline&&(n.textBaseline=t.textBaseline)}function gl(n,t,e,i,o){if(o.strikethrough||o.underline){const s=n.measureText(i),a=t-s.actualBoundingBoxLeft,r=t+s.actualBoundingBoxRight,l=e-s.actualBoundingBoxAscent,c=e+s.actualBoundingBoxDescent,d=o.strikethrough?(l+c)/2:c;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=o.decorationWidth||2,n.moveTo(a,d),n.lineTo(r,d),n.stroke()}}function vl(n,t){const e=n.fillStyle;n.fillStyle=t.color,n.fillRect(t.left,t.top,t.width,t.height),n.fillStyle=e}function cn(n,t,e,i,o,s={}){const a=Ht(t)?t:[t],r=s.strokeWidth>0&&s.strokeColor!=="";let l,c;for(n.save(),n.font=o.string,ml(n,s),l=0;l<a.length;++l)c=a[l],s.backdrop&&vl(n,s.backdrop),r&&(s.strokeColor&&(n.strokeStyle=s.strokeColor),Tt(s.strokeWidth)||(n.lineWidth=s.strokeWidth),n.strokeText(c,e,i,s.maxWidth)),n.fillText(c,e,i,s.maxWidth),gl(n,e,i,c,s),i+=Number(o.lineHeight);n.restore()}function Un(n,t){const{x:e,y:i,w:o,h:s,radius:a}=t;n.arc(e+a.topLeft,i+a.topLeft,a.topLeft,1.5*Ot,Ot,!0),n.lineTo(e,i+s-a.bottomLeft),n.arc(e+a.bottomLeft,i+s-a.bottomLeft,a.bottomLeft,Ot,Xt,!0),n.lineTo(e+o-a.bottomRight,i+s),n.arc(e+o-a.bottomRight,i+s-a.bottomRight,a.bottomRight,Xt,0,!0),n.lineTo(e+o,i+a.topRight),n.arc(e+o-a.topRight,i+a.topRight,a.topRight,0,-Xt,!0),n.lineTo(e+a.topLeft,i)}const bl=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,yl=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function wl(n,t){const e=(""+n).match(bl);if(!e||e[1]==="normal")return t*1.2;switch(n=+e[2],e[3]){case"px":return n;case"%":n/=100;break}return t*n}const _l=n=>+n||0;function Lo(n,t){const e={},i=At(t),o=i?Object.keys(t):t,s=At(n)?i?a=>Dt(n[a],n[t[a]]):a=>n[a]:()=>n;for(const a of o)e[a]=_l(s(a));return e}function Ea(n){return Lo(n,{top:"y",right:"x",bottom:"y",left:"x"})}function an(n){return Lo(n,["topLeft","topRight","bottomLeft","bottomRight"])}function ce(n){const t=Ea(n);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function Qt(n,t){n=n||{},t=t||jt.font;let e=Dt(n.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let i=Dt(n.style,t.style);i&&!(""+i).match(yl)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const o={family:Dt(n.family,t.family),lineHeight:wl(Dt(n.lineHeight,t.lineHeight),e),size:e,style:i,weight:Dt(n.weight,t.weight),string:""};return o.string=ul(o),o}function kn(n,t,e,i){let o,s,a;for(o=0,s=n.length;o<s;++o)if(a=n[o],a!==void 0&&a!==void 0)return a}function xl(n,t,e){const{min:i,max:o}=n,s=va(t,(o-i)/2),a=(r,l)=>e&&r===0?0:r+l;return{min:a(i,-Math.abs(s)),max:a(o,s)}}function Ge(n,t){return Object.assign(Object.create(n),t)}function Oo(n,t=[""],e,i,o=()=>n[0]){const s=e||n;typeof i>"u"&&(i=Ba("_fallback",n));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:s,_fallback:i,_getTarget:o,override:r=>Oo([r,...n],t,s,i)};return new Proxy(a,{deleteProperty(r,l){return delete r[l],delete r._keys,delete n[0][l],!0},get(r,l){return Pa(r,l,()=>Tl(l,t,n,r))},getOwnPropertyDescriptor(r,l){return Reflect.getOwnPropertyDescriptor(r._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(r,l){return ss(r).includes(l)},ownKeys(r){return ss(r)},set(r,l,c){const d=r._storage||(r._storage=o());return r[l]=d[l]=c,delete r._keys,!0}})}function mn(n,t,e,i){const o={_cacheable:!1,_proxy:n,_context:t,_subProxy:e,_stack:new Set,_descriptors:Ta(n,i),setContext:s=>mn(n,s,e,i),override:s=>mn(n.override(s),t,e,i)};return new Proxy(o,{deleteProperty(s,a){return delete s[a],delete n[a],!0},get(s,a,r){return Pa(s,a,()=>Cl(s,a,r))},getOwnPropertyDescriptor(s,a){return s._descriptors.allKeys?Reflect.has(n,a)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,a)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(s,a){return Reflect.has(n,a)},ownKeys(){return Reflect.ownKeys(n)},set(s,a,r){return n[a]=r,delete s[a],!0}})}function Ta(n,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:i=t.indexable,_allKeys:o=t.allKeys}=n;return{allKeys:o,scriptable:e,indexable:i,isScriptable:qe(e)?e:()=>e,isIndexable:qe(i)?i:()=>i}}const Sl=(n,t)=>n?n+Eo(t):t,Fo=(n,t)=>At(t)&&n!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function Pa(n,t,e){if(Object.prototype.hasOwnProperty.call(n,t)||t==="constructor")return n[t];const i=e();return n[t]=i,i}function Cl(n,t,e){const{_proxy:i,_context:o,_subProxy:s,_descriptors:a}=n;let r=i[t];return qe(r)&&a.isScriptable(t)&&(r=Dl(t,r,n,e)),Ht(r)&&r.length&&(r=kl(t,r,n,a.isIndexable)),Fo(t,r)&&(r=mn(r,o,s&&s[t],a)),r}function Dl(n,t,e,i){const{_proxy:o,_context:s,_subProxy:a,_stack:r}=e;if(r.has(n))throw new Error("Recursion detected: "+Array.from(r).join("->")+"->"+n);r.add(n);let l=t(s,a||i);return r.delete(n),Fo(n,l)&&(l=No(o._scopes,o,n,l)),l}function kl(n,t,e,i){const{_proxy:o,_context:s,_subProxy:a,_descriptors:r}=e;if(typeof s.index<"u"&&i(n))return t[s.index%t.length];if(At(t[0])){const l=t,c=o._scopes.filter(d=>d!==l);t=[];for(const d of l){const u=No(c,o,n,d);t.push(mn(u,s,a&&a[n],r))}}return t}function Aa(n,t,e){return qe(n)?n(t,e):n}const Il=(n,t)=>n===!0?t:typeof n=="string"?$e(t,n):void 0;function Ml(n,t,e,i,o){for(const s of t){const a=Il(e,s);if(a){n.add(a);const r=Aa(a._fallback,e,o);if(typeof r<"u"&&r!==e&&r!==i)return r}else if(a===!1&&typeof i<"u"&&e!==i)return null}return!1}function No(n,t,e,i){const o=t._rootScopes,s=Aa(t._fallback,e,i),a=[...n,...o],r=new Set;r.add(i);let l=os(r,a,e,s||e,i);return l===null||typeof s<"u"&&s!==e&&(l=os(r,a,s,l,i),l===null)?!1:Oo(Array.from(r),[""],o,s,()=>El(t,e,i))}function os(n,t,e,i,o){for(;e;)e=Ml(n,t,e,i,o);return e}function El(n,t,e){const i=n._getTarget();t in i||(i[t]={});const o=i[t];return Ht(o)&&At(e)?e:o||{}}function Tl(n,t,e,i){let o;for(const s of t)if(o=Ba(Sl(s,n),e),typeof o<"u")return Fo(n,o)?No(e,i,n,o):o}function Ba(n,t){for(const e of t){if(!e)continue;const i=e[n];if(typeof i<"u")return i}}function ss(n){let t=n._keys;return t||(t=n._keys=Pl(n._scopes)),t}function Pl(n){const t=new Set;for(const e of n)for(const i of Object.keys(e).filter(o=>!o.startsWith("_")))t.add(i);return Array.from(t)}function La(n,t,e,i){const{iScale:o}=n,{key:s="r"}=this._parsing,a=new Array(i);let r,l,c,d;for(r=0,l=i;r<l;++r)c=r+e,d=t[c],a[r]={r:o.parse($e(d,s),c)};return a}const Al=Number.EPSILON||1e-14,gn=(n,t)=>t<n.length&&!n[t].skip&&n[t],Oa=n=>n==="x"?"y":"x";function Bl(n,t,e,i){const o=n.skip?t:n,s=t,a=e.skip?t:e,r=co(s,o),l=co(a,s);let c=r/(r+l),d=l/(r+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const u=i*c,f=i*d;return{previous:{x:s.x-u*(a.x-o.x),y:s.y-u*(a.y-o.y)},next:{x:s.x+f*(a.x-o.x),y:s.y+f*(a.y-o.y)}}}function Ll(n,t,e){const i=n.length;let o,s,a,r,l,c=gn(n,0);for(let d=0;d<i-1;++d)if(l=c,c=gn(n,d+1),!(!l||!c)){if(An(t[d],0,Al)){e[d]=e[d+1]=0;continue}o=e[d]/t[d],s=e[d+1]/t[d],r=Math.pow(o,2)+Math.pow(s,2),!(r<=9)&&(a=3/Math.sqrt(r),e[d]=o*a*t[d],e[d+1]=s*a*t[d])}}function Ol(n,t,e="x"){const i=Oa(e),o=n.length;let s,a,r,l=gn(n,0);for(let c=0;c<o;++c){if(a=r,r=l,l=gn(n,c+1),!r)continue;const d=r[e],u=r[i];a&&(s=(d-a[e])/3,r["cp1".concat(e)]=d-s,r["cp1".concat(i)]=u-s*t[c]),l&&(s=(l[e]-d)/3,r["cp2".concat(e)]=d+s,r["cp2".concat(i)]=u+s*t[c])}}function Fl(n,t="x"){const e=Oa(t),i=n.length,o=Array(i).fill(0),s=Array(i);let a,r,l,c=gn(n,0);for(a=0;a<i;++a)if(r=l,l=c,c=gn(n,a+1),!!l){if(c){const d=c[t]-l[t];o[a]=d!==0?(c[e]-l[e])/d:0}s[a]=r?c?Ie(o[a-1])!==Ie(o[a])?0:(o[a-1]+o[a])/2:o[a-1]:o[a]}Ll(n,o,s),Ol(n,s,t)}function Jn(n,t,e){return Math.max(Math.min(n,e),t)}function Nl(n,t){let e,i,o,s,a,r=Ne(n[0],t);for(e=0,i=n.length;e<i;++e)a=s,s=r,r=e<i-1&&Ne(n[e+1],t),s&&(o=n[e],a&&(o.cp1x=Jn(o.cp1x,t.left,t.right),o.cp1y=Jn(o.cp1y,t.top,t.bottom)),r&&(o.cp2x=Jn(o.cp2x,t.left,t.right),o.cp2y=Jn(o.cp2y,t.top,t.bottom)))}function Rl(n,t,e,i,o){let s,a,r,l;if(t.spanGaps&&(n=n.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")Fl(n,o);else{let c=i?n[n.length-1]:n[0];for(s=0,a=n.length;s<a;++s)r=n[s],l=Bl(c,r,n[Math.min(s+1,a-(i?0:1))%a],t.tension),r.cp1x=l.previous.x,r.cp1y=l.previous.y,r.cp2x=l.next.x,r.cp2y=l.next.y,c=r}t.capBezierPoints&&Nl(n,e)}function Ro(){return typeof window<"u"&&typeof document<"u"}function Vo(n){let t=n.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function ki(n,t,e){let i;return typeof n=="string"?(i=parseInt(n,10),n.indexOf("%")!==-1&&(i=i/100*t.parentNode[e])):i=n,i}const Fi=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function Vl(n,t){return Fi(n).getPropertyValue(t)}const zl=["top","right","bottom","left"];function rn(n,t,e){const i={};e=e?"-"+e:"";for(let o=0;o<4;o++){const s=zl[o];i[s]=parseFloat(n[t+"-"+s+e])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const Ul=(n,t,e)=>(n>0||t>0)&&(!e||!e.shadowRoot);function Hl(n,t){const e=n.touches,i=e&&e.length?e[0]:n,{offsetX:o,offsetY:s}=i;let a=!1,r,l;if(Ul(o,s,n.target))r=o,l=s;else{const c=t.getBoundingClientRect();r=i.clientX-c.left,l=i.clientY-c.top,a=!0}return{x:r,y:l,box:a}}function nn(n,t){if("native"in n)return n;const{canvas:e,currentDevicePixelRatio:i}=t,o=Fi(e),s=o.boxSizing==="border-box",a=rn(o,"padding"),r=rn(o,"border","width"),{x:l,y:c,box:d}=Hl(n,e),u=a.left+(d&&r.left),f=a.top+(d&&r.top);let{width:h,height:w}=t;return s&&(h-=a.width+r.width,w-=a.height+r.height),{x:Math.round((l-u)/h*e.width/i),y:Math.round((c-f)/w*e.height/i)}}function jl(n,t,e){let i,o;if(t===void 0||e===void 0){const s=n&&Vo(n);if(!s)t=n.clientWidth,e=n.clientHeight;else{const a=s.getBoundingClientRect(),r=Fi(s),l=rn(r,"border","width"),c=rn(r,"padding");t=a.width-c.width-l.width,e=a.height-c.height-l.height,i=ki(r.maxWidth,s,"clientWidth"),o=ki(r.maxHeight,s,"clientHeight")}}return{width:t,height:e,maxWidth:i||Ci,maxHeight:o||Ci}}const Zn=n=>Math.round(n*10)/10;function Wl(n,t,e,i){const o=Fi(n),s=rn(o,"margin"),a=ki(o.maxWidth,n,"clientWidth")||Ci,r=ki(o.maxHeight,n,"clientHeight")||Ci,l=jl(n,t,e);let{width:c,height:d}=l;if(o.boxSizing==="content-box"){const f=rn(o,"border","width"),h=rn(o,"padding");c-=h.width+f.width,d-=h.height+f.height}return c=Math.max(0,c-s.width),d=Math.max(0,i?c/i:d-s.height),c=Zn(Math.min(c,a,l.maxWidth)),d=Zn(Math.min(d,r,l.maxHeight)),c&&!d&&(d=Zn(c/2)),(t!==void 0||e!==void 0)&&i&&l.height&&d>l.height&&(d=l.height,c=Zn(Math.floor(d*i))),{width:c,height:d}}function as(n,t,e){const i=t||1,o=Math.floor(n.height*i),s=Math.floor(n.width*i);n.height=Math.floor(n.height),n.width=Math.floor(n.width);const a=n.canvas;return a.style&&(e||!a.style.height&&!a.style.width)&&(a.style.height="".concat(n.height,"px"),a.style.width="".concat(n.width,"px")),n.currentDevicePixelRatio!==i||a.height!==o||a.width!==s?(n.currentDevicePixelRatio=i,a.height=o,a.width=s,n.ctx.setTransform(i,0,0,i,0,0),!0):!1}const Yl=(function(){let n=!1;try{const t={get passive(){return n=!0,!1}};Ro()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch(t){}return n})();function rs(n,t){const e=Vl(n,t),i=e&&e.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function on(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:n.y+e*(t.y-n.y)}}function $l(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:i==="middle"?e<.5?n.y:t.y:i==="after"?e<1?n.y:t.y:e>0?t.y:n.y}}function ql(n,t,e,i){const o={x:n.cp2x,y:n.cp2y},s={x:t.cp1x,y:t.cp1y},a=on(n,o,e),r=on(o,s,e),l=on(s,t,e),c=on(a,r,e),d=on(r,l,e);return on(c,d,e)}const Gl=function(n,t){return{x(e){return n+n+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,i){return e-i},leftForLtr(e,i){return e-i}}},Xl=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,t){return n+t},leftForLtr(n,t){return n}}};function hn(n,t,e){return n?Gl(t,e):Xl()}function Fa(n,t){let e,i;(t==="ltr"||t==="rtl")&&(e=n.canvas.style,i=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),n.prevTextDirection=i)}function Na(n,t){t!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",t[0],t[1]))}function Ra(n){return n==="angle"?{between:zn,compare:Kr,normalize:re}:{between:Oe,compare:(t,e)=>t-e,normalize:t=>t}}function ls({start:n,end:t,count:e,loop:i,style:o}){return{start:n%e,end:t%e,loop:i&&(t-n+1)%e===0,style:o}}function Kl(n,t,e){const{property:i,start:o,end:s}=e,{between:a,normalize:r}=Ra(i),l=t.length;let{start:c,end:d,loop:u}=n,f,h;if(u){for(c+=l,d+=l,f=0,h=l;f<h&&a(r(t[c%l][i]),o,s);++f)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:u,style:n.style}}function Va(n,t,e){if(!e)return[n];const{property:i,start:o,end:s}=e,a=t.length,{compare:r,between:l,normalize:c}=Ra(i),{start:d,end:u,loop:f,style:h}=Kl(n,t,e),w=[];let _=!1,S=null,F,R,tt;const rt=()=>l(o,tt,F)&&r(o,tt)!==0,b=()=>r(s,F)===0||l(s,tt,F),D=()=>_||rt(),N=()=>!_||b();for(let A=d,U=d;A<=u;++A)R=t[A%a],!R.skip&&(F=c(R[i]),F!==tt&&(_=l(F,o,s),S===null&&D()&&(S=r(F,o)===0?A:U),S!==null&&N()&&(w.push(ls({start:S,end:A,loop:f,count:a,style:h})),S=null),U=A,tt=F));return S!==null&&w.push(ls({start:S,end:u,loop:f,count:a,style:h})),w}function za(n,t){const e=[],i=n.segments;for(let o=0;o<i.length;o++){const s=Va(i[o],n.points,t);s.length&&e.push(...s)}return e}function Jl(n,t,e,i){let o=0,s=t-1;if(e&&!i)for(;o<t&&!n[o].skip;)o++;for(;o<t&&n[o].skip;)o++;for(o%=t,e&&(s+=o);s>o&&n[s%t].skip;)s--;return s%=t,{start:o,end:s}}function Zl(n,t,e,i){const o=n.length,s=[];let a=t,r=n[t],l;for(l=t+1;l<=e;++l){const c=n[l%o];c.skip||c.stop?r.skip||(i=!1,s.push({start:t%o,end:(l-1)%o,loop:i}),t=a=c.stop?l:null):(a=l,r.skip&&(t=l)),r=c}return a!==null&&s.push({start:t%o,end:a%o,loop:i}),s}function Ql(n,t){const e=n.points,i=n.options.spanGaps,o=e.length;if(!o)return[];const s=!!n._loop,{start:a,end:r}=Jl(e,o,s,i);if(i===!0)return cs(n,[{start:a,end:r,loop:s}],e,t);const l=r<a?r+o:r,c=!!n._fullLoop&&a===0&&r===o-1;return cs(n,Zl(e,a,l,c),e,t)}function cs(n,t,e,i){return!i||!i.setContext||!e?t:tc(n,t,e,i)}function tc(n,t,e,i){const o=n._chart.getContext(),s=ds(n.options),{_datasetIndex:a,options:{spanGaps:r}}=n,l=e.length,c=[];let d=s,u=t[0].start,f=u;function h(w,_,S,F){const R=r?-1:1;if(w!==_){for(w+=l;e[w%l].skip;)w-=R;for(;e[_%l].skip;)_+=R;w%l!==_%l&&(c.push({start:w%l,end:_%l,loop:S,style:F}),d=F,u=_%l)}}for(const w of t){u=r?u:w.start;let _=e[u%l],S;for(f=u+1;f<=w.end;f++){const F=e[f%l];S=ds(i.setContext(Ge(o,{type:"segment",p0:_,p1:F,p0DataIndex:(f-1)%l,p1DataIndex:f%l,datasetIndex:a}))),ec(S,d)&&h(u,f-1,w.loop,d),_=F,d=S}u<f-1&&h(u,f-1,w.loop,d)}return c}function ds(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function ec(n,t){if(!t)return!1;const e=[],i=function(o,s){return Bo(s)?(e.includes(s)||e.push(s),e.indexOf(s)):s};return JSON.stringify(n,i)!==JSON.stringify(t,i)}function Qn(n,t,e){return n.options.clip?n[e]:t[e]}function nc(n,t){const{xScale:e,yScale:i}=n;return e&&i?{left:Qn(e,t,"left"),right:Qn(e,t,"right"),top:Qn(i,t,"top"),bottom:Qn(i,t,"bottom")}:t}function Ua(n,t){const e=t._clip;if(e.disabled)return!1;const i=nc(t,n.chartArea);return{left:e.left===!1?0:i.left-(e.left===!0?0:e.left),right:e.right===!1?n.width:i.right+(e.right===!0?0:e.right),top:e.top===!1?0:i.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?n.height:i.bottom+(e.bottom===!0?0:e.bottom)}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class ic{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,o){const s=e.listeners[o],a=e.duration;s.forEach(r=>r({chart:t,initial:e.initial,numSteps:a,currentStep:Math.min(i-e.start,a)}))}_refresh(){this._request||(this._running=!0,this._request=Sa.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((i,o)=>{if(!i.running||!i.items.length)return;const s=i.items;let a=s.length-1,r=!1,l;for(;a>=0;--a)l=s[a],l._active?(l._total>i.duration&&(i.duration=l._total),l.tick(t),r=!0):(s[a]=s[s.length-1],s.pop());r&&(o.draw(),this._notify(o,i,t,"progress")),s.length||(i.running=!1,this._notify(o,i,t,"complete"),i.initial=!1),e+=s.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((i,o)=>Math.max(i,o._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let o=i.length-1;for(;o>=0;--o)i[o].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Pe=new ic;const us="transparent",oc={boolean(n,t,e){return e>.5?t:n},color(n,t,e){const i=es(n||us),o=i.valid&&es(t||us);return o&&o.valid?o.mix(i,e).hexString():t},number(n,t,e){return n+(t-n)*e}};class sc{constructor(t,e,i,o){const s=e[i];o=kn([t.to,o,s,t.from]);const a=kn([t.from,s,o]);this._active=!0,this._fn=t.fn||oc[t.type||typeof a],this._easing=Bn[t.easing]||Bn.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=a,this._to=o,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const o=this._target[this._prop],s=i-this._start,a=this._duration-s;this._start=i,this._duration=Math.floor(Math.max(a,t.duration)),this._total+=s,this._loop=!!t.loop,this._to=kn([t.to,e,o,t.from]),this._from=kn([t.from,o,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,o=this._prop,s=this._from,a=this._loop,r=this._to;let l;if(this._active=s!==r&&(a||e<i),!this._active){this._target[o]=r,this._notify(!0);return}if(e<0){this._target[o]=s;return}l=e/i%2,l=a&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[o]=this._fn(s,r,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,i)=>{t.push({res:e,rej:i})})}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let o=0;o<i.length;o++)i[o][e]()}}class Ha{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!At(t))return;const e=Object.keys(jt.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(o=>{const s=t[o];if(!At(s))return;const a={};for(const r of e)a[r]=s[r];(Ht(s.properties)&&s.properties||[o]).forEach(r=>{(r===o||!i.has(r))&&i.set(r,a)})})}_animateOptions(t,e){const i=e.options,o=rc(t,i);if(!o)return[];const s=this._createAnimations(o,i);return i.$shared&&ac(t.options.$animations,i).then(()=>{t.options=i},()=>{}),s}_createAnimations(t,e){const i=this._properties,o=[],s=t.$animations||(t.$animations={}),a=Object.keys(e),r=Date.now();let l;for(l=a.length-1;l>=0;--l){const c=a[l];if(c.charAt(0)==="$")continue;if(c==="options"){o.push(...this._animateOptions(t,e));continue}const d=e[c];let u=s[c];const f=i.get(c);if(u)if(f&&u.active()){u.update(f,d,r);continue}else u.cancel();if(!f||!f.duration){t[c]=d;continue}s[c]=u=new sc(f,t,c,d),o.push(u)}return o}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const i=this._createAnimations(t,e);if(i.length)return Pe.add(this._chart,i),!0}}function ac(n,t){const e=[],i=Object.keys(t);for(let o=0;o<i.length;o++){const s=n[i[o]];s&&s.active()&&e.push(s.wait())}return Promise.all(e)}function rc(n,t){if(!t)return;let e=n.options;if(!e){n.options=t;return}return e.$shared&&(n.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function fs(n,t){const e=n&&n.options||{},i=e.reverse,o=e.min===void 0?t:0,s=e.max===void 0?t:0;return{start:i?s:o,end:i?o:s}}function lc(n,t,e){if(e===!1)return!1;const i=fs(n,e),o=fs(t,e);return{top:o.end,right:i.end,bottom:o.start,left:i.start}}function cc(n){let t,e,i,o;return At(n)?(t=n.top,e=n.right,i=n.bottom,o=n.left):t=e=i=o=n,{top:t,right:e,bottom:i,left:o,disabled:n===!1}}function ja(n,t){const e=[],i=n._getSortedDatasetMetas(t);let o,s;for(o=0,s=i.length;o<s;++o)e.push(i[o].index);return e}function hs(n,t,e,i={}){const o=n.keys,s=i.mode==="single";let a,r,l,c;if(t===null)return;let d=!1;for(a=0,r=o.length;a<r;++a){if(l=+o[a],l===e){if(d=!0,i.all)continue;break}c=n.values[l],qt(c)&&(s||t===0||Ie(t)===Ie(c))&&(t+=c)}return!d&&!i.all?0:t}function dc(n,t){const{iScale:e,vScale:i}=t,o=e.axis==="x"?"x":"y",s=i.axis==="x"?"x":"y",a=Object.keys(n),r=new Array(a.length);let l,c,d;for(l=0,c=a.length;l<c;++l)d=a[l],r[l]={[o]:d,[s]:n[d]};return r}function $i(n,t){const e=n&&n.options.stacked;return e||e===void 0&&t.stack!==void 0}function uc(n,t,e){return"".concat(n.id,".").concat(t.id,".").concat(e.stack||e.type)}function fc(n){const{min:t,max:e,minDefined:i,maxDefined:o}=n.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:o?e:Number.POSITIVE_INFINITY}}function hc(n,t,e){const i=n[t]||(n[t]={});return i[e]||(i[e]={})}function ps(n,t,e,i){for(const o of t.getMatchingVisibleMetas(i).reverse()){const s=n[o.index];if(e&&s>0||!e&&s<0)return o.index}return null}function ms(n,t){const{chart:e,_cachedMeta:i}=n,o=e._stacks||(e._stacks={}),{iScale:s,vScale:a,index:r}=i,l=s.axis,c=a.axis,d=uc(s,a,i),u=t.length;let f;for(let h=0;h<u;++h){const w=t[h],{[l]:_,[c]:S}=w,F=w._stacks||(w._stacks={});f=F[c]=hc(o,d,_),f[r]=S,f._top=ps(f,a,!0,i.type),f._bottom=ps(f,a,!1,i.type);const R=f._visualValues||(f._visualValues={});R[r]=S}}function qi(n,t){const e=n.scales;return Object.keys(e).filter(i=>e[i].axis===t).shift()}function pc(n,t){return Ge(n,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function mc(n,t,e){return Ge(n,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function wn(n,t){const e=n.controller.index,i=n.vScale&&n.vScale.axis;if(i){t=t||n._parsed;for(const o of t){const s=o._stacks;if(!s||s[i]===void 0||s[i][e]===void 0)return;delete s[i][e],s[i]._visualValues!==void 0&&s[i]._visualValues[e]!==void 0&&delete s[i]._visualValues[e]}}}const Gi=n=>n==="reset"||n==="none",gs=(n,t)=>t?n:Object.assign({},n),gc=(n,t,e)=>n&&!t.hidden&&t._stacked&&{keys:ja(e,!0),values:null};class xe{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=$i(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&wn(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),o=(u,f,h,w)=>u==="x"?f:u==="r"?w:h,s=e.xAxisID=Dt(i.xAxisID,qi(t,"x")),a=e.yAxisID=Dt(i.yAxisID,qi(t,"y")),r=e.rAxisID=Dt(i.rAxisID,qi(t,"r")),l=e.indexAxis,c=e.iAxisID=o(l,s,a,r),d=e.vAxisID=o(l,a,s,r);e.xScale=this.getScaleForId(s),e.yScale=this.getScaleForId(a),e.rScale=this.getScaleForId(r),e.iScale=this.getScaleForId(c),e.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Zo(this._data,this),t._stacked&&wn(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(At(e)){const o=this._cachedMeta;this._data=dc(e,o)}else if(i!==e){if(i){Zo(i,this);const o=this._cachedMeta;wn(o),o._parsed=[]}e&&Object.isExtensible(e)&&tl(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let o=!1;this._dataCheck();const s=e._stacked;e._stacked=$i(e.vScale,e),e.stack!==i.stack&&(o=!0,wn(e),e.stack=i.stack),this._resyncElements(t),(o||s!==e._stacked)&&(ms(this,e._parsed),e._stacked=$i(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:o}=this,{iScale:s,_stacked:a}=i,r=s.axis;let l=t===0&&e===o.length?!0:i._sorted,c=t>0&&i._parsed[t-1],d,u,f;if(this._parsing===!1)i._parsed=o,i._sorted=!0,f=o;else{Ht(o[t])?f=this.parseArrayData(i,o,t,e):At(o[t])?f=this.parseObjectData(i,o,t,e):f=this.parsePrimitiveData(i,o,t,e);const h=()=>u[r]===null||c&&u[r]<c[r];for(d=0;d<e;++d)i._parsed[d+t]=u=f[d],l&&(h()&&(l=!1),c=u);i._sorted=l}a&&ms(this,f)}parsePrimitiveData(t,e,i,o){const{iScale:s,vScale:a}=t,r=s.axis,l=a.axis,c=s.getLabels(),d=s===a,u=new Array(o);let f,h,w;for(f=0,h=o;f<h;++f)w=f+i,u[f]={[r]:d||s.parse(c[w],w),[l]:a.parse(e[w],w)};return u}parseArrayData(t,e,i,o){const{xScale:s,yScale:a}=t,r=new Array(o);let l,c,d,u;for(l=0,c=o;l<c;++l)d=l+i,u=e[d],r[l]={x:s.parse(u[0],d),y:a.parse(u[1],d)};return r}parseObjectData(t,e,i,o){const{xScale:s,yScale:a}=t,{xAxisKey:r="x",yAxisKey:l="y"}=this._parsing,c=new Array(o);let d,u,f,h;for(d=0,u=o;d<u;++d)f=d+i,h=e[f],c[d]={x:s.parse($e(h,r),f),y:a.parse($e(h,l),f)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const o=this.chart,s=this._cachedMeta,a=e[t.axis],r={keys:ja(o,!0),values:e._stacks[t.axis]._visualValues};return hs(r,a,s.index,{mode:i})}updateRangeFromParsed(t,e,i,o){const s=i[e.axis];let a=s===null?NaN:s;const r=o&&i._stacks[e.axis];o&&r&&(o.values=r,a=hs(o,s,this._cachedMeta.index)),t.min=Math.min(t.min,a),t.max=Math.max(t.max,a)}getMinMax(t,e){const i=this._cachedMeta,o=i._parsed,s=i._sorted&&t===i.iScale,a=o.length,r=this._getOtherScale(t),l=gc(e,i,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:u}=fc(r);let f,h;function w(){h=o[f];const _=h[r.axis];return!qt(h[t.axis])||d>_||u<_}for(f=0;f<a&&!(!w()&&(this.updateRangeFromParsed(c,t,h,l),s));++f);if(s){for(f=a-1;f>=0;--f)if(!w()){this.updateRangeFromParsed(c,t,h,l);break}}return c}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let o,s,a;for(o=0,s=e.length;o<s;++o)a=e[o][t.axis],qt(a)&&i.push(a);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,o=e.vScale,s=this.getParsed(t);return{label:i?""+i.getLabelForValue(s[i.axis]):"",value:o?""+o.getLabelForValue(s[o.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=cc(Dt(this.options.clip,lc(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,o=i.data||[],s=e.chartArea,a=[],r=this._drawStart||0,l=this._drawCount||o.length-r,c=this.options.drawActiveElementsOnTop;let d;for(i.dataset&&i.dataset.draw(t,s,r,l),d=r;d<r+l;++d){const u=o[d];u.hidden||(u.active&&c?a.push(u):u.draw(t,s))}for(d=0;d<a.length;++d)a[d].draw(t,s)}getStyle(t,e){const i=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const o=this.getDataset();let s;if(t>=0&&t<this._cachedMeta.data.length){const a=this._cachedMeta.data[t];s=a.$context||(a.$context=mc(this.getContext(),t,a)),s.parsed=this.getParsed(t),s.raw=o.data[t],s.index=s.dataIndex=t}else s=this.$context||(this.$context=pc(this.chart.getContext(),this.index)),s.dataset=o,s.index=s.datasetIndex=this.index;return s.active=!!e,s.mode=i,s}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const o=e==="active",s=this._cachedDataOpts,a=t+"-"+e,r=s[a],l=this.enableOptionSharing&&Vn(i);if(r)return gs(r,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,t),u=o?["".concat(t,"Hover"),"hover",t,""]:[t,""],f=c.getOptionScopes(this.getDataset(),d),h=Object.keys(jt.elements[t]),w=()=>this.getContext(i,o,e),_=c.resolveNamedOptions(f,h,w,u);return _.$shared&&(_.$shared=l,s[a]=Object.freeze(gs(_,l))),_}_resolveAnimations(t,e,i){const o=this.chart,s=this._cachedDataOpts,a="animation-".concat(e),r=s[a];if(r)return r;let l;if(o.options.animation!==!1){const d=this.chart.config,u=d.datasetAnimationScopeKeys(this._type,e),f=d.getOptionScopes(this.getDataset(),u);l=d.createResolver(f,this.getContext(t,i,e))}const c=new Ha(o,l&&l.animations);return l&&l._cacheable&&(s[a]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||Gi(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),o=this._sharedOptions,s=this.getSharedOptions(i),a=this.includeOptions(e,s)||s!==o;return this.updateSharedOptions(s,e,i),{sharedOptions:s,includeOptions:a}}updateElement(t,e,i,o){Gi(o)?Object.assign(t,i):this._resolveAnimations(e,o).update(t,i)}updateSharedOptions(t,e,i){t&&!Gi(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,o){t.active=o;const s=this.getStyle(e,o);this._resolveAnimations(e,i,o).update(t,{options:!o&&this.getSharedOptions(s)||s})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[r,l,c]of this._syncList)this[r](l,c);this._syncList=[];const o=i.length,s=e.length,a=Math.min(s,o);a&&this.parse(0,a),s>o?this._insertElements(o,s-o,t):s<o&&this._removeElements(s,o-s)}_insertElements(t,e,i=!0){const o=this._cachedMeta,s=o.data,a=t+e;let r;const l=c=>{for(c.length+=e,r=c.length-1;r>=a;r--)c[r]=c[r-e]};for(l(s),r=t;r<a;++r)s[r]=new this.dataElementType;this._parsing&&l(o._parsed),this.parse(t,e),i&&this.updateElements(s,t,e,"reset")}updateElements(t,e,i,o){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const o=i._parsed.splice(t,e);i._stacked&&wn(i,o)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,o]=t;this[e](i,o)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}mt(xe,"defaults",{}),mt(xe,"datasetElementType",null),mt(xe,"dataElementType",null);function vc(n,t){if(!n._cache.$bar){const e=n.getMatchingVisibleMetas(t);let i=[];for(let o=0,s=e.length;o<s;o++)i=i.concat(e[o].controller.getAllParsedValues(n));n._cache.$bar=xa(i.sort((o,s)=>o-s))}return n._cache.$bar}function bc(n){const t=n.iScale,e=vc(t,n.type);let i=t._length,o,s,a,r;const l=()=>{a===32767||a===-32768||(Vn(r)&&(i=Math.min(i,Math.abs(a-r)||i)),r=a)};for(o=0,s=e.length;o<s;++o)a=t.getPixelForValue(e[o]),l();for(r=void 0,o=0,s=t.ticks.length;o<s;++o)a=t.getPixelForTick(o),l();return i}function yc(n,t,e,i){const o=e.barThickness;let s,a;return Tt(o)?(s=t.min*e.categoryPercentage,a=e.barPercentage):(s=o*i,a=1),{chunk:s/i,ratio:a,start:t.pixels[n]-s/2}}function wc(n,t,e,i){const o=t.pixels,s=o[n];let a=n>0?o[n-1]:null,r=n<o.length-1?o[n+1]:null;const l=e.categoryPercentage;a===null&&(a=s-(r===null?t.end-t.start:r-s)),r===null&&(r=s+s-a);const c=s-(s-Math.min(a,r))/2*l;return{chunk:Math.abs(r-a)/2*l/i,ratio:e.barPercentage,start:c}}function _c(n,t,e,i){const o=e.parse(n[0],i),s=e.parse(n[1],i),a=Math.min(o,s),r=Math.max(o,s);let l=a,c=r;Math.abs(a)>Math.abs(r)&&(l=r,c=a),t[e.axis]=c,t._custom={barStart:l,barEnd:c,start:o,end:s,min:a,max:r}}function Wa(n,t,e,i){return Ht(n)?_c(n,t,e,i):t[e.axis]=e.parse(n,i),t}function vs(n,t,e,i){const o=n.iScale,s=n.vScale,a=o.getLabels(),r=o===s,l=[];let c,d,u,f;for(c=e,d=e+i;c<d;++c)f=t[c],u={},u[o.axis]=r||o.parse(a[c],c),l.push(Wa(f,u,s,c));return l}function Xi(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function xc(n,t,e){return n!==0?Ie(n):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function Sc(n){let t,e,i,o,s;return n.horizontal?(t=n.base>n.x,e="left",i="right"):(t=n.base<n.y,e="bottom",i="top"),t?(o="end",s="start"):(o="start",s="end"),{start:e,end:i,reverse:t,top:o,bottom:s}}function Cc(n,t,e,i){let o=t.borderSkipped;const s={};if(!o){n.borderSkipped=s;return}if(o===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:a,end:r,reverse:l,top:c,bottom:d}=Sc(n);o==="middle"&&e&&(n.enableBorderRadius=!0,(e._top||0)===i?o=c:(e._bottom||0)===i?o=d:(s[bs(d,a,r,l)]=!0,o=c)),s[bs(o,a,r,l)]=!0,n.borderSkipped=s}function bs(n,t,e,i){return i?(n=Dc(n,t,e),n=ys(n,e,t)):n=ys(n,t,e),n}function Dc(n,t,e){return n===t?e:n===e?t:n}function ys(n,t,e){return n==="start"?t:n==="end"?e:n}function kc(n,{inflateAmount:t},e){n.inflateAmount=t==="auto"?e===1?.33:0:t}class di extends xe{parsePrimitiveData(t,e,i,o){return vs(t,e,i,o)}parseArrayData(t,e,i,o){return vs(t,e,i,o)}parseObjectData(t,e,i,o){const{iScale:s,vScale:a}=t,{xAxisKey:r="x",yAxisKey:l="y"}=this._parsing,c=s.axis==="x"?r:l,d=a.axis==="x"?r:l,u=[];let f,h,w,_;for(f=i,h=i+o;f<h;++f)_=e[f],w={},w[s.axis]=s.parse($e(_,c),f),u.push(Wa($e(_,d),w,a,f));return u}updateRangeFromParsed(t,e,i,o){super.updateRangeFromParsed(t,e,i,o);const s=i._custom;s&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,s.min),t.max=Math.max(t.max,s.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:o}=e,s=this.getParsed(t),a=s._custom,r=Xi(a)?"["+a.start+", "+a.end+"]":""+o.getLabelForValue(s[o.axis]);return{label:""+i.getLabelForValue(s[i.axis]),value:r}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,i,o){const s=o==="reset",{index:a,_cachedMeta:{vScale:r}}=this,l=r.getBasePixel(),c=r.isHorizontal(),d=this._getRuler(),{sharedOptions:u,includeOptions:f}=this._getSharedOptions(e,o);for(let h=e;h<e+i;h++){const w=this.getParsed(h),_=s||Tt(w[r.axis])?{base:l,head:l}:this._calculateBarValuePixels(h),S=this._calculateBarIndexPixels(h,d),F=(w._stacks||{})[r.axis],R={horizontal:c,base:_.base,enableBorderRadius:!F||Xi(w._custom)||a===F._top||a===F._bottom,x:c?_.head:S.center,y:c?S.center:_.head,height:c?S.size:Math.abs(_.size),width:c?Math.abs(_.size):S.size};f&&(R.options=u||this.resolveDataElementOptions(h,t[h].active?"active":o));const tt=R.options||t[h].options;Cc(R,tt,F,a),kc(R,tt,d.ratio),this.updateElement(t[h],h,R,o)}}_getStacks(t,e){const{iScale:i}=this._cachedMeta,o=i.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),s=i.options.stacked,a=[],r=this._cachedMeta.controller.getParsed(e),l=r&&r[i.axis],c=d=>{const u=d._parsed.find(h=>h[i.axis]===l),f=u&&u[d.vScale.axis];if(Tt(f)||isNaN(f))return!0};for(const d of o)if(!(e!==void 0&&c(d))&&((s===!1||a.indexOf(d.stack)===-1||s===void 0&&d.stack===void 0)&&a.push(d.stack),d.index===t))break;return a.length||a.push(void 0),a}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(i=>t[i].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[Dt(this.chart.options.indexAxis==="x"?i.xAxisID:i.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,i){const o=this._getStacks(t,i),s=e!==void 0?o.indexOf(e):-1;return s===-1?o.length-1:s}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,o=[];let s,a;for(s=0,a=e.data.length;s<a;++s)o.push(i.getPixelForValue(this.getParsed(s)[i.axis],s));const r=t.barThickness;return{min:r||bc(e),pixels:o,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:r?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:i,index:o},options:{base:s,minBarLength:a}}=this,r=s||0,l=this.getParsed(t),c=l._custom,d=Xi(c);let u=l[e.axis],f=0,h=i?this.applyStack(e,l,i):u,w,_;h!==u&&(f=h-u,h=u),d&&(u=c.barStart,h=c.barEnd-c.barStart,u!==0&&Ie(u)!==Ie(c.barEnd)&&(f=0),f+=u);const S=!Tt(s)&&!d?s:f;let F=e.getPixelForValue(S);if(this.chart.getDataVisibility(t)?w=e.getPixelForValue(f+h):w=F,_=w-F,Math.abs(_)<a){_=xc(_,e,r)*a,u===r&&(F-=_/2);const R=e.getPixelForDecimal(0),tt=e.getPixelForDecimal(1),rt=Math.min(R,tt),b=Math.max(R,tt);F=Math.max(Math.min(F,b),rt),w=F+_,i&&!d&&(l._stacks[e.axis]._visualValues[o]=e.getValueForPixel(w)-e.getValueForPixel(F))}if(F===e.getPixelForValue(r)){const R=Ie(_)*e.getLineWidthForValue(r)/2;F+=R,_-=R}return{size:_,base:F,head:w,center:w+_/2}}_calculateBarIndexPixels(t,e){const i=e.scale,o=this.options,s=o.skipNull,a=Dt(o.maxBarThickness,1/0);let r,l;const c=this._getAxisCount();if(e.grouped){const d=s?this._getStackCount(t):e.stackCount,u=o.barThickness==="flex"?wc(t,e,o,d*c):yc(t,e,o,d*c),f=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,h=this._getAxis().indexOf(Dt(f,this.getFirstScaleIdForIndexAxis())),w=this._getStackIndex(this.index,this._cachedMeta.stack,s?t:void 0)+h;r=u.start+u.chunk*w+u.chunk/2,l=Math.min(a,u.chunk*u.ratio)}else r=i.getPixelForValue(this.getParsed(t)[i.axis],t),l=Math.min(a,e.min*e.ratio);return{base:r-l/2,head:r+l/2,center:r,size:l}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,o=i.length;let s=0;for(;s<o;++s)this.getParsed(s)[e.axis]!==null&&!i[s].hidden&&i[s].draw(this._ctx)}}mt(di,"id","bar"),mt(di,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),mt(di,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class ui extends xe{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,o){const s=super.parsePrimitiveData(t,e,i,o);for(let a=0;a<s.length;a++)s[a]._custom=this.resolveDataElementOptions(a+i).radius;return s}parseArrayData(t,e,i,o){const s=super.parseArrayData(t,e,i,o);for(let a=0;a<s.length;a++){const r=e[i+a];s[a]._custom=Dt(r[2],this.resolveDataElementOptions(a+i).radius)}return s}parseObjectData(t,e,i,o){const s=super.parseObjectData(t,e,i,o);for(let a=0;a<s.length;a++){const r=e[i+a];s[a]._custom=Dt(r&&r.r&&+r.r,this.resolveDataElementOptions(a+i).radius)}return s}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:o,yScale:s}=e,a=this.getParsed(t),r=o.getLabelForValue(a.x),l=s.getLabelForValue(a.y),c=a._custom;return{label:i[t]||"",value:"("+r+", "+l+(c?", "+c:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,o){const s=o==="reset",{iScale:a,vScale:r}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(e,o),d=a.axis,u=r.axis;for(let f=e;f<e+i;f++){const h=t[f],w=!s&&this.getParsed(f),_={},S=_[d]=s?a.getPixelForDecimal(.5):a.getPixelForValue(w[d]),F=_[u]=s?r.getBasePixel():r.getPixelForValue(w[u]);_.skip=isNaN(S)||isNaN(F),c&&(_.options=l||this.resolveDataElementOptions(f,h.active?"active":o),s&&(_.options.radius=0)),this.updateElement(h,f,_,o)}}resolveDataElementOptions(t,e){const i=this.getParsed(t);let o=super.resolveDataElementOptions(t,e);o.$shared&&(o=Object.assign({},o,{$shared:!1}));const s=o.radius;return e!=="active"&&(o.radius=0),o.radius+=Dt(i&&i._custom,s),o}}mt(ui,"id","bubble"),mt(ui,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),mt(ui,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function Ic(n,t,e){let i=1,o=1,s=0,a=0;if(t<zt){const r=n,l=r+t,c=Math.cos(r),d=Math.sin(r),u=Math.cos(l),f=Math.sin(l),h=(tt,rt,b)=>zn(tt,r,l,!0)?1:Math.max(rt,rt*e,b,b*e),w=(tt,rt,b)=>zn(tt,r,l,!0)?-1:Math.min(rt,rt*e,b,b*e),_=h(0,c,u),S=h(Xt,d,f),F=w(Ot,c,u),R=w(Ot+Xt,d,f);i=(_-F)/2,o=(S-R)/2,s=-(_+F)/2,a=-(S+R)/2}return{ratioX:i,ratioY:o,offsetX:s,offsetY:a}}class sn extends xe{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,o=this._cachedMeta;if(this._parsing===!1)o._parsed=i;else{let s=l=>+i[l];if(At(i[t])){const{key:l="value"}=this._parsing;s=c=>+$e(i[c],l)}let a,r;for(a=t,r=t+e;a<r;++a)o._parsed[a]=s(a)}}_getRotation(){return _e(this.options.rotation-90)}_getCircumference(){return _e(this.options.circumference)}_getRotationExtents(){let t=zt,e=-zt;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const o=this.chart.getDatasetMeta(i).controller,s=o._getRotation(),a=o._getCircumference();t=Math.min(t,s),e=Math.max(e,s+a)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,o=this._cachedMeta,s=o.data,a=this.getMaxBorderWidth()+this.getMaxOffset(s)+this.options.spacing,r=Math.max((Math.min(i.width,i.height)-a)/2,0),l=Math.min(Vr(this.options.cutout,r),1),c=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:f,ratioY:h,offsetX:w,offsetY:_}=Ic(u,d,l),S=(i.width-a)/f,F=(i.height-a)/h,R=Math.max(Math.min(S,F)/2,0),tt=va(this.options.radius,R),rt=Math.max(tt*l,0),b=(tt-rt)/this._getVisibleDatasetWeightTotal();this.offsetX=w*tt,this.offsetY=_*tt,o.total=this.calculateTotal(),this.outerRadius=tt-b*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-b*c,0),this.updateElements(s,0,s.length,t)}_circumference(t,e){const i=this.options,o=this._cachedMeta,s=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||o._parsed[t]===null||o.data[t].hidden?0:this.calculateCircumference(o._parsed[t]*s/zt)}updateElements(t,e,i,o){const s=o==="reset",a=this.chart,r=a.chartArea,c=a.options.animation,d=(r.left+r.right)/2,u=(r.top+r.bottom)/2,f=s&&c.animateScale,h=f?0:this.innerRadius,w=f?0:this.outerRadius,{sharedOptions:_,includeOptions:S}=this._getSharedOptions(e,o);let F=this._getRotation(),R;for(R=0;R<e;++R)F+=this._circumference(R,s);for(R=e;R<e+i;++R){const tt=this._circumference(R,s),rt=t[R],b={x:d+this.offsetX,y:u+this.offsetY,startAngle:F,endAngle:F+tt,circumference:tt,outerRadius:w,innerRadius:h};S&&(b.options=_||this.resolveDataElementOptions(R,rt.active?"active":o)),F+=tt,this.updateElement(rt,R,b,o)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let i=0,o;for(o=0;o<e.length;o++){const s=t._parsed[o];s!==null&&!isNaN(s)&&this.chart.getDataVisibility(o)&&!e[o].hidden&&(i+=Math.abs(s))}return i}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?zt*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,o=i.data.labels||[],s=$n(e._parsed[t],i.options.locale);return{label:o[t]||"",value:s}}getMaxBorderWidth(t){let e=0;const i=this.chart;let o,s,a,r,l;if(!t){for(o=0,s=i.data.datasets.length;o<s;++o)if(i.isDatasetVisible(o)){a=i.getDatasetMeta(o),t=a.data,r=a.controller;break}}if(!t)return 0;for(o=0,s=t.length;o<s;++o)l=r.resolveDataElementOptions(o),l.borderAlign!=="inner"&&(e=Math.max(e,l.borderWidth||0,l.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,o=t.length;i<o;++i){const s=this.resolveDataElementOptions(i);e=Math.max(e,s.offset||0,s.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(Dt(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}mt(sn,"id","doughnut"),mt(sn,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),mt(sn,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),mt(sn,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:o}}=t.legend.options;return e.labels.map((s,a)=>{const l=t.getDatasetMeta(0).controller.getStyle(a);return{text:s,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:o,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(a),index:a}})}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}}});class fi extends xe{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:o=[],_dataset:s}=e,a=this.chart._animationsDisabled;let{start:r,count:l}=Da(e,o,a);this._drawStart=r,this._drawCount=l,ka(e)&&(r=0,l=o.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!s._decimated,i.points=o;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(i,void 0,{animated:!a,options:c},t),this.updateElements(o,r,l,t)}updateElements(t,e,i,o){const s=o==="reset",{iScale:a,vScale:r,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:d,includeOptions:u}=this._getSharedOptions(e,o),f=a.axis,h=r.axis,{spanGaps:w,segment:_}=this.options,S=pn(w)?w:Number.POSITIVE_INFINITY,F=this.chart._animationsDisabled||s||o==="none",R=e+i,tt=t.length;let rt=e>0&&this.getParsed(e-1);for(let b=0;b<tt;++b){const D=t[b],N=F?D:{};if(b<e||b>=R){N.skip=!0;continue}const A=this.getParsed(b),U=Tt(A[h]),j=N[f]=a.getPixelForValue(A[f],b),z=N[h]=s||U?r.getBasePixel():r.getPixelForValue(l?this.applyStack(r,A,l):A[h],b);N.skip=isNaN(j)||isNaN(z)||U,N.stop=b>0&&Math.abs(A[f]-rt[f])>S,_&&(N.parsed=A,N.raw=c.data[b]),u&&(N.options=d||this.resolveDataElementOptions(b,D.active?"active":o)),F||this.updateElement(D,b,N,o),rt=A}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,o=t.data||[];if(!o.length)return i;const s=o[0].size(this.resolveDataElementOptions(0)),a=o[o.length-1].size(this.resolveDataElementOptions(o.length-1));return Math.max(i,s,a)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}mt(fi,"id","line"),mt(fi,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),mt(fi,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class On extends xe{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,o=i.data.labels||[],s=$n(e._parsed[t].r,i.options.locale);return{label:o[t]||"",value:s}}parseObjectData(t,e,i,o){return La.bind(this)(t,e,i,o)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,o)=>{const s=this.getParsed(o).r;!isNaN(s)&&this.chart.getDataVisibility(o)&&(s<e.min&&(e.min=s),s>e.max&&(e.max=s))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,o=Math.min(e.right-e.left,e.bottom-e.top),s=Math.max(o/2,0),a=Math.max(i.cutoutPercentage?s/100*i.cutoutPercentage:1,0),r=(s-a)/t.getVisibleDatasetCount();this.outerRadius=s-r*this.index,this.innerRadius=this.outerRadius-r}updateElements(t,e,i,o){const s=o==="reset",a=this.chart,l=a.options.animation,c=this._cachedMeta.rScale,d=c.xCenter,u=c.yCenter,f=c.getIndexAngle(0)-.5*Ot;let h=f,w;const _=360/this.countVisibleElements();for(w=0;w<e;++w)h+=this._computeAngle(w,o,_);for(w=e;w<e+i;w++){const S=t[w];let F=h,R=h+this._computeAngle(w,o,_),tt=a.getDataVisibility(w)?c.getDistanceFromCenterForValue(this.getParsed(w).r):0;h=R,s&&(l.animateScale&&(tt=0),l.animateRotate&&(F=R=f));const rt={x:d,y:u,innerRadius:0,outerRadius:tt,startAngle:F,endAngle:R,options:this.resolveDataElementOptions(w,S.active?"active":o)};this.updateElement(S,w,rt,o)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((i,o)=>{!isNaN(this.getParsed(o).r)&&this.chart.getDataVisibility(o)&&e++}),e}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?_e(this.resolveDataElementOptions(t,e).angle||i):0}}mt(On,"id","polarArea"),mt(On,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),mt(On,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:o}}=t.legend.options;return e.labels.map((s,a)=>{const l=t.getDatasetMeta(0).controller.getStyle(a);return{text:s,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:o,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(a),index:a}})}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class ho extends sn{}mt(ho,"id","pie"),mt(ho,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class hi extends xe{getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}parseObjectData(t,e,i,o){return La.bind(this)(t,e,i,o)}update(t){const e=this._cachedMeta,i=e.dataset,o=e.data||[],s=e.iScale.getLabels();if(i.points=o,t!=="resize"){const a=this.resolveDatasetElementOptions(t);this.options.showLine||(a.borderWidth=0);const r={_loop:!0,_fullLoop:s.length===o.length,options:a};this.updateElement(i,void 0,r,t)}this.updateElements(o,0,o.length,t)}updateElements(t,e,i,o){const s=this._cachedMeta.rScale,a=o==="reset";for(let r=e;r<e+i;r++){const l=t[r],c=this.resolveDataElementOptions(r,l.active?"active":o),d=s.getPointPositionForValue(r,this.getParsed(r).r),u=a?s.xCenter:d.x,f=a?s.yCenter:d.y,h={x:u,y:f,angle:d.angle,skip:isNaN(u)||isNaN(f),options:c};this.updateElement(l,r,h,o)}}}mt(hi,"id","radar"),mt(hi,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),mt(hi,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class pi extends xe{getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:o,yScale:s}=e,a=this.getParsed(t),r=o.getLabelForValue(a.x),l=s.getLabelForValue(a.y);return{label:i[t]||"",value:"("+r+", "+l+")"}}update(t){const e=this._cachedMeta,{data:i=[]}=e,o=this.chart._animationsDisabled;let{start:s,count:a}=Da(e,i,o);if(this._drawStart=s,this._drawCount=a,ka(e)&&(s=0,a=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:r,_dataset:l}=e;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!l._decimated,r.points=i;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(r,void 0,{animated:!o,options:c},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(i,s,a,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,i,o){const s=o==="reset",{iScale:a,vScale:r,_stacked:l,_dataset:c}=this._cachedMeta,d=this.resolveDataElementOptions(e,o),u=this.getSharedOptions(d),f=this.includeOptions(o,u),h=a.axis,w=r.axis,{spanGaps:_,segment:S}=this.options,F=pn(_)?_:Number.POSITIVE_INFINITY,R=this.chart._animationsDisabled||s||o==="none";let tt=e>0&&this.getParsed(e-1);for(let rt=e;rt<e+i;++rt){const b=t[rt],D=this.getParsed(rt),N=R?b:{},A=Tt(D[w]),U=N[h]=a.getPixelForValue(D[h],rt),j=N[w]=s||A?r.getBasePixel():r.getPixelForValue(l?this.applyStack(r,D,l):D[w],rt);N.skip=isNaN(U)||isNaN(j)||A,N.stop=rt>0&&Math.abs(D[h]-tt[h])>F,S&&(N.parsed=D,N.raw=c.data[rt]),f&&(N.options=u||this.resolveDataElementOptions(rt,b.active?"active":o)),R||this.updateElement(b,rt,N,o),tt=D}this.updateSharedOptions(u,o,d)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let r=0;for(let l=e.length-1;l>=0;--l)r=Math.max(r,e[l].size(this.resolveDataElementOptions(l))/2);return r>0&&r}const i=t.dataset,o=i.options&&i.options.borderWidth||0;if(!e.length)return o;const s=e[0].size(this.resolveDataElementOptions(0)),a=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(o,s,a)/2}}mt(pi,"id","scatter"),mt(pi,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),mt(pi,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var Mc=Object.freeze({__proto__:null,BarController:di,BubbleController:ui,DoughnutController:sn,LineController:fi,PieController:ho,PolarAreaController:On,RadarController:hi,ScatterController:pi});function Qe(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class zo{constructor(t){mt(this,"options");this.options=t||{}}static override(t){Object.assign(zo.prototype,t)}init(){}formats(){return Qe()}parse(){return Qe()}format(){return Qe()}add(){return Qe()}diff(){return Qe()}startOf(){return Qe()}endOf(){return Qe()}}var Ec={_date:zo};function Tc(n,t,e,i){const{controller:o,data:s,_sorted:a}=n,r=o._cachedMeta.iScale,l=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(r&&t===r.axis&&t!=="r"&&a&&s.length){const c=r._reversePixels?Zr:Fe;if(i){if(o._sharedOptions){const d=s[0],u=typeof d.getRange=="function"&&d.getRange(t);if(u){const f=c(s,t,e-u),h=c(s,t,e+u);return{lo:f.lo,hi:h.hi}}}}else{const d=c(s,t,e);if(l){const{vScale:u}=o._cachedMeta,{_parsed:f}=n,h=f.slice(0,d.lo+1).reverse().findIndex(_=>!Tt(_[u.axis]));d.lo-=Math.max(0,h);const w=f.slice(d.hi).findIndex(_=>!Tt(_[u.axis]));d.hi+=Math.max(0,w)}return d}}return{lo:0,hi:s.length-1}}function Ni(n,t,e,i,o){const s=n.getSortedVisibleDatasetMetas(),a=e[t];for(let r=0,l=s.length;r<l;++r){const{index:c,data:d}=s[r],{lo:u,hi:f}=Tc(s[r],t,a,o);for(let h=u;h<=f;++h){const w=d[h];w.skip||i(w,c,h)}}}function Pc(n){const t=n.indexOf("x")!==-1,e=n.indexOf("y")!==-1;return function(i,o){const s=t?Math.abs(i.x-o.x):0,a=e?Math.abs(i.y-o.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(a,2))}}function Ki(n,t,e,i,o){const s=[];return!o&&!n.isPointInArea(t)||Ni(n,e,t,function(r,l,c){!o&&!Ne(r,n.chartArea,0)||r.inRange(t.x,t.y,i)&&s.push({element:r,datasetIndex:l,index:c})},!0),s}function Ac(n,t,e,i){let o=[];function s(a,r,l){const{startAngle:c,endAngle:d}=a.getProps(["startAngle","endAngle"],i),{angle:u}=wa(a,{x:t.x,y:t.y});zn(u,c,d)&&o.push({element:a,datasetIndex:r,index:l})}return Ni(n,e,t,s),o}function Bc(n,t,e,i,o,s){let a=[];const r=Pc(e);let l=Number.POSITIVE_INFINITY;function c(d,u,f){const h=d.inRange(t.x,t.y,o);if(i&&!h)return;const w=d.getCenterPoint(o);if(!(!!s||n.isPointInArea(w))&&!h)return;const S=r(t,w);S<l?(a=[{element:d,datasetIndex:u,index:f}],l=S):S===l&&a.push({element:d,datasetIndex:u,index:f})}return Ni(n,e,t,c),a}function Ji(n,t,e,i,o,s){return!s&&!n.isPointInArea(t)?[]:e==="r"&&!i?Ac(n,t,e,o):Bc(n,t,e,i,o,s)}function ws(n,t,e,i,o){const s=[],a=e==="x"?"inXRange":"inYRange";let r=!1;return Ni(n,e,t,(l,c,d)=>{l[a]&&l[a](t[e],o)&&(s.push({element:l,datasetIndex:c,index:d}),r=r||l.inRange(t.x,t.y,o))}),i&&!r?[]:s}var Lc={modes:{index(n,t,e,i){const o=nn(t,n),s=e.axis||"x",a=e.includeInvisible||!1,r=e.intersect?Ki(n,o,s,i,a):Ji(n,o,s,!1,i,a),l=[];return r.length?(n.getSortedVisibleDatasetMetas().forEach(c=>{const d=r[0].index,u=c.data[d];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:d})}),l):[]},dataset(n,t,e,i){const o=nn(t,n),s=e.axis||"xy",a=e.includeInvisible||!1;let r=e.intersect?Ki(n,o,s,i,a):Ji(n,o,s,!1,i,a);if(r.length>0){const l=r[0].datasetIndex,c=n.getDatasetMeta(l).data;r=[];for(let d=0;d<c.length;++d)r.push({element:c[d],datasetIndex:l,index:d})}return r},point(n,t,e,i){const o=nn(t,n),s=e.axis||"xy",a=e.includeInvisible||!1;return Ki(n,o,s,i,a)},nearest(n,t,e,i){const o=nn(t,n),s=e.axis||"xy",a=e.includeInvisible||!1;return Ji(n,o,s,e.intersect,i,a)},x(n,t,e,i){const o=nn(t,n);return ws(n,o,"x",e.intersect,i)},y(n,t,e,i){const o=nn(t,n);return ws(n,o,"y",e.intersect,i)}}};const Ya=["left","top","right","bottom"];function _n(n,t){return n.filter(e=>e.pos===t)}function _s(n,t){return n.filter(e=>Ya.indexOf(e.pos)===-1&&e.box.axis===t)}function xn(n,t){return n.sort((e,i)=>{const o=t?i:e,s=t?e:i;return o.weight===s.weight?o.index-s.index:o.weight-s.weight})}function Oc(n){const t=[];let e,i,o,s,a,r;for(e=0,i=(n||[]).length;e<i;++e)o=n[e],{position:s,options:{stack:a,stackWeight:r=1}}=o,t.push({index:e,box:o,pos:s,horizontal:o.isHorizontal(),weight:o.weight,stack:a&&s+a,stackWeight:r});return t}function Fc(n){const t={};for(const e of n){const{stack:i,pos:o,stackWeight:s}=e;if(!i||!Ya.includes(o))continue;const a=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});a.count++,a.weight+=s}return t}function Nc(n,t){const e=Fc(n),{vBoxMaxWidth:i,hBoxMaxHeight:o}=t;let s,a,r;for(s=0,a=n.length;s<a;++s){r=n[s];const{fullSize:l}=r.box,c=e[r.stack],d=c&&r.stackWeight/c.weight;r.horizontal?(r.width=d?d*i:l&&t.availableWidth,r.height=o):(r.width=i,r.height=d?d*o:l&&t.availableHeight)}return e}function Rc(n){const t=Oc(n),e=xn(t.filter(c=>c.box.fullSize),!0),i=xn(_n(t,"left"),!0),o=xn(_n(t,"right")),s=xn(_n(t,"top"),!0),a=xn(_n(t,"bottom")),r=_s(t,"x"),l=_s(t,"y");return{fullSize:e,leftAndTop:i.concat(s),rightAndBottom:o.concat(l).concat(a).concat(r),chartArea:_n(t,"chartArea"),vertical:i.concat(o).concat(l),horizontal:s.concat(a).concat(r)}}function xs(n,t,e,i){return Math.max(n[e],t[e])+Math.max(n[i],t[i])}function $a(n,t){n.top=Math.max(n.top,t.top),n.left=Math.max(n.left,t.left),n.bottom=Math.max(n.bottom,t.bottom),n.right=Math.max(n.right,t.right)}function Vc(n,t,e,i){const{pos:o,box:s}=e,a=n.maxPadding;if(!At(o)){e.size&&(n[o]-=e.size);const u=i[e.stack]||{size:0,count:1};u.size=Math.max(u.size,e.horizontal?s.height:s.width),e.size=u.size/u.count,n[o]+=e.size}s.getPadding&&$a(a,s.getPadding());const r=Math.max(0,t.outerWidth-xs(a,n,"left","right")),l=Math.max(0,t.outerHeight-xs(a,n,"top","bottom")),c=r!==n.w,d=l!==n.h;return n.w=r,n.h=l,e.horizontal?{same:c,other:d}:{same:d,other:c}}function zc(n){const t=n.maxPadding;function e(i){const o=Math.max(t[i]-n[i],0);return n[i]+=o,o}n.y+=e("top"),n.x+=e("left"),e("right"),e("bottom")}function Uc(n,t){const e=t.maxPadding;function i(o){const s={left:0,top:0,right:0,bottom:0};return o.forEach(a=>{s[a]=Math.max(t[a],e[a])}),s}return i(n?["left","right"]:["top","bottom"])}function In(n,t,e,i){const o=[];let s,a,r,l,c,d;for(s=0,a=n.length,c=0;s<a;++s){r=n[s],l=r.box,l.update(r.width||t.w,r.height||t.h,Uc(r.horizontal,t));const{same:u,other:f}=Vc(t,e,r,i);c|=u&&o.length,d=d||f,l.fullSize||o.push(r)}return c&&In(o,t,e,i)||d}function ti(n,t,e,i,o){n.top=e,n.left=t,n.right=t+i,n.bottom=e+o,n.width=i,n.height=o}function Ss(n,t,e,i){const o=e.padding;let{x:s,y:a}=t;for(const r of n){const l=r.box,c=i[r.stack]||{placed:0,weight:1},d=r.stackWeight/c.weight||1;if(r.horizontal){const u=t.w*d,f=c.size||l.height;Vn(c.start)&&(a=c.start),l.fullSize?ti(l,o.left,a,e.outerWidth-o.right-o.left,f):ti(l,t.left+c.placed,a,u,f),c.start=a,c.placed+=u,a=l.bottom}else{const u=t.h*d,f=c.size||l.width;Vn(c.start)&&(s=c.start),l.fullSize?ti(l,s,o.top,f,e.outerHeight-o.bottom-o.top):ti(l,s,t.top+c.placed,f,u),c.start=s,c.placed+=u,s=l.right}}t.x=s,t.y=a}var le={addBox(n,t){n.boxes||(n.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},n.boxes.push(t)},removeBox(n,t){const e=n.boxes?n.boxes.indexOf(t):-1;e!==-1&&n.boxes.splice(e,1)},configure(n,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(n,t,e,i){if(!n)return;const o=ce(n.options.layout.padding),s=Math.max(t-o.width,0),a=Math.max(e-o.height,0),r=Rc(n.boxes),l=r.vertical,c=r.horizontal;Nt(n.boxes,_=>{typeof _.beforeLayout=="function"&&_.beforeLayout()});const d=l.reduce((_,S)=>S.box.options&&S.box.options.display===!1?_:_+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:e,padding:o,availableWidth:s,availableHeight:a,vBoxMaxWidth:s/2/d,hBoxMaxHeight:a/2}),f=Object.assign({},o);$a(f,ce(i));const h=Object.assign({maxPadding:f,w:s,h:a,x:o.left,y:o.top},o),w=Nc(l.concat(c),u);In(r.fullSize,h,u,w),In(l,h,u,w),In(c,h,u,w)&&In(l,h,u,w),zc(h),Ss(r.leftAndTop,h,u,w),h.x+=h.w,h.y+=h.h,Ss(r.rightAndBottom,h,u,w),n.chartArea={left:h.left,top:h.top,right:h.left+h.w,bottom:h.top+h.h,height:h.h,width:h.w},Nt(r.chartArea,_=>{const S=_.box;Object.assign(S,n.chartArea),S.update(h.w,h.h,{left:0,top:0,right:0,bottom:0})})}};class qa{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,o){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,o?Math.floor(e/o):i)}}isAttached(t){return!0}updateConfig(t){}}class Hc extends qa{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const mi="$chartjs",jc={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Cs=n=>n===null||n==="";function Wc(n,t){const e=n.style,i=n.getAttribute("height"),o=n.getAttribute("width");if(n[mi]={initial:{height:i,width:o,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",Cs(o)){const s=rs(n,"width");s!==void 0&&(n.width=s)}if(Cs(i))if(n.style.height==="")n.height=n.width/(t||2);else{const s=rs(n,"height");s!==void 0&&(n.height=s)}return n}const Ga=Yl?{passive:!0}:!1;function Yc(n,t,e){n&&n.addEventListener(t,e,Ga)}function $c(n,t,e){n&&n.canvas&&n.canvas.removeEventListener(t,e,Ga)}function qc(n,t){const e=jc[n.type]||n.type,{x:i,y:o}=nn(n,t);return{type:e,chart:t,native:n,x:i!==void 0?i:null,y:o!==void 0?o:null}}function Ii(n,t){for(const e of n)if(e===t||e.contains(t))return!0}function Gc(n,t,e){const i=n.canvas,o=new MutationObserver(s=>{let a=!1;for(const r of s)a=a||Ii(r.addedNodes,i),a=a&&!Ii(r.removedNodes,i);a&&e()});return o.observe(document,{childList:!0,subtree:!0}),o}function Xc(n,t,e){const i=n.canvas,o=new MutationObserver(s=>{let a=!1;for(const r of s)a=a||Ii(r.removedNodes,i),a=a&&!Ii(r.addedNodes,i);a&&e()});return o.observe(document,{childList:!0,subtree:!0}),o}const Hn=new Map;let Ds=0;function Xa(){const n=window.devicePixelRatio;n!==Ds&&(Ds=n,Hn.forEach((t,e)=>{e.currentDevicePixelRatio!==n&&t()}))}function Kc(n,t){Hn.size||window.addEventListener("resize",Xa),Hn.set(n,t)}function Jc(n){Hn.delete(n),Hn.size||window.removeEventListener("resize",Xa)}function Zc(n,t,e){const i=n.canvas,o=i&&Vo(i);if(!o)return;const s=Ca((r,l)=>{const c=o.clientWidth;e(r,l),c<o.clientWidth&&e()},window),a=new ResizeObserver(r=>{const l=r[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||s(c,d)});return a.observe(o),Kc(n,s),a}function Zi(n,t,e){e&&e.disconnect(),t==="resize"&&Jc(n)}function Qc(n,t,e){const i=n.canvas,o=Ca(s=>{n.ctx!==null&&e(qc(s,n))},n);return Yc(i,t,o),o}class td extends qa{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(Wc(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e[mi])return!1;const i=e[mi].initial;["height","width"].forEach(s=>{const a=i[s];Tt(a)?e.removeAttribute(s):e.setAttribute(s,a)});const o=i.style||{};return Object.keys(o).forEach(s=>{e.style[s]=o[s]}),e.width=e.width,delete e[mi],!0}addEventListener(t,e,i){this.removeEventListener(t,e);const o=t.$proxies||(t.$proxies={}),a={attach:Gc,detach:Xc,resize:Zc}[e]||Qc;o[e]=a(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),o=i[e];if(!o)return;({attach:Zi,detach:Zi,resize:Zi}[e]||$c)(t,e,o),i[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,o){return Wl(t,e,i,o)}isAttached(t){const e=t&&Vo(t);return!!(e&&e.isConnected)}}function ed(n){return!Ro()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?Hc:td}class Se{constructor(){mt(this,"x");mt(this,"y");mt(this,"active",!1);mt(this,"options");mt(this,"$animations")}tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return pn(this.x)&&pn(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const o={};return t.forEach(s=>{o[s]=i[s]&&i[s].active()?i[s]._to:this[s]}),o}}mt(Se,"defaults",{}),mt(Se,"defaultRoutes");function nd(n,t){const e=n.options.ticks,i=id(n),o=Math.min(e.maxTicksLimit||i,i),s=e.major.enabled?sd(t):[],a=s.length,r=s[0],l=s[a-1],c=[];if(a>o)return ad(t,c,s,a/o),c;const d=od(s,t,o);if(a>0){let u,f;const h=a>1?Math.round((l-r)/(a-1)):null;for(ei(t,c,d,Tt(h)?0:r-h,r),u=0,f=a-1;u<f;u++)ei(t,c,d,s[u],s[u+1]);return ei(t,c,d,l,Tt(h)?t.length:l+h),c}return ei(t,c,d),c}function id(n){const t=n.options.offset,e=n._tickSize(),i=n._length/e+(t?0:1),o=n._maxLength/e;return Math.floor(Math.min(i,o))}function od(n,t,e){const i=rd(n),o=t.length/e;if(!i)return Math.max(o,1);const s=qr(i);for(let a=0,r=s.length-1;a<r;a++){const l=s[a];if(l>o)return l}return Math.max(o,1)}function sd(n){const t=[];let e,i;for(e=0,i=n.length;e<i;e++)n[e].major&&t.push(e);return t}function ad(n,t,e,i){let o=0,s=e[0],a;for(i=Math.ceil(i),a=0;a<n.length;a++)a===s&&(t.push(n[a]),o++,s=e[o*i])}function ei(n,t,e,i,o){const s=Dt(i,0),a=Math.min(Dt(o,n.length),n.length);let r=0,l,c,d;for(e=Math.ceil(e),o&&(l=o-i,e=l/Math.floor(l/e)),d=s;d<0;)r++,d=Math.round(s+r*e);for(c=Math.max(s,0);c<a;c++)c===d&&(t.push(n[c]),r++,d=Math.round(s+r*e))}function rd(n){const t=n.length;let e,i;if(t<2)return!1;for(i=n[0],e=1;e<t;++e)if(n[e]-n[e-1]!==i)return!1;return i}const ld=n=>n==="left"?"right":n==="right"?"left":n,ks=(n,t,e)=>t==="top"||t==="left"?n[t]+e:n[t]-e,Is=(n,t)=>Math.min(t||n,n);function Ms(n,t){const e=[],i=n.length/t,o=n.length;let s=0;for(;s<o;s+=i)e.push(n[Math.floor(s)]);return e}function cd(n,t,e){const i=n.ticks.length,o=Math.min(t,i-1),s=n._startPixel,a=n._endPixel,r=1e-6;let l=n.getPixelForTick(o),c;if(!(e&&(i===1?c=Math.max(l-s,a-l):t===0?c=(n.getPixelForTick(1)-l)/2:c=(l-n.getPixelForTick(o-1))/2,l+=o<t?c:-c,l<s-r||l>a+r)))return l}function dd(n,t){Nt(n,e=>{const i=e.gc,o=i.length/2;let s;if(o>t){for(s=0;s<o;++s)delete e.data[i[s]];i.splice(0,o)}})}function Sn(n){return n.drawTicks?n.tickLength:0}function Es(n,t){if(!n.display)return 0;const e=Qt(n.font,t),i=ce(n.padding);return(Ht(n.text)?n.text.length:1)*e.lineHeight+i.height}function ud(n,t){return Ge(n,{scale:t,type:"scale"})}function fd(n,t,e){return Ge(n,{tick:e,index:t,type:"tick"})}function hd(n,t,e){let i=Ao(n);return(e&&t!=="right"||!e&&t==="right")&&(i=ld(i)),i}function pd(n,t,e,i){const{top:o,left:s,bottom:a,right:r,chart:l}=n,{chartArea:c,scales:d}=l;let u=0,f,h,w;const _=a-o,S=r-s;if(n.isHorizontal()){if(h=ae(i,s,r),At(e)){const F=Object.keys(e)[0],R=e[F];w=d[F].getPixelForValue(R)+_-t}else e==="center"?w=(c.bottom+c.top)/2+_-t:w=ks(n,e,t);f=r-s}else{if(At(e)){const F=Object.keys(e)[0],R=e[F];h=d[F].getPixelForValue(R)-S+t}else e==="center"?h=(c.left+c.right)/2-S+t:h=ks(n,e,t);w=ae(i,a,o),u=e==="left"?-Xt:Xt}return{titleX:h,titleY:w,maxWidth:f,rotation:u}}class dn extends Se{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:o}=this;return t=ve(t,Number.POSITIVE_INFINITY),e=ve(e,Number.NEGATIVE_INFINITY),i=ve(i,Number.POSITIVE_INFINITY),o=ve(o,Number.NEGATIVE_INFINITY),{min:ve(t,i),max:ve(e,o),minDefined:qt(t),maxDefined:qt(e)}}getMinMax(t){let{min:e,max:i,minDefined:o,maxDefined:s}=this.getUserBounds(),a;if(o&&s)return{min:e,max:i};const r=this.getMatchingVisibleMetas();for(let l=0,c=r.length;l<c;++l)a=r[l].controller.getMinMax(this,t),o||(e=Math.min(e,a.min)),s||(i=Math.max(i,a.max));return e=s&&e>i?i:e,i=o&&e>i?e:i,{min:ve(e,ve(i,e)),max:ve(i,ve(e,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Vt(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:o,grace:s,ticks:a}=this.options,r=a.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=xl(this,s,o),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=r<this.ticks.length;this._convertTicksToLabels(l?Ms(this.ticks,r):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),a.display&&(a.autoSkip||a.source==="auto")&&(this.ticks=nd(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,i;this.isHorizontal()?(e=this.left,i=this.right):(e=this.top,i=this.bottom,t=!t),this._startPixel=e,this._endPixel=i,this._reversePixels=t,this._length=i-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Vt(this.options.afterUpdate,[this])}beforeSetDimensions(){Vt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Vt(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),Vt(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Vt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,o,s;for(i=0,o=t.length;i<o;i++)s=t[i],s.label=Vt(e.callback,[s.value,i,t],this)}afterTickToLabelConversion(){Vt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Vt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=Is(this.ticks.length,t.ticks.maxTicksLimit),o=e.minRotation||0,s=e.maxRotation;let a=o,r,l,c;if(!this._isVisible()||!e.display||o>=s||i<=1||!this.isHorizontal()){this.labelRotation=o;return}const d=this._getLabelSizes(),u=d.widest.width,f=d.highest.height,h=ee(this.chart.width-u,0,this.maxWidth);r=t.offset?this.maxWidth/i:h/(i-1),u+6>r&&(r=h/(i-(t.offset?.5:1)),l=this.maxHeight-Sn(t.grid)-e.padding-Es(t.title,this.chart.options.font),c=Math.sqrt(u*u+f*f),a=To(Math.min(Math.asin(ee((d.highest.height+6)/r,-1,1)),Math.asin(ee(l/c,-1,1))-Math.asin(ee(f/c,-1,1)))),a=Math.max(o,Math.min(s,a))),this.labelRotation=a}afterCalculateLabelRotation(){Vt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Vt(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:o,grid:s}}=this,a=this._isVisible(),r=this.isHorizontal();if(a){const l=Es(o,e.options.font);if(r?(t.width=this.maxWidth,t.height=Sn(s)+l):(t.height=this.maxHeight,t.width=Sn(s)+l),i.display&&this.ticks.length){const{first:c,last:d,widest:u,highest:f}=this._getLabelSizes(),h=i.padding*2,w=_e(this.labelRotation),_=Math.cos(w),S=Math.sin(w);if(r){const F=i.mirror?0:S*u.width+_*f.height;t.height=Math.min(this.maxHeight,t.height+F+h)}else{const F=i.mirror?0:_*u.width+S*f.height;t.width=Math.min(this.maxWidth,t.width+F+h)}this._calculatePadding(c,d,S,_)}}this._handleMargins(),r?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,o){const{ticks:{align:s,padding:a},position:r}=this.options,l=this.labelRotation!==0,c=r!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let f=0,h=0;l?c?(f=o*t.width,h=i*e.height):(f=i*t.height,h=o*e.width):s==="start"?h=e.width:s==="end"?f=t.width:s!=="inner"&&(f=t.width/2,h=e.width/2),this.paddingLeft=Math.max((f-d+a)*this.width/(this.width-d),0),this.paddingRight=Math.max((h-u+a)*this.width/(this.width-u),0)}else{let d=e.height/2,u=t.height/2;s==="start"?(d=0,u=t.height):s==="end"&&(d=e.height,u=0),this.paddingTop=d+a,this.paddingBottom=u+a}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Vt(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,i;for(e=0,i=t.length;e<i;e++)Tt(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=Ms(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,i){const{ctx:o,_longestTextCache:s}=this,a=[],r=[],l=Math.floor(e/Is(e,i));let c=0,d=0,u,f,h,w,_,S,F,R,tt,rt,b;for(u=0;u<e;u+=l){if(w=t[u].label,_=this._resolveTickFontOptions(u),o.font=S=_.string,F=s[S]=s[S]||{data:{},gc:[]},R=_.lineHeight,tt=rt=0,!Tt(w)&&!Ht(w))tt=Di(o,F.data,F.gc,tt,w),rt=R;else if(Ht(w))for(f=0,h=w.length;f<h;++f)b=w[f],!Tt(b)&&!Ht(b)&&(tt=Di(o,F.data,F.gc,tt,b),rt+=R);a.push(tt),r.push(rt),c=Math.max(tt,c),d=Math.max(rt,d)}dd(s,e);const D=a.indexOf(c),N=r.indexOf(d),A=U=>({width:a[U]||0,height:r[U]||0});return{first:A(0),last:A(e-1),widest:A(D),highest:A(N),widths:a,heights:r}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Jr(this._alignToPixels?Ze(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=fd(this.getContext(),t,i))}return this.$context||(this.$context=ud(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=_e(this.labelRotation),i=Math.abs(Math.cos(e)),o=Math.abs(Math.sin(e)),s=this._getLabelSizes(),a=t.autoSkipPadding||0,r=s?s.widest.width+a:0,l=s?s.highest.height+a:0;return this.isHorizontal()?l*i>r*o?r/i:l/o:l*o<r*i?l/i:r/o}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,o=this.options,{grid:s,position:a,border:r}=o,l=s.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),f=Sn(s),h=[],w=r.setContext(this.getContext()),_=w.display?w.width:0,S=_/2,F=function(ct){return Ze(i,ct,_)};let R,tt,rt,b,D,N,A,U,j,z,W,lt;if(a==="top")R=F(this.bottom),N=this.bottom-f,U=R-S,z=F(t.top)+S,lt=t.bottom;else if(a==="bottom")R=F(this.top),z=t.top,lt=F(t.bottom)-S,N=R+S,U=this.top+f;else if(a==="left")R=F(this.right),D=this.right-f,A=R-S,j=F(t.left)+S,W=t.right;else if(a==="right")R=F(this.left),j=t.left,W=F(t.right)-S,D=R+S,A=this.left+f;else if(e==="x"){if(a==="center")R=F((t.top+t.bottom)/2+.5);else if(At(a)){const ct=Object.keys(a)[0],$=a[ct];R=F(this.chart.scales[ct].getPixelForValue($))}z=t.top,lt=t.bottom,N=R+S,U=N+f}else if(e==="y"){if(a==="center")R=F((t.left+t.right)/2);else if(At(a)){const ct=Object.keys(a)[0],$=a[ct];R=F(this.chart.scales[ct].getPixelForValue($))}D=R-S,A=D-f,j=t.left,W=t.right}const Y=Dt(o.ticks.maxTicksLimit,u),nt=Math.max(1,Math.ceil(u/Y));for(tt=0;tt<u;tt+=nt){const ct=this.getContext(tt),$=s.setContext(ct),V=r.setContext(ct),L=$.lineWidth,X=$.color,Z=V.dash||[],K=V.dashOffset,H=$.tickWidth,M=$.tickColor,E=$.tickBorderDash||[],G=$.tickBorderDashOffset;rt=cd(this,tt,l),rt!==void 0&&(b=Ze(i,rt,L),c?D=A=j=W=b:N=U=z=lt=b,h.push({tx1:D,ty1:N,tx2:A,ty2:U,x1:j,y1:z,x2:W,y2:lt,width:L,color:X,borderDash:Z,borderDashOffset:K,tickWidth:H,tickColor:M,tickBorderDash:E,tickBorderDashOffset:G}))}return this._ticksLength=u,this._borderValue=R,h}_computeLabelItems(t){const e=this.axis,i=this.options,{position:o,ticks:s}=i,a=this.isHorizontal(),r=this.ticks,{align:l,crossAlign:c,padding:d,mirror:u}=s,f=Sn(i.grid),h=f+d,w=u?-d:h,_=-_e(this.labelRotation),S=[];let F,R,tt,rt,b,D,N,A,U,j,z,W,lt="middle";if(o==="top")D=this.bottom-w,N=this._getXAxisLabelAlignment();else if(o==="bottom")D=this.top+w,N=this._getXAxisLabelAlignment();else if(o==="left"){const nt=this._getYAxisLabelAlignment(f);N=nt.textAlign,b=nt.x}else if(o==="right"){const nt=this._getYAxisLabelAlignment(f);N=nt.textAlign,b=nt.x}else if(e==="x"){if(o==="center")D=(t.top+t.bottom)/2+h;else if(At(o)){const nt=Object.keys(o)[0],ct=o[nt];D=this.chart.scales[nt].getPixelForValue(ct)+h}N=this._getXAxisLabelAlignment()}else if(e==="y"){if(o==="center")b=(t.left+t.right)/2-h;else if(At(o)){const nt=Object.keys(o)[0],ct=o[nt];b=this.chart.scales[nt].getPixelForValue(ct)}N=this._getYAxisLabelAlignment(f).textAlign}e==="y"&&(l==="start"?lt="top":l==="end"&&(lt="bottom"));const Y=this._getLabelSizes();for(F=0,R=r.length;F<R;++F){tt=r[F],rt=tt.label;const nt=s.setContext(this.getContext(F));A=this.getPixelForTick(F)+s.labelOffset,U=this._resolveTickFontOptions(F),j=U.lineHeight,z=Ht(rt)?rt.length:1;const ct=z/2,$=nt.color,V=nt.textStrokeColor,L=nt.textStrokeWidth;let X=N;a?(b=A,N==="inner"&&(F===R-1?X=this.options.reverse?"left":"right":F===0?X=this.options.reverse?"right":"left":X="center"),o==="top"?c==="near"||_!==0?W=-z*j+j/2:c==="center"?W=-Y.highest.height/2-ct*j+j:W=-Y.highest.height+j/2:c==="near"||_!==0?W=j/2:c==="center"?W=Y.highest.height/2-ct*j:W=Y.highest.height-z*j,u&&(W*=-1),_!==0&&!nt.showLabelBackdrop&&(b+=j/2*Math.sin(_))):(D=A,W=(1-z)*j/2);let Z;if(nt.showLabelBackdrop){const K=ce(nt.backdropPadding),H=Y.heights[F],M=Y.widths[F];let E=W-K.top,G=0-K.left;switch(lt){case"middle":E-=H/2;break;case"bottom":E-=H;break}switch(N){case"center":G-=M/2;break;case"right":G-=M;break;case"inner":F===R-1?G-=M:F>0&&(G-=M/2);break}Z={left:G,top:E,width:M+K.width,height:H+K.height,color:nt.backdropColor}}S.push({label:rt,font:U,textOffset:W,options:{rotation:_,color:$,strokeColor:V,strokeWidth:L,textAlign:X,textBaseline:lt,translation:[b,D],backdrop:Z}})}return S}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-_e(this.labelRotation))return t==="top"?"left":"right";let o="center";return e.align==="start"?o="left":e.align==="end"?o="right":e.align==="inner"&&(o="inner"),o}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:o,padding:s}}=this.options,a=this._getLabelSizes(),r=t+s,l=a.widest.width;let c,d;return e==="left"?o?(d=this.right+s,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-r,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d=this.left)):e==="right"?o?(d=this.left+s,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+r,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:o,width:s,height:a}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,o,s,a),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const o=this.ticks.findIndex(s=>s.value===t);return o>=0?e.setContext(this.getContext(o)).lineWidth:0}drawGrid(t){const e=this.options.grid,i=this.ctx,o=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let s,a;const r=(l,c,d)=>{!d.width||!d.color||(i.save(),i.lineWidth=d.width,i.strokeStyle=d.color,i.setLineDash(d.borderDash||[]),i.lineDashOffset=d.borderDashOffset,i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(c.x,c.y),i.stroke(),i.restore())};if(e.display)for(s=0,a=o.length;s<a;++s){const l=o[s];e.drawOnChartArea&&r({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),e.drawTicks&&r({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:i,grid:o}}=this,s=i.setContext(this.getContext()),a=i.display?s.width:0;if(!a)return;const r=o.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,u,f;this.isHorizontal()?(c=Ze(t,this.left,a)-a/2,d=Ze(t,this.right,r)+r/2,u=f=l):(u=Ze(t,this.top,a)-a/2,f=Ze(t,this.bottom,r)+r/2,c=d=l),e.save(),e.lineWidth=s.width,e.strokeStyle=s.color,e.beginPath(),e.moveTo(c,u),e.lineTo(d,f),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,o=this._computeLabelArea();o&&Li(i,o);const s=this.getLabelItems(t);for(const a of s){const r=a.options,l=a.font,c=a.label,d=a.textOffset;cn(i,c,0,d,l,r)}o&&Oi(i)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:o}}=this;if(!i.display)return;const s=Qt(i.font),a=ce(i.padding),r=i.align;let l=s.lineHeight/2;e==="bottom"||e==="center"||At(e)?(l+=a.bottom,Ht(i.text)&&(l+=s.lineHeight*(i.text.length-1))):l+=a.top;const{titleX:c,titleY:d,maxWidth:u,rotation:f}=pd(this,l,e,r);cn(t,i.text,0,0,s,{color:i.color,maxWidth:u,rotation:f,textAlign:hd(r,e,o),textBaseline:"middle",translation:[c,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=Dt(t.grid&&t.grid.z,-1),o=Dt(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==dn.prototype.draw?[{z:e,draw:s=>{this.draw(s)}}]:[{z:i,draw:s=>{this.drawBackground(),this.drawGrid(s),this.drawTitle()}},{z:o,draw:()=>{this.drawBorder()}},{z:e,draw:s=>{this.drawLabels(s)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",o=[];let s,a;for(s=0,a=e.length;s<a;++s){const r=e[s];r[i]===this.id&&(!t||r.type===t)&&o.push(r)}return o}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return Qt(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class ni{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;vd(e)&&(i=this.register(e));const o=this.items,s=t.id,a=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+t);return s in o||(o[s]=t,md(t,a,i),this.override&&jt.override(t.id,t.overrides)),a}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,o=this.scope;i in e&&delete e[i],o&&i in jt[o]&&(delete jt[o][i],this.override&&delete ln[i])}}function md(n,t,e){const i=Rn(Object.create(null),[e?jt.get(e):{},jt.get(t),n.defaults]);jt.set(t,i),n.defaultRoutes&&gd(t,n.defaultRoutes),n.descriptors&&jt.describe(t,n.descriptors)}function gd(n,t){Object.keys(t).forEach(e=>{const i=e.split("."),o=i.pop(),s=[n].concat(i).join("."),a=t[e].split("."),r=a.pop(),l=a.join(".");jt.route(s,o,l,r)})}function vd(n){return"id"in n&&"defaults"in n}class bd{constructor(){this.controllers=new ni(xe,"datasets",!0),this.elements=new ni(Se,"elements"),this.plugins=new ni(Object,"plugins"),this.scales=new ni(dn,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach(o=>{const s=i||this._getRegistryForType(o);i||s.isForType(o)||s===this.plugins&&o.id?this._exec(t,s,o):Nt(o,a=>{const r=i||this._getRegistryForType(a);this._exec(t,r,a)})})}_exec(t,e,i){const o=Eo(t);Vt(i["before"+o],[],i),e[t](i),Vt(i["after"+o],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const o=e.get(t);if(o===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return o}}var ke=new bd;class yd{constructor(){this._init=[]}notify(t,e,i,o){e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const s=o?this._descriptors(t).filter(o):this._descriptors(t),a=this._notify(s,t,e,i);return e==="afterDestroy"&&(this._notify(s,t,"stop"),this._notify(this._init,t,"uninstall")),a}_notify(t,e,i,o){o=o||{};for(const s of t){const a=s.plugin,r=a[i],l=[e,o,s.options];if(Vt(r,l,a)===!1&&o.cancelable)return!1}return!0}invalidate(){Tt(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,o=Dt(i.options&&i.options.plugins,{}),s=wd(i);return o===!1&&!e?[]:xd(t,s,o,e)}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,o=(s,a)=>s.filter(r=>!a.some(l=>r.plugin.id===l.plugin.id));this._notify(o(e,i),t,"stop"),this._notify(o(i,e),t,"start")}}function wd(n){const t={},e=[],i=Object.keys(ke.plugins.items);for(let s=0;s<i.length;s++)e.push(ke.getPlugin(i[s]));const o=n.plugins||[];for(let s=0;s<o.length;s++){const a=o[s];e.indexOf(a)===-1&&(e.push(a),t[a.id]=!0)}return{plugins:e,localIds:t}}function _d(n,t){return!t&&n===!1?null:n===!0?{}:n}function xd(n,{plugins:t,localIds:e},i,o){const s=[],a=n.getContext();for(const r of t){const l=r.id,c=_d(i[l],o);c!==null&&s.push({plugin:r,options:Sd(n.config,{plugin:r,local:e[l]},c,a)})}return s}function Sd(n,{plugin:t,local:e},i,o){const s=n.pluginScopeKeys(t),a=n.getOptionScopes(i,s);return e&&t.defaults&&a.push(t.defaults),n.createResolver(a,o,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function po(n,t){const e=jt.datasets[n]||{};return((t.datasets||{})[n]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function Cd(n,t){let e=n;return n==="_index_"?e=t:n==="_value_"&&(e=t==="x"?"y":"x"),e}function Dd(n,t){return n===t?"_index_":"_value_"}function Ts(n){if(n==="x"||n==="y"||n==="r")return n}function kd(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function mo(n,...t){if(Ts(n))return n;for(const e of t){const i=e.axis||kd(e.position)||n.length>1&&Ts(n[0].toLowerCase());if(i)return i}throw new Error("Cannot determine type of '".concat(n,"' axis. Please provide 'axis' or 'position' option."))}function Ps(n,t,e){if(e[t+"AxisID"]===n)return{axis:t}}function Id(n,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(i=>i.xAxisID===n||i.yAxisID===n);if(e.length)return Ps(n,"x",e[0])||Ps(n,"y",e[0])}return{}}function Md(n,t){const e=ln[n.type]||{scales:{}},i=t.scales||{},o=po(n.type,t),s=Object.create(null);return Object.keys(i).forEach(a=>{const r=i[a];if(!At(r))return console.error("Invalid scale configuration for scale: ".concat(a));if(r._proxy)return console.warn("Ignoring resolver passed as options for scale: ".concat(a));const l=mo(a,r,Id(a,n),jt.scales[r.type]),c=Dd(l,o),d=e.scales||{};s[a]=Pn(Object.create(null),[{axis:l},r,d[l],d[c]])}),n.data.datasets.forEach(a=>{const r=a.type||n.type,l=a.indexAxis||po(r,t),d=(ln[r]||{}).scales||{};Object.keys(d).forEach(u=>{const f=Cd(u,l),h=a[f+"AxisID"]||f;s[h]=s[h]||Object.create(null),Pn(s[h],[{axis:f},i[h],d[u]])})}),Object.keys(s).forEach(a=>{const r=s[a];Pn(r,[jt.scales[r.type],jt.scale])}),s}function Ka(n){const t=n.options||(n.options={});t.plugins=Dt(t.plugins,{}),t.scales=Md(n,t)}function Ja(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function Ed(n){return n=n||{},n.data=Ja(n.data),Ka(n),n}const As=new Map,Za=new Set;function ii(n,t){let e=As.get(n);return e||(e=t(),As.set(n,e),Za.add(e)),e}const Cn=(n,t,e)=>{const i=$e(t,e);i!==void 0&&n.add(i)};class Td{constructor(t){this._config=Ed(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Ja(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),Ka(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return ii(t,()=>[["datasets.".concat(t),""]])}datasetAnimationScopeKeys(t,e){return ii("".concat(t,".transition.").concat(e),()=>[["datasets.".concat(t,".transitions.").concat(e),"transitions.".concat(e)],["datasets.".concat(t),""]])}datasetElementScopeKeys(t,e){return ii("".concat(t,"-").concat(e),()=>[["datasets.".concat(t,".elements.").concat(e),"datasets.".concat(t),"elements.".concat(e),""]])}pluginScopeKeys(t){const e=t.id,i=this.type;return ii("".concat(i,"-plugin-").concat(e),()=>[["plugins.".concat(e),...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const i=this._scopeCache;let o=i.get(t);return(!o||e)&&(o=new Map,i.set(t,o)),o}getOptionScopes(t,e,i){const{options:o,type:s}=this,a=this._cachedScopes(t,i),r=a.get(e);if(r)return r;const l=new Set;e.forEach(d=>{t&&(l.add(t),d.forEach(u=>Cn(l,t,u))),d.forEach(u=>Cn(l,o,u)),d.forEach(u=>Cn(l,ln[s]||{},u)),d.forEach(u=>Cn(l,jt,u)),d.forEach(u=>Cn(l,uo,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),Za.has(e)&&a.set(e,c),c}chartOptionScopes(){const{options:t,type:e}=this;return[t,ln[e]||{},jt.datasets[e]||{},{type:e},jt,uo]}resolveNamedOptions(t,e,i,o=[""]){const s={$shared:!0},{resolver:a,subPrefixes:r}=Bs(this._resolverCache,t,o);let l=a;if(Ad(a,e)){s.$shared=!1,i=qe(i)?i():i;const c=this.createResolver(t,i,r);l=mn(a,i,c)}for(const c of e)s[c]=l[c];return s}createResolver(t,e,i=[""],o){const{resolver:s}=Bs(this._resolverCache,t,i);return At(e)?mn(s,e,void 0,o):s}}function Bs(n,t,e){let i=n.get(t);i||(i=new Map,n.set(t,i));const o=e.join();let s=i.get(o);return s||(s={resolver:Oo(t,e),subPrefixes:e.filter(r=>!r.toLowerCase().includes("hover"))},i.set(o,s)),s}const Pd=n=>At(n)&&Object.getOwnPropertyNames(n).some(t=>qe(n[t]));function Ad(n,t){const{isScriptable:e,isIndexable:i}=Ta(n);for(const o of t){const s=e(o),a=i(o),r=(a||s)&&n[o];if(s&&(qe(r)||Pd(r))||a&&Ht(r))return!0}return!1}var Bd="4.5.0";const Ld=["top","bottom","left","right","chartArea"];function Ls(n,t){return n==="top"||n==="bottom"||Ld.indexOf(n)===-1&&t==="x"}function Os(n,t){return function(e,i){return e[n]===i[n]?e[t]-i[t]:e[n]-i[n]}}function Fs(n){const t=n.chart,e=t.options.animation;t.notifyPlugins("afterRender"),Vt(e&&e.onComplete,[n],t)}function Od(n){const t=n.chart,e=t.options.animation;Vt(e&&e.onProgress,[n],t)}function Qa(n){return Ro()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const gi={},Ns=n=>{const t=Qa(n);return Object.values(gi).filter(e=>e.canvas===t).pop()};function Fd(n,t,e){const i=Object.keys(n);for(const o of i){const s=+o;if(s>=t){const a=n[o];delete n[o],(e>0||s>t)&&(n[s+e]=a)}}}function Nd(n,t,e,i){return!e||n.type==="mouseout"?null:i?t:n}var Ve;let Le=(Ve=class{static register(...t){ke.add(...t),Rs()}static unregister(...t){ke.remove(...t),Rs()}constructor(t,e){const i=this.config=new Td(e),o=Qa(t),s=Ns(o);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas with ID '"+s.canvas.id+"' can be reused.");const a=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||ed(o)),this.platform.updateConfig(i);const r=this.platform.acquireContext(o,a.aspectRatio),l=r&&r.canvas,c=l&&l.height,d=l&&l.width;if(this.id=Rr(),this.ctx=r,this.canvas=l,this.width=d,this.height=c,this._options=a,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new yd,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=el(u=>this.update(u),a.resizeDelay||0),this._dataChanges=[],gi[this.id]=this,!r||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Pe.listen(this,"complete",Fs),Pe.listen(this,"progress",Od),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:o,_aspectRatio:s}=this;return Tt(t)?e&&s?s:o?i/o:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return ke}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():as(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return is(this.canvas,this.ctx),this}stop(){return Pe.stop(this),this}resize(t,e){Pe.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,o=this.canvas,s=i.maintainAspectRatio&&this.aspectRatio,a=this.platform.getMaximumSize(o,t,e,s),r=i.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=a.width,this.height=a.height,this._aspectRatio=this.aspectRatio,as(this,r,!0)&&(this.notifyPlugins("resize",{size:a}),Vt(i.onResize,[this,a],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};Nt(e,(i,o)=>{i.id=o})}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,o=Object.keys(i).reduce((a,r)=>(a[r]=!1,a),{});let s=[];e&&(s=s.concat(Object.keys(e).map(a=>{const r=e[a],l=mo(a,r),c=l==="r",d=l==="x";return{options:r,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),Nt(s,a=>{const r=a.options,l=r.id,c=mo(l,r),d=Dt(r.type,a.dtype);(r.position===void 0||Ls(r.position,c)!==Ls(a.dposition))&&(r.position=a.dposition),o[l]=!0;let u=null;if(l in i&&i[l].type===d)u=i[l];else{const f=ke.getScale(d);u=new f({id:l,type:d,ctx:this.ctx,chart:this}),i[u.id]=u}u.init(r,t)}),Nt(o,(a,r)=>{a||delete i[r]}),Nt(i,a=>{le.configure(this,a,a.options),le.addBox(this,a)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort((o,s)=>o.index-s.index),i>e){for(let o=e;o<i;++o)this._destroyDatasetMeta(o);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(Os("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((i,o)=>{e.filter(s=>s===i._dataset).length===0&&this._destroyDatasetMeta(o)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,o;for(this._removeUnreferencedMetasets(),i=0,o=e.length;i<o;i++){const s=e[i];let a=this.getDatasetMeta(i);const r=s.type||this.config.type;if(a.type&&a.type!==r&&(this._destroyDatasetMeta(i),a=this.getDatasetMeta(i)),a.type=r,a.indexAxis=s.indexAxis||po(r,this.options),a.order=s.order||0,a.index=i,a.label=""+s.label,a.visible=this.isDatasetVisible(i),a.controller)a.controller.updateIndex(i),a.controller.linkScales();else{const l=ke.getController(r),{datasetElementType:c,dataElementType:d}=jt.datasets[r];Object.assign(l,{dataElementType:ke.getElement(d),datasetElementType:c&&ke.getElement(c)}),a.controller=new l(this,i),t.push(a.controller)}}return this._updateMetasets(),t}_resetElements(){Nt(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),o=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let a=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:u}=this.getDatasetMeta(c),f=!o&&s.indexOf(u)===-1;u.buildOrUpdateElements(f),a=Math.max(+u.getMaxOverflow(),a)}a=this._minPadding=i.layout.autoPadding?a:0,this._updateLayout(a),o||Nt(s,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(Os("z","_idx"));const{_active:r,_lastEvent:l}=this;l?this._eventHandler(l,!0):r.length&&this._updateHoverStyles(r,r,!0),this.render()}_updateScales(){Nt(this.scales,t=>{le.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!Go(e,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:o,count:s}of e){const a=i==="_removeElements"?-s:s;Fd(t,o,a)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=s=>new Set(t.filter(a=>a[0]===s).map((a,r)=>r+","+a.splice(1).join(","))),o=i(0);for(let s=1;s<e;s++)if(!Go(o,i(s)))return;return Array.from(o).map(s=>s.split(",")).map(s=>({method:s[1],start:+s[2],count:+s[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;le.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],Nt(this.boxes,o=>{i&&o.position==="chartArea"||(o.configure&&o.configure(),this._layers.push(...o._layers()))},this),this._layers.forEach((o,s)=>{o._idx=s}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,i=this.data.datasets.length;e<i;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,qe(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),o={meta:i,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",o)!==!1&&(i.controller._update(e),o.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",o))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Pe.has(this)?this.attached&&!Pe.running(this)&&Pe.start(this):(this.draw(),Fs({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:o}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,o)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let o,s;for(o=0,s=e.length;o<s;++o){const a=e[o];(!t||a.visible)&&i.push(a)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i={meta:t,index:t.index,cancelable:!0},o=Ua(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(o&&Li(e,o),t.controller.draw(),o&&Oi(e),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return Ne(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,o){const s=Lc.modes[e];return typeof s=="function"?s(this,t,i,o):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let o=i.filter(s=>s&&s._dataset===e).pop();return o||(o={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(o)),o}getContext(){return this.$context||(this.$context=Ge(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!e.hidden}setDatasetVisibility(t,e){const i=this.getDatasetMeta(t);i.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const o=i?"show":"hide",s=this.getDatasetMeta(t),a=s.controller._resolveAnimations(void 0,o);Vn(e)?(s.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),a.update(s,{visible:i}),this.update(r=>r.datasetIndex===t?o:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),Pe.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),is(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete gi[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(s,a)=>{e.addEventListener(this,s,a),t[s]=a},o=(s,a,r)=>{s.offsetX=a,s.offsetY=r,this._eventHandler(s)};Nt(this.options.events,s=>i(s,o))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(l,c)=>{e.addEventListener(this,l,c),t[l]=c},o=(l,c)=>{t[l]&&(e.removeEventListener(this,l,c),delete t[l])},s=(l,c)=>{this.canvas&&this.resize(l,c)};let a;const r=()=>{o("attach",r),this.attached=!0,this.resize(),i("resize",s),i("detach",a)};a=()=>{this.attached=!1,o("resize",s),this._stop(),this._resize(0,0),i("attach",r)},e.isAttached(this.canvas)?r():a()}unbindEvents(){Nt(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},Nt(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const o=i?"set":"remove";let s,a,r,l;for(e==="dataset"&&(s=this.getDatasetMeta(t[0].datasetIndex),s.controller["_"+o+"DatasetHoverStyle"]()),r=0,l=t.length;r<l;++r){a=t[r];const c=a&&this.getDatasetMeta(a.datasetIndex).controller;c&&c[o+"HoverStyle"](a.element,a.datasetIndex,a.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map(({datasetIndex:s,index:a})=>{const r=this.getDatasetMeta(s);if(!r)throw new Error("No dataset found at index "+s);return{datasetIndex:s,element:r.data[a],index:a}});!xi(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,i){const o=this.options.hover,s=(l,c)=>l.filter(d=>!c.some(u=>d.datasetIndex===u.datasetIndex&&d.index===u.index)),a=s(e,t),r=i?t:s(t,e);a.length&&this.updateHoverStyle(a,o.mode,!1),r.length&&o.mode&&this.updateHoverStyle(r,o.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},o=a=>(a.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,o)===!1)return;const s=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,o),(s||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:o=[],options:s}=this,a=e,r=this._getActiveElements(t,o,i,a),l=Wr(t),c=Nd(t,this._lastEvent,i,l);i&&(this._lastEvent=null,Vt(s.onHover,[t,r,this],this),l&&Vt(s.onClick,[t,r,this],this));const d=!xi(r,o);return(d||e)&&(this._active=r,this._updateHoverStyles(r,o,e)),this._lastEvent=c,d}_getActiveElements(t,e,i,o){if(t.type==="mouseout")return[];if(!i)return e;const s=this.options.hover;return this.getElementsAtEventForMode(t,s.mode,s,o)}},mt(Ve,"defaults",jt),mt(Ve,"instances",gi),mt(Ve,"overrides",ln),mt(Ve,"registry",ke),mt(Ve,"version",Bd),mt(Ve,"getChart",Ns),Ve);function Rs(){return Nt(Le.instances,n=>n._plugins.invalidate())}function Rd(n,t,e){const{startAngle:i,x:o,y:s,outerRadius:a,innerRadius:r,options:l}=t,{borderWidth:c,borderJoinStyle:d}=l,u=Math.min(c/a,re(i-e));if(n.beginPath(),n.arc(o,s,a-c/2,i+u/2,e-u/2),r>0){const f=Math.min(c/r,re(i-e));n.arc(o,s,r+c/2,e-f/2,i+f/2,!0)}else{const f=Math.min(c/2,a*re(i-e));if(d==="round")n.arc(o,s,f,e-Ot/2,i+Ot/2,!0);else if(d==="bevel"){const h=2*f*f,w=-h*Math.cos(e+Ot/2)+o,_=-h*Math.sin(e+Ot/2)+s,S=h*Math.cos(i+Ot/2)+o,F=h*Math.sin(i+Ot/2)+s;n.lineTo(w,_),n.lineTo(S,F)}}n.closePath(),n.moveTo(0,0),n.rect(0,0,n.canvas.width,n.canvas.height),n.clip("evenodd")}function Vd(n,t,e){const{startAngle:i,pixelMargin:o,x:s,y:a,outerRadius:r,innerRadius:l}=t;let c=o/r;n.beginPath(),n.arc(s,a,r,i-c,e+c),l>o?(c=o/l,n.arc(s,a,l,e+c,i-c,!0)):n.arc(s,a,o,e+Xt,i-Xt),n.closePath(),n.clip()}function zd(n){return Lo(n,["outerStart","outerEnd","innerStart","innerEnd"])}function Ud(n,t,e,i){const o=zd(n.options.borderRadius),s=(e-t)/2,a=Math.min(s,i*t/2),r=l=>{const c=(e-Math.min(s,l))*i/2;return ee(l,0,Math.min(s,c))};return{outerStart:r(o.outerStart),outerEnd:r(o.outerEnd),innerStart:ee(o.innerStart,0,a),innerEnd:ee(o.innerEnd,0,a)}}function fn(n,t,e,i){return{x:e+n*Math.cos(t),y:i+n*Math.sin(t)}}function Mi(n,t,e,i,o,s){const{x:a,y:r,startAngle:l,pixelMargin:c,innerRadius:d}=t,u=Math.max(t.outerRadius+i+e-c,0),f=d>0?d+i+e+c:0;let h=0;const w=o-l;if(i){const nt=d>0?d-i:0,ct=u>0?u-i:0,$=(nt+ct)/2,V=$!==0?w*$/($+i):w;h=(w-V)/2}const _=Math.max(.001,w*u-e/Ot)/u,S=(w-_)/2,F=l+S+h,R=o-S-h,{outerStart:tt,outerEnd:rt,innerStart:b,innerEnd:D}=Ud(t,f,u,R-F),N=u-tt,A=u-rt,U=F+tt/N,j=R-rt/A,z=f+b,W=f+D,lt=F+b/z,Y=R-D/W;if(n.beginPath(),s){const nt=(U+j)/2;if(n.arc(a,r,u,U,nt),n.arc(a,r,u,nt,j),rt>0){const L=fn(A,j,a,r);n.arc(L.x,L.y,rt,j,R+Xt)}const ct=fn(W,R,a,r);if(n.lineTo(ct.x,ct.y),D>0){const L=fn(W,Y,a,r);n.arc(L.x,L.y,D,R+Xt,Y+Math.PI)}const $=(R-D/f+(F+b/f))/2;if(n.arc(a,r,f,R-D/f,$,!0),n.arc(a,r,f,$,F+b/f,!0),b>0){const L=fn(z,lt,a,r);n.arc(L.x,L.y,b,lt+Math.PI,F-Xt)}const V=fn(N,F,a,r);if(n.lineTo(V.x,V.y),tt>0){const L=fn(N,U,a,r);n.arc(L.x,L.y,tt,F-Xt,U)}}else{n.moveTo(a,r);const nt=Math.cos(U)*u+a,ct=Math.sin(U)*u+r;n.lineTo(nt,ct);const $=Math.cos(j)*u+a,V=Math.sin(j)*u+r;n.lineTo($,V)}n.closePath()}function Hd(n,t,e,i,o){const{fullCircles:s,startAngle:a,circumference:r}=t;let l=t.endAngle;if(s){Mi(n,t,e,i,l,o);for(let c=0;c<s;++c)n.fill();isNaN(r)||(l=a+(r%zt||zt))}return Mi(n,t,e,i,l,o),n.fill(),l}function jd(n,t,e,i,o){const{fullCircles:s,startAngle:a,circumference:r,options:l}=t,{borderWidth:c,borderJoinStyle:d,borderDash:u,borderDashOffset:f,borderRadius:h}=l,w=l.borderAlign==="inner";if(!c)return;n.setLineDash(u||[]),n.lineDashOffset=f,w?(n.lineWidth=c*2,n.lineJoin=d||"round"):(n.lineWidth=c,n.lineJoin=d||"bevel");let _=t.endAngle;if(s){Mi(n,t,e,i,_,o);for(let S=0;S<s;++S)n.stroke();isNaN(r)||(_=a+(r%zt||zt))}w&&Vd(n,t,_),l.selfJoin&&_-a>=Ot&&h===0&&d!=="miter"&&Rd(n,t,_),s||(Mi(n,t,e,i,_,o),n.stroke())}class Mn extends Se{constructor(e){super();mt(this,"circumference");mt(this,"endAngle");mt(this,"fullCircles");mt(this,"innerRadius");mt(this,"outerRadius");mt(this,"pixelMargin");mt(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,i,o){const s=this.getProps(["x","y"],o),{angle:a,distance:r}=wa(s,{x:e,y:i}),{startAngle:l,endAngle:c,innerRadius:d,outerRadius:u,circumference:f}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],o),h=(this.options.spacing+this.options.borderWidth)/2,w=Dt(f,c-l),_=zn(a,l,c)&&l!==c,S=w>=zt||_,F=Oe(r,d+h,u+h);return S&&F}getCenterPoint(e){const{x:i,y:o,startAngle:s,endAngle:a,innerRadius:r,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:c,spacing:d}=this.options,u=(s+a)/2,f=(r+l+d+c)/2;return{x:i+Math.cos(u)*f,y:o+Math.sin(u)*f}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:i,circumference:o}=this,s=(i.offset||0)/4,a=(i.spacing||0)/2,r=i.circular;if(this.pixelMargin=i.borderAlign==="inner"?.33:0,this.fullCircles=o>zt?Math.floor(o/zt):0,o===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const l=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(l)*s,Math.sin(l)*s);const c=1-Math.sin(Math.min(Ot,o||0)),d=s*c;e.fillStyle=i.backgroundColor,e.strokeStyle=i.borderColor,Hd(e,this,d,a,r),jd(e,this,d,a,r),e.restore()}}mt(Mn,"id","arc"),mt(Mn,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),mt(Mn,"defaultRoutes",{backgroundColor:"backgroundColor"}),mt(Mn,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"});function tr(n,t,e=t){n.lineCap=Dt(e.borderCapStyle,t.borderCapStyle),n.setLineDash(Dt(e.borderDash,t.borderDash)),n.lineDashOffset=Dt(e.borderDashOffset,t.borderDashOffset),n.lineJoin=Dt(e.borderJoinStyle,t.borderJoinStyle),n.lineWidth=Dt(e.borderWidth,t.borderWidth),n.strokeStyle=Dt(e.borderColor,t.borderColor)}function Wd(n,t,e){n.lineTo(e.x,e.y)}function Yd(n){return n.stepped?hl:n.tension||n.cubicInterpolationMode==="monotone"?pl:Wd}function er(n,t,e={}){const i=n.length,{start:o=0,end:s=i-1}=e,{start:a,end:r}=t,l=Math.max(o,a),c=Math.min(s,r),d=o<a&&s<a||o>r&&s>r;return{count:i,start:l,loop:t.loop,ilen:c<l&&!d?i+c-l:c-l}}function $d(n,t,e,i){const{points:o,options:s}=t,{count:a,start:r,loop:l,ilen:c}=er(o,e,i),d=Yd(s);let{move:u=!0,reverse:f}=i||{},h,w,_;for(h=0;h<=c;++h)w=o[(r+(f?c-h:h))%a],!w.skip&&(u?(n.moveTo(w.x,w.y),u=!1):d(n,_,w,f,s.stepped),_=w);return l&&(w=o[(r+(f?c:0))%a],d(n,_,w,f,s.stepped)),!!l}function qd(n,t,e,i){const o=t.points,{count:s,start:a,ilen:r}=er(o,e,i),{move:l=!0,reverse:c}=i||{};let d=0,u=0,f,h,w,_,S,F;const R=rt=>(a+(c?r-rt:rt))%s,tt=()=>{_!==S&&(n.lineTo(d,S),n.lineTo(d,_),n.lineTo(d,F))};for(l&&(h=o[R(0)],n.moveTo(h.x,h.y)),f=0;f<=r;++f){if(h=o[R(f)],h.skip)continue;const rt=h.x,b=h.y,D=rt|0;D===w?(b<_?_=b:b>S&&(S=b),d=(u*d+rt)/++u):(tt(),n.lineTo(rt,b),w=D,u=0,_=S=b),F=b}tt()}function go(n){const t=n.options,e=t.borderDash&&t.borderDash.length;return!n._decimated&&!n._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?qd:$d}function Gd(n){return n.stepped?$l:n.tension||n.cubicInterpolationMode==="monotone"?ql:on}function Xd(n,t,e,i){let o=t._path;o||(o=t._path=new Path2D,t.path(o,e,i)&&o.closePath()),tr(n,t.options),n.stroke(o)}function Kd(n,t,e,i){const{segments:o,options:s}=t,a=go(t);for(const r of o)tr(n,s,r.style),n.beginPath(),a(n,t,r,{start:e,end:e+i-1})&&n.closePath(),n.stroke()}const Jd=typeof Path2D=="function";function Zd(n,t,e,i){Jd&&!t.options.segment?Xd(n,t,e,i):Kd(n,t,e,i)}class je extends Se{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const o=i.spanGaps?this._loop:this._fullLoop;Rl(this._points,i,t,o,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Ql(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,o=t[e],s=this.points,a=za(this,{property:e,start:o,end:o});if(!a.length)return;const r=[],l=Gd(i);let c,d;for(c=0,d=a.length;c<d;++c){const{start:u,end:f}=a[c],h=s[u],w=s[f];if(h===w){r.push(h);continue}const _=Math.abs((o-h[e])/(w[e]-h[e])),S=l(h,w,_,i.stepped);S[e]=t[e],r.push(S)}return r.length===1?r[0]:r}pathSegment(t,e,i){return go(this)(t,this,e,i)}path(t,e,i){const o=this.segments,s=go(this);let a=this._loop;e=e||0,i=i||this.points.length-e;for(const r of o)a&=s(t,this,r,{start:e,end:e+i-1});return!!a}draw(t,e,i,o){const s=this.options||{};(this.points||[]).length&&s.borderWidth&&(t.save(),Zd(t,this,i,o),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}mt(je,"id","line"),mt(je,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),mt(je,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),mt(je,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function Vs(n,t,e,i){const o=n.options,{[e]:s}=n.getProps([e],i);return Math.abs(t-s)<o.radius+o.hitRadius}class vi extends Se{constructor(e){super();mt(this,"parsed");mt(this,"skip");mt(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,i,o){const s=this.options,{x:a,y:r}=this.getProps(["x","y"],o);return Math.pow(e-a,2)+Math.pow(i-r,2)<Math.pow(s.hitRadius+s.radius,2)}inXRange(e,i){return Vs(this,e,"x",i)}inYRange(e,i){return Vs(this,e,"y",i)}getCenterPoint(e){const{x:i,y:o}=this.getProps(["x","y"],e);return{x:i,y:o}}size(e){e=e||this.options||{};let i=e.radius||0;i=Math.max(i,i&&e.hoverRadius||0);const o=i&&e.borderWidth||0;return(i+o)*2}draw(e,i){const o=this.options;this.skip||o.radius<.1||!Ne(this,i,this.size(o)/2)||(e.strokeStyle=o.borderColor,e.lineWidth=o.borderWidth,e.fillStyle=o.backgroundColor,fo(e,o,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}mt(vi,"id","point"),mt(vi,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),mt(vi,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function nr(n,t){const{x:e,y:i,base:o,width:s,height:a}=n.getProps(["x","y","base","width","height"],t);let r,l,c,d,u;return n.horizontal?(u=a/2,r=Math.min(e,o),l=Math.max(e,o),c=i-u,d=i+u):(u=s/2,r=e-u,l=e+u,c=Math.min(i,o),d=Math.max(i,o)),{left:r,top:c,right:l,bottom:d}}function We(n,t,e,i){return n?0:ee(t,e,i)}function Qd(n,t,e){const i=n.options.borderWidth,o=n.borderSkipped,s=Ea(i);return{t:We(o.top,s.top,0,e),r:We(o.right,s.right,0,t),b:We(o.bottom,s.bottom,0,e),l:We(o.left,s.left,0,t)}}function tu(n,t,e){const{enableBorderRadius:i}=n.getProps(["enableBorderRadius"]),o=n.options.borderRadius,s=an(o),a=Math.min(t,e),r=n.borderSkipped,l=i||At(o);return{topLeft:We(!l||r.top||r.left,s.topLeft,0,a),topRight:We(!l||r.top||r.right,s.topRight,0,a),bottomLeft:We(!l||r.bottom||r.left,s.bottomLeft,0,a),bottomRight:We(!l||r.bottom||r.right,s.bottomRight,0,a)}}function eu(n){const t=nr(n),e=t.right-t.left,i=t.bottom-t.top,o=Qd(n,e/2,i/2),s=tu(n,e/2,i/2);return{outer:{x:t.left,y:t.top,w:e,h:i,radius:s},inner:{x:t.left+o.l,y:t.top+o.t,w:e-o.l-o.r,h:i-o.t-o.b,radius:{topLeft:Math.max(0,s.topLeft-Math.max(o.t,o.l)),topRight:Math.max(0,s.topRight-Math.max(o.t,o.r)),bottomLeft:Math.max(0,s.bottomLeft-Math.max(o.b,o.l)),bottomRight:Math.max(0,s.bottomRight-Math.max(o.b,o.r))}}}}function Qi(n,t,e,i){const o=t===null,s=e===null,r=n&&!(o&&s)&&nr(n,i);return r&&(o||Oe(t,r.left,r.right))&&(s||Oe(e,r.top,r.bottom))}function nu(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function iu(n,t){n.rect(t.x,t.y,t.w,t.h)}function to(n,t,e={}){const i=n.x!==e.x?-t:0,o=n.y!==e.y?-t:0,s=(n.x+n.w!==e.x+e.w?t:0)-i,a=(n.y+n.h!==e.y+e.h?t:0)-o;return{x:n.x+i,y:n.y+o,w:n.w+s,h:n.h+a,radius:n.radius}}class bi extends Se{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:o}}=this,{inner:s,outer:a}=eu(this),r=nu(a.radius)?Un:iu;t.save(),(a.w!==s.w||a.h!==s.h)&&(t.beginPath(),r(t,to(a,e,s)),t.clip(),r(t,to(s,-e,a)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),r(t,to(s,e)),t.fillStyle=o,t.fill(),t.restore()}inRange(t,e,i){return Qi(this,t,e,i)}inXRange(t,e){return Qi(this,t,null,e)}inYRange(t,e){return Qi(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:o,horizontal:s}=this.getProps(["x","y","base","horizontal"],t);return{x:s?(e+o)/2:e,y:s?i:(i+o)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}mt(bi,"id","bar"),mt(bi,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),mt(bi,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var ou=Object.freeze({__proto__:null,ArcElement:Mn,BarElement:bi,LineElement:je,PointElement:vi});const vo=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],zs=vo.map(n=>n.replace("rgb(","rgba(").replace(")",", 0.5)"));function ir(n){return vo[n%vo.length]}function or(n){return zs[n%zs.length]}function su(n,t){return n.borderColor=ir(t),n.backgroundColor=or(t),++t}function au(n,t){return n.backgroundColor=n.data.map(()=>ir(t++)),t}function ru(n,t){return n.backgroundColor=n.data.map(()=>or(t++)),t}function lu(n){let t=0;return(e,i)=>{const o=n.getDatasetMeta(i).controller;o instanceof sn?t=au(e,t):o instanceof On?t=ru(e,t):o&&(t=su(e,t))}}function Us(n){let t;for(t in n)if(n[t].borderColor||n[t].backgroundColor)return!0;return!1}function cu(n){return n&&(n.borderColor||n.backgroundColor)}function du(){return jt.borderColor!=="rgba(0,0,0,0.1)"||jt.backgroundColor!=="rgba(0,0,0,0.1)"}var uu={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(n,t,e){if(!e.enabled)return;const{data:{datasets:i},options:o}=n.config,{elements:s}=o,a=Us(i)||cu(o)||s&&Us(s)||du();if(!e.forceOverride&&a)return;const r=lu(n);i.forEach(r)}};function fu(n,t,e,i,o){const s=o.samples||i;if(s>=e)return n.slice(t,t+e);const a=[],r=(e-2)/(s-2);let l=0;const c=t+e-1;let d=t,u,f,h,w,_;for(a[l++]=n[d],u=0;u<s-2;u++){let S=0,F=0,R;const tt=Math.floor((u+1)*r)+1+t,rt=Math.min(Math.floor((u+2)*r)+1,e)+t,b=rt-tt;for(R=tt;R<rt;R++)S+=n[R].x,F+=n[R].y;S/=b,F/=b;const D=Math.floor(u*r)+1+t,N=Math.min(Math.floor((u+1)*r)+1,e)+t,{x:A,y:U}=n[d];for(h=w=-1,R=D;R<N;R++)w=.5*Math.abs((A-S)*(n[R].y-U)-(A-n[R].x)*(F-U)),w>h&&(h=w,f=n[R],_=R);a[l++]=f,d=_}return a[l++]=n[c],a}function hu(n,t,e,i){let o=0,s=0,a,r,l,c,d,u,f,h,w,_;const S=[],F=t+e-1,R=n[t].x,rt=n[F].x-R;for(a=t;a<t+e;++a){r=n[a],l=(r.x-R)/rt*i,c=r.y;const b=l|0;if(b===d)c<w?(w=c,u=a):c>_&&(_=c,f=a),o=(s*o+r.x)/++s;else{const D=a-1;if(!Tt(u)&&!Tt(f)){const N=Math.min(u,f),A=Math.max(u,f);N!==h&&N!==D&&S.push({...n[N],x:o}),A!==h&&A!==D&&S.push({...n[A],x:o})}a>0&&D!==h&&S.push(n[D]),S.push(r),d=b,s=0,w=_=c,u=f=h=a}}return S}function sr(n){if(n._decimated){const t=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function Hs(n){n.data.datasets.forEach(t=>{sr(t)})}function pu(n,t){const e=t.length;let i=0,o;const{iScale:s}=n,{min:a,max:r,minDefined:l,maxDefined:c}=s.getUserBounds();return l&&(i=ee(Fe(t,s.axis,a).lo,0,e-1)),c?o=ee(Fe(t,s.axis,r).hi+1,i,e)-i:o=e-i,{start:i,count:o}}var mu={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,t,e)=>{if(!e.enabled){Hs(n);return}const i=n.width;n.data.datasets.forEach((o,s)=>{const{_data:a,indexAxis:r}=o,l=n.getDatasetMeta(s),c=a||o.data;if(kn([r,n.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const d=n.scales[l.xAxisID];if(d.type!=="linear"&&d.type!=="time"||n.options.parsing)return;let{start:u,count:f}=pu(l,c);const h=e.threshold||4*i;if(f<=h){sr(o);return}Tt(a)&&(o._data=c,delete o.data,Object.defineProperty(o,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(_){this._data=_}}));let w;switch(e.algorithm){case"lttb":w=fu(c,u,f,i,e);break;case"min-max":w=hu(c,u,f,i);break;default:throw new Error("Unsupported decimation algorithm '".concat(e.algorithm,"'"))}o._decimated=w})},destroy(n){Hs(n)}};function gu(n,t,e){const i=n.segments,o=n.points,s=t.points,a=[];for(const r of i){let{start:l,end:c}=r;c=Ri(l,c,o);const d=bo(e,o[l],o[c],r.loop);if(!t.segments){a.push({source:r,target:d,start:o[l],end:o[c]});continue}const u=za(t,d);for(const f of u){const h=bo(e,s[f.start],s[f.end],f.loop),w=Va(r,o,h);for(const _ of w)a.push({source:_,target:f,start:{[e]:js(d,h,"start",Math.max)},end:{[e]:js(d,h,"end",Math.min)}})}}return a}function bo(n,t,e,i){if(i)return;let o=t[n],s=e[n];return n==="angle"&&(o=re(o),s=re(s)),{property:n,start:o,end:s}}function vu(n,t){const{x:e=null,y:i=null}=n||{},o=t.points,s=[];return t.segments.forEach(({start:a,end:r})=>{r=Ri(a,r,o);const l=o[a],c=o[r];i!==null?(s.push({x:l.x,y:i}),s.push({x:c.x,y:i})):e!==null&&(s.push({x:e,y:l.y}),s.push({x:e,y:c.y}))}),s}function Ri(n,t,e){for(;t>n;t--){const i=e[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function js(n,t,e,i){return n&&t?i(n[e],t[e]):n?n[e]:t?t[e]:0}function ar(n,t){let e=[],i=!1;return Ht(n)?(i=!0,e=n):e=vu(n,t),e.length?new je({points:e,options:{tension:0},_loop:i,_fullLoop:i}):null}function Ws(n){return n&&n.fill!==!1}function bu(n,t,e){let o=n[t].fill;const s=[t];let a;if(!e)return o;for(;o!==!1&&s.indexOf(o)===-1;){if(!qt(o))return o;if(a=n[o],!a)return!1;if(a.visible)return o;s.push(o),o=a.fill}return!1}function yu(n,t,e){const i=Su(n);if(At(i))return isNaN(i.value)?!1:i;let o=parseFloat(i);return qt(o)&&Math.floor(o)===o?wu(i[0],t,o,e):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function wu(n,t,e,i){return(n==="-"||n==="+")&&(e=t+e),e===t||e<0||e>=i?!1:e}function _u(n,t){let e=null;return n==="start"?e=t.bottom:n==="end"?e=t.top:At(n)?e=t.getPixelForValue(n.value):t.getBasePixel&&(e=t.getBasePixel()),e}function xu(n,t,e){let i;return n==="start"?i=e:n==="end"?i=t.options.reverse?t.min:t.max:At(n)?i=n.value:i=t.getBaseValue(),i}function Su(n){const t=n.options,e=t.fill;let i=Dt(e&&e.target,e);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function Cu(n){const{scale:t,index:e,line:i}=n,o=[],s=i.segments,a=i.points,r=Du(t,e);r.push(ar({x:null,y:t.bottom},i));for(let l=0;l<s.length;l++){const c=s[l];for(let d=c.start;d<=c.end;d++)ku(o,a[d],r)}return new je({points:o,options:{}})}function Du(n,t){const e=[],i=n.getMatchingVisibleMetas("line");for(let o=0;o<i.length;o++){const s=i[o];if(s.index===t)break;s.hidden||e.unshift(s.dataset)}return e}function ku(n,t,e){const i=[];for(let o=0;o<e.length;o++){const s=e[o],{first:a,last:r,point:l}=Iu(s,t,"x");if(!(!l||a&&r)){if(a)i.unshift(l);else if(n.push(l),!r)break}}n.push(...i)}function Iu(n,t,e){const i=n.interpolate(t,e);if(!i)return{};const o=i[e],s=n.segments,a=n.points;let r=!1,l=!1;for(let c=0;c<s.length;c++){const d=s[c],u=a[d.start][e],f=a[d.end][e];if(Oe(o,u,f)){r=o===u,l=o===f;break}}return{first:r,last:l,point:i}}class rr{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:o,y:s,radius:a}=this;return e=e||{start:0,end:zt},t.arc(o,s,a,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:o}=this,s=t.angle;return{x:e+Math.cos(s)*o,y:i+Math.sin(s)*o,angle:s}}}function Mu(n){const{chart:t,fill:e,line:i}=n;if(qt(e))return Eu(t,e);if(e==="stack")return Cu(n);if(e==="shape")return!0;const o=Tu(n);return o instanceof rr?o:ar(o,i)}function Eu(n,t){const e=n.getDatasetMeta(t);return e&&n.isDatasetVisible(t)?e.dataset:null}function Tu(n){return(n.scale||{}).getPointPositionForValue?Au(n):Pu(n)}function Pu(n){const{scale:t={},fill:e}=n,i=_u(e,t);if(qt(i)){const o=t.isHorizontal();return{x:o?i:null,y:o?null:i}}return null}function Au(n){const{scale:t,fill:e}=n,i=t.options,o=t.getLabels().length,s=i.reverse?t.max:t.min,a=xu(e,t,s),r=[];if(i.grid.circular){const l=t.getPointPositionForValue(0,s);return new rr({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(a)})}for(let l=0;l<o;++l)r.push(t.getPointPositionForValue(l,a));return r}function eo(n,t,e){const i=Mu(t),{chart:o,index:s,line:a,scale:r,axis:l}=t,c=a.options,d=c.fill,u=c.backgroundColor,{above:f=u,below:h=u}=d||{},w=o.getDatasetMeta(s),_=Ua(o,w);i&&a.points.length&&(Li(n,e),Bu(n,{line:a,target:i,above:f,below:h,area:e,scale:r,axis:l,clip:_}),Oi(n))}function Bu(n,t){const{line:e,target:i,above:o,below:s,area:a,scale:r,clip:l}=t,c=e._loop?"angle":t.axis;n.save();let d=s;s!==o&&(c==="x"?(Ys(n,i,a.top),no(n,{line:e,target:i,color:o,scale:r,property:c,clip:l}),n.restore(),n.save(),Ys(n,i,a.bottom)):c==="y"&&($s(n,i,a.left),no(n,{line:e,target:i,color:s,scale:r,property:c,clip:l}),n.restore(),n.save(),$s(n,i,a.right),d=o)),no(n,{line:e,target:i,color:d,scale:r,property:c,clip:l}),n.restore()}function Ys(n,t,e){const{segments:i,points:o}=t;let s=!0,a=!1;n.beginPath();for(const r of i){const{start:l,end:c}=r,d=o[l],u=o[Ri(l,c,o)];s?(n.moveTo(d.x,d.y),s=!1):(n.lineTo(d.x,e),n.lineTo(d.x,d.y)),a=!!t.pathSegment(n,r,{move:a}),a?n.closePath():n.lineTo(u.x,e)}n.lineTo(t.first().x,e),n.closePath(),n.clip()}function $s(n,t,e){const{segments:i,points:o}=t;let s=!0,a=!1;n.beginPath();for(const r of i){const{start:l,end:c}=r,d=o[l],u=o[Ri(l,c,o)];s?(n.moveTo(d.x,d.y),s=!1):(n.lineTo(e,d.y),n.lineTo(d.x,d.y)),a=!!t.pathSegment(n,r,{move:a}),a?n.closePath():n.lineTo(e,u.y)}n.lineTo(e,t.first().y),n.closePath(),n.clip()}function no(n,t){const{line:e,target:i,property:o,color:s,scale:a,clip:r}=t,l=gu(e,i,o);for(const{source:c,target:d,start:u,end:f}of l){const{style:{backgroundColor:h=s}={}}=c,w=i!==!0;n.save(),n.fillStyle=h,Lu(n,a,r,w&&bo(o,u,f)),n.beginPath();const _=!!e.pathSegment(n,c);let S;if(w){_?n.closePath():qs(n,i,f,o);const F=!!i.pathSegment(n,d,{move:_,reverse:!0});S=_&&F,S||qs(n,i,u,o)}n.closePath(),n.fill(S?"evenodd":"nonzero"),n.restore()}}function Lu(n,t,e,i){const o=t.chart.chartArea,{property:s,start:a,end:r}=i||{};if(s==="x"||s==="y"){let l,c,d,u;s==="x"?(l=a,c=o.top,d=r,u=o.bottom):(l=o.left,c=a,d=o.right,u=r),n.beginPath(),e&&(l=Math.max(l,e.left),d=Math.min(d,e.right),c=Math.max(c,e.top),u=Math.min(u,e.bottom)),n.rect(l,c,d-l,u-c),n.clip()}}function qs(n,t,e,i){const o=t.interpolate(e,i);o&&n.lineTo(o.x,o.y)}var Ou={id:"filler",afterDatasetsUpdate(n,t,e){const i=(n.data.datasets||[]).length,o=[];let s,a,r,l;for(a=0;a<i;++a)s=n.getDatasetMeta(a),r=s.dataset,l=null,r&&r.options&&r instanceof je&&(l={visible:n.isDatasetVisible(a),index:a,fill:yu(r,a,i),chart:n,axis:s.controller.options.indexAxis,scale:s.vScale,line:r}),s.$filler=l,o.push(l);for(a=0;a<i;++a)l=o[a],!(!l||l.fill===!1)&&(l.fill=bu(o,a,e.propagate))},beforeDraw(n,t,e){const i=e.drawTime==="beforeDraw",o=n.getSortedVisibleDatasetMetas(),s=n.chartArea;for(let a=o.length-1;a>=0;--a){const r=o[a].$filler;r&&(r.line.updateControlPoints(s,r.axis),i&&r.fill&&eo(n.ctx,r,s))}},beforeDatasetsDraw(n,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const i=n.getSortedVisibleDatasetMetas();for(let o=i.length-1;o>=0;--o){const s=i[o].$filler;Ws(s)&&eo(n.ctx,s,n.chartArea)}},beforeDatasetDraw(n,t,e){const i=t.meta.$filler;!Ws(i)||e.drawTime!=="beforeDatasetDraw"||eo(n.ctx,i,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Gs=(n,t)=>{let{boxHeight:e=t,boxWidth:i=t}=n;return n.usePointStyle&&(e=Math.min(e,t),i=n.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:e,itemHeight:Math.max(t,e)}},Fu=(n,t)=>n!==null&&t!==null&&n.datasetIndex===t.datasetIndex&&n.index===t.index;class Xs extends Se{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=Vt(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(i=>t.filter(i,this.chart.data))),t.sort&&(e=e.sort((i,o)=>t.sort(i,o,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,o=Qt(i.font),s=o.size,a=this._computeTitleHeight(),{boxWidth:r,itemHeight:l}=Gs(i,s);let c,d;e.font=o.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(a,s,r,l)+10):(d=this.maxHeight,c=this._fitCols(a,o,r,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(d,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,o){const{ctx:s,maxWidth:a,options:{labels:{padding:r}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=o+r;let u=t;s.textAlign="left",s.textBaseline="middle";let f=-1,h=-d;return this.legendItems.forEach((w,_)=>{const S=i+e/2+s.measureText(w.text).width;(_===0||c[c.length-1]+S+2*r>a)&&(u+=d,c[c.length-(_>0?0:1)]=0,h+=d,f++),l[_]={left:0,top:h,row:f,width:S,height:o},c[c.length-1]+=S+r}),u}_fitCols(t,e,i,o){const{ctx:s,maxHeight:a,options:{labels:{padding:r}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=a-t;let u=r,f=0,h=0,w=0,_=0;return this.legendItems.forEach((S,F)=>{const{itemWidth:R,itemHeight:tt}=Nu(i,e,s,S,o);F>0&&h+tt+2*r>d&&(u+=f+r,c.push({width:f,height:h}),w+=f+r,_++,f=h=0),l[F]={left:w,top:h,col:_,width:R,height:tt},f=Math.max(f,R),h+=tt+r}),u+=f,c.push({width:f,height:h}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:o},rtl:s}}=this,a=hn(s,this.left,this.width);if(this.isHorizontal()){let r=0,l=ae(i,this.left+o,this.right-this.lineWidths[r]);for(const c of e)r!==c.row&&(r=c.row,l=ae(i,this.left+o,this.right-this.lineWidths[r])),c.top+=this.top+t+o,c.left=a.leftForLtr(a.x(l),c.width),l+=c.width+o}else{let r=0,l=ae(i,this.top+t+o,this.bottom-this.columnSizes[r].height);for(const c of e)c.col!==r&&(r=c.col,l=ae(i,this.top+t+o,this.bottom-this.columnSizes[r].height)),c.top=l,c.left+=this.left+o,c.left=a.leftForLtr(a.x(c.left),c.width),l+=c.height+o}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;Li(t,this),this._draw(),Oi(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:o}=this,{align:s,labels:a}=t,r=jt.color,l=hn(t.rtl,this.left,this.width),c=Qt(a.font),{padding:d}=a,u=c.size,f=u/2;let h;this.drawTitle(),o.textAlign=l.textAlign("left"),o.textBaseline="middle",o.lineWidth=.5,o.font=c.string;const{boxWidth:w,boxHeight:_,itemHeight:S}=Gs(a,u),F=function(D,N,A){if(isNaN(w)||w<=0||isNaN(_)||_<0)return;o.save();const U=Dt(A.lineWidth,1);if(o.fillStyle=Dt(A.fillStyle,r),o.lineCap=Dt(A.lineCap,"butt"),o.lineDashOffset=Dt(A.lineDashOffset,0),o.lineJoin=Dt(A.lineJoin,"miter"),o.lineWidth=U,o.strokeStyle=Dt(A.strokeStyle,r),o.setLineDash(Dt(A.lineDash,[])),a.usePointStyle){const j={radius:_*Math.SQRT2/2,pointStyle:A.pointStyle,rotation:A.rotation,borderWidth:U},z=l.xPlus(D,w/2),W=N+f;Ma(o,j,z,W,a.pointStyleWidth&&w)}else{const j=N+Math.max((u-_)/2,0),z=l.leftForLtr(D,w),W=an(A.borderRadius);o.beginPath(),Object.values(W).some(lt=>lt!==0)?Un(o,{x:z,y:j,w,h:_,radius:W}):o.rect(z,j,w,_),o.fill(),U!==0&&o.stroke()}o.restore()},R=function(D,N,A){cn(o,A.text,D,N+S/2,c,{strikethrough:A.hidden,textAlign:l.textAlign(A.textAlign)})},tt=this.isHorizontal(),rt=this._computeTitleHeight();tt?h={x:ae(s,this.left+d,this.right-i[0]),y:this.top+d+rt,line:0}:h={x:this.left+d,y:ae(s,this.top+rt+d,this.bottom-e[0].height),line:0},Fa(this.ctx,t.textDirection);const b=S+d;this.legendItems.forEach((D,N)=>{o.strokeStyle=D.fontColor,o.fillStyle=D.fontColor;const A=o.measureText(D.text).width,U=l.textAlign(D.textAlign||(D.textAlign=a.textAlign)),j=w+f+A;let z=h.x,W=h.y;l.setWidth(this.width),tt?N>0&&z+j+d>this.right&&(W=h.y+=b,h.line++,z=h.x=ae(s,this.left+d,this.right-i[h.line])):N>0&&W+b>this.bottom&&(z=h.x=z+e[h.line].width+d,h.line++,W=h.y=ae(s,this.top+rt+d,this.bottom-e[h.line].height));const lt=l.x(z);if(F(lt,W,D),z=nl(U,z+w+f,tt?z+j:this.right,t.rtl),R(l.x(z),W,D),tt)h.x+=j+d;else if(typeof D.text!="string"){const Y=c.lineHeight;h.y+=lr(D,Y)+d}else h.y+=b}),Na(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=Qt(e.font),o=ce(e.padding);if(!e.display)return;const s=hn(t.rtl,this.left,this.width),a=this.ctx,r=e.position,l=i.size/2,c=o.top+l;let d,u=this.left,f=this.width;if(this.isHorizontal())f=Math.max(...this.lineWidths),d=this.top+c,u=ae(t.align,u,this.right-f);else{const w=this.columnSizes.reduce((_,S)=>Math.max(_,S.height),0);d=c+ae(t.align,this.top,this.bottom-w-t.labels.padding-this._computeTitleHeight())}const h=ae(r,u,u+f);a.textAlign=s.textAlign(Ao(r)),a.textBaseline="middle",a.strokeStyle=e.color,a.fillStyle=e.color,a.font=i.string,cn(a,e.text,h,d,i)}_computeTitleHeight(){const t=this.options.title,e=Qt(t.font),i=ce(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,o,s;if(Oe(t,this.left,this.right)&&Oe(e,this.top,this.bottom)){for(s=this.legendHitBoxes,i=0;i<s.length;++i)if(o=s[i],Oe(t,o.left,o.left+o.width)&&Oe(e,o.top,o.top+o.height))return this.legendItems[i]}return null}handleEvent(t){const e=this.options;if(!zu(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const o=this._hoveredItem,s=Fu(o,i);o&&!s&&Vt(e.onLeave,[t,o,this],this),this._hoveredItem=i,i&&!s&&Vt(e.onHover,[t,i,this],this)}else i&&Vt(e.onClick,[t,i,this],this)}}function Nu(n,t,e,i,o){const s=Ru(i,n,t,e),a=Vu(o,i,t.lineHeight);return{itemWidth:s,itemHeight:a}}function Ru(n,t,e,i){let o=n.text;return o&&typeof o!="string"&&(o=o.reduce((s,a)=>s.length>a.length?s:a)),t+e.size/2+i.measureText(o).width}function Vu(n,t,e){let i=n;return typeof t.text!="string"&&(i=lr(t,e)),i}function lr(n,t){const e=n.text?n.text.length:0;return t*e}function zu(n,t){return!!((n==="mousemove"||n==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(n==="click"||n==="mouseup"))}var Uu={id:"legend",_element:Xs,start(n,t,e){const i=n.legend=new Xs({ctx:n.ctx,options:e,chart:n});le.configure(n,i,e),le.addBox(n,i)},stop(n){le.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,t,e){const i=n.legend;le.configure(n,i,e),i.options=e},afterUpdate(n){const t=n.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(n,t){t.replay||n.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,t,e){const i=t.datasetIndex,o=e.chart;o.isDatasetVisible(i)?(o.hide(i),t.hidden=!0):(o.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const t=n.data.datasets,{labels:{usePointStyle:e,pointStyle:i,textAlign:o,color:s,useBorderRadius:a,borderRadius:r}}=n.legend.options;return n._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(e?0:void 0),d=ce(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:s,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:i||c.pointStyle,rotation:c.rotation,textAlign:o||c.textAlign,borderRadius:a&&(r||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class Uo extends Se{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const o=Ht(i.text)?i.text.length:1;this._padding=ce(i.padding);const s=o*Qt(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=s:this.width=s}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:i,bottom:o,right:s,options:a}=this,r=a.align;let l=0,c,d,u;return this.isHorizontal()?(d=ae(r,i,s),u=e+t,c=s-i):(a.position==="left"?(d=i+t,u=ae(r,o,e),l=Ot*-.5):(d=s-t,u=ae(r,e,o),l=Ot*.5),c=o-e),{titleX:d,titleY:u,maxWidth:c,rotation:l}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=Qt(e.font),s=i.lineHeight/2+this._padding.top,{titleX:a,titleY:r,maxWidth:l,rotation:c}=this._drawArgs(s);cn(t,e.text,0,0,i,{color:e.color,maxWidth:l,rotation:c,textAlign:Ao(e.align),textBaseline:"middle",translation:[a,r]})}}function Hu(n,t){const e=new Uo({ctx:n.ctx,options:t,chart:n});le.configure(n,e,t),le.addBox(n,e),n.titleBlock=e}var ju={id:"title",_element:Uo,start(n,t,e){Hu(n,e)},stop(n){const t=n.titleBlock;le.removeBox(n,t),delete n.titleBlock},beforeUpdate(n,t,e){const i=n.titleBlock;le.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const oi=new WeakMap;var Wu={id:"subtitle",start(n,t,e){const i=new Uo({ctx:n.ctx,options:e,chart:n});le.configure(n,i,e),le.addBox(n,i),oi.set(n,i)},stop(n){le.removeBox(n,oi.get(n)),oi.delete(n)},beforeUpdate(n,t,e){const i=oi.get(n);le.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const En={average(n){if(!n.length)return!1;let t,e,i=new Set,o=0,s=0;for(t=0,e=n.length;t<e;++t){const r=n[t].element;if(r&&r.hasValue()){const l=r.tooltipPosition();i.add(l.x),o+=l.y,++s}}return s===0||i.size===0?!1:{x:[...i].reduce((r,l)=>r+l)/i.size,y:o/s}},nearest(n,t){if(!n.length)return!1;let e=t.x,i=t.y,o=Number.POSITIVE_INFINITY,s,a,r;for(s=0,a=n.length;s<a;++s){const l=n[s].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=co(t,c);d<o&&(o=d,r=l)}}if(r){const l=r.tooltipPosition();e=l.x,i=l.y}return{x:e,y:i}}};function Ce(n,t){return t&&(Ht(t)?Array.prototype.push.apply(n,t):n.push(t)),n}function Ae(n){return(typeof n=="string"||n instanceof String)&&n.indexOf("\n")>-1?n.split("\n"):n}function Yu(n,t){const{element:e,datasetIndex:i,index:o}=t,s=n.getDatasetMeta(i).controller,{label:a,value:r}=s.getLabelAndValue(o);return{chart:n,label:a,parsed:s.getParsed(o),raw:n.data.datasets[i].data[o],formattedValue:r,dataset:s.getDataset(),dataIndex:o,datasetIndex:i,element:e}}function Ks(n,t){const e=n.chart.ctx,{body:i,footer:o,title:s}=n,{boxWidth:a,boxHeight:r}=t,l=Qt(t.bodyFont),c=Qt(t.titleFont),d=Qt(t.footerFont),u=s.length,f=o.length,h=i.length,w=ce(t.padding);let _=w.height,S=0,F=i.reduce((rt,b)=>rt+b.before.length+b.lines.length+b.after.length,0);if(F+=n.beforeBody.length+n.afterBody.length,u&&(_+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),F){const rt=t.displayColors?Math.max(r,l.lineHeight):l.lineHeight;_+=h*rt+(F-h)*l.lineHeight+(F-1)*t.bodySpacing}f&&(_+=t.footerMarginTop+f*d.lineHeight+(f-1)*t.footerSpacing);let R=0;const tt=function(rt){S=Math.max(S,e.measureText(rt).width+R)};return e.save(),e.font=c.string,Nt(n.title,tt),e.font=l.string,Nt(n.beforeBody.concat(n.afterBody),tt),R=t.displayColors?a+2+t.boxPadding:0,Nt(i,rt=>{Nt(rt.before,tt),Nt(rt.lines,tt),Nt(rt.after,tt)}),R=0,e.font=d.string,Nt(n.footer,tt),e.restore(),S+=w.width,{width:S,height:_}}function $u(n,t){const{y:e,height:i}=t;return e<i/2?"top":e>n.height-i/2?"bottom":"center"}function qu(n,t,e,i){const{x:o,width:s}=i,a=e.caretSize+e.caretPadding;if(n==="left"&&o+s+a>t.width||n==="right"&&o-s-a<0)return!0}function Gu(n,t,e,i){const{x:o,width:s}=e,{width:a,chartArea:{left:r,right:l}}=n;let c="center";return i==="center"?c=o<=(r+l)/2?"left":"right":o<=s/2?c="left":o>=a-s/2&&(c="right"),qu(c,n,t,e)&&(c="center"),c}function Js(n,t,e){const i=e.yAlign||t.yAlign||$u(n,e);return{xAlign:e.xAlign||t.xAlign||Gu(n,t,e,i),yAlign:i}}function Xu(n,t){let{x:e,width:i}=n;return t==="right"?e-=i:t==="center"&&(e-=i/2),e}function Ku(n,t,e){let{y:i,height:o}=n;return t==="top"?i+=e:t==="bottom"?i-=o+e:i-=o/2,i}function Zs(n,t,e,i){const{caretSize:o,caretPadding:s,cornerRadius:a}=n,{xAlign:r,yAlign:l}=e,c=o+s,{topLeft:d,topRight:u,bottomLeft:f,bottomRight:h}=an(a);let w=Xu(t,r);const _=Ku(t,l,c);return l==="center"?r==="left"?w+=c:r==="right"&&(w-=c):r==="left"?w-=Math.max(d,f)+o:r==="right"&&(w+=Math.max(u,h)+o),{x:ee(w,0,i.width-t.width),y:ee(_,0,i.height-t.height)}}function si(n,t,e){const i=ce(e.padding);return t==="center"?n.x+n.width/2:t==="right"?n.x+n.width-i.right:n.x+i.left}function Qs(n){return Ce([],Ae(n))}function Ju(n,t,e){return Ge(n,{tooltip:t,tooltipItems:e,type:"tooltip"})}function ta(n,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?n.override(e):n}const cr={beforeTitle:Ee,title(n){if(n.length>0){const t=n[0],e=t.chart.data.labels,i=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return e[t.dataIndex]}return""},afterTitle:Ee,beforeBody:Ee,beforeLabel:Ee,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let t=n.dataset.label||"";t&&(t+=": ");const e=n.formattedValue;return Tt(e)||(t+=e),t},labelColor(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Ee,afterBody:Ee,beforeFooter:Ee,footer:Ee,afterFooter:Ee};function he(n,t,e,i){const o=n[t].call(e,i);return typeof o>"u"?cr[t].call(e,i):o}class yo extends Se{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),o=i.enabled&&e.options.animation&&i.animations,s=new Ha(this.chart,o);return o._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=Ju(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:i}=e,o=he(i,"beforeTitle",this,t),s=he(i,"title",this,t),a=he(i,"afterTitle",this,t);let r=[];return r=Ce(r,Ae(o)),r=Ce(r,Ae(s)),r=Ce(r,Ae(a)),r}getBeforeBody(t,e){return Qs(he(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:i}=e,o=[];return Nt(t,s=>{const a={before:[],lines:[],after:[]},r=ta(i,s);Ce(a.before,Ae(he(r,"beforeLabel",this,s))),Ce(a.lines,he(r,"label",this,s)),Ce(a.after,Ae(he(r,"afterLabel",this,s))),o.push(a)}),o}getAfterBody(t,e){return Qs(he(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:i}=e,o=he(i,"beforeFooter",this,t),s=he(i,"footer",this,t),a=he(i,"afterFooter",this,t);let r=[];return r=Ce(r,Ae(o)),r=Ce(r,Ae(s)),r=Ce(r,Ae(a)),r}_createItems(t){const e=this._active,i=this.chart.data,o=[],s=[],a=[];let r=[],l,c;for(l=0,c=e.length;l<c;++l)r.push(Yu(this.chart,e[l]));return t.filter&&(r=r.filter((d,u,f)=>t.filter(d,u,f,i))),t.itemSort&&(r=r.sort((d,u)=>t.itemSort(d,u,i))),Nt(r,d=>{const u=ta(t.callbacks,d);o.push(he(u,"labelColor",this,d)),s.push(he(u,"labelPointStyle",this,d)),a.push(he(u,"labelTextColor",this,d))}),this.labelColors=o,this.labelPointStyles=s,this.labelTextColors=a,this.dataPoints=r,r}update(t,e){const i=this.options.setContext(this.getContext()),o=this._active;let s,a=[];if(!o.length)this.opacity!==0&&(s={opacity:0});else{const r=En[i.position].call(this,o,this._eventPosition);a=this._createItems(i),this.title=this.getTitle(a,i),this.beforeBody=this.getBeforeBody(a,i),this.body=this.getBody(a,i),this.afterBody=this.getAfterBody(a,i),this.footer=this.getFooter(a,i);const l=this._size=Ks(this,i),c=Object.assign({},r,l),d=Js(this.chart,i,c),u=Zs(i,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,s={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:r.x,caretY:r.y}}this._tooltipItems=a,this.$context=void 0,s&&this._resolveAnimations().update(this,s),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,o){const s=this.getCaretPosition(t,i,o);e.lineTo(s.x1,s.y1),e.lineTo(s.x2,s.y2),e.lineTo(s.x3,s.y3)}getCaretPosition(t,e,i){const{xAlign:o,yAlign:s}=this,{caretSize:a,cornerRadius:r}=i,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:u}=an(r),{x:f,y:h}=t,{width:w,height:_}=e;let S,F,R,tt,rt,b;return s==="center"?(rt=h+_/2,o==="left"?(S=f,F=S-a,tt=rt+a,b=rt-a):(S=f+w,F=S+a,tt=rt-a,b=rt+a),R=S):(o==="left"?F=f+Math.max(l,d)+a:o==="right"?F=f+w-Math.max(c,u)-a:F=this.caretX,s==="top"?(tt=h,rt=tt-a,S=F-a,R=F+a):(tt=h+_,rt=tt+a,S=F+a,R=F-a),b=tt),{x1:S,x2:F,x3:R,y1:tt,y2:rt,y3:b}}drawTitle(t,e,i){const o=this.title,s=o.length;let a,r,l;if(s){const c=hn(i.rtl,this.x,this.width);for(t.x=si(this,i.titleAlign,i),e.textAlign=c.textAlign(i.titleAlign),e.textBaseline="middle",a=Qt(i.titleFont),r=i.titleSpacing,e.fillStyle=i.titleColor,e.font=a.string,l=0;l<s;++l)e.fillText(o[l],c.x(t.x),t.y+a.lineHeight/2),t.y+=a.lineHeight+r,l+1===s&&(t.y+=i.titleMarginBottom-r)}}_drawColorBox(t,e,i,o,s){const a=this.labelColors[i],r=this.labelPointStyles[i],{boxHeight:l,boxWidth:c}=s,d=Qt(s.bodyFont),u=si(this,"left",s),f=o.x(u),h=l<d.lineHeight?(d.lineHeight-l)/2:0,w=e.y+h;if(s.usePointStyle){const _={radius:Math.min(c,l)/2,pointStyle:r.pointStyle,rotation:r.rotation,borderWidth:1},S=o.leftForLtr(f,c)+c/2,F=w+l/2;t.strokeStyle=s.multiKeyBackground,t.fillStyle=s.multiKeyBackground,fo(t,_,S,F),t.strokeStyle=a.borderColor,t.fillStyle=a.backgroundColor,fo(t,_,S,F)}else{t.lineWidth=At(a.borderWidth)?Math.max(...Object.values(a.borderWidth)):a.borderWidth||1,t.strokeStyle=a.borderColor,t.setLineDash(a.borderDash||[]),t.lineDashOffset=a.borderDashOffset||0;const _=o.leftForLtr(f,c),S=o.leftForLtr(o.xPlus(f,1),c-2),F=an(a.borderRadius);Object.values(F).some(R=>R!==0)?(t.beginPath(),t.fillStyle=s.multiKeyBackground,Un(t,{x:_,y:w,w:c,h:l,radius:F}),t.fill(),t.stroke(),t.fillStyle=a.backgroundColor,t.beginPath(),Un(t,{x:S,y:w+1,w:c-2,h:l-2,radius:F}),t.fill()):(t.fillStyle=s.multiKeyBackground,t.fillRect(_,w,c,l),t.strokeRect(_,w,c,l),t.fillStyle=a.backgroundColor,t.fillRect(S,w+1,c-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:o}=this,{bodySpacing:s,bodyAlign:a,displayColors:r,boxHeight:l,boxWidth:c,boxPadding:d}=i,u=Qt(i.bodyFont);let f=u.lineHeight,h=0;const w=hn(i.rtl,this.x,this.width),_=function(A){e.fillText(A,w.x(t.x+h),t.y+f/2),t.y+=f+s},S=w.textAlign(a);let F,R,tt,rt,b,D,N;for(e.textAlign=a,e.textBaseline="middle",e.font=u.string,t.x=si(this,S,i),e.fillStyle=i.bodyColor,Nt(this.beforeBody,_),h=r&&S!=="right"?a==="center"?c/2+d:c+2+d:0,rt=0,D=o.length;rt<D;++rt){for(F=o[rt],R=this.labelTextColors[rt],e.fillStyle=R,Nt(F.before,_),tt=F.lines,r&&tt.length&&(this._drawColorBox(e,t,rt,w,i),f=Math.max(u.lineHeight,l)),b=0,N=tt.length;b<N;++b)_(tt[b]),f=u.lineHeight;Nt(F.after,_)}h=0,f=u.lineHeight,Nt(this.afterBody,_),t.y-=s}drawFooter(t,e,i){const o=this.footer,s=o.length;let a,r;if(s){const l=hn(i.rtl,this.x,this.width);for(t.x=si(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=l.textAlign(i.footerAlign),e.textBaseline="middle",a=Qt(i.footerFont),e.fillStyle=i.footerColor,e.font=a.string,r=0;r<s;++r)e.fillText(o[r],l.x(t.x),t.y+a.lineHeight/2),t.y+=a.lineHeight+i.footerSpacing}}drawBackground(t,e,i,o){const{xAlign:s,yAlign:a}=this,{x:r,y:l}=t,{width:c,height:d}=i,{topLeft:u,topRight:f,bottomLeft:h,bottomRight:w}=an(o.cornerRadius);e.fillStyle=o.backgroundColor,e.strokeStyle=o.borderColor,e.lineWidth=o.borderWidth,e.beginPath(),e.moveTo(r+u,l),a==="top"&&this.drawCaret(t,e,i,o),e.lineTo(r+c-f,l),e.quadraticCurveTo(r+c,l,r+c,l+f),a==="center"&&s==="right"&&this.drawCaret(t,e,i,o),e.lineTo(r+c,l+d-w),e.quadraticCurveTo(r+c,l+d,r+c-w,l+d),a==="bottom"&&this.drawCaret(t,e,i,o),e.lineTo(r+h,l+d),e.quadraticCurveTo(r,l+d,r,l+d-h),a==="center"&&s==="left"&&this.drawCaret(t,e,i,o),e.lineTo(r,l+u),e.quadraticCurveTo(r,l,r+u,l),e.closePath(),e.fill(),o.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,o=i&&i.x,s=i&&i.y;if(o||s){const a=En[t.position].call(this,this._active,this._eventPosition);if(!a)return;const r=this._size=Ks(this,t),l=Object.assign({},a,this._size),c=Js(e,t,l),d=Zs(t,l,c,e);(o._to!==d.x||s._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=r.width,this.height=r.height,this.caretX=a.x,this.caretY=a.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const o={width:this.width,height:this.height},s={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const a=ce(e.padding),r=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&r&&(t.save(),t.globalAlpha=i,this.drawBackground(s,t,o,e),Fa(t,e.textDirection),s.y+=a.top,this.drawTitle(s,t,e),this.drawBody(s,t,e),this.drawFooter(s,t,e),Na(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,o=t.map(({datasetIndex:r,index:l})=>{const c=this.chart.getDatasetMeta(r);if(!c)throw new Error("Cannot find a dataset at index "+r);return{datasetIndex:r,element:c.data[l],index:l}}),s=!xi(i,o),a=this._positionChanged(o,e);(s||a)&&(this._active=o,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const o=this.options,s=this._active||[],a=this._getActiveElements(t,s,e,i),r=this._positionChanged(a,t),l=e||!xi(a,s)||r;return l&&(this._active=a,(o.enabled||o.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),l}_getActiveElements(t,e,i,o){const s=this.options;if(t.type==="mouseout")return[];if(!o)return e.filter(r=>this.chart.data.datasets[r.datasetIndex]&&this.chart.getDatasetMeta(r.datasetIndex).controller.getParsed(r.index)!==void 0);const a=this.chart.getElementsAtEventForMode(t,s.mode,s,i);return s.reverse&&a.reverse(),a}_positionChanged(t,e){const{caretX:i,caretY:o,options:s}=this,a=En[s.position].call(this,t,e);return a!==!1&&(i!==a.x||o!==a.y)}}mt(yo,"positioners",En);var Zu={id:"tooltip",_element:yo,positioners:En,afterInit(n,t,e){e&&(n.tooltip=new yo({chart:n,options:e}))},beforeUpdate(n,t,e){n.tooltip&&n.tooltip.initialize(e)},reset(n,t,e){n.tooltip&&n.tooltip.initialize(e)},afterDraw(n){const t=n.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(n.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",e)}},afterEvent(n,t){if(n.tooltip){const e=t.replay;n.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,t)=>t.bodyFont.size,boxWidth:(n,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:cr},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Qu=Object.freeze({__proto__:null,Colors:uu,Decimation:mu,Filler:Ou,Legend:Uu,SubTitle:Wu,Title:ju,Tooltip:Zu});const tf=(n,t,e,i)=>(typeof t=="string"?(e=n.push(t)-1,i.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function ef(n,t,e,i){const o=n.indexOf(t);if(o===-1)return tf(n,t,e,i);const s=n.lastIndexOf(t);return o!==s?e:o}const nf=(n,t)=>n===null?null:ee(Math.round(n),0,t);function ea(n){const t=this.getLabels();return n>=0&&n<t.length?t[n]:n}class wo extends dn{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const i=this.getLabels();for(const{index:o,label:s}of e)i[o]===s&&i.splice(o,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(Tt(t))return null;const i=this.getLabels();return e=isFinite(e)&&i[e]===t?e:ef(i,t,Dt(e,t),this._addedLabels),nf(e,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:o}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),e||(o=this.getLabels().length-1)),this.min=i,this.max=o}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,o=[];let s=this.getLabels();s=t===0&&e===s.length-1?s:s.slice(t,e+1),this._valueRange=Math.max(s.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let a=t;a<=e;a++)o.push({value:a});return o}getLabelForValue(t){return ea.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}mt(wo,"id","category"),mt(wo,"defaults",{ticks:{callback:ea}});function of(n,t){const e=[],{bounds:o,step:s,min:a,max:r,precision:l,count:c,maxTicks:d,maxDigits:u,includeBounds:f}=n,h=s||1,w=d-1,{min:_,max:S}=t,F=!Tt(a),R=!Tt(r),tt=!Tt(c),rt=(S-_)/(u+1);let b=Ko((S-_)/w/h)*h,D,N,A,U;if(b<1e-14&&!F&&!R)return[{value:_},{value:S}];U=Math.ceil(S/b)-Math.floor(_/b),U>w&&(b=Ko(U*b/w/h)*h),Tt(l)||(D=Math.pow(10,l),b=Math.ceil(b*D)/D),o==="ticks"?(N=Math.floor(_/b)*b,A=Math.ceil(S/b)*b):(N=_,A=S),F&&R&&s&&Xr((r-a)/s,b/1e3)?(U=Math.round(Math.min((r-a)/b,d)),b=(r-a)/U,N=a,A=r):tt?(N=F?a:N,A=R?r:A,U=c-1,b=(A-N)/U):(U=(A-N)/b,An(U,Math.round(U),b/1e3)?U=Math.round(U):U=Math.ceil(U));const j=Math.max(Jo(b),Jo(N));D=Math.pow(10,Tt(l)?j:l),N=Math.round(N*D)/D,A=Math.round(A*D)/D;let z=0;for(F&&(f&&N!==a?(e.push({value:a}),N<a&&z++,An(Math.round((N+z*b)*D)/D,a,na(a,rt,n))&&z++):N<a&&z++);z<U;++z){const W=Math.round((N+z*b)*D)/D;if(R&&W>r)break;e.push({value:W})}return R&&f&&A!==r?e.length&&An(e[e.length-1].value,r,na(r,rt,n))?e[e.length-1].value=r:e.push({value:r}):(!R||A===r)&&e.push({value:A}),e}function na(n,t,{horizontal:e,minRotation:i}){const o=_e(i),s=(e?Math.sin(o):Math.cos(o))||.001,a=.75*t*(""+n).length;return Math.min(t/s,a)}class Ei extends dn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return Tt(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:o,max:s}=this;const a=l=>o=e?o:l,r=l=>s=i?s:l;if(t){const l=Ie(o),c=Ie(s);l<0&&c<0?r(0):l>0&&c>0&&a(0)}if(o===s){let l=s===0?1:Math.abs(s*.05);r(s+l),t||a(o-l)}this.min=o,this.max=s}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:i}=t,o;return i?(o=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,o>1e3&&(console.warn("scales.".concat(this.id,".ticks.stepSize: ").concat(i," would result generating up to ").concat(o," ticks. Limiting to 1000.")),o=1e3)):(o=this.computeTickLimit(),e=e||11),e&&(o=Math.min(e,o)),o}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const o={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},s=this._range||this,a=of(o,s);return t.bounds==="ticks"&&ya(a,this,"value"),t.reverse?(a.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),a}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const o=(i-e)/Math.max(t.length-1,1)/2;e-=o,i+=o}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return $n(t,this.chart.options.locale,this.options.ticks.format)}}class _o extends Ei{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=qt(t)?t:0,this.max=qt(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=_e(this.options.ticks.minRotation),o=(t?Math.sin(i):Math.cos(i))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,s.lineHeight/o))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}mt(_o,"id","linear"),mt(_o,"defaults",{ticks:{callback:Bi.formatters.numeric}});const jn=n=>Math.floor(He(n)),tn=(n,t)=>Math.pow(10,jn(n)+t);function ia(n){return n/Math.pow(10,jn(n))===1}function oa(n,t,e){const i=Math.pow(10,e),o=Math.floor(n/i);return Math.ceil(t/i)-o}function sf(n,t){const e=t-n;let i=jn(e);for(;oa(n,t,i)>10;)i++;for(;oa(n,t,i)<10;)i--;return Math.min(i,jn(n))}function af(n,{min:t,max:e}){t=ve(n.min,t);const i=[],o=jn(t);let s=sf(t,e),a=s<0?Math.pow(10,Math.abs(s)):1;const r=Math.pow(10,s),l=o>s?Math.pow(10,o):0,c=Math.round((t-l)*a)/a,d=Math.floor((t-l)/r/10)*r*10;let u=Math.floor((c-d)/Math.pow(10,s)),f=ve(n.min,Math.round((l+d+u*Math.pow(10,s))*a)/a);for(;f<e;)i.push({value:f,major:ia(f),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(s++,u=2,a=s>=0?1:a),f=Math.round((l+d+u*Math.pow(10,s))*a)/a;const h=ve(n.max,f);return i.push({value:h,major:ia(h),significand:u}),i}class xo extends dn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=Ei.prototype.parse.apply(this,[t,e]);if(i===0){this._zero=!0;return}return qt(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=qt(t)?Math.max(0,t):null,this.max=qt(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!qt(this._userMin)&&(this.min=t===tn(this.min,0)?tn(this.min,-1):tn(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,o=this.max;const s=r=>i=t?i:r,a=r=>o=e?o:r;i===o&&(i<=0?(s(1),a(10)):(s(tn(i,-1)),a(tn(o,1)))),i<=0&&s(tn(o,-1)),o<=0&&a(tn(i,1)),this.min=i,this.max=o}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},i=af(e,this);return t.bounds==="ticks"&&ya(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":$n(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=He(t),this._valueRange=He(this.max)-He(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(He(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}mt(xo,"id","logarithmic"),mt(xo,"defaults",{ticks:{callback:Bi.formatters.logarithmic,major:{enabled:!0}}});function So(n){const t=n.ticks;if(t.display&&n.display){const e=ce(t.backdropPadding);return Dt(t.font&&t.font.size,jt.font.size)+e.height}return 0}function rf(n,t,e){return e=Ht(e)?e:[e],{w:fl(n,t.string,e),h:e.length*t.lineHeight}}function sa(n,t,e,i,o){return n===i||n===o?{start:t-e/2,end:t+e/2}:n<i||n>o?{start:t-e,end:t}:{start:t,end:t+e}}function lf(n){const t={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},e=Object.assign({},t),i=[],o=[],s=n._pointLabels.length,a=n.options.pointLabels,r=a.centerPointLabels?Ot/s:0;for(let l=0;l<s;l++){const c=a.setContext(n.getPointLabelContext(l));o[l]=c.padding;const d=n.getPointPosition(l,n.drawingArea+o[l],r),u=Qt(c.font),f=rf(n.ctx,u,n._pointLabels[l]);i[l]=f;const h=re(n.getIndexAngle(l)+r),w=Math.round(To(h)),_=sa(w,d.x,f.w,0,180),S=sa(w,d.y,f.h,90,270);cf(e,t,h,_,S)}n.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),n._pointLabelItems=ff(n,i,o)}function cf(n,t,e,i,o){const s=Math.abs(Math.sin(e)),a=Math.abs(Math.cos(e));let r=0,l=0;i.start<t.l?(r=(t.l-i.start)/s,n.l=Math.min(n.l,t.l-r)):i.end>t.r&&(r=(i.end-t.r)/s,n.r=Math.max(n.r,t.r+r)),o.start<t.t?(l=(t.t-o.start)/a,n.t=Math.min(n.t,t.t-l)):o.end>t.b&&(l=(o.end-t.b)/a,n.b=Math.max(n.b,t.b+l))}function df(n,t,e){const i=n.drawingArea,{extra:o,additionalAngle:s,padding:a,size:r}=e,l=n.getPointPosition(t,i+o+a,s),c=Math.round(To(re(l.angle+Xt))),d=mf(l.y,r.h,c),u=hf(c),f=pf(l.x,r.w,u);return{visible:!0,x:l.x,y:d,textAlign:u,left:f,top:d,right:f+r.w,bottom:d+r.h}}function uf(n,t){if(!t)return!0;const{left:e,top:i,right:o,bottom:s}=n;return!(Ne({x:e,y:i},t)||Ne({x:e,y:s},t)||Ne({x:o,y:i},t)||Ne({x:o,y:s},t))}function ff(n,t,e){const i=[],o=n._pointLabels.length,s=n.options,{centerPointLabels:a,display:r}=s.pointLabels,l={extra:So(s)/2,additionalAngle:a?Ot/o:0};let c;for(let d=0;d<o;d++){l.padding=e[d],l.size=t[d];const u=df(n,d,l);i.push(u),r==="auto"&&(u.visible=uf(u,c),u.visible&&(c=u))}return i}function hf(n){return n===0||n===180?"center":n<180?"left":"right"}function pf(n,t,e){return e==="right"?n-=t:e==="center"&&(n-=t/2),n}function mf(n,t,e){return e===90||e===270?n-=t/2:(e>270||e<90)&&(n-=t),n}function gf(n,t,e){const{left:i,top:o,right:s,bottom:a}=e,{backdropColor:r}=t;if(!Tt(r)){const l=an(t.borderRadius),c=ce(t.backdropPadding);n.fillStyle=r;const d=i-c.left,u=o-c.top,f=s-i+c.width,h=a-o+c.height;Object.values(l).some(w=>w!==0)?(n.beginPath(),Un(n,{x:d,y:u,w:f,h,radius:l}),n.fill()):n.fillRect(d,u,f,h)}}function vf(n,t){const{ctx:e,options:{pointLabels:i}}=n;for(let o=t-1;o>=0;o--){const s=n._pointLabelItems[o];if(!s.visible)continue;const a=i.setContext(n.getPointLabelContext(o));gf(e,a,s);const r=Qt(a.font),{x:l,y:c,textAlign:d}=s;cn(e,n._pointLabels[o],l,c+r.lineHeight/2,r,{color:a.color,textAlign:d,textBaseline:"middle"})}}function dr(n,t,e,i){const{ctx:o}=n;if(e)o.arc(n.xCenter,n.yCenter,t,0,zt);else{let s=n.getPointPosition(0,t);o.moveTo(s.x,s.y);for(let a=1;a<i;a++)s=n.getPointPosition(a,t),o.lineTo(s.x,s.y)}}function bf(n,t,e,i,o){const s=n.ctx,a=t.circular,{color:r,lineWidth:l}=t;!a&&!i||!r||!l||e<0||(s.save(),s.strokeStyle=r,s.lineWidth=l,s.setLineDash(o.dash||[]),s.lineDashOffset=o.dashOffset,s.beginPath(),dr(n,e,a,i),s.closePath(),s.stroke(),s.restore())}function yf(n,t,e){return Ge(n,{label:e,index:t,type:"pointLabel"})}class Tn extends Ei{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=ce(So(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=qt(t)&&!isNaN(t)?t:0,this.max=qt(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/So(this.options))}generateTickLabels(t){Ei.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,i)=>{const o=Vt(this.options.pointLabels.callback,[e,i],this);return o||o===0?o:""}).filter((e,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?lf(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,o){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-o)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,o))}getIndexAngle(t){const e=zt/(this._pointLabels.length||1),i=this.options.startAngle||0;return re(t*e+_e(i))}getDistanceFromCenterForValue(t){if(Tt(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(Tt(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return yf(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const o=this.getIndexAngle(t)-Xt+i;return{x:Math.cos(o)*e+this.xCenter,y:Math.sin(o)*e+this.yCenter,angle:o}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:o,bottom:s}=this._pointLabelItems[t];return{left:e,top:i,right:o,bottom:s}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),dr(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:i,grid:o,border:s}=e,a=this._pointLabels.length;let r,l,c;if(e.pointLabels.display&&vf(this,a),o.display&&this.ticks.forEach((d,u)=>{if(u!==0||u===0&&this.min<0){l=this.getDistanceFromCenterForValue(d.value);const f=this.getContext(u),h=o.setContext(f),w=s.setContext(f);bf(this,h,l,a,w)}}),i.display){for(t.save(),r=a-1;r>=0;r--){const d=i.setContext(this.getPointLabelContext(r)),{color:u,lineWidth:f}=d;!f||!u||(t.lineWidth=f,t.strokeStyle=u,t.setLineDash(d.borderDash),t.lineDashOffset=d.borderDashOffset,l=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),c=this.getPointPosition(r,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const o=this.getIndexAngle(0);let s,a;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(o),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((r,l)=>{if(l===0&&this.min>=0&&!e.reverse)return;const c=i.setContext(this.getContext(l)),d=Qt(c.font);if(s=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=d.string,a=t.measureText(r.label).width,t.fillStyle=c.backdropColor;const u=ce(c.backdropPadding);t.fillRect(-a/2-u.left,-s-d.size/2-u.top,a+u.width,d.size+u.height)}cn(t,r.label,0,-s,d,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}mt(Tn,"id","radialLinear"),mt(Tn,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Bi.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),mt(Tn,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),mt(Tn,"descriptors",{angleLines:{_fallback:"grid"}});const Vi={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},me=Object.keys(Vi);function aa(n,t){return n-t}function ra(n,t){if(Tt(t))return null;const e=n._adapter,{parser:i,round:o,isoWeekday:s}=n._parseOpts;let a=t;return typeof i=="function"&&(a=i(a)),qt(a)||(a=typeof i=="string"?e.parse(a,i):e.parse(a)),a===null?null:(o&&(a=o==="week"&&(pn(s)||s===!0)?e.startOf(a,"isoWeek",s):e.startOf(a,o)),+a)}function la(n,t,e,i){const o=me.length;for(let s=me.indexOf(n);s<o-1;++s){const a=Vi[me[s]],r=a.steps?a.steps:Number.MAX_SAFE_INTEGER;if(a.common&&Math.ceil((e-t)/(r*a.size))<=i)return me[s]}return me[o-1]}function wf(n,t,e,i,o){for(let s=me.length-1;s>=me.indexOf(e);s--){const a=me[s];if(Vi[a].common&&n._adapter.diff(o,i,a)>=t-1)return a}return me[e?me.indexOf(e):0]}function _f(n){for(let t=me.indexOf(n)+1,e=me.length;t<e;++t)if(Vi[me[t]].common)return me[t]}function ca(n,t,e){if(!e)n[t]=!0;else if(e.length){const{lo:i,hi:o}=Po(e,t),s=e[i]>=t?e[i]:e[o];n[s]=!0}}function xf(n,t,e,i){const o=n._adapter,s=+o.startOf(t[0].value,i),a=t[t.length-1].value;let r,l;for(r=s;r<=a;r=+o.add(r,1,i))l=e[r],l>=0&&(t[l].major=!0);return t}function da(n,t,e){const i=[],o={},s=t.length;let a,r;for(a=0;a<s;++a)r=t[a],o[r]=a,i.push({value:r,major:!1});return s===0||!e?i:xf(n,i,o,e)}class Wn extends dn{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const i=t.time||(t.time={}),o=this._adapter=new Ec._date(t.adapters.date);o.init(e),Pn(i.displayFormats,o.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:ra(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:o,max:s,minDefined:a,maxDefined:r}=this.getUserBounds();function l(c){!a&&!isNaN(c.min)&&(o=Math.min(o,c.min)),!r&&!isNaN(c.max)&&(s=Math.max(s,c.max))}(!a||!r)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),o=qt(o)&&!isNaN(o)?o:+e.startOf(Date.now(),i),s=qt(s)&&!isNaN(s)?s:+e.endOf(Date.now(),i)+1,this.min=Math.min(o,s-1),this.max=Math.max(o+1,s)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,o=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&o.length&&(this.min=this._userMin||o[0],this.max=this._userMax||o[o.length-1]);const s=this.min,a=this.max,r=Qr(o,s,a);return this._unit=e.unit||(i.autoSkip?la(e.minUnit,this.min,this.max,this._getLabelCapacity(s)):wf(this,r.length,e.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:_f(this._unit),this.initOffsets(o),t.reverse&&r.reverse(),da(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,i=0,o,s;this.options.offset&&t.length&&(o=this.getDecimalForValue(t[0]),t.length===1?e=1-o:e=(this.getDecimalForValue(t[1])-o)/2,s=this.getDecimalForValue(t[t.length-1]),t.length===1?i=s:i=(s-this.getDecimalForValue(t[t.length-2]))/2);const a=t.length<3?.5:.25;e=ee(e,0,a),i=ee(i,0,a),this._offsets={start:e,end:i,factor:1/(e+1+i)}}_generate(){const t=this._adapter,e=this.min,i=this.max,o=this.options,s=o.time,a=s.unit||la(s.minUnit,e,i,this._getLabelCapacity(e)),r=Dt(o.ticks.stepSize,1),l=a==="week"?s.isoWeekday:!1,c=pn(l)||l===!0,d={};let u=e,f,h;if(c&&(u=+t.startOf(u,"isoWeek",l)),u=+t.startOf(u,c?"day":a),t.diff(i,e,a)>1e5*r)throw new Error(e+" and "+i+" are too far apart with stepSize of "+r+" "+a);const w=o.ticks.source==="data"&&this.getDataTimestamps();for(f=u,h=0;f<i;f=+t.add(f,r,a),h++)ca(d,f,w);return(f===i||o.bounds==="ticks"||h===1)&&ca(d,f,w),Object.keys(d).sort(aa).map(_=>+_)}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}format(t,e){const o=this.options.time.displayFormats,s=this._unit,a=e||o[s];return this._adapter.format(t,a)}_tickFormatFunction(t,e,i,o){const s=this.options,a=s.ticks.callback;if(a)return Vt(a,[t,e,i],this);const r=s.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&r[l],u=c&&r[c],f=i[e],h=c&&u&&f&&f.major;return this._adapter.format(t,o||(h?u:d))}generateTickLabels(t){let e,i,o;for(e=0,i=t.length;e<i;++e)o=t[e],o.label=this._tickFormatFunction(o.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,o=_e(this.isHorizontal()?e.maxRotation:e.minRotation),s=Math.cos(o),a=Math.sin(o),r=this._resolveTickFontOptions(0).size;return{w:i*s+r*a,h:i*a+r*s}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,o=i[e.unit]||i.millisecond,s=this._tickFormatFunction(t,0,da(this,[t],this._majorUnit),o),a=this._getLabelSize(s),r=Math.floor(this.isHorizontal()?this.width/a.w:this.height/a.h)-1;return r>0?r:1}getDataTimestamps(){let t=this._cache.data||[],e,i;if(t.length)return t;const o=this.getMatchingVisibleMetas();if(this._normalized&&o.length)return this._cache.data=o[0].controller.getAllParsedValues(this);for(e=0,i=o.length;e<i;++e)t=t.concat(o[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const o=this.getLabels();for(e=0,i=o.length;e<i;++e)t.push(ra(this,o[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return xa(t.sort(aa))}}mt(Wn,"id","time"),mt(Wn,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function ai(n,t,e){let i=0,o=n.length-1,s,a,r,l;e?(t>=n[i].pos&&t<=n[o].pos&&({lo:i,hi:o}=Fe(n,"pos",t)),{pos:s,time:r}=n[i],{pos:a,time:l}=n[o]):(t>=n[i].time&&t<=n[o].time&&({lo:i,hi:o}=Fe(n,"time",t)),{time:s,pos:r}=n[i],{time:a,pos:l}=n[o]);const c=a-s;return c?r+(l-r)*(t-s)/c:r}class Co extends Wn{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=ai(e,this.min),this._tableRange=ai(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,o=[],s=[];let a,r,l,c,d;for(a=0,r=t.length;a<r;++a)c=t[a],c>=e&&c<=i&&o.push(c);if(o.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(a=0,r=o.length;a<r;++a)d=o[a+1],l=o[a-1],c=o[a],Math.round((d+l)/2)!==c&&s.push({time:c,pos:a/(r-1)});return s}_generate(){const t=this.min,e=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(e)||i.length===1)&&i.push(e),i.sort((o,s)=>o-s)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return e.length&&i.length?t=this.normalize(e.concat(i)):t=e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(ai(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return ai(this._table,i*this._tableRange+this._minPos,!0)}}mt(Co,"id","timeseries"),mt(Co,"defaults",Wn.defaults);var Sf=Object.freeze({__proto__:null,CategoryScale:wo,LinearScale:_o,LogarithmicScale:xo,RadialLinearScale:Tn,TimeScale:Wn,TimeSeriesScale:Co});const Cf=[Mc,ou,Qu,Sf];Le.register(...Cf);function Df(n){return n?(n=String(n).toLowerCase(),n==="ytd"||n==="ltm"?"mensile":n):""}function kf(n){var t=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),e=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-e);var i=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-i)/864e5+1)/7)}typeof window<"u"&&(typeof window.effectivePeriodType!="function"&&(window.effectivePeriodType=Df),typeof window.isoWeekNum!="function"&&(window.isoWeekNum=kf));(function(){const n=window.fetch.bind(window);function t(){try{const i=JSON.parse(localStorage.getItem("user")||"{}");if(i&&(i.token||i.jwt||i.accessToken))return i.token||i.jwt||i.accessToken}catch(i){}const e=["token","authToken","jwt","bp_token","accessToken","id_token"];for(const i of e){let o=localStorage.getItem(i)||sessionStorage.getItem(i);if(o){try{const s=JSON.parse(o);if(s&&(s.token||s.jwt||s.accessToken))return s.token||s.jwt||s.accessToken}catch(s){}if(o=String(o).replace(/^"+|"+$/g,""),/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$/.test(o))return o}}return null}window.fetch=function(e,i){const o=typeof e=="string"?e:e&&e.url||"";if(!(typeof o=="string"&&(o.startsWith("/api/")||o.startsWith(location.origin+"/api/"))))return n(e,i);const a=t(),r=Object.assign({},i);return r.headers=new Headers(r&&r.headers||{}),a&&!r.headers.has("Authorization")&&r.headers.set("Authorization","Bearer "+a),n(e,r)}})();(function(){function n(){const o=r=>String(r).replace(/^"+|"+$/g,""),s=r=>/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$/.test(r||""),a=["token","authToken","jwt","bp_token","accessToken","id_token"];for(const r of a){let l=localStorage.getItem(r)||sessionStorage.getItem(r);if(l){try{const c=JSON.parse(l);if(c&&(c.token||c.jwt||c.accessToken))return c.token||c.jwt||c.accessToken}catch(c){}if(l=o(l),s(l))return l}}try{const r=JSON.parse(localStorage.getItem("user")||"{}");if(r&&(r.token||r.jwt||r.accessToken))return r.token||r.jwt||r.accessToken}catch(r){}return null}typeof window.users>"u"&&(window.users=[]),(async function o(){try{if(window.GET){const r=await window.GET("/api/usernames");r&&Array.isArray(r.users)&&(window.users=r.users);return}const s=n(),a=await fetch("/api/usernames",{headers:{Accept:"application/json",...s?{Authorization:"Bearer "+s}:{}}});if(a.status===401){setTimeout(o,800);return}if(a.ok){const r=await a.json();r&&Array.isArray(r.users)&&(window.users=r.users)}}catch(s){setTimeout(o,1200)}})();function t(o,s,a){return new Date(Date.UTC(o,s,a))}function e(o){return new Date(o.getTime()+24*3600*1e3-1)}function i(o,s){return new Date(Date.UTC(o,s+1,0))}typeof window.buildBuckets!="function"&&(window.buildBuckets=function(o,s){var a=String(o||"mensile").toLowerCase(),r=effectivePeriodType(a),l=s?new Date(s):new Date,c=l.getUTCFullYear(),d=[];function u(Z,K){d.push({s:Z.getTime(),e:K.getTime()})}if(a==="ytd"){for(var f=0;f<=l.getUTCMonth();f++){var h=t(l.getUTCFullYear(),f,1),w=e(i(h.getUTCFullYear(),h.getUTCMonth()));u(h,w)}return d}if(a==="ltm"){for(var _=t(l.getUTCFullYear(),l.getUTCMonth(),1),S=11;S>=0;S--){var f=t(_.getUTCFullYear(),_.getUTCMonth()-S,1);u(f,e(i(f.getUTCFullYear(),f.getUTCMonth())))}return d}if(r==="settimanale"){var F=new Date(Date.UTC(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate())),R=(F.getUTCDay()+6)%7;F.setUTCDate(F.getUTCDate()-R);for(var tt=52;tt>=0;tt--){var rt=new Date(F);rt.setUTCDate(F.getUTCDate()-tt*7);var b=new Date(rt);b.setUTCDate(rt.getUTCDate()+6),b.setUTCHours(23,59,59,999),u(rt,b)}return d}if(r==="mensile"){for(var _=new Date(Date.UTC(l.getUTCFullYear(),l.getUTCMonth(),1)),S=23;S>=0;S--){var f=new Date(Date.UTC(_.getUTCFullYear(),_.getUTCMonth()-S,1));u(f,e(i(f.getUTCFullYear(),f.getUTCMonth())))}return d}if(r==="trimestrale"){for(var D=Math.floor(l.getUTCMonth()/3),N=11;N>=0;N--){var A=D-N,U=c+Math.floor(A/4),j=(A%4+4)%4,rt=t(U,j*3,1),b=e(new Date(Date.UTC(U,j*3+3,0)));u(rt,b)}return d}if(r==="semestrale"){for(var z=l.getUTCMonth()<6?0:1,W=5;W>=0;W--){var lt=z-W,Y=c+Math.floor(lt/2),nt=(lt%2+2)%2,ct=nt===0?0:6,$=t(Y,ct,1),V=e(new Date(Date.UTC(Y,ct+6,0)));u($,V)}return d}for(var L=2;L>=0;L--){var X=c-L;u(t(X,0,1),e(new Date(Date.UTC(X,12,0))))}return d}),typeof window.labelsForBuckets!="function"&&(window.labelsForBuckets=function(o,s){var a=effectivePeriodType(o||"mensile");return(s||[]).map(function(r){var l=new Date(r.s);return a==="settimanale"?"W"+isoWeekNum(l)+" "+l.getUTCFullYear():a==="mensile"?String(l.getUTCMonth()+1).padStart(2,"0")+"/"+l.getUTCFullYear():a==="trimestrale"?"Q"+(Math.floor(l.getUTCMonth()/3)+1)+" "+l.getUTCFullYear():a==="semestrale"?(l.getUTCMonth()<6?"S1 ":"S2 ")+l.getUTCFullYear():String(l.getUTCFullYear())})}),typeof window.sumIndicator!="function"&&(window.sumIndicator=function(o,s,a){var c,d;var r=String(s).toLowerCase()==="previsionale"?o.indicatorsPrev||{}:o.indicatorsCons||{};if(a==="VSDTotale")return Number(r.VSDPersonale||0)+Number(r.VSDIndiretto||0);var l=Number((d=(c=r[a])!=null?c:r[a.toUpperCase()])!=null?d:0);return Number.isFinite(l)?l:0}),(function(){try{let a=function(r,l){try{if(this&&typeof this.getLabelForValue=="function")return String(this.getLabelForValue(r))}catch(f){}try{var c=typeof r=="number"?r:l,d=this&&this.chart&&this.chart.data&&this.chart.data.labels||[],u=Array.isArray(d)?d[c]:void 0;return String(u!=null?u:r)}catch(f){return String(r)}};if(typeof window.Chart>"u")return;try{Chart.defaults=Chart.defaults||{},Chart.defaults.scales=Chart.defaults.scales||{},Chart.defaults.scales.category=Chart.defaults.scales.category||{},Chart.defaults.scales.category.ticks=Object.assign({},Chart.defaults.scales.category.ticks||{},{callback:a})}catch(r){}var s={id:"bpAutoTicks",beforeUpdate:function(r){try{let h=function(w,_){try{var S=Array.isArray(w)?w.length:0;if(!S)return{autoSkip:!0,maxRotation:0,minRotation:0,callback:a};for(var F=0,R=0;R<w.length;R++){var tt=""+(w[R]==null?"":w[R]);tt.length>F&&(F=tt.length)}var rt=Math.max(28,Math.min(90,Math.round(F*7))),b=S*rt;return b>(_||320)*1.2?{autoSkip:!0,maxRotation:45,minRotation:45,callback:a}:{autoSkip:!0,maxRotation:0,minRotation:0,callback:a}}catch(D){return{autoSkip:!0,maxRotation:0,minRotation:0,callback:a}}};if(!r||(r.config&&r.config.type)!=="line")return;var l=r.config&&r.config.data&&r.config.data.labels||[],c=r.canvas&&(r.canvas.clientWidth||r.canvas.width)||320,d=typeof window.computeTickOptions=="function"?window.computeTickOptions:h,u=d(l,c);r.options=r.options||{},r.options.scales=r.options.scales||{};var f=r.options.scales.x||(r.options.scales.x={display:!0});f.ticks=Object.assign({},f.ticks||{},u)}catch(h){}}};try{Chart.register?Chart.register(s):Chart.plugins&&Chart.plugins.register&&Chart.plugins.register(s)}catch(r){}}catch(a){}})()})();(function(n){const t=["localhost","127.0.0.1"].includes(n.location.hostname),e=n.pino?n.pino({level:t?"debug":"info"}):console,i={info:(...o)=>e.info?e.info(...o):console.log(...o),error:(...o)=>e.error?e.error(...o):console.error(...o),warn:(...o)=>e.warn?e.warn(...o):console.warn(...o),debug:(...o)=>e.debug?e.debug(...o):console.debug(...o)};n.logger=i})(window);window.BP_PHRASES=(function(){const n=["Ottimo, {name}! ","Ben fatto, {name}! ","Avanti cos, {name}! ","Perfetto, {name}! ","Bel colpo, {name}! ","Ci siamo, {name}! ","Grande {name}! ","Pezzo dopo pezzo, {name}! ","Molto bene, {name}! ","Stai andando bene, {name}! "],t=["Che figata, {name}! ","Ma cosa dico grande grandissimo, {name}! ","Super, {name}! ","Non ti ferma nessuno, {name}!! ","Stai andando alla grande, {name}! ","Gran progressione, {name}! ","Il ritmo  giusto, {name}! ","Questa spinge, {name}! ","Bello tosto, {name}! ","Gran focus, {name}! "],e=["BOOM! {name}, questo  livello PRO! ","Risultato pazzesco, {name}! ","Clamoroso {name}, cos si fa! "," ufficiale: {name} ON FIRE! ","Top di gamma, {name}! ","Mostruoso upgrade, {name}! ","Record personale in vista, {name}! ","Spacchi tutto, {name}! ","Da incorniciare, {name}! ","Questo alza lasticella, {name}! "],i={lite:n,mid:t,mega:e};return i.standard=n,i.rilevante=t,i.grande=e,i.pick=function(o,s){const a=i[o]||n,r=s||JSON.parse(localStorage.getItem("bp_user")||"{}").name||"campione";return(a[Math.floor(Math.random()*a.length)]||"Grande!").replace(/\{name\}/g,r)},i.random=function(o){const s=[n,t,e],a=s[Math.floor(Math.random()*s.length)];return i.pick(a===e?"mega":a===t?"rilevante":"standard",o)},i})();(function(){const n=window.BP=window.BP||{},t=n.Haptics=n.Haptics||{};function e(){const o=navigator.userAgent||navigator.vendor||"";return/android|iphone|ipad|ipod|mobile/i.test(o)}function i(o){if(e()&&"vibrate"in navigator)try{switch(o){case"light":navigator.vibrate(12);break;case"heavy":navigator.vibrate([10,30,10]);break;default:navigator.vibrate(18);break}}catch(s){}}t.impact=i})();(function(){const n=window.BP=window.BP||{},t=n.Undo=n.Undo||{},e=document.createElement("div");e.className="bp-undo-host",document.body.appendChild(e);const i="\n  .bp-undo-host{\n    position: fixed; left:50%; transform: translateX(-50%);\n    bottom: 20px; z-index: 1201; display:flex; flex-direction:column; gap:8px;\n  }\n  .bp-undo{\n    min-width: 280px; max-width: 540px;\n    background: rgba(15,19,28,.95);\n    border:1px solid rgba(255,255,255,.18);\n    border-radius: 12px; padding: 10px 12px;\n    box-shadow: 0 10px 24px rgba(0,0,0,.35);\n    display:flex; align-items:center; gap:10px;\n    animation: bpUndoPop .16s ease-out;\n  }\n  .bp-undo .lbl{ font-weight:700; }\n  .bp-undo .spacer{ flex:1; }\n  .bp-undo button{ white-space:nowrap; }\n  @keyframes bpUndoPop{ from{ transform: translate(-50%, 4px); opacity:0 } to{ transform: translate(-50%, 0); opacity:1 } }\n  ",o=document.createElement("style");o.textContent=i,document.head.appendChild(o);function s(a){const r=document.createElement("div");r.className="bp-undo",r.innerHTML='\n      <div class="lbl">'.concat(a&&a.label||"Operazione eseguita",'</div>\n      <div class="spacer"></div>\n      <button type="button" class="ghost" data-undo>Annulla</button>\n    '),e.appendChild(r);let l=!1;const c=setTimeout(()=>{l||(l=!0,r.remove())},a&&a.timeoutMs||5e3);r.querySelector("[data-undo]").addEventListener("click",()=>{if(!l){l=!0,clearTimeout(c);try{a&&a.onUndo&&a.onUndo()}catch(d){}r.remove()}})}t.push=s})();(function(){const n=window.BP=window.BP||{},t=n.ClientsHelpers=n.ClientsHelpers||{};function e(a){return String(a||"").trim().toLowerCase()}function i(a){const r={};return(a||[]).forEach(l=>{const c=e(l.client);if(!c)return;const d=l.start||l.end;if(!d)return;const u=r[c];(!u||new Date(d)>new Date(u))&&(r[c]=d)}),r}function o(a,r){const l=i(r);return(a||[]).map(c=>{const d=l[e(c.name)]||null;return{...c,lastAppointment:d}})}function s(a,{status:r,consultantId:l,consultantName:c}){const d=h=>String(h||"").trim().toLowerCase(),u=h=>{const w=d(h).replace(/\s+/g,"_").replace(/-/g,"_");return w==="lead_non_chiuso"||w==="lead_non-chiuso"?"lead_non_chiuso":w};let f=a||[];if(r&&r!=="tutti"&&(f=f.filter(h=>u(h.status)===u(r))),l)f=f.filter(h=>(h.consultantId||"")===String(l));else if(c){const h=d(c);f=f.filter(w=>d(w.consultantName)===h)}return f}t.withLastAppointment=o,t.filter=s})();(function(){const n=window.BP=window.BP||{},t=n.Targets=n.Targets||{},e=["VSS","VSDPersonale","VSDIndiretto","GI"],i=["NNCF","AppFatti","Telefonate"],o=e.concat(i),s={senior:{VSS:3e4,VSDPersonale:15e3,VSDIndiretto:5e3,GI:15e3,NNCF:1,AppFatti:4,Telefonate:0},junior:{VSS:15e3,VSDPersonale:5e3,VSDIndiretto:5e3,GI:1e4,NNCF:4,AppFatti:30,Telefonate:300}};function a(h,w){const _=Number(h||0),S=Number(w||0);return S?Math.ceil(_/S)*S:Math.ceil(_)}function r(h){switch(String(h||"mensile").toLowerCase()){case"settimanale":return 1/4;case"mensile":return 1;case"trimestrale":return 3;case"semestrale":return 6;case"annuale":return 12;default:return 1}}function l(h){return e.indexOf(h)>=0}function c(h){const w=String(h||"junior").toLowerCase()==="senior"?"senior":"junior";return{...s[w]}}function d(h,w){const _=r(w),S=c(h),F={};for(const R of o){const tt=Number(S[R]||0)*_;l(R)?String(w).toLowerCase()==="settimanale"?F[R]=a(tt,500):F[R]=a(tt,5e3):F[R]=Math.ceil(tt)}return F}function u(h,w){const _={};for(const S of o){const F=Number((h||{})[S]||0),R=Number((w||{})[S]||0),tt=F-R,rt=R>0?Math.round(F/R*100):F>0?100:0;_[S]={value:F,target:R,delta:tt,pct:Math.max(0,rt)}}return _}function f(h){const w=[];for(const S of o){const F=(h||{})[S];F&&F.target>0&&w.push(Number(F.pct||0))}if(!w.length)return 0;const _=w.reduce((S,F)=>S+F,0)/w.length;return Math.round(_)}t.MONEY_KEYS=e,t.COUNT_KEYS=i,t.ALL_KEYS=o,t.getMonthly=c,t.getForPeriod=d,t.compare=u,t.summarize=f})();(function(){const n=window.BP=window.BP||{},t=n.ICS=n.ICS||{};function e(i){try{logger.warn("[BP ICS bulk disabled] chiamata a:",i)}catch(o){}}t.createCalendarForRange=function(){return e("createCalendarForRange()"),null},t.downloadForRange=function(){return e("downloadForRange()"),!1}})();(function(){const n=window.BP=window.BP||{},t=n.ClientStatus=n.ClientStatus||{},e="bp_banner_seen";function i(){try{return JSON.parse(localStorage.getItem(e)||"{}")}catch(h){return{}}}function o(h){try{localStorage.setItem(e,JSON.stringify(h||{}))}catch(w){}}function s(h){return!!i()[h]}function a(h){const w=i();w[h]=!0,o(w)}async function r(h){const w=window.authToken||"",_=await fetch(h,{headers:w?{Authorization:"Bearer "+w}:{}});if(!_.ok)throw new Error("GET "+h+" failed");return _.json()}async function l(h,w){const _=window.authToken||"",S=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json",..._?{Authorization:"Bearer "+_}:{}},body:JSON.stringify(w||{})});if(!S.ok)throw new Error("POST "+h+" failed");return S.json()}async function c({clientId:h,status:w}){if(!h)throw new Error("missing clientId");return l("/api/clients",{id:h,status:String(w||"")})}t.setClientStatusByName=d;async function d({clientName:h,status:w}){const _=String(h||"").trim();if(!_)throw new Error("missing clientName");const F=((await r("/api/clients")).clients||[]).find(rt=>String(rt.name||"").toLowerCase()===_.toLowerCase());if(F)return c({clientId:F.id,status:w});await l("/api/clients",{name:_});const tt=((await r("/api/clients")).clients||[]).find(rt=>String(rt.name||"").toLowerCase()===_.toLowerCase());if(!tt)throw new Error("client creation failed");return c({clientId:tt.id,status:w})}function u({appointment:h,clientName:w},_){const S=h||{},F=w||S.client||"Cliente",R=document.createElement("div");return R.className="bp-banner-client",R.innerHTML='\n      <div class="bp-banner-inner">\n        <div class="bp-banner-title"> diventato cliente?</div>\n        <div class="bp-banner-sub">Appuntamento con <b>'.concat(f(F),'</b></div>\n        <div class="bp-banner-actions">\n          <button type="button" data-yes>S</button>\n          <button type="button" class="ghost" data-no>No</button>\n        </div>\n      </div>\n    '),R.querySelector("[data-yes]").addEventListener("click",()=>_&&_(!0,S)),R.querySelector("[data-no]").addEventListener("click",()=>_&&_(!1,S)),R}function f(h){return String(h).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(function(){if(document.getElementById("bp-clientstatus-css"))return;const w="\n.bp-banner-client{\n  position: fixed; left:50%; transform:translateX(-50%);\n  top: 70px; z-index: 1200;\n  background: rgba(20,24,34,.95);\n  color: #fff;\n  border: 1px solid rgba(255,255,255,.18);\n  box-shadow: 0 10px 24px rgba(0,0,0,.35);\n  border-radius:14px; padding:10px; min-width:280px;\n  animation: bpBannerPop .18s ease-out;\n}\n.bp-banner-inner{ display:flex; flex-direction:column; gap:6px; }\n.bp-banner-title{ font-weight:800; }\n.bp-banner-sub{ font-size:12px; opacity:.92; }\n.bp-banner-actions{ display:flex; gap:8px; margin-top:6px; justify-content:flex-end; }\n@keyframes bpBannerPop{ from{ transform:translate(-50%, -6px); opacity:0 } to{ transform:translate(-50%, 0); opacity:1 } }\n",_=document.createElement("style");_.id="bp-clientstatus-css",_.textContent=w,document.head.appendChild(_)})(),t.hasSeen=s,t.markSeen=a,t.renderBecameClientBanner=u,t.setClientStatus=c,t.setClientStatusByName=d})();(function(){function n(t){try{fetch("/api/client_error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:location.href,info:{ua:navigator.userAgent},...t})})}catch(e){}}window.addEventListener("error",function(t){try{n({message:t.message,stack:t.error&&t.error.stack||null})}catch(e){}}),window.addEventListener("unhandledrejection",function(t){try{n({message:"unhandledrejection",stack:t.reason&&t.reason.stack||String(t.reason)})}catch(e){}})})();(function(){function n(t){return String(t||"event").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9._-]+/g,"_").replace(/^_+|_+$/g,"").slice(0,80)||"event"}if(window.saveICS&&!window.__icsSanitized){const t=window.saveICS;window.saveICS=function(e,i){try{e=n(e)}catch(o){}return t(e,i)},window.__icsSanitized=!0}window.__icsSanitize=n})();(function(n){function t(e){try{if(n.__postSaleBannersInitialized)return;n.__postSaleBannersInitialized=!0,N("init")}catch(M){}const i=window.BANNERS_LOOKBACK_DAYS||7,o="nncf",s="sale",a=(M,E)=>"bp_snooze_".concat(E,"_").concat(M),r=(M,E)=>"bp_done_".concat(E,"_").concat(M),l=(M,E)=>{try{const G=localStorage.getItem(a(M,E));return G&&new Date(G).getTime()>Date.now()}catch(G){return!1}},c=(M,E)=>{try{const G=new Date;G.setDate(G.getDate()+1),localStorage.setItem(a(M,E),G.toISOString())}catch(G){}},d=(M,E)=>{try{return localStorage.getItem(r(M,E))==="1"}catch(G){return!1}},u=(M,E)=>{try{localStorage.setItem(r(M,E),"1")}catch(G){}},f=new Set,h=(M,E)=>"bp_pending_".concat(E,"_").concat(M),w=(M,E)=>{const G="".concat(E,":").concat(M);if(f.has(G))return!0;try{const st=localStorage.getItem(h(M,E));return st&&new Date(st).getTime()>Date.now()}catch(st){return!1}},_=(M,E,G=5)=>{const st="".concat(E,":").concat(M);f.add(st);try{const q=new Date;q.setMinutes(q.getMinutes()+Math.max(1,Number(G)||5)),localStorage.setItem(h(M,E),q.toISOString())}catch(q){}},S=(M,E)=>{const G="".concat(E,":").concat(M);f.delete(G);try{localStorage.removeItem(h(M,E))}catch(st){}},F=(M,E)=>"bp_push_".concat(E,"_").concat(M),R=(M,E)=>{try{return localStorage.getItem(F(M,E))==="1"}catch(G){return!1}},tt=(M,E)=>{try{localStorage.setItem(F(M,E),"1")}catch(G){}},rt=window.BPFinal&&BPFinal.GET||window.GET,b=window.BPFinal&&BPFinal.POST||window.POST,D=window.toast||(M=>alert(M));function N(){try{if(!window||window.DEBUG_BANNERS!==!0)return}catch(M){return}try{window.logger&&typeof window.logger.debug=="function"?window.logger.debug("[banners]",...arguments):console.debug("[banners]",...arguments)}catch(M){}}function A(M){return String(M||"").replace(/[&<>\"]/g,E=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[E])}async function U(M,E){try{if(!b||!E||!E.id||R(E.id,M))return;const G=new Date(E.end||E.start||Date.now()).toLocaleString("it-IT",{dateStyle:"short",timeStyle:"short"}),st="Battle Plan",q=M==="nncf"?" diventato cliente? ".concat(String(E.client||""),". Appuntamento del ").concat(G):"Hai venduto a ".concat(String(E.client||"Cliente"),"? Appuntamento del ").concat(G);await b("/api/push/test",{payload:{title:st,body:q,tag:M==="nncf"?"bp-nncf":"bp-sale",url:"/"}}),tt(E.id,M)}catch(G){}}function j(){if(document.getElementById("bp-banner-css"))return;const M="\n      #bp_banner_host{position:fixed;left:16px;right:16px;bottom:16px;z-index:9999;display:flex;justify-content:center;pointer-events:none}\n      .bp-banner-card{pointer-events:auto;width:100%;max-width:720px;background:var(--card,#fff);color:var(--text,#111);\n        border:1px solid rgba(0,0,0,.12);border-radius:14px;box-shadow:0 10px 28px rgba(0,0,0,.28);padding:12px;display:flex;gap:12px;align-items:center;opacity:0;transform:translateY(8px);transition:opacity .2s,transform .2s}\n      .bp-banner-card.show{opacity:1;transform:none}\n      .bp-banner-card .msg{flex:1}.bp-banner-card .row{display:flex;gap:8px;align-items:center}\n      .bp-banner-card .ghost{background:rgba(0,0,0,.06);border:1px solid rgba(0,0,0,.12)}\n      @media (prefers-color-scheme: dark){ .bp-banner-card{background:rgba(15,18,28,.96);color:#fff;border-color:rgba(255,255,255,.16)}\n        .bp-banner-card .ghost{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.18)}}\n    ",E=document.createElement("style");E.id="bp-banner-css",E.textContent=M,document.head.appendChild(E)}function z(){let M=document.getElementById("bp_banner_host");return M||(M=document.createElement("div"),M.id="bp_banner_host",document.body.appendChild(M)),M}let W=[],lt=!1;function Y(M){W.push(M),nt()}function nt(){if(lt)return;const M=W.shift();if(!M)return;lt=!0,j();const E=z();E.innerHTML="";const G=M(st);E.appendChild(G),requestAnimationFrame(()=>G.classList.add("show"));function st(){E.innerHTML="",lt=!1,setTimeout(nt,40)}}async function ct(M,E){if(!M)return;const G=await rt("/api/clients"),q=(G&&G.clients||[]).find(m=>String(m.name||"").trim().toLowerCase()===String(M).trim().toLowerCase());q&&await b("/api/clients",{id:q.id,status:E})}async function $(M){try{if(!M)return null;const E=await rt("/api/clients"),G=E&&E.clients||[],st=String(M||"").trim().toLowerCase(),q=G.find(m=>String(m.name||"").trim().toLowerCase()===st);return q?q.id:null}catch(E){return null}}function V(M){if(M)try{if(typeof window.openPaymentBuilderById=="function"){window.openPaymentBuilderById(M);return}if(typeof window.gotoGIAndOpenBuilder=="function"){window.gotoGIAndOpenBuilder(M);return}if(document.querySelector("#gi_rows")){document.dispatchEvent(new CustomEvent("gi:edit",{detail:{id:M}}));return}if(typeof window.viewGI=="function"){try{window.viewGI()}catch(G){}let E=0;(function G(){if(document.getElementById("gi_rows")||E>40){try{document.dispatchEvent(new CustomEvent("gi:edit",{detail:{id:M}}))}catch(q){}return}E++,setTimeout(G,100)})();return}document.dispatchEvent(new CustomEvent("gi:edit",{detail:{id:M}}))}catch(E){}}function L(M,E){const G=Number(M.vss||M.vsdPersonal||0)||0,st=M.client||"Cliente",q='\n      <div class="card" style="min-width:min(380px,96vw);max-width:480px">\n        <div style="display:flex;justify-content:space-between;align-items:center">\n          <b>VSS per '.concat(A(st),'</b>\n          <button class="ghost" id="vss_x">Chiudi</button>\n        </div>\n        <div class="row" style="margin-top:8px;gap:8px;align-items:flex-end;flex-wrap:wrap">\n          <div style="min-width:200px">\n            <label>Valore VSS</label>\n            <input id="vss_val" type="number" step="1" value="').concat(G,'">\n          </div>\n          <div class="muted small">Modifica consentita solo per VSS</div>\n        </div>\n        <div class="right" style="margin-top:12px">\n          <button id="vss_ok">Salva</button>\n        </div>\n      </div>');if(typeof window.showOverlay=="function"&&typeof window.hideOverlay=="function"){showOverlay(q);const g=document.getElementById("bp-overlay-panel")||document.body,v=B=>g.querySelector(B),k=()=>{try{hideOverlay()}catch(B){}};v("#vss_x").onclick=k,v("#vss_ok").onclick=async()=>{try{const B=Math.max(0,Number(v("#vss_val").value||0));if(await b("/api/appointments",{id:M.id,vss:B}),e("medium"),D("Appuntamento aggiornato"),k(),B>0)try{const T=await X(M,B);if(T&&(T.id||T._id)){const P=T.id||T._id;V(P)}}catch(T){logger.error(T)}E&&E.onSaved}catch(B){logger.error(B),D("Errore salvataggio VSS")}};return}const m=document.createElement("div");m.className="modal",m.innerHTML=q,document.body.appendChild(m);const p=()=>{try{m.remove()}catch(g){}};m.querySelector("#vss_x").onclick=p,m.querySelector("#vss_ok").onclick=async()=>{try{const g=Math.max(0,Number(m.querySelector("#vss_val").value||0));if(await b("/api/appointments",{id:M.id,vss:g}),e("medium"),D("Appuntamento aggiornato"),p(),g>0)try{const v=await X(M,g);if(v&&(v.id||v._id)){const k=v.id||v._id;V(k)}}catch(v){logger.error(v)}E&&E.onSaved}catch(g){logger.error(g),D("Errore salvataggio VSS")}}}async function X(M,E){let G=M.clientId||null;G||(G=await $(M.client));const st={apptId:M.id,date:new Date(M.end||M.start||Date.now()).toISOString(),clientId:G||void 0,clientName:M.client||"Cliente",vssTotal:Math.round(Number(E||0)),services:M.services||M.note||"",consultantId:M.userId||M.ownerId||null},q=await b("/api/gi",st);return q&&(q.sale||q.gi||q.data)||q}function Z(M){return function(E){const G=document.createElement("div");G.className="bp-banner-card",G.setAttribute("role","alertdialog"),G.setAttribute("aria-live","assertive");const st=new Date(M.end||M.start||Date.now()).toLocaleString("it-IT",{dateStyle:"short",timeStyle:"short"});return G.innerHTML='<div class="msg"><b>Allora, hai venduto a '.concat(A(M.client||"Cliente"),'?</b>\n           <div class="small muted">Appuntamento del ').concat(A(st),'</div></div>\n         <div class="row">\n           <button class="ghost" data-act="later">Posticipa</button>\n           <button class="ghost" data-act="no">No</button>\n           <button data-act="yes">S</button>\n         </div>'),G.querySelector('[data-act="yes"]').onclick=function(){u(M.id,s),S(M.id,s),E(),L(M)},G.querySelector('[data-act="no"]').onclick=async function(){u(M.id,s),S(M.id,s),E();try{await b("/api/appointments",{id:M.id,vss:0}),D("Registrato: nessuna vendita")}catch(q){}},G.querySelector('[data-act="later"]').onclick=function(){c(M.id,s),S(M.id,s),D("Te lo ripropongo domani"),E()},G}}function K(M){return function(E){const G=document.createElement("div");G.className="bp-banner-card",G.setAttribute("role","alertdialog"),G.setAttribute("aria-live","assertive");const st=new Date(M.end||M.start||Date.now()).toLocaleString("it-IT",{dateStyle:"short",timeStyle:"short"});return G.innerHTML='<div class="msg"><b> diventato cliente?</b> '.concat(A(M.client||""),'\n           <div class="small muted">Appuntamento del ').concat(A(st),'</div></div>\n         <div class="row">\n           <button class="ghost" data-act="later">Posticipa</button>\n           <button class="ghost" data-act="no">No</button>\n           <button data-act="yes">S</button>\n         </div>'),G.querySelector('[data-act="yes"]').onclick=async function(){u(M.id,o),S(M.id,o),E();try{await b("/api/appointments",{id:M.id,nncfPromptAnswered:!0}),await ct(M.client,"attivo")}catch(q){}L(M)},G.querySelector('[data-act="no"]').onclick=async function(){u(M.id,o),S(M.id,o),E();try{await b("/api/appointments",{id:M.id,nncfPromptAnswered:!0}),await ct(M.client,"lead non chiuso"),await b("/api/appointments",{id:M.id,vss:0}),D("Aggiornato: Lead non chiuso, VSS=0")}catch(q){}},G.querySelector('[data-act="later"]').onclick=function(){c(M.id,o),S(M.id,o),D("Te lo ripropongo domani"),E()},G}}async function H(){try{const M=await rt("/api/appointments"),E=Date.now(),G=E-i*24*60*60*1e3,st=M&&M.appointments||[];st.sort((q,m)=>+new Date(m.end||m.start||0)-+new Date(q.end||q.start||0)),st.forEach(q=>{try{const m=+new Date(q.end||q.start||0);if(!m||m>E||m<G||!(String(q.type||"").toLowerCase()==="vendita"))return;if(q.nncf){if(q.nncfPromptAnswered)return;if(d(q.id,o)||l(q.id,o)||w(q.id,o)){N("skip pending NNCF",q&&q.id);return}U(o,q),_(q.id,o),N("mark pending NNCF",q&&q.id),Y(K(q))}else{if(d(q.id,s)||l(q.id,s)||w(q.id,s)){N("skip pending SALE",q&&q.id);return}U(s,q),_(q.id,s),N("mark pending SALE",q&&q.id),Y(Z(q))}}catch(m){}})}catch(M){}}window.scanBanners=H,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",H,{once:!0}):H();try{document.addEventListener("appt:saved",function(){setTimeout(H,50)})}catch(M){}try{document.addEventListener("visibilitychange",function(){document.hidden||setTimeout(H,50)})}catch(M){}try{setInterval(function(){H()},60*1e3)}catch(M){}}typeof n<"u"&&(n.initPostSaleBanners=t)})(typeof window<"u"?window:void 0);const Lt=window.BP&&BP.Haptics&&BP.Haptics.impact?BP.Haptics.impact:()=>{};(function(){window.bpAuthToken||(window.bpAuthToken=function(){try{const p=localStorage.getItem("bp_user")||sessionStorage.getItem("bp_user");if(p)try{const g=JSON.parse(p);if(g&&(g.token||g.jwt||g.accessToken))return g.token||g.jwt||g.accessToken}catch(g){}}catch(p){}const m=["bp_token","authToken","token","jwt","accessToken","id_token","auth","authorization","session","user"];for(const p of m)try{const g=localStorage.getItem(p)||sessionStorage.getItem(p);if(!g)continue;try{const v=JSON.parse(g);if(v&&(v.token||v.jwt||v.accessToken))return v.token||v.jwt||v.accessToken}catch(v){}if(/^[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+$/.test(g))return g}catch(g){}try{for(let p=0;p<localStorage.length;p++){const g=localStorage.key(p),v=localStorage.getItem(g);if(v){try{const k=JSON.parse(v);if(k&&(k.token||k.jwt||k.accessToken))return k.token||k.jwt||k.accessToken}catch(k){}if(/^[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+$/.test(v))return v}}}catch(p){}try{const p=JSON.parse(localStorage.getItem("user")||"{}");if(p&&(p.token||p.jwt||p.accessToken))return p.token||p.jwt||p.accessToken}catch(p){}return null}),window.GET||(window.GET=async function(m){const p=window.bpAuthToken&&window.bpAuthToken()||null,g=await fetch(m,{headers:{Accept:"application/json",...p?{Authorization:"Bearer "+p}:{}}});return g.status===204?null:(g.headers.get("content-type")||"").includes("application/json")?g.json():{ok:g.ok,status:g.status,text:await g.text()}}),window.POST||(window.POST=async function(m,p){const g=window.bpAuthToken&&window.bpAuthToken()||null,v=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json",...g?{Authorization:"Bearer "+g}:{}},body:JSON.stringify(p||{})});return v.status===204?null:(v.headers.get("content-type")||"").includes("application/json")?v.json():{ok:v.ok,status:v.status,text:await v.text()}}),typeof window<"u"&&typeof window.initPostSaleBanners=="function"&&window.initPostSaleBanners(Lt),(function(){if(document.getElementById("bp-qvss-css"))return;const p=document.createElement("style");p.id="bp-qvss-css",p.textContent='\n    #bp_overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);\n      display:flex;align-items:center;justify-content:center;z-index:9999;padding:16px}\n    .bp-modal{max-width:560px;width:clamp(300px,90vw,560px);background:var(--card,#fff);\n      color:var(--text,#111);border-radius:14px;border:1px solid rgba(0,0,0,.12);\n      box-shadow:0 12px 34px rgba(0,0,0,.35)}\n    .bp-modal .hd{display:flex;align-items:center;justify-content:space-between;padding:12px 14px}\n    .bp-modal .bd{padding:10px 14px 14px}\n    .bp-modal .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}\n    .bp-modal .right{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}\n    .bp-modal input[type="number"], .bp-modal input[type="date"], .bp-modal select, .bp-modal textarea{\n      width:100%;padding:8px;border:1px solid rgba(0,0,0,.18);border-radius:10px}\n    @media (prefers-color-scheme:dark){\n      .bp-modal{background:rgba(15,18,28,.98);color:#fff;border-color:rgba(255,255,255,.14)}\n      .bp-modal input, .bp-modal select, .bp-modal textarea{background:rgba(255,255,255,.04);color:#fff;border-color:rgba(255,255,255,.18)}\n    }\n  ',document.head.appendChild(p)})();function n(m){return String(m||"").replace(/[&<>'"]/g,p=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[p])}function t(m){if(window.showOverlay)window.showOverlay(m);else{const p=document.createElement("div");p.id="bp_overlay",p.innerHTML=m,document.body.appendChild(p)}}function e(){if(window.hideOverlay)window.hideOverlay();else{const m=document.getElementById("bp_overlay");m&&m.remove()}}async function i(m){try{const p=await R("/api/clients"),g=p&&p.clients||[],v=String(m||"").trim().toLowerCase(),k=g.find(B=>String(B.name||"").trim().toLowerCase()===v);return k?k.id:null}catch(p){return null}}async function o(m,p){if(!(Number(p)>0))return null;const g=new Date(m.end||m.start||Date.now()).toISOString();let v=m.clientId||null;v||(v=await i(m.client));const k={date:g,vssTotal:Number(p)||0,services:m.services||"",consultantId:m.userId||(JSON.parse(localStorage.getItem("user")||"{}")||{}).id,clientId:v||void 0,clientName:m.client||void 0},B=await tt("/api/gi",k);return B&&(B.id||B.sale&&B.sale.id)||null}async function s(m){if(typeof viewGI=="function"&&document.querySelector("#gi_rows")){document.dispatchEvent(new CustomEvent("gi:edit",{detail:{id:m}}));return}if(typeof viewGI=="function"){try{viewGI()}catch(p){}setTimeout(()=>document.dispatchEvent(new CustomEvent("gi:edit",{detail:{id:m}})),350);return}try{let B=function(T){const P=k("pb_rates");if(!T||!T.length){P.textContent="Nessuna rata",P._data=[];return}P.innerHTML=T.map(y=>{const x=new Date(y.dueDate).toLocaleDateString("it-IT");return"<div>".concat(x,"  ").concat(Number(y.amount||0).toLocaleString("it-IT"),' <span class="muted">').concat(n(y.note||""),"</span></div>")}).join(""),P._data=T};const p=await R("/api/gi?from=1900-01-01&to=2999-12-31"),g=(p&&p.sales||[]).find(T=>String(T.id)===String(m));if(!g){S("Vendita non trovata");return}const v=new Date().toISOString().slice(0,10);t('<div class="bp-modal"><div class="hd"><b>Builder pagamenti  '+n(g.clientName||"Cliente")+'</b><button class="ghost" id="pb_x">Chiudi</button></div><div class="bd"><div class="row"><div style="flex:1"><label>Totale VSS</label><input id="pb_vss" type="number" value="'+Number(g.vssTotal||0)+'"></div></div><div class="row" style="margin-top:8px;gap:12px"><div><label>Regola rapida</label><select id="pb_rule"><option value="0">Manuale</option><option value="50-25-25">50% + 25% / 30-60gg</option><option value="20+12">20% + 12 rate mensili</option></select></div><div><label>Prima scadenza</label><input id="pb_first" type="date" value="'+v+'"></div></div><div style="margin-top:8px"><label>Rate</label><div id="pb_rates" class="small muted">Nessuna rata</div></div><div class="right"><button class="ghost" id="pb_apply">Ricalcola</button><button id="pb_save">Salva</button></div></div></div>');const k=T=>document.getElementById(T);k("pb_apply").onclick=function(){const T=k("pb_rule").value||"0",P=Math.max(0,Number(k("pb_vss").value||0)),y=new Date(k("pb_first").value||new Date),x=[],C=(I,O,Q)=>x.push({dueDate:new Date(I).toISOString(),amount:Math.round(O),note:Q||""});if(T==="50-25-25"){C(y,P*.5,"Acconto 50%");const I=new Date(y);I.setDate(I.getDate()+30),C(I,P*.25,"Saldo 25% a 30gg");const O=new Date(y);O.setDate(O.getDate()+60),C(O,P*.25,"Saldo 25% a 60gg")}else if(T==="20+12"){C(y,P*.2,"Acconto 20%");const I=P*.8,O=12,Q=I/O;for(let it=0;it<O;it++){const dt=new Date(y);dt.setMonth(dt.getMonth()+it+1),C(dt,Q,"Rata "+(it+1)+"/"+O)}}B(x)},k("pb_save").onclick=async function(){const T=Math.max(0,Number(k("pb_vss").value||0)),P=k("pb_rates")._data||[];try{await tt("/api/gi",{id:g.id,vssTotal:T,schedule:P});try{document.dispatchEvent(new CustomEvent("payments:defined",{detail:{id:g.id,vssTotal:T,schedule:P}}))}catch(y){}S("Piano pagamenti salvato"),e()}catch(y){logger.error(y),S("Errore salvataggio")}},k("pb_x").onclick=e}catch(p){logger.error(p)}}function a(m){const p=m.client||"Cliente",g=Number(m.vss||m.vsdPersonal||0)||0;t('<div class="bp-modal"><div class="hd"><b>VSS per '+n(p)+'</b><button class="ghost" id="qvss_x">Chiudi</button></div><div class="bd"><div><label>Valore VSS</label><input id="qvss_val" type="number" step="1" value="'+g+'"></div><div class="small muted" style="margin-top:6px">Modifica consentita solo per VSS</div><div class="right"><button id="qvss_ok">Salva</button></div></div></div>'),document.getElementById("qvss_x").onclick=e,document.getElementById("qvss_ok").onclick=async function(){try{const v=Math.max(0,Number(document.getElementById("qvss_val").value||0));await tt("/api/appointments",{id:m.id,vss:v});const k=await o(m,v);e(),S("VSS salvato"),k&&s(k);try{k&&document.dispatchEvent(new CustomEvent("gi:created",{detail:{id:k}}))}catch(B){}document.dispatchEvent(new Event("bp:saved"))}catch(v){logger.error(v),S("Errore salvataggio VSS")}}}async function r(m){try{m.nncf&&(await(async function(){try{const g=await R("/api/clients"),v=g&&g.clients||[],k=String(m.client||"").trim().toLowerCase(),B=v.find(T=>String(T.name||"").trim().toLowerCase()===k);B&&await tt("/api/clients",{id:B.id,status:"attivo"})}catch(g){}})(),document.dispatchEvent(new Event("client:converted"))),a(m)}catch(p){logger.error(p)}}async function l(m){try{if(m.nncf)try{const p=await R("/api/clients"),g=p&&p.clients||[],v=String(m.client||"").trim().toLowerCase(),k=g.find(B=>String(B.name||"").trim().toLowerCase()===v);k&&await tt("/api/clients",{id:k.id,status:"lead non chiuso"})}catch(p){}await tt("/api/appointments",{id:m.id,vss:0}),S("Ok, segnato come non venduto")}catch(p){logger.error(p),S("Errore aggiornamento")}}window.pipelineYes=r,window.pipelineNo=l,(function(){function m(){if(document.getElementById("bp-center-css"))return;const x="\n      #bp_overlay{display:flex;align-items:center;justify-content:center}\n      .bp-modal-card{min-width:min(480px,90vw);max-width:600px;max-height:86vh;overflow:auto}\n      @media (max-width:640px){ .bp-modal-card{min-width:90vw} }\n      .bp-modal-foot{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}\n    ",C=document.createElement("style");C.id="bp-center-css",C.textContent=x,document.head.appendChild(C)}function p(x){try{document.documentElement.style.overflow=x?"hidden":""}catch(C){}}async function g(x){if(!x)return null;try{const C=await R("/api/clients"),I=C&&C.clients||[],O=String(x).trim().toLowerCase(),Q=I.find(it=>String(it.name||"").trim().toLowerCase()===O);return Q?Q.id:null}catch(C){return null}}async function v(x,C){const I=await g(x);if(I)try{await tt("/api/clients",{id:I,status:C})}catch(O){}}async function k(x,C){return tt("/api/appointments",{id:x,vss:Math.max(0,Number(C||0))})}async function B(x,C){const I=await g(x.client||""),O={date:new Date(x.end||x.start||Date.now()).toISOString(),clientId:I||void 0,clientName:x.client||"",vssTotal:Math.max(0,Number(C||0)),services:x.services||"",schedule:[]},Q=await tt("/api/gi",O);return Q&&(Q.id||Q.sale&&Q.sale.id||Array.isArray(Q.sales)&&Q.sales[0]&&Q.sales[0].id)||null}async function T(x){if(!x)return;try{typeof window.viewGI=="function"&&window.viewGI()}catch(I){}let C=0;(function I(){if(document.getElementById("gi_rows")||C>40){try{const Q=new CustomEvent("gi:edit",{detail:{id:x}});document.dispatchEvent(Q)}catch(Q){}return}C++,setTimeout(I,100)})()}function P(x,C){m(),p(!0);const I=Math.max(0,Number(x.vss||0)),O='<div class="modal"><div class="card bp-modal-card"><div style="display:flex;justify-content:space-between;align-items:center;gap:8px"><b>VSS per '+(x.client?y(x.client):"appuntamento")+'</b><button class="ghost" id="qvss_x">Chiudi</button></div><div style="margin-top:8px"><label>Valore VSS</label><input id="qvss_val" type="number" step="1" value="'+I+'"><div class="small muted" style="margin-top:6px">Modifica consentita solo per VSS</div></div><div class="bp-modal-foot"><button id="qvss_ok">Salva</button></div></div></div>';showOverlay(O);function Q(){p(!1),hideOverlay()}const it=document.getElementById("qvss_val");document.getElementById("qvss_x").onclick=Q,document.getElementById("qvss_ok").onclick=async function(){try{const dt=Math.max(0,Number(it.value||0));await k(x.id,dt);const ft=await B(x,dt);if(Q(),ft)try{document.dispatchEvent(new CustomEvent("gi:created",{detail:{id:ft}}))}catch(ht){}typeof window.coachSay=="function"&&st("medium"),T(ft)}catch(dt){logger.error(dt),S("Errore salvataggio VSS")}}}function y(x){return String(x||"").replace(/[&<>'"]/g,C=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[C])}window.pipelineYes=async function(x){try{x.nncf&&await v(x.client,"cliente"),P(x)}catch(C){logger.error(C)}},window.pipelineNo=async function(x){try{x.nncf&&await v(x.client,"lead non chiuso"),await k(x.id,0),Lt("light"),S("Segnato VSS 0")}catch(C){logger.error(C)}}})(),(function(){function m(T){return encodeURIComponent(String(T||""))}function p(){try{const C=document.getElementById("rep_label");if(C&&C.textContent)return C.textContent.trim()}catch(C){}const T=(document.getElementById("rep_type")||{}).value||"mensile",P=new Date,y=String(P.getMonth()+1).padStart(2,"0"),x=P.getFullYear();return T==="settimanale"?"Settimana ISO "+(isoWeekNum?isoWeekNum(P):"corrente")+" "+x:T==="trimestrale"?"Q"+(Math.floor(P.getMonth()/3)+1)+" "+x:T==="semestrale"?"Semestre "+(P.getMonth()<6?"1":"2")+" "+x:T==="annuale"?"Anno "+x:"Mese "+y+"/"+x}async function g(){try{const T=await R("/api/usernames");return(T&&T.users||[]).map(y=>y.email).filter(Boolean).join(",")}catch(T){return""}}function v(){const T=document.getElementById("report_subject");return T&&T.value&&T.value.trim()?T.value.trim():"Report BP  "+p()}function k(){const T=document.getElementById("report_body");return T&&T.value&&T.value.trim()?T.value:"Ciao,\n\ndi seguito il report del periodo "+p()+".\n\n VSS\n VSD\n GI\n NNCF\n\nA presto."}async function B(){const T=document.getElementById("rep_gmail_web"),P=document.getElementById("rep_gmail_app");if(!T&&!P)return;const y=await g(),x=v(),C=k();try{await navigator.clipboard.writeText(C)}catch(I){}T&&(T.onclick=function(){const I="https://mail.google.com/mail/?view=cm&fs=1&tf=1&su="+m(x)+"&cc="+m(y)+"&body="+m(C);window.open(I,"_blank");try{document.dispatchEvent(new Event("report:composed"))}catch(O){}}),P&&(P.onclick=function(){const I="googlegmail:///co?subject="+m(x)+"&cc="+m(y)+"&body="+m(C);location.href=I;try{document.dispatchEvent(new Event("report:composed"))}catch(O){}setTimeout(function(){if(!document.hidden){location.href="mailto:?subject="+m(x)+"&cc="+m(y)+"&body="+m(C);try{document.dispatchEvent(new Event("report:composed"))}catch(O){}}},1200)})}window.wireReportButtons=B})(),(function(){function m(P){var y=P instanceof Date?P:new Date(P||Date.now()),x=y.getFullYear(),C=("0"+(y.getMonth()+1)).slice(-2),I=("0"+y.getDate()).slice(-2);return x+"-"+C+"-"+I}function p(P){for(var y=m(new Date),x=P.querySelectorAll("[data-date], [data-day]"),C=0;C<x.length;C++){var I=x[C],O=I.getAttribute("data-date")||I.getAttribute("data-day")||"";if(O){var Q=String(O).slice(0,10);Q===y&&I.classList.add("today")}}}function g(P){if(typeof window.attachICSButtons=="function"){try{window.attachICSButtons(P)}catch(dt){logger.error(dt)}return}for(var y=P.querySelectorAll("[data-appt], [data-start][data-title], .appt, .calendar-appt"),x=0;x<y.length;x++){var C=y[x];if(!C.querySelector(".bp-ics")){var I=C.getAttribute("data-start")||"",O=C.getAttribute("data-end")||"",Q=C.getAttribute("data-title")||C.getAttribute("data-client")||"Appuntamento";if(I){var it=document.createElement("a");it.href="#",it.className="bp-ics btn-ics",it.textContent="",it.style.marginLeft="6px",it.onclick=function(dt){dt.preventDefault();try{var ft=dt.currentTarget.parentElement||document.body,ht=ft.getAttribute("data-start")||I,Ct=ft.getAttribute("data-end")||O||ht,vt=ft.getAttribute("data-title")||ft.getAttribute("data-client")||Q,J=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//BP//Calendar//IT","BEGIN:VEVENT","UID:"+Date.now()+"@bp","DTSTAMP:"+new Date().toISOString().replace(/[-:]/g,"").replace(/\.\d{3}Z$/,"Z"),"DTSTART:"+new Date(ht).toISOString().replace(/[-:]/g,"").replace(/\.\d{3}Z$/,"Z"),"DTEND:"+new Date(Ct).toISOString().replace(/[-:]/g,"").replace(/\.\d{3}Z$/,"Z"),"SUMMARY:"+vt,"END:VEVENT","END:VCALENDAR"].join("\r\n"),ot=new Blob([J],{type:"text/calendar"}),ut=URL.createObjectURL(ot),yt=document.createElement("a");yt.href=ut,yt.download=(vt||"appuntamento")+".ics",document.body.appendChild(yt),yt.click(),setTimeout(function(){URL.revokeObjectURL(ut);try{yt.remove()}catch(_t){}},0)}catch(_t){logger.error(_t)}},C.appendChild(it)}}}}function v(){var P=document.getElementById("calendar")||document.querySelector(".calendar")||document;p(P),g(P)}window.hookCalendar=v;function k(P){if(document.readyState==="complete"||document.readyState==="interactive")return P();document.addEventListener("DOMContentLoaded",P,{once:!0})}k(v);var B=document.getElementById("calendar")||document.querySelector(".calendar");if(B&&!B.__bpCalObs){B.__bpCalObs=!0;var T=new MutationObserver(function(){try{v()}catch(P){}});T.observe(B,{childList:!0,subtree:!0})}})(),(function(){var m=!1;function p(){if(!m){m=!0;var g='.today{outline:2px solid var(--accent, #5dd3ff); outline-offset:-2px; border-radius:8px; position:relative;}.today::after{content:"OGGI"; position:absolute; top:6px; right:8px; font-size:10px; font-weight:700; color:#fff; background:var(--accent, #5dd3ff); padding:2px 6px; border-radius:6px;}',v=document.createElement("style");v.setAttribute("data-bp-today","1"),v.textContent=g,document.head.appendChild(v)}}window.injectTodayCSS=p,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",p,{once:!0}):p()})(),(function(){function m(){try{return JSON.parse(localStorage.getItem("user")||"{}")}catch(x){return{}}}function p(){var x=m();return x&&x.role==="admin"}function g(x,C){return(C||document).querySelector(x)}function v(x,C){return Array.prototype.slice.call((C||document).querySelectorAll(x))}function k(x){var C=new Date(x);return!C||isNaN(C)?"":("0"+C.getDate()).slice(-2)+"/"+("0"+(C.getMonth()+1)).slice(-2)+"/"+C.getFullYear()}async function B(){try{for(var x=await R("/api/appointments"),C=x&&x.appointments||[],I={},O=0;O<C.length;O++){var Q=C[O],it=String(Q.client||"").trim().toLowerCase();if(it){var dt=new Date(Q.start||Q.end||0).getTime();(!I[it]||dt>I[it])&&(I[it]=dt)}}return I}catch(ft){return logger.error(ft),{}}}async function T(){var x=document.getElementById("cl_list");if(x){var C=await B();v(".card",x).forEach(function(I){var O=g("b",I);if(O){var Q=(O.textContent||"").trim().toLowerCase();if(Q){var it=C[Q],dt=g(".bp-lastapp",I),ft="Ultimo appuntamento: "+(it?k(it):"");if(dt)dt.textContent=ft;else{var ht=document.createElement("div");ht.className="small muted bp-lastapp",ht.textContent=ft,I.appendChild(ht)}}}})}}async function P(){if(!p())return;var x=document.getElementById("cl_list");if(!x)return;var[C,I]=await Promise.all([R("/api/clients"),R("/api/usernames")]),O=C&&C.clients||[],Q=I&&I.users||[];function it(dt){var ft=g("b",dt),ht=(ft&&ft.textContent||"").trim().toLowerCase();return O.find(function(Ct){return String(Ct.name||"").trim().toLowerCase()===ht})}x.__bpInlineReady||(x.__bpInlineReady=!0,v(".card",x).forEach(function(dt){if(!dt.__bpInline){dt.__bpInline=!0;var ft=it(dt);if(ft){var ht=document.createElement("div");ht.style.display="flex",ht.style.gap="8px",ht.style.marginTop="6px";var Ct=document.createElement("button");Ct.className="ghost",Ct.textContent="Modifica",ht.appendChild(Ct),dt.appendChild(ht);var vt=document.createElement("div");vt.style.display="none",vt.style.marginTop="8px",vt.innerHTML='<div class="row" style="gap:8px"><div><label>Nome</label><input class="bp-ed-name" type="text" value="'+(ft.name||"")+'"></div><div><label>Stato</label><select class="bp-ed-state"><option value="prospect" '+(ft.status==="prospect"?"selected":"")+'>Prospect</option><option value="attivo" '+(ft.status==="attivo"?"selected":"")+'>Attivo</option><option value="cliente" '+(ft.status==="cliente"?"selected":"")+'>Cliente</option></select></div><div><label>Consulente</label><select class="bp-ed-consulente"></select></div><div style="align-self:flex-end"><button class="ghost bp-ed-save">Salva</button></div></div>',dt.appendChild(vt);var J=g(".bp-ed-consulente",vt);J.innerHTML='<option value=""></option>'+Q.map(function(ot){return'<option value="'+ot.id+'" '+(String(ft.consultantId||"")===String(ot.id)?"selected":"")+">"+(ot.name||"User "+ot.id)+"</option>"}).join(""),Ct.onclick=function(){vt.style.display=vt.style.display==="none"?"block":"none"},g(".bp-ed-save",vt).onclick=async function(ot){ot.preventDefault();try{var ut={id:ft.id,name:g(".bp-ed-name",vt).value.trim(),status:g(".bp-ed-state",vt).value,consultantId:g(".bp-ed-consulente",vt).value||null};await tt("/api/clients",ut);var yt=g("b",dt);yt&&(yt.textContent=ut.name);var _t=g(".small",dt);_t&&/Stato:/.test(_t.textContent||"")&&(_t.innerHTML="Stato: <b>"+ut.status+"</b>");var Mt=v(".small",dt).find(function(Rt){return/Consulente:/.test(Rt.textContent||"")});if(Mt){var Et=Q.find(function(Rt){return String(Rt.id)===String(ut.consultantId||"")});Mt.innerHTML="Consulente: <b>"+(Et?Et.name||"User "+Et.id:"")+"</b>"}Lt("medium")}catch(Rt){logger.error(Rt),Lt("heavy")}}}}}))}window.applyClientsLastAppointment=T,window.ensureClientInlineEdit=P;function y(){var x=document.getElementById("cl_list");if(x&&(T(),P(),!x.__bpCliObs)){x.__bpCliObs=!0;var C=new MutationObserver(function(){T(),P()});C.observe(x,{childList:!0,subtree:!0})}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",y,{once:!0}):y()})();function c(m){const p=["#".concat(m,"_mode"),"#dash_mode","#comm_mode",'[data-scope="'.concat(m,'"] [name="mode"]'),"#".concat(m,' select[name="mode"]'),'#dashboard select[name="mode"]','select[name="mode"]'];for(const g of p){const v=document.querySelector(g);if(v&&v.value)return v.value}return"consuntivo"}if(window.__BP_FINAL_READY__)return;window.__BP_FINAL_READY__=!0;const d=(m,p)=>(p||document).querySelector(m),u=(m,p,g)=>m&&m.addEventListener(p,g,!1),f=m=>document.readyState!=="loading"?m():document.addEventListener("DOMContentLoaded",m),h=(m,p)=>{try{return JSON.parse(m)}catch(g){return p}},w=m=>m<10?"0"+m:""+m,_=()=>{const m=new Date;return"".concat(m.getFullYear(),"-").concat(w(m.getMonth()+1),"-").concat(w(m.getDate()))};function S(m){try{(window.showToast?window.showToast:alert)(m)}catch(p){alert(m)}}function F(){const m=g=>{if(!g)return null;g=String(g).replace(/^"+|"+$/g,"");try{const v=JSON.parse(g);if(v&&(v.token||v.jwt||v.accessToken))return v.token||v.jwt||v.accessToken}catch(v){}return/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+$/.test(g)?g:null};for(let g=0;g<localStorage.length;g++){const v=m(localStorage.getItem(localStorage.key(g)));if(v)return v}const p=["token","authToken","jwt","bp_token","accessToken","id_token","auth","authorization","bp.jwt","_token","session","user"];for(const g of p){const v=m(localStorage.getItem(g)||sessionStorage.getItem(g));if(v)return v}try{const g=h(localStorage.getItem("user")||"{}",{});if(g&&(g.token||g.jwt||g.accessToken))return g.token||g.jwt||g.accessToken}catch(g){}return null}async function R(m,p={}){if(typeof window.GET=="function"&&!p.forceFetch)try{return await window.GET(m)}catch(k){}const g=F(),v=await fetch(m,{headers:{Accept:"application/json",...g?{Authorization:"Bearer "+g}:{}}});return v.status===401&&window.GET?window.GET(m):v.status===204?null:v.json()}async function tt(m,p,g={}){if(typeof window.POST=="function"&&!g.forceFetch)try{return await window.POST(m,p)}catch(B){}const v=F(),k=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json",...v?{Authorization:"Bearer "+v}:{}},body:JSON.stringify(p||{})});return!k.ok&&k.status===401&&window.POST?window.POST(m,p):k.status===204?null:k.json()}function rt(m,p,g){const v=document.getElementById(m);if(!v)return;const k=v.getContext("2d"),B=window.devicePixelRatio||1,T=Math.max(220,v.clientWidth||320),P=Math.max(80,v.clientHeight||80);v.style.width=T+"px",v.style.height=P+"px",v.width=T*B,v.height=P*B,k.scale(B,B),k.clearRect(0,0,T,P);const y=Array.isArray(g)?g.map(ht=>+ht||0):[];if(!y.length)return;const x=Math.max(...y),C=Math.min(...y),I=x-C===0?(x||1)*.2:(x-C)*.2,O=x+I,Q=Math.max(0,C-I),it=y.length>1?(T-8)/(y.length-1):0,dt=ht=>4+ht*it,ft=ht=>{const Ct=(ht-Q)/(O-Q||1);return P-6-Ct*(P-12)};k.lineWidth=2,k.lineJoin=k.lineCap="round",k.strokeStyle="#2e6cff",k.beginPath(),k.moveTo(dt(0),ft(y[0]));for(let ht=1;ht<y.length;ht++)k.lineTo(dt(ht),ft(y[ht]));k.stroke(),k.fillStyle="#2e6cff";for(let ht=0;ht<y.length;ht++)k.beginPath(),k.arc(dt(ht),ft(y[ht]),2,0,Math.PI*2),k.fill()}(function(){const p=function(g,v,k){const B=document.getElementById(g);if(B){if(window.Chart)try{B.__chart&&typeof B.__chart.destroy=="function"&&B.__chart.destroy();const T=typeof window.computeTickOptions=="function"?window.computeTickOptions(v,B.clientWidth||320):void 0,P={type:"line",data:{labels:v,datasets:[{data:k,tension:.35,pointRadius:2,borderWidth:2}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{x:Object.assign({display:!0},T?{ticks:T}:{}),y:{display:!0}}}};B.__chart=new Chart(B.getContext("2d"),P);return}catch(T){}rt(g,v,k)}};(!window.drawFullLine||!window.drawFullLine.__patched)&&(window.drawFullLine=p,window.drawFullLine.__patched=!0)})();function b(m,p){try{if(typeof window.labelsForBuckets=="function")return window.labelsForBuckets(m,p)}catch(v){}const g=typeof effectivePeriodType=="function"?effectivePeriodType(String(m||"mensile").toLowerCase()):String(m||"mensile").toLowerCase();return(p||[]).map(v=>{const k=new Date(v.s);return g==="settimanale"?"W"+(typeof isoWeekNum=="function"?isoWeekNum(k):"")+" "+k.getUTCFullYear():g==="mensile"?String(k.getUTCMonth()+1).padStart(2,"0")+"/"+k.getUTCFullYear():g==="trimestrale"?"Q"+(Math.floor(k.getUTCMonth()/3)+1)+" "+k.getUTCFullYear():g==="semestrale"?(k.getUTCMonth()<6?"S1 ":"S2 ")+k.getUTCFullYear():String(k.getUTCFullYear())})}const D=typeof window<"u"?window.__periodsCache||(window.__periodsCache={}):{};function N(m){try{const p=new Date(m),g=p.getUTCFullYear(),v=String(p.getUTCMonth()+1).padStart(2,"0"),k=String(p.getUTCDate()).padStart(2,"0");return g+"-"+v+"-"+k}catch(p){return""}}function A(m){try{return typeof effectivePeriodType=="function"?effectivePeriodType(String(m||"mensile").toLowerCase()):String(m||"mensile").toLowerCase()}catch(p){return String(m||"mensile").toLowerCase()}}async function U(m){if(!m){if(Array.isArray(window.periods)&&window.periods.length)return window.periods;try{const y=await R("/api/periods?global=1");if(y&&Array.isArray(y.periods))return window.periods=y.periods,y.periods}catch(y){}return window.periods||[]}let p,g,v,k=null;if(typeof m=="string"){const y=window.readUnifiedRange&&window.readUnifiedRange(m)||{type:"mensile",end:new Date};p=y.type||"mensile";const x=window.buildBuckets?window.buildBuckets(p,y.end):[];if(x&&x.length)g=N(new Date(x[0].s)),v=N(new Date(x[x.length-1].e));else if(y.start&&y.end)g=N(new Date(y.start)),v=N(new Date(y.end));else{const C=new Date;g=N(C),v=N(C)}}else{const y=m||{};p=y.type||"mensile",g=y.from||N(new Date),v=y.to||N(new Date),k=y.userId||null}const B=A(p),T=[B,g,v,k||""].join("|");if(D[T])return D[T];const P=["?global=1","type="+encodeURIComponent(B),"from="+encodeURIComponent(g),"to="+encodeURIComponent(v)].concat(k?["userId="+encodeURIComponent(k)]:[]).join("&").replace("?&","?");try{const y=await R("/api/periods"+P).catch(function(){return R("/api/periods"+P.replace("?global=1","?").replace("??","?"))}),x=y&&Array.isArray(y.periods)?y.periods:[];return D[T]=x,x}catch(y){return[]}}function j(m,p,g){const v=String(p).toLowerCase()==="previsionale"?m.indicatorsPrev||{}:m.indicatorsCons||{},k=Number(v[g]||0);return Number.isFinite(k)?k:0}function z(m,p,g){if(typeof window.drawFullLine=="function")return window.drawFullLine(m,p,g);rt(m,p,g)}async function W(){const m=window.readUnifiedRange&&window.readUnifiedRange("dash")||{type:"mensile",end:new Date},p=m.type||"mensile",g=c("dash"),v=window.buildBuckets?window.buildBuckets(p,m.end):[],k=await U("dash"),B=b(p,v);["VSS","VSDPersonale","GI","NNCF"].forEach(T=>{const P=v.map(y=>{let x=0;return k.forEach(C=>{if(C.type!==effectivePeriodType(p))return;const I=new Date(C.startDate).getTime(),O=new Date(C.endDate).getTime();I>=y.s&&O<=y.e&&(x+=j(C,g,T))}),Math.round(x)});z("d_mini_"+T.toLowerCase(),B,P)});try{if(window.BP&&BP.Targets&&typeof BP.Targets.getForPeriod=="function"){const T=JSON.parse(localStorage.getItem("user")||"{}")||{},P=String(T.grade||"junior").toLowerCase()==="senior"?"senior":"junior",y=BP.Targets.getForPeriod(P,effectivePeriodType(p))||{},x=["VSS","VSDPersonale","GI","NNCF"],C={};x.forEach(I=>{let O=0;const Q=v[v.length-1];Q&&(k.forEach(it=>{if(it.type!==effectivePeriodType(p))return;const dt=new Date(it.startDate).getTime(),ft=new Date(it.endDate).getTime();dt>=Q.s&&ft<=Q.e&&(O+=j(it,g,I))}),C[I]=Math.round(O))}),window.__bpCoachKpiFired=window.__bpCoachKpiFired||{},x.forEach(I=>{const O=Number(y[I]||0);if(O<=0)return;const Q=Number(C[I]||0),it=Math.round(Q/O*100),dt=effectivePeriodType(p)+"_"+I;if(it>=100&&!window.__bpCoachKpiFired[dt+"_100"]){window.__bpCoachKpiFired[dt+"_100"]=!0;try{document.dispatchEvent(new CustomEvent("kpi:goal-reached",{detail:{key:I,value:Q,target:O}}))}catch(ft){}}else if(it>=80&&!window.__bpCoachKpiFired[dt+"_80"]){window.__bpCoachKpiFired[dt+"_80"]=!0;try{document.dispatchEvent(new CustomEvent("kpi:goal-80",{detail:{key:I,value:Q,target:O}}))}catch(ft){}}})}}catch(T){}}async function lt(){const m="comm",p=window.readUnifiedRange&&(window.readUnifiedRange(m)||window.readUnifiedRange("cm"))||{type:"mensile",end:new Date},g=p.type||"mensile",v=c&&c(m)||c&&c("cm")||"cons",k=window.buildBuckets?window.buildBuckets(g,p.end):[],B=await U("comm"),T=b(g,k),P=k.map(y=>{let x=0;return B.forEach(C=>{if(C.type!==effectivePeriodType(g))return;const I=new Date(C.startDate).getTime(),O=new Date(C.endDate).getTime();I>=y.s&&O<=y.e&&(x+=j(C,v,"VSDPersonale"))}),Math.round(x)});z("cm_mini_vsd",T,P)}async function Y(){const m=window.readUnifiedRange&&(window.readUnifiedRange("t")||window.readUnifiedRange("tg"))||{type:"mensile",end:new Date},p=m.type||"mensile",g=c&&c("t")||c&&c("tg")||"cons",v=(d("#tg_user")||{}).value||"",k=(d("#tg_ind")||{}).value||"VSS",B=window.buildBuckets?window.buildBuckets(p,m.end):[];function T(O){try{const Q=new Date(O),it=Q.getUTCFullYear(),dt=String(Q.getUTCMonth()+1).padStart(2,"0"),ft=String(Q.getUTCDate()).padStart(2,"0");return it+"-"+dt+"-"+ft}catch(Q){return""}}const P=B.length?T(new Date(B[0].s)):T(new Date),y=B.length?T(new Date(B[B.length-1].e)):T(new Date),x=await U({type:p,from:P,to:y,userId:v||null}),C=b(p,B),I=B.map(O=>{let Q=0;return x.forEach(it=>{if(it.type!==effectivePeriodType(p)||v&&String(it.userId)!==String(v))return;const dt=new Date(it.startDate).getTime(),ft=new Date(it.endDate).getTime();dt>=O.s&&ft<=O.e&&(Q+=j(it,g,k))}),Math.round(Q)});z("tg_chart",C,I)}function nt(){u(d("#dash_mode"),"change",()=>{Lt("light"),window.recomputeDashboard&&recomputeDashboard(),window.recomputeDashboardMini&&W()}),u(d("#d_mode"),"change",()=>{Lt("light"),window.recomputeDashboard&&recomputeDashboard(),window.recomputeDashboardMini&&W()}),u(d("#comm_mode"),"change",()=>{Lt("light"),window.recomputeCommsMini&&lt()}),u(d("#cm_mode"),"change",()=>{Lt("light"),window.recomputeCommsMini&&lt()});const m=d("#tg_user");m&&m.options.length<=1&&R("/api/usernames").then(v=>{(v&&v.users||[]).forEach(k=>{var B=document.createElement("option");B.value=k.id,B.textContent=(k.name||"User "+k.id)+(k.grade?"  "+k.grade:""),m.appendChild(B)})}).catch(v=>logger.error(v));const p=()=>{window.recomputeTeamChart&&Y(),window.recomputeTeamAggChart&&recomputeTeamAggChart()};u(d("#t_mode"),"change",()=>{Lt("light"),p()}),["#t_y","#t_m","#t_q","#t_from","#t_to"].forEach(v=>{const k=d(v);k&&u(k,"change",p)}),m&&u(m,"change",()=>{Lt("light"),window.recomputeTeamChart&&Y()});const g=d("#t_ind");g&&u(g,"change",()=>{Lt("light"),window.recomputeTeamAggChart&&recomputeTeamAggChart()}),d("#tg_chart")&&window.recomputeTeamChart&&Y(),d("#t_chart")&&window.recomputeTeamAggChart&&recomputeTeamAggChart()}typeof window.todayKey!="function"&&(window.todayKey=function(){var p=new Date,g=p.getFullYear(),v=("0"+(p.getMonth()+1)).slice(-2),k=("0"+p.getDate()).slice(-2);return g+"-"+v+"-"+k});function ct(){try{var m=_(),p=document.querySelector('.calendar .day[data-day="'+m+'"], .calendar .day[data-date="'+m+'"]');if(!p)for(var g=parseInt(m.slice(8,10),10),v=document.querySelectorAll(".calendar .day"),k=0;k<v.length;k++){var B=v[k],T=parseInt((B.getAttribute("data-day")||B.getAttribute("data-date")||"").slice(8,10)||B.textContent.trim(),10);if(T===g){p=B;break}}p&&p.classList.add("today")}catch(P){}}function $(){try{for(var m=_(),p=document.querySelectorAll(".calendar .day[data-day], .calendar .day[data-date]"),g=0;g<p.length;g++){var v=p[g],k=(v.getAttribute("data-day")||v.getAttribute("data-date")||"").slice(0,10);k&&k<m&&v.classList.remove("slot-free")}}catch(B){}}function V(){try{var m=document.getElementById("cal_day_box");if(!m)return;for(var p=m.querySelectorAll(".cal-app"),g=0;g<p.length;g++){var v=p[g];if(!v.querySelector("[data-ics-inline]")){var k=v.getAttribute("data-start")||"",B=v.getAttribute("data-end")||"",T=v.getAttribute("data-title")||(v.querySelector("b")?v.querySelector("b").textContent.trim():"Appuntamento");if(!(!k||!B)&&window.BP&&BP.ICS&&typeof BP.ICS.downloadIcsForAppointment=="function"){var P=document.createElement("button");P.className="ghost btn-ics",P.textContent="",P.setAttribute("data-ics-inline","1"),P.style.marginTop="6px",P.addEventListener("click",function(y){y.stopPropagation();var x=y.currentTarget.parentElement,C=x.getAttribute("data-start"),I=x.getAttribute("data-end"),O=x.getAttribute("data-title")||(x.querySelector("b")?x.querySelector("b").textContent.trim():"Appuntamento"),Q={client:O,start:C,end:I,type:"manuale",vss:0,vsdPersonal:0,nncf:!1};try{BP.ICS.downloadIcsForAppointment(Q),Lt("medium")}catch(it){}}),v.appendChild(P)}}}}catch(y){}}window.markToday=window.markToday||ct,window.clampSlotCounters=window.clampSlotCounters||$,window.wireICSInsideDayBox=window.wireICSInsideDayBox||V,(function(){function m(T){return encodeURIComponent(String(T||""))}function p(){return R("/api/users_emails").then(function(T){return T&&Array.isArray(T.emails)?T.emails.filter(Boolean):T&&Array.isArray(T.users)?T.users.map(P=>P.email).filter(Boolean):[]}).catch(function(){return R("/api/usernames").then(function(T){var P=T&&T.users||[];return P.map(y=>y.email).filter(Boolean)}).catch(function(){return[]})})}function g(){var T=document.getElementById("report_subject");return T&&T.value.trim()||"Report BP"}function v(){var T=document.getElementById("report_body");return T&&T.value||""}function k(){var T=document.getElementById("rep_gmail_web"),P=document.getElementById("rep_gmail_app");!T&&!P||p().then(function(y){var x=(y||[]).join(",");function C(){return"https://mail.google.com/mail/?view=cm&fs=1&tf=1&su="+m(g())+"&cc="+m(x)+"&body="+m(v())}function I(){return"googlegmail:///co?subject="+m(g())+"&cc="+m(x)+"&body="+m(v())}T&&(T.onclick=function(){try{navigator.clipboard&&navigator.clipboard.writeText(v())}catch(O){}window.open(C(),"_blank")}),P&&(P.onclick=function(){try{navigator.clipboard&&navigator.clipboard.writeText(v())}catch(O){}location.href=I(),setTimeout(function(){if(!document.hidden){var O="mailto:?subject="+m(g())+"&cc="+m(x)+"&body="+m(v());location.href=O}},1200)})})}var B=window.BPFinal=window.BPFinal||{};B.wireReportButtons=k,window.wireReportButtons||(window.wireReportButtons=k)})(),(function(){let m={ts:0,map:null},p=null;function g(v){const k=Object.create(null);for(const B of v||[]){const T=String(B.client||"").toLowerCase();if(!T)continue;const P=+new Date(B.end||B.start||0);(!k[T]||P>k[T])&&(k[T]=P)}return k}window.BPFinal=window.BPFinal||{},BPFinal.getLastApptMap=function(){const k=Date.now();return m.map&&k-m.ts<15e3?Promise.resolve(m.map):p||(p=R("/api/appointments?global=1").then(B=>g(B&&B.appointments||[])).then(B=>(m={ts:Date.now(),map:B},B)).catch(()=>({})).finally(()=>{p=null}),p)}})();function L(m){var k;if(!m)return;let p=m.querySelector(".bp-appts");if(p&&p.style.display!=="none"){p.remove();return}p||(p=document.createElement("div"),p.className="bp-appts",p.style.marginTop="8px",m.appendChild(p)),p.innerHTML='<div class="muted">Caricamento</div>',p.style.display="block";const g=m.getAttribute("data-clid")||"",v=(((k=m.querySelector("b"))==null?void 0:k.textContent)||"").trim();R("/api/appointments?global=1").then(B=>{const T=B&&B.appointments||[],P=v.toLowerCase(),y=T.filter(C=>String(C.clientId||"")===g||String(C.client||"").trim().toLowerCase()===P);y.sort((C,I)=>new Date(I.start)-new Date(C.start));const x=y.map(C=>{const I=new Date(C.start),O=("0"+I.getDate()).slice(-2)+"/"+("0"+(I.getMonth()+1)).slice(-2)+"/"+I.getFullYear(),Q=[];return Number(C.vss)>0&&Q.push("VSS "+Number(C.vss).toLocaleString("it-IT")+""),Number(C.vsdPersonal)>0&&Q.push("VSD "+Number(C.vsdPersonal).toLocaleString("it-IT")+""),Number(C.vsdIndiretto)>0&&Q.push("VSD ind "+Number(C.vsdIndiretto).toLocaleString("it-IT")+""),Number(C.telefonate)>0&&Q.push("Tel "+Number(C.telefonate)),Number(C.appFissati)>0&&Q.push("AppFiss "+Number(C.appFissati)),'<div class="small">'.concat(n(C.type||""),"  ").concat(O).concat(Q.length?"  "+Q.join("  "):"","</div>")}).join("")||'<div class="muted">Nessun appuntamento</div>';p.innerHTML=x}).catch(B=>{logger.error(B),p.innerHTML='<div class="muted">Errore caricamento appuntamenti</div>'})}BPFinal.showClientAppointments=L,BPFinal.enrichClientCards=function(){const p=document.getElementById("cl_list");p&&BPFinal.getLastApptMap().then(g=>{const v=p.querySelectorAll(".card[data-clid], .card");for(const k of v){const B=k.querySelector("b"),T=(B?B.textContent:k.getAttribute("data-name")||"").trim().toLowerCase(),P=g[T]||0,y=k.querySelector(".last-appt, .client-last");if(y)if(P){const x=new Date(P),C=("0"+x.getDate()).slice(-2),I=("0"+(x.getMonth()+1)).slice(-2),O=x.getFullYear();y.textContent="".concat(C,"/").concat(I,"/").concat(O)}else y.textContent="";k.setAttribute("data-last-ts",String(P||0)),!k.getAttribute("data-name-lower")&&T&&k.setAttribute("data-name-lower",T),k.__bp_appts||(k.__bp_appts=!0,k.addEventListener("click",x=>{x.target.closest("button,select,input,a")||L(k)}))}})},BPFinal.enableClientsInlineAdmin=function(){const p=document.getElementById("cl_list");if(!p||p.__bp_inline_admin_wired)return;p.__bp_inline_admin_wired=!0;let g=null;function v(){return g?Promise.resolve(g):R("/api/usernames").then(P=>g=P&&P.users||[]).catch(()=>[])}const k=["attivo","lead non chiuso","potenziale"];function B(P){if(!P||P.nodeType!==1||P.querySelector("[data-edit-client]"))return;P.style.position="relative";const y=document.createElement("button");y.className="ghost small",y.textContent="Modifica",y.title="Modifica cliente",y.setAttribute("data-edit-client","1"),y.style.position="absolute",y.style.right="8px",y.style.top="8px",y.style.zIndex="2",y.style.cursor="pointer",P.appendChild(y),y.addEventListener("click",function(){const x=P.getAttribute("data-clid")||P.dataset.clid||"",C=P.querySelector("b"),I=P.querySelector(".cl-status, .client-status"),O=P.querySelector(".cl-cons, .client-owner"),Q={name:C?C.textContent.trim():"",status:String(I&&I.textContent||P.getAttribute("data-status")||"potenziale").toLowerCase(),consId:P.getAttribute("data-consultant-id")||"",consText:O?O.textContent:""},it=document.createElement("input");it.type="text",it.value=Q.name,it.style.width="100%",C&&C.replaceWith(it);const dt=document.createElement("select");dt.innerHTML=k.map(ft=>'<option value="'.concat(ft,'">').concat(ft.charAt(0).toUpperCase()+ft.slice(1),"</option>")).join(""),dt.value=k.includes(Q.status)?Q.status:"potenziale",I&&(I.textContent="",I.appendChild(dt)),v().then(ft=>{const ht=document.createElement("select");ht.innerHTML='<option value=""></option>'+ft.map(ot=>'<option value="'.concat(ot.id,'">').concat(ot.name||"User "+ot.id).concat(ot.grade?" ("+ot.grade+")":"","</option>")).join(""),Q.consId&&(ht.value=String(Q.consId)),O&&(O.textContent="",O.appendChild(ht));const Ct=document.createElement("div");Ct.className="row",Ct.style.marginTop="8px";const vt=document.createElement("button");vt.textContent="Salva";const J=document.createElement("button");J.textContent="Annulla",J.className="ghost",Ct.appendChild(vt),Ct.appendChild(J),P.appendChild(Ct),J.addEventListener("click",function(){const ot=document.createElement("b");ot.textContent=Q.name,it.replaceWith(ot),I&&(I.textContent=Q.status),O.textContent=Q.consText||"",Ct.remove()}),vt.addEventListener("click",function(){const ot={id:x,name:it.value.trim(),status:dt.value},ut=ht.value?String(ht.value):"";ut&&(ot.consultantId=ut),tt("/api/clients",ot).then(function(){S("Cliente aggiornato"),typeof addXP=="function"&&addXP(4);const yt=document.createElement("b");yt.textContent=ot.name||Q.name,it.replaceWith(yt),I&&(I.textContent=ot.status),ut?(O.textContent=ht.options[ht.selectedIndex].textContent||"#"+ut,P.setAttribute("data-consultant-id",ut)):(O.textContent="",P.setAttribute("data-consultant-id","")),P.setAttribute("data-status",ot.status),Ct.remove()}).catch(function(yt){logger.error(yt),S("Errore aggiornamento cliente")})})})})}p.querySelectorAll(".card[data-clid], .card").forEach(B),new MutationObserver(P=>{for(const y of P)for(const x of y.addedNodes)x.nodeType===1&&x.matches(".card[data-clid], .card")&&B(x),x.nodeType===1&&x.querySelectorAll&&x.querySelectorAll(".card[data-clid], .card").forEach(B)}).observe(p,{childList:!0,subtree:!0})},BPFinal.applyClientSort=function(){const p=document.getElementById("cl_list");if(!p)return;const g=document.getElementById("cl_order"),v=g?g.value:"az",k=Array.from(p.children).filter(B=>B.classList.contains("card"));if(k.length){v==="last_desc"?k.sort((B,T)=>(+T.getAttribute("data-last-ts")||0)-(+B.getAttribute("data-last-ts")||0)):k.sort((B,T)=>String(B.getAttribute("data-name-lower")||"").localeCompare(String(T.getAttribute("data-name-lower")||"")));for(const B of k)p.appendChild(B)}},BPFinal.ensureClientFilters=function(){const p=document.getElementById("cl_f_apply");p&&!p.__bp_wired&&(p.__bp_wired=!0,p.addEventListener("click",()=>{setTimeout(()=>{BPFinal.enrichClientCards(),BPFinal.applyClientSort()},0)}));const g=document.getElementById("cl_order");g&&!g.__bp_wired&&(g.__bp_wired=!0,g.addEventListener("change",()=>BPFinal.applyClientSort()))},BPFinal.wireCreateClientExtras=function(){const p=document.getElementById("cl_add");!p||p.__bp_wired||(p.__bp_wired=!0,p.addEventListener("click",g=>{const v=document.getElementById("cl_name"),k=document.getElementById("cl_new_state"),B=document.getElementById("cl_new_owner");if(!v)return;const T=(v.value||"").trim();if(!T||!k&&!B)return;g.stopPropagation(),g.preventDefault();const P={name:T};k&&(P.status=k.value),B&&B.value&&(P.consultantId=B.value),tt("/api/clients",P).then(()=>{S("Cliente aggiunto"),addXP&&addXP(5),v.value="",setTimeout(()=>{BPFinal.enrichClientCards(),BPFinal.applyClientSort()},150)}).catch(()=>S("Errore creazione cliente"))},!0))},BPFinal.ensureClientSection=function(){BPFinal.ensureClientFilters(),BPFinal.wireCreateClientExtras(),BPFinal.enrichClientCards(),BPFinal.enableClientsInlineAdmin(),BPFinal.applyClientSort()};async function X(){const m=d("#tg_user");if(!m||m.options.length>1)return;const p=await R("/api/usernames").catch(()=>null);(p&&p.users||[]).forEach(g=>{const v=document.createElement("option");v.value=g.id,v.textContent=g.name+(g.grade?" ("+g.grade+")":""),m.appendChild(v)})}function Z(){const m=d("#users, .users");if(!m||m.__userEditWired)return;m.__userEditWired=!0,m.addEventListener("click",g=>{var x,C;const v=g.target.closest("[data-edit-user]");if(!v)return;const k=v.closest("[data-user-id]"),B=k==null?void 0:k.getAttribute("data-user-id"),T=((x=k==null?void 0:k.querySelector(".u-name"))==null?void 0:x.textContent)||"",P=((C=k==null?void 0:k.querySelector(".u-email"))==null?void 0:C.textContent)||"",y=document.createElement("div");y.className="modal",y.innerHTML='<div class="card"><h3>Modifica utente</h3><label>Nome <input id="u_name" value="'+T+'"></label><label>Email <input id="u_email" value="'+P+'"></label><label>Password <input id="u_pass" type="password" placeholder="(lascia vuoto per non cambiare)"></label><div class="row right"><button id="u_ok" class="btn-ghost">Salva</button><button id="u_x" class="btn-ghost">Chiudi</button></div></div>',document.body.appendChild(y),d("#u_x",y).onclick=()=>y.remove(),d("#u_ok",y).onclick=async()=>{try{const I={id:B,name:d("#u_name",y).value,email:d("#u_email",y).value},O=d("#u_pass",y).value.trim();O&&(I.password=O),await tt("/api/users",I),S("Utente aggiornato"),y.remove(),location.reload()}catch(I){S("Errore aggiornamento utente")}}});const p=d("#btnProfile")||d("[data-edit-self]");p&&!p.__wired&&(p.__wired=!0,p.onclick=()=>{const g=h(localStorage.getItem("user")||"{}",{}),v=document.createElement("div");v.className="modal",v.innerHTML='<div class="card"><h3>Profilo</h3><label>Nome <input id="me_name" value="'+(g.name||"")+'"></label><label>Email <input id="me_email" value="'+(g.email||"")+'"></label><label>Password <input id="me_pass" type="password" placeholder="(nuova password)"></label><div class="row right"><button id="me_ok" class="btn-ghost">Salva</button><button id="me_x" class="btn-ghost">Chiudi</button></div></div>',document.body.appendChild(v),d("#me_x",v).onclick=()=>v.remove(),d("#me_ok",v).onclick=async()=>{try{const k={id:g.id,name:d("#me_name",v).value,email:d("#me_email",v).value},B=d("#me_pass",v).value.trim();B&&(k.password=B),await tt("/api/users",k),S("Profilo aggiornato"),v.remove(),location.reload()}catch(k){S("Errore aggiornamento profilo")}}})}const K=document.createElement("div");K.className="bp-coach-host",K.style.cssText="position:fixed;left:50%;transform:translateX(-50%);z-index:1200;display:flex;flex-direction:column;gap:6px;pointer-events:none;",document.documentElement.appendChild(K);const H="\n    /* Desktop default */\n    .bp-coach-host{ top:14px; }\n    /* Mobile: place below header + safe-area */\n    @media (max-width:980px){\n      .bp-coach-host{ top: calc(env(safe-area-inset-top) + 56px + 12px); }\n    }\n    .bp-coach{background:rgba(20,24,34,.92);color:#fff;border:1px solid rgba(255,255,255,.16);\n      border-radius:12px;padding:8px 10px;font-weight:700;box-shadow:0 12px 24px rgba(0,0,0,.35);opacity:.98;transform:translateY(0);transition:all .18s;}\n    @keyframes bpCoachPop{from{transform:translateY(-6px);opacity:0}to{transform:translateY(0);opacity:1}}\n  ",M=document.createElement("style");M.textContent=H,document.head.appendChild(M);function E(){return h(localStorage.getItem("user")||"{}",{})}function G(m){const p=E().name||"campione",g=window.BP&&window.BP.Phrases?window.BP.Phrases:null;let v=[];return g?v=m==="high"?g.high||g.standard||[]:m==="low"?g.low||g.standard||[]:g.medium||g.standard||[]:v=["Grande {{name}}!","Che figata, {{name}}!","Super!","Non ti ferma nessuno!!","Grandissimo!"],v.length||(v=["Grande {{name}}!"]),v[Math.floor(Math.random()*v.length)].replace(/{{\s*name\s*}}/gi,p)}function st(m){const p=document.createElement("div");p.className="bp-coach",p.textContent=G(m||"medium"),K.appendChild(p),setTimeout(()=>{p.style.opacity="0",p.style.transform="translateY(-4px)"},2200),setTimeout(()=>{p.remove()},2420)}window.coachSay=window.coachSay||st;try{window.BP=window.BP||{},window.BP.Coach=window.BP.Coach||{},window.BP.Coach.say=window.BP.Coach.say||function(m,p){try{const g=String(m||"").toLowerCase();let v=p&&p.intensity||(g==="low"||g==="medium"||g==="high"?g:void 0);v||(g==="bp_saved"||g==="client_converted"||g==="gi_created"?v="high":g==="appointment_created"||g==="payments_defined"||g==="report_composed"?v="medium":v="low"),st(v)}catch(g){st("medium")}}}catch(m){}(function(){var m="bp-nncf-banner",p="bp_seen_nncf_appt";function g(){if(!document.getElementById("bp-nncf-css")){var P="\n      #".concat(m,"{\n        position: fixed; left: 16px; right:16px; bottom: 16px; z-index: 9999;\n        background: var(--card, rgba(15,18,28,.96));\n        border: 1px solid var(--hair2, rgba(255,255,255,.12));\n        border-radius: 14px; box-shadow: 0 8px 28px rgba(0,0,0,.35);\n        padding: 12px; display:flex; align-items:center; gap:12px; backdrop-filter: blur(6px);\n      }\n      #").concat(m," .msg{ flex:1; }\n      #").concat(m," .row{ display:flex; gap:8px; align-items:center; }\n      #").concat(m," .ghost{ background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.18); }\n      @media (prefers-color-scheme: light){\n        #").concat(m,"{ background:#fff; border-color: rgba(0,0,0,.12); }\n        #").concat(m," .ghost{ background:rgba(0,0,0,.04); border-color: rgba(0,0,0,.12); }\n      }\n    "),y=document.createElement("style");y.id="bp-nncf-css",y.textContent=P,document.head.appendChild(y)}}function v(P,y){return P?(P=String(P).trim().toLowerCase(),R("/api/clients").then(function(x){var C=x&&x.clients||[],I=C.find(function(O){return String(O.name||"").trim().toLowerCase()===P});if(!I)throw new Error("Cliente non trovato: "+P);return tt("/api/clients",{id:I.id,status:y})})):Promise.reject(new Error("Nome cliente mancante"))}function k(P){if(document.getElementById(m))return;g();var y=P.client||"Cliente",x=document.createElement("div");x.id=m,x.innerHTML='<div class="msg"><b> diventato cliente?</b> '+n(y)+'</div><div class="row"><button class="ghost" id="bp_nncf_yes">S</button><button class="ghost" id="bp_nncf_notyet">Non ancora</button><button id="bp_nncf_close">Chiudi</button></div>',document.body.appendChild(x);function C(){try{localStorage.setItem(p,String(P.id||P.end||Date.now()))}catch(O){}}function I(){try{x.remove()}catch(O){}}document.getElementById("bp_nncf_yes").onclick=function(){v(y,"cliente").then(function(){S("Stato cliente aggiornato")}).catch(function(){S("Impossibile aggiornare lo stato")}).finally(function(){C(),I()})},document.getElementById("bp_nncf_notyet").onclick=function(){v(y,"prospect").catch(function(){}).finally(function(){C(),I()})},document.getElementById("bp_nncf_close").onclick=function(){C(),I()}}function B(){var P=localStorage.getItem(p)||"";return R("/api/appointments").then(function(y){var x=Date.now(),C=y&&y.appointments||[],I=C.filter(function(it){if(!it||!it.nncf)return!1;var dt=+new Date(it.end||it.start||0);return dt&&dt<x-60*1e3}).sort(function(it,dt){return+new Date(dt.end||dt.start||0)-+new Date(it.end||it.start||0)});if(I.length){var O=I[0],Q=String(O.id||O.end||"");Q&&P&&String(P)===Q||k(O)}}).catch(function(y){})}var T=window.BPFinal=window.BPFinal||{};T.injectBannerCSS=g,T.updateClientStatusByName=v,T.scanNNCF=B,window.scanNNCF||(window.scanNNCF=B)})(),(function(){window.showUndo=window.showUndo||function(m,p,g){try{var v=document.getElementById("bp_undo_bar");v||(v=document.createElement("div"),v.id="bp_undo_bar",v.style.position="fixed",v.style.left="16px",v.style.bottom="16px",v.style.zIndex="9999",v.style.background="rgba(20,22,28,0.95)",v.style.color="#fff",v.style.padding="10px 12px",v.style.borderRadius="10px",v.style.boxShadow="0 8px 24px rgba(0,0,0,.25)",v.style.display="flex",v.style.alignItems="center",v.style.gap="12px",document.body.appendChild(v)),v.innerHTML="<span>"+m+'</span><button id="bp_undo_btn" class="ghost" style="background:#fff;color:#111;border-radius:8px;padding:6px 10px">Annulla</button>';var k=document.getElementById("bp_undo_btn"),B=setTimeout(function(){try{v.remove()}catch(T){}},g||5e3);k.onclick=function(){clearTimeout(B);try{v.remove()}catch(T){}typeof p=="function"&&Promise.resolve(p()).then(function(){Lt("medium");try{document.dispatchEvent(new Event("undo:performed"))}catch(T){}}).catch(function(){Lt("heavy")})},Lt("light")}catch(T){logger.error(T)}},window.pushUndo=window.pushUndo||function(m){if(!(!m||typeof m.undo!="function")){var p=m.label||"Annulla ultima operazione";window.showUndo(p,m.undo,m.ttl||5e3)}},window.wireCoachUndoHaptics=function(){function m(){try{window.__periodsCache&&Object.keys(window.__periodsCache).forEach(function(g){delete window.__periodsCache[g]}),delete window.periods}catch(g){}}document.addEventListener("bp:saved",function(){window.coachSay&&st("high"),Lt("heavy"),m()}),document.addEventListener("bp:deleted",function(){window.coachSay&&st("medium"),Lt("medium"),m()}),document.addEventListener("appt:saved",function(){window.coachSay&&st("medium"),Lt("medium")}),document.addEventListener("ics:exported",function(){window.coachSay&&st("low"),Lt("light")}),document.addEventListener("report:composed",function(){window.coachSay&&st("medium"),Lt("medium")}),document.addEventListener("client:converted",function(){window.coachSay&&st("high"),Lt("heavy")}),document.addEventListener("gi:created",function(){window.coachSay&&st("high"),Lt("heavy")}),document.addEventListener("payments:defined",function(){window.coachSay&&st("medium"),Lt("medium")}),document.addEventListener("user:profile-updated",function(){window.coachSay&&st("low"),Lt("light")}),document.addEventListener("appt:created",function(){window.coachSay&&st("medium"),Lt("medium")}),document.addEventListener("undo:performed",function(){window.coachSay&&st("low"),Lt("light")}),document.addEventListener("kpi:goal-80",function(){window.coachSay&&st("medium"),Lt("medium")}),document.addEventListener("kpi:goal-reached",function(){window.coachSay&&st("high"),Lt("heavy")}),document.addEventListener("click",function(g){try{for(var v=g.target,k=0;k<3&&v;k++){if(v.matches&&(v.matches('[data-close], [aria-label*="Chiudi" i], [aria-label*="Close" i]')||(v.id||"").toLowerCase().includes("close")||(v.className||"").toLowerCase().includes("close")||/^\s*(chiudi|close)\s*$/i.test(v.textContent||""))){window.coachSay&&st("low"),Lt("light");break}v=v.parentElement}}catch(B){}},!0);var p=document.getElementById("app")||document.body;p&&!p.__undoWired&&(p.__undoWired=!0,p.addEventListener("click",function(g){var v=g.target.closest("[data-delete], .btn-delete");if(v){var k=v.getAttribute("href"),B=v.getAttribute("data-id");(k||B)&&(g.preventDefault(),showUndo("Eliminato  Annulla",async function(){try{if(k){var T=k+(k.indexOf("?")>=0?"&":"?")+"undo=1";await R(T)}else B&&await tt("/api/restore",{id:B});location.reload()}catch(P){logger.error(P)}}))}},!0))},window.wireHapticsUI=function(){var m=document.body;if(!m.__hapticsWired){m.__hapticsWired=!0,m.addEventListener("click",function(g){var v=g.target.closest('button, .button, .btn, .ghost, [role="button"], a.button, a.btn, [data-action]');if(v){var k="light";v.classList.contains("danger")||v.getAttribute("data-danger")==="1"?k="heavy":(v.classList.contains("primary")||v.getAttribute("data-primary")==="1")&&(k="medium"),Lt(k)}},!0),m.addEventListener("change",function(g){var v=g.target;v&&v.matches('select, input[type="checkbox"], input[type="radio"], input[type="range"]')&&Lt("light")},!0);var p=document.querySelector("[data-drawer-toggle], #menuToggle, .menu-toggle");p&&!p.__hW&&(p.__hW=!0,p.addEventListener("click",function(){Lt("light")},!0))}}})(),window.recomputeDashboardMini=typeof W=="function"?W:()=>{},window.recomputeCommsMini=typeof lt=="function"?lt:()=>{},window.recomputeTeamChart=typeof Y=="function"?Y:()=>{},window.ensureTeamUserSelect=typeof X=="function"?X:()=>{},window.attachICSButtons=typeof attachICSButtons=="function"?attachICSButtons:()=>{},window.addSaveAndExport=typeof addSaveAndExport=="function"?addSaveAndExport:()=>{},window.BPFinal=window.BPFinal||{},(function(m){function p(g,v){typeof v=="function"&&(m[g]=v,window[g]||(window[g]=v))}typeof W<"u"&&p("recomputeDashboardMini",W),typeof lt<"u"&&p("recomputeCommsMini",lt),typeof Y<"u"&&p("recomputeTeamChart",Y),typeof viewGI<"u"&&p("viewGI",viewGI),typeof X<"u"&&p("ensureTeamUserSelect",X),typeof attachICSButtons<"u"&&p("attachICSButtons",attachICSButtons),typeof addSaveAndExport<"u"&&p("addSaveAndExport",addSaveAndExport),typeof st<"u"&&p("coachSay",st),typeof ensureClientFilters<"u"&&p("ensureClientFilters",ensureClientFilters),typeof enrichClientCards<"u"&&p("enrichClientCards",enrichClientCards),typeof L<"u"&&p("showClientAppointments",L),typeof wireReportButtons<"u"&&p("wireReportButtons",wireReportButtons),typeof scanNNCF<"u"&&p("scanNNCF",scanNNCF),typeof ensureNNCFChip<"u"&&p("ensureNNCFChip",ensureNNCFChip),typeof ct<"u"&&p("markToday",ct),typeof $<"u"&&p("clampSlotCounters",$),typeof filterPastAppointments<"u"&&p("filterPastAppointments",filterPastAppointments),typeof openWeb<"u"&&p("openWeb",openWeb),typeof openApp<"u"&&p("openApp",openApp),typeof notifyConversion<"u"&&p("notifyConversion",notifyConversion),typeof icsFromAppt<"u"&&p("icsFromAppt",icsFromAppt),typeof downloadICS<"u"&&p("downloadICS",downloadICS),typeof R<"u"&&p("GET",R),typeof tt<"u"&&p("POST",tt)})(window.BPFinal);const q=new MutationObserver(()=>{typeof ensureNNCFChip=="function"&&ensureNNCFChip(),typeof addSaveAndExport=="function"&&addSaveAndExport(),typeof attachICSButtons=="function"&&attachICSButtons(),typeof wireReportButtons=="function"&&wireReportButtons(),typeof ensureClientFilters=="function"&&ensureClientFilters(),typeof enrichClientCards=="function"&&enrichClientCards(),typeof X=="function"&&X(),typeof Z=="function"&&Z(),typeof filterPastAppointments=="function"&&filterPastAppointments(document.body),typeof ct=="function"&&ct()});f(async()=>{typeof injectTodayCSS=="function"&&injectTodayCSS(),typeof ct=="function"&&ct(),typeof $=="function"&&$(),typeof nt=="function"&&nt(),typeof W=="function"&&await W(),typeof lt=="function"&&await lt(),typeof Y=="function"&&await Y(),typeof wireHapticsUI=="function"&&wireHapticsUI(),typeof wireCoachUndoHaptics=="function"&&wireCoachUndoHaptics();try{const m="bpCoachGreetedDate",p=new Date().toISOString().slice(0,10);(localStorage.getItem(m)||"")!==p&&typeof window.coachSay=="function"&&(localStorage.setItem(m,p),st("low"))}catch(m){}q.observe(document.body,{childList:!0,subtree:!0}),window.onUnifiedRangeChange&&window.onUnifiedRangeChange(m=>{const p=m==="d"?"dash":m==="cm"?"comm":m==="tg"?"t":m;p==="dash"&&typeof W=="function"&&(W(),typeof renderDashboard=="function"&&renderDashboard()),p==="comm"&&typeof lt=="function"&&lt(),(p==="t"||p==="team")&&typeof Y=="function"&&Y()})})})();(function(){if(!window.GET)return;const n=window.GET;window.GET=function(t){try{if(typeof t=="string"&&t.indexOf("/api/leaderboard")===0){if(!(t.indexOf("/api/leaderboard_overall")===0)&&t.indexOf("indicator=")===-1)return Promise.resolve({ranking:[]});if(window.readUnifiedRange){var e=window.readUnifiedRange("lb")||{},i=e.type==="ytd"||e.type==="ltm"?"mensile":e.type;i&&(t+=(t.includes("?")?"&":"?")+"type="+encodeURIComponent(i))}var o=document.getElementById("lb_mode"),s=o?o.value:"consuntivo";t+=(t.includes("?")?"&":"?")+"mode="+encodeURIComponent(s)}}catch(a){}return n.apply(this,arguments)}})();(function(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return;function n(){try{const s=JSON.parse(localStorage.getItem("bp_user")||"null")||{};if(s.token)return s.token}catch(s){}return localStorage.getItem("bp_token")||localStorage.getItem("authToken")||localStorage.getItem("token")||""}function t(s){const a="=".repeat((4-s.length%4)%4),r=(s+a).replace(/-/g,"+").replace(/_/g,"/"),l=atob(r),c=new Uint8Array(l.length);for(let d=0;d<l.length;d++)c[d]=l.charCodeAt(d);return c}async function e(s){const a=n();if(a)try{await fetch("/api/push/subscribe",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a},body:JSON.stringify(s)})}catch(r){logger.warn("[BP] push subscribe error",r)}}async function i(){try{const s=await navigator.serviceWorker.ready;let a=await s.pushManager.getSubscription();if(!a){const l=await(await fetch("/api/push/publicKey")).json(),c=l.publicKey||l.key||"";if(!c)return;a=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t(c)})}await e(a.toJSON())}catch(s){logger.warn("[BP] push subscribe fail",s)}}async function o(){if(Notification.permission==="granted")return i();if(Notification.permission==="default")try{if(await Notification.requestPermission()==="granted")return i()}catch(s){}}window.BPPush={init:o,subscribe:i},window.addEventListener("load",o)})();function ze(n,t){localStorage.setItem(n,typeof t=="string"?t:JSON.stringify(t))}function yi(n,t){const e=localStorage.getItem(n);if(e==null)return t;try{return JSON.parse(e)}catch(i){return e}}function Fn(n){localStorage.removeItem(n)}function If(n,t){t?ze("bp_token",n):sessionStorage.setItem("bp_token",n)}function wi(){return localStorage.getItem("bp_token")||sessionStorage.getItem("bp_token")||""}function Mf(n){ze("bp_user",n)}function Ut(){return yi("bp_user",null)||null}function Ef(){Fn("bp_token"),sessionStorage.removeItem("bp_token"),Fn("bp_user"),location.href="/?v=13"}function Ho(n,t={}){t.method=t.method||"GET";const e={...t.headers||{}},i=wi();return i&&(e.Authorization="Bearer "+i),t.body!=null&&typeof t.body!="string"&&(e["Content-Type"]="application/json; charset=utf-8",t.body=JSON.stringify(t.body)),t.headers=e,fetch(n,t).then(Tf)}async function Tf(n){const t=await n.text();if(!n.ok)throw Pf(t,n);return Af(t,n)}function Pf(n,t){try{const e=JSON.parse(n).error||"";return new Error(e||t.statusText||"HTTP "+t.status)}catch(e){return new Error(t.statusText||"HTTP "+t.status)}}function Af(n,t){try{if((t.headers.get("content-type")||"").toLowerCase().indexOf("application/json")!==-1)return n?JSON.parse(n):{}}catch(e){}return n}function It(n,t){return Ho(n,Object.assign({method:"GET"},{}))}function fe(n,t){return Ho(n,{method:"POST",body:t||{}})}function Bf(n){return Ho(n,{method:"DELETE"})}function ye(n){return(n<10?"0":"")+n}function ri(n){const t=new Date(n);return ye(t.getDate())+"/"+ye(t.getMonth()+1)+"/"+t.getFullYear()}function oe(n){const t=new Date(n);return t.getFullYear()+"-"+ye(t.getMonth()+1)+"-"+ye(t.getDate())}function ua(n){const t=new Date(n);return ye(t.getHours())+":"+ye(t.getMinutes())}function Lf(n){const t=new Date(n);t.setHours(0,0,0,0);const e=(t.getDay()+6)%7;return t.setDate(t.getDate()-e),t}function io(n){const t=new Date(n);return new Date(t.getFullYear(),t.getMonth(),1)}function oo(n){const t=new Date(n);return new Date(t.getFullYear(),t.getMonth()+1,0,23,59,59,999)}function te(n){const t=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),e=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-e);const i=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-i)/864e5+1)/7)}function Ti(n){const t=new Date(n),e=Math.floor(t.getMonth()/3);return new Date(t.getFullYear(),e*3,1)}function so(n){const t=Ti(n);return new Date(t.getFullYear(),t.getMonth()+3,0,23,59,59,999)}function Pi(n){const t=new Date(n),e=t.getMonth()<6?0:6;return new Date(t.getFullYear(),e,1)}function ao(n){const t=Pi(n);return new Date(t.getFullYear(),t.getMonth()+6,0,23,59,59,999)}function Do(n){const t=new Date(n);return new Date(t.getFullYear(),0,1)}function _i(n){const t=new Date(n);return new Date(t.getFullYear(),11,31,23,59,59,999)}function Of(n,t){const e=new Date(n,0,1+(t-1)*7),i=e.getDay()||7,o=new Date(e);return o.setDate(e.getDate()-(i-1)),o.setHours(0,0,0,0),o}function en(n,t){const e=Of(n,t),i=new Date(e);return i.setDate(e.getDate()+6),i.setHours(23,59,59,999),{start:e,end:i}}function Ff(n){const t=Lf(n);t.setDate(t.getDate()+7);const e=new Date(t);return e.setDate(t.getDate()+6),e.setHours(23,59,59,999),{start:t,end:e}}function Nf(n){const t=new Date(n.getFullYear(),n.getMonth()+1,1);return{start:t,end:new Date(t.getFullYear(),t.getMonth()+1,0,23,59,59,999)}}function Rf(n){const t=Ti(new Date(n.getFullYear(),n.getMonth()+3,1));return{start:t,end:new Date(t.getFullYear(),t.getMonth()+3,0,23,59,59,999)}}function Vf(n){const t=Pi(new Date(n.getFullYear(),n.getMonth()+6,1));return{start:t,end:new Date(t.getFullYear(),t.getMonth()+6,0,23,59,59,999)}}function zf(n){const t=Do(new Date(n.getFullYear()+1,0,1));return{start:t,end:_i(t)}}function li(n,t){const e=new Date(t);return n==="settimanale"?"Sett. "+te(new Date(t))+" "+e.getFullYear():n==="mensile"?e.toLocaleString("it-IT",{month:"long",year:"numeric"}):n==="trimestrale"?"Trimestre "+(Math.floor(e.getMonth()/3)+1)+" "+e.getFullYear():n==="semestrale"?(e.getMonth()<6?"1":"2")+" semestre "+e.getFullYear():n==="annuale"?"Anno "+e.getFullYear():n==="ytd"?"YTD "+e.getFullYear():n==="ltm"?"Ultimi 12 mesi":n}let De;function Uf(){return De||(De=document.getElementById("toast-container"),De||(De=document.createElement("div"),De.id="toast-container",De.setAttribute("role","status"),De.setAttribute("aria-live","polite"),document.body.appendChild(De))),De}function wt(n){const t=Uf(),e=document.createElement("div");e.className="toast",e.setAttribute("role","alert"),e.textContent=n,t.appendChild(e),setTimeout(function(){try{e.remove(),t.children.length||(t.remove(),De=null)}catch(i){}},2200)}function ci(){if(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return;const n=document.createElement("div");n.className="confetti",document.body.appendChild(n);for(let t=0;t<26;t++){const e=document.createElement("span");e.style.position="absolute",e.style.left=2+t*4+"%",e.style.top="0",e.style.width="6px",e.style.height="10px",e.style.background="hsl("+t*14+",90%,60%)",e.style.opacity="0.95",n.appendChild(e),(function(i,o){setTimeout(function(){i.animate&&i.animate([{transform:"translateY(-20px) rotate(0deg)"},{transform:"translateY(110vh) rotate(540deg)"}],{duration:1200+Math.random()*800,easing:"cubic-bezier(.2,.6,.2,1)"})},o)})(e,t*35)}setTimeout(function(){try{n.remove()}catch(t){}},2500)}function Ft(n){return String(n).replace(/[&<>'"]/g,function(t){return{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"}[t]})}function Te(n){return(Number(n)||0).toLocaleString("it-IT")+""}function ie(n){const t=Number(n)||0;return String(Math.round(t))}function Hf(){if(document.getElementById("bp-mobile-drawer-fix"))return;const n="\n  @media (max-width:980px){\n    .topbar{\n      background: rgba(20,24,34,.90) !important;\n      border-bottom: 1px solid rgba(255,255,255,.08) !important;\n    }\n    .drawer{\n      background: rgba(20,24,34,.96) !important;\n      box-shadow: 14px 0 28px rgba(0,0,0,.45) !important;\n      width: 86vw !important;\n      overflow-y: auto !important;\n    }\n    .drawer .row{ gap:10px !important; }\n    .drawer button{\n      background: rgba(255,255,255,.10) !important;\n      border: 1px solid rgba(255,255,255,.22) !important;\n      color: #fff !important;\n      padding: 12px 14px !important;\n      font-weight: 700 !important;\n      border-radius: 12px !important;\n      -webkit-tap-highlight-color: transparent;\n    }\n    .drawer button:hover{\n      background: rgba(255,255,255,.14) !important;\n      border-color: rgba(255,255,255,.30) !important;\n    }\n    .drawer button.ghost{\n      background: rgba(255,255,255,.10) !important;\n      box-shadow: none !important;\n    }\n  }",t=document.createElement("style");t.id="bp-mobile-drawer-fix",t.textContent=n,document.head.appendChild(t)}function jf(){if(document.getElementById("bp-mobile-light-fix"))return;const n="\n    @media (max-width:980px) and (prefers-color-scheme: light){\n      .topbar{\n        background:#fff !important;\n        border-bottom:1px solid rgba(0,0,0,.08) !important;\n        box-shadow:none !important;\n      }\n      .topbar .brand .logo{\n        color:#0f172a !important;\n        font-weight:900 !important;\n        letter-spacing:.4px;\n        text-shadow:none !important;\n        opacity:1 !important;\n      }\n      .topbar .hamb span{ background:#0f172a !important; }\n      .card{\n        background:#fff !important;\n        background-image:none !important;\n        box-shadow:none !important;\n      }\n      .drawer{\n        background:#fff !important;\n        box-shadow:14px 0 28px rgba(0,0,0,.10) !important;\n      }\n      .drawer button{\n        color:#0f172a !important;\n        background:rgba(0,0,0,.04) !important;\n        border:1px solid rgba(0,0,0,.12) !important;\n      }\n      .drawer button:hover{\n        background:rgba(0,0,0,.08) !important;\n      }\n    }\n  ",t=document.createElement("style");t.id="bp-mobile-light-fix",t.textContent=n,document.head.appendChild(t)}function Wf(){if(document.getElementById("bp-badge-light-css"))return;const n="\n    @media (prefers-color-scheme: light){\n      .badge{\n        background: linear-gradient(180deg, #eef2ff, #f8fafc) !important;\n        border: 1px solid #c7d2fe !important;\n        color: #0f172a !important;\n        font-weight: 700 !important;\n        padding: 6px 10px !important;\n        border-radius: 9999px !important;\n        letter-spacing: .2px !important;\n        box-shadow: 0 1px 0 rgba(15,23,42,.05) inset !important;\n      }\n      .chip, .tag{\n        background: #ffffff !important;\n        border: 1px solid #cbd5e1 !important;\n        color: #0f172a !important;\n        font-weight: 600 !important;\n        border-radius: 9999px !important;\n      }\n      .card .badge{\n        background: #fff !important;\n      }\n    }\n  ",t=document.createElement("style");t.id="bp-badge-light-css",t.textContent=n,document.head.appendChild(t)}function pe(){const n=Ut();if(!n)return"";const t=n.role==="admin",e='<span class="badge">Lvl '+(window.level?window.level():"")+"  XP "+(window.getXP?window.getXP():"")+"</span>",i='<div id="drawer" class="drawer" role="dialog" aria-modal="true" aria-label="Menu"><div class="row"><button class="ghost" onclick="viewHome();toggleDrawer(false)">Dashboard</button><button class="ghost" onclick="viewCalendar();toggleDrawer(false)">Calendario</button><button class="ghost" onclick="viewPeriods();toggleDrawer(false)">BP</button><button class="ghost" onclick="viewAppointments();toggleDrawer(false)">Appuntamenti</button><button class="ghost" onclick="viewLeaderboard();toggleDrawer(false)">Classifiche</button><button class="ghost" onclick="viewCommissions();toggleDrawer(false)">Provvigioni</button><button class="ghost" onclick="viewVendite();toggleDrawer(false)">Vendite e Riordini</button><button class="ghost" onclick="viewGI();toggleDrawer(false)">GI &amp; Scadenzario</button><button class="ghost" onclick="viewReport();toggleDrawer(false)">Report</button><button class="ghost" onclick="viewClients();toggleDrawer(false)">Clienti</button><button class="ghost" onclick="viewTeam();toggleDrawer(false)">Squadra</button>'+(t?'<button class="ghost" onclick="viewUsers();toggleDrawer(false)">Utenti</button>':"")+'<button onclick="logout()">Logout</button></div></div>';return'<div class="topbar"><div class="brand"><button class="hamb" id="hamb" aria-label="Apri menu" aria-controls="drawer" aria-expanded="false"><span></span><span></span><span></span></button><div class="logo">BATTLE PLAN</div></div><div class="nav right">'+e+'<button class="ghost" onclick="viewHome()">Dashboard</button><button class="ghost" onclick="viewCalendar()">Calendario</button><button class="ghost" onclick="viewPeriods()">BP</button><button class="ghost" onclick="viewAppointments()">Appuntamenti</button><button class="ghost" onclick="viewLeaderboard()">Classifiche</button><button class="ghost" onclick="viewCommissions()">Provvigioni</button><button class="ghost" onclick="viewVendite()">Vendite e Riordini</button><button class="ghost" onclick="viewGI()">GI &amp; Scadenzario</button><button class="ghost" onclick="viewReport()">Report</button><button class="ghost" onclick="viewClients()">Clienti</button><button class="ghost" onclick="viewTeam()">Squadra</button>'+(t?'<button class="ghost" onclick="viewUsers()">Utenti</button>':"")+'<button onclick="logout()">Logout</button></div></div>'+i}function se(){if(!Ut())return;if(!document.getElementById("bp_nav_contrast_css")){const s="\n      @media (min-width: 1024px){\n        .topbar .nav .ghost{\n          background: rgba(255,255,255,.06);\n          border: 1px solid rgba(255,255,255,.18);\n        }\n        .topbar .nav .ghost:hover{\n          background: rgba(255,255,255,.12);\n        }\n      }\n    ",a=document.createElement("style");a.id="bp_nav_contrast_css",a.textContent=s,document.head.appendChild(a)}const n=document.getElementById("app"),t=document.querySelector(".topbar"),e=pe();t?t.outerHTML=e:n&&n.insertAdjacentHTML("afterbegin",e);try{Hf()}catch(s){}try{jf()}catch(s){}try{Wf()}catch(s){}if(!document.getElementById("bp-unified-filters-css")){const s="\n      /* Nested inputs align in two columns inside unified filters */\n      .uf .row .row{ display:grid; grid-template-columns: 1fr 1fr; gap:8px; }\n\n      @media (max-width: 980px){\n        .uf input, .uf select{ min-width: 0; width: 100%; }\n        .uf .row > div{ flex: 1 1 180px; min-width: 0; }\n\n        /* Squadra admin bar: grid on small screens */\n        #t_adminbar{ display:grid !important; grid-template-columns: 1fr 1fr; align-items:end; gap:10px; }\n        #t_adminbar > div{ min-width: 0; }\n        #t_adminbar .row{ display:grid; grid-template-columns: 1fr 1fr; gap:8px; }\n      }\n\n      @media (max-width: 560px){\n        #t_adminbar{ grid-template-columns: 1fr; }\n      }\n    ",a=document.createElement("style");a.id="bp-unified-filters-css",a.textContent=s,document.head.appendChild(a)}const i=document.getElementById("hamb");i&&(i.onclick=function(){Ai()});const o=document.getElementById("drawer");o&&o.addEventListener("click",function(s){s.target.id==="drawer"&&Ai(!1)}),document.removeEventListener("keydown",fa,!1),document.addEventListener("keydown",fa,!1)}function fa(n){if(n&&n.key==="Escape"){const t=document.getElementById("drawer");t&&t.classList.contains("open")&&Ai(!1)}}function Ai(n){const t=document.getElementById("drawer");if(!t)return;const e=typeof n=="boolean"?n:!t.classList.contains("open");t.classList.toggle("open",e);const i=document.getElementById("hamb");i&&i.setAttribute("aria-expanded",String(e)),document.body.classList.toggle("no-scroll",e)}let ha=null;function Yf(){clearTimeout(ha),ha=setTimeout(se,60)}function we(n){return document.querySelector(n)}function ro(n){return Array.from(document.querySelectorAll(n))}(function(){const n=window.BP=window.BP||{},t=n.ICS=n.ICS||{};function e(l){if(!l)return"";if(/[Zz]|[+\-]\d{2}:\d{2}$/.test(String(l)))return new Date(l).toISOString().replace(/[-:]/g,"").replace(/\.\d{3}Z$/,"Z").slice(0,15)+"Z";const[c,d="00:00"]=String(l).split("T"),[u,f,h]=c.split("-").map(Number),[w,_]=d.split(":").map(Number);return new Date(u,f-1,h,w,_,0,0).toISOString().replace(/[-:]/g,"").replace(/\.\d{3}Z$/,"Z").slice(0,15)+"Z"}function i(l){return(l||"").replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n")}function o(l){if(l.length<=74)return[l];const d=[];let u=0;for(;u<l.length;){const f=l.slice(u,u+74);d.push(u===0?f:" "+f),u+=74}return d}function s(l){const c=(l&&l.id||"bp-"+Date.now())+"@bpapp",d=l&&l.client?"Appuntamento  "+l.client:"Appuntamento",u=e(l&&l.start),f=e(l&&l.end),h=e(new Date().toISOString().slice(0,16)),w=[];l&&l.type&&w.push("Tipo: "+l.type),l&&l.vss&&w.push("VSS: "+l.vss),l&&l.vsdPersonal&&w.push("VSD Personale: "+l.vsdPersonal),l&&l.notes&&w.push("Note: "+l.notes);const _=i(w.join("\n")),S=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//BPApp//Calendario//IT","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT","UID:"+c,"DTSTAMP:"+h,u?"DTSTART:"+u:"",f?"DTEND:"+f:"","SUMMARY:"+i(d),_?"DESCRIPTION:"+_:"","END:VEVENT","END:VCALENDAR"].filter(Boolean),F=[];return S.forEach(R=>F.push.apply(F,o(R))),F.join("\r\n")}function a(){try{const l=navigator.userAgent||navigator.vendor||"",c=/iP(ad|hone|od)/.test(l),d=/^((?!chrome|android|crios|fxios|edgi).)*safari/i.test(l);return c||d}catch(l){return!1}}function r(l){try{const c=s(l),d=l&&l.start?String(l.start).split("T")[0]:"evento",u=(l&&l.client||"appuntamento").trim().replace(/[^\w\-]+/g,"_").slice(0,40),f="bp_".concat(u,"_").concat(d,".ics");if(a())try{const _="data:text/calendar;charset=utf-8,"+encodeURIComponent(c),S=document.createElement("a");return S.href=_,S.setAttribute("target","_blank"),S.setAttribute("download",f),document.body.appendChild(S),S.click(),S.remove(),!0}catch(_){try{return window.location.assign("data:text/calendar;charset=utf-8,"+encodeURIComponent(c)),!0}catch(S){try{logger.error(S)}catch(F){}return!1}}const h=new Blob([c],{type:"text/calendar;charset=utf-8"}),w=document.createElement("a");return w.href=URL.createObjectURL(h),w.download=f,document.body.appendChild(w),w.click(),setTimeout(()=>{try{URL.revokeObjectURL(w.href)}catch(_){}w.remove()},50),!0}catch(c){try{logger.error(c)}catch(d){}return!1}}t.makeIcsForAppointment=s,t.downloadIcsForAppointment=r,window.icsFromAppt=window.icsFromAppt||function(l){return s(l)},window.downloadICS=window.downloadICS||function(l,c){try{var d=window.__icsSanitize?__icsSanitize(l):l||"evento";/\.ics$/i.test(d)||(d+=".ics");var u=new Blob([c],{type:"text/calendar;charset=utf-8"}),f=document.createElement("a");f.href=URL.createObjectURL(u),f.download=d,document.body.appendChild(f),f.click(),setTimeout(function(){URL.revokeObjectURL(f.href),f.remove()},50)}catch(h){logger.error(h)}}})();window.Chart=Le;(function(){var n=document.getElementById("app");window.$1=window.$1||we,window.$all=window.$all||ro,window.addXP=window.addXP||function(){},typeof window.logger!="object"&&(window.logger=["debug","info","log","warn","error"].reduce((b,D)=>(b[D]=(console[D]||console.log).bind(console),b),{})),typeof window.haptic!="function"&&(window.haptic=window.BP&&BP.Haptics&&BP.Haptics.impact?BP.Haptics.impact:function(){}),(function(){const b=window.__miniCharts=window.__miniCharts||{};function D(z,W,lt){const Y=z.getContext("2d"),nt=window.devicePixelRatio||1,ct=z.clientWidth||320,$=z.clientHeight||80;z.width=Math.round(ct*nt),z.height=Math.round($*nt),Y.save(),Y.scale(nt,nt),Y.clearRect(0,0,ct,$);const V=Math.max(1,...lt),L=lt.length>1?(ct-8)/(lt.length-1):0;Y.strokeStyle="#2e6cff",Y.lineWidth=2,Y.beginPath();for(let X=0;X<lt.length;X++){const Z=4+X*L,K=$-6-lt[X]/V*($-12);X===0?Y.moveTo(Z,K):Y.lineTo(Z,K)}Y.stroke(),Y.fillStyle="#2e6cff";for(let X=0;X<lt.length;X++){const Z=4+X*L,K=$-6-lt[X]/V*($-12);Y.beginPath(),Y.arc(Z,K,2,0,Math.PI*2),Y.fill()}Y.restore()}function N(z,W){try{let Y=function(V,L){try{if(this&&typeof this.getLabelForValue=="function")return String(this.getLabelForValue(V))}catch(K){}const X=typeof V=="number"?V:L,Z=Array.isArray(z)?z[X]:V;return String(Z!=null?Z:V)};const lt=Array.isArray(z)?z.length:0;if(!lt)return{autoSkip:!0,maxRotation:0,minRotation:0};const nt=Math.max(0,...z.map(V=>String(V||"").length)),ct=Math.max(28,Math.min(90,Math.round(nt*7)));return lt*ct>(W||320)*1.2?{autoSkip:!0,maxRotation:45,minRotation:45,callback:Y}:{autoSkip:!0,maxRotation:0,minRotation:0,callback:Y}}catch(lt){return{autoSkip:!0,maxRotation:0,minRotation:0}}}window.computeTickOptions=N,window.drawFullLine=function(z,W,lt){const Y=document.getElementById(z);if(!Y)return;if(Y.width=Y.clientWidth||Y.width||320,Y.height=Y.clientHeight||Y.height||80,!Le){D(Y,W,lt),b[String(z)]={canvas:Y,labels:W,data:lt,fallback:!0};return}const nt=String(z),ct=N(W,Y.width||320);if(b[nt]&&b[nt].canvas!==Y){try{b[nt].destroy()}catch($){}delete b[nt]}if(b[nt]){const $=b[nt];$.data.labels=W,$.data.datasets[0].data=lt,$.options.scales.x.ticks=N(W,Y.width||320),$.update()}else{const $=Y.getContext("2d");b[nt]=new Le($,{type:"line",data:{labels:W,datasets:[{label:"",data:lt,borderColor:"#2e6cff",backgroundColor:"rgba(46,108,255,0.10)",borderWidth:2,tension:.3,pointRadius:3,pointHoverRadius:5,fill:!1}]},options:{responsive:!1,maintainAspectRatio:!1,animation:!1,animations:!1,plugins:{legend:{display:!1}},devicePixelRatio:window.devicePixelRatio||1,scales:{x:{grid:{display:!1},ticks:ct},y:{beginAtZero:!0}}}})}};let A=window.devicePixelRatio||1;function U(){Object.keys(b).forEach(z=>{const W=b[z];if(W&&typeof W.resize=="function")try{W.resize()}catch(lt){}else if(W&&W.fallback)try{D(W.canvas,W.labels,W.data)}catch(lt){}})}function j(){const z=window.devicePixelRatio||1;z!==A&&(A=z,U())}window.addEventListener("pageshow",U),window.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&j()}),window.addEventListener("resize",j),window.addEventListener("orientationchange",()=>setTimeout(()=>{A=-1,j()},50))})();function t(){document.title="Battle Plan  Login";var b='<div class="hero" id="hero"><div class="layer glow"></div><div class="layer grid"></div><div class="title">Pianifica. Eroga. Vinci. <span class="small muted">BP  stile gaming</span></div></div><div class="wrap"><div class="grid"><div class="card"><h3>Accedi</h3><form id="loginForm" autocomplete="on"><div class="row"><div><label>Email</label><input id="li_email" name="email" type="email" autocomplete="username" required></div><div><label>Password</label><input id="li_password" name="password" type="password" autocomplete="current-password" required></div></div><div class="row"><label class="small"><input type="checkbox" id="li_remember" checked> Rimani collegato</label></div><div class="right" style="margin-top:8px"><button type="submit" id="btnLogin">Accedi</button></div></form></div><div class="card"><h3>Registrati</h3><form id="regForm" autocomplete="on"><div class="row"><div><label>Nome</label><input id="re_name" name="name" type="text" required></div><div><label>Email</label><input id="re_email" name="email" type="email" autocomplete="username" required></div><div><label>Password</label><input id="re_password" name="new-password" type="password" autocomplete="new-password" required></div></div><div class="right" style="margin-top:8px"><button type="submit" id="btnRegister">Registrati</button></div></form></div></div></div>';n.innerHTML=b;var D=document.getElementById("hero");D&&D.addEventListener("pointermove",function(U){var j=D.getBoundingClientRect();D.style.setProperty("--gx",(U.clientX-j.left)/j.width*100+"%"),D.style.setProperty("--gy",(U.clientY-j.top)/j.height*100+"%")});var N=document.getElementById("loginForm"),A=document.getElementById("regForm");N.addEventListener("submit",function(U){U.preventDefault();var j=document.getElementById("btnLogin");j.disabled=!0;var z=document.getElementById("li_email").value.trim().toLowerCase(),W=document.getElementById("li_password").value,lt=document.getElementById("li_remember").checked;fe("/api/login",{email:z,password:W}).then(function(Y){if(typeof Y=="string")try{Y=JSON.parse(Y)}catch(nt){}If(Y.token,lt),Mf(Y.user),wt("Bentornato "+Y.user.name+"!"),window.addXP(10),c(),se(),window.BPPush&&window.BPPush.subscribe()},function(Y){wt("Credenziali errate"),logger.error(Y)}).catch(function(Y){logger.error(Y)}).finally(function(){j.disabled=!1})}),A.addEventListener("submit",function(U){U.preventDefault();var j=document.getElementById("btnRegister");j.disabled=!0;var z=document.getElementById("re_name").value.trim(),W=document.getElementById("re_email").value.trim().toLowerCase(),lt=document.getElementById("re_password").value;fe("/api/register",{name:z,email:W,password:lt}).then(function(){wt("Registrazione ok. Ora accedi"),ci(),window.addXP(20),window.scrollTo({top:0,behavior:"smooth"})}).catch(function(Y){wt("Email gi registrata?"),logger.error(Y)}).finally(function(){j.disabled=!1})})}function e(b){const D=new Date,N=D.getFullYear(),A=D.getMonth()+1,U=te(D),j=Math.floor((A-1)/3)+1,z=2e3,W=2100,lt=(function(){let $="";for(let V=z;V<=W;V++)$+='<option value="'.concat(V,'" ').concat(V===N?"selected":"",">").concat(V,"</option>");return $})(),Y=(function(){let $="";for(let V=1;V<=12;V++)$+='<option value="'.concat(V,'" ').concat(V===A?"selected":"",">").concat(V,"</option>");return $})(),nt=(function(){let $="";for(let V=1;V<=53;V++)$+='<option value="'.concat(V,'" ').concat(V===U?"selected":"",">").concat(V,"</option>");return $})(),ct=(function(){let $="";for(let V=1;V<=4;V++)$+='<option value="'.concat(V,'" ').concat(V===j?"selected":"",">Q").concat(V,"</option>");return $})();return'<div class="uf"><div class="row"><div><label>Granularit</label><select id="'+b+'_gran"><option value="settimanale">Settimanale</option><option value="mensile" selected>Mensile</option><option value="trimestrale">Trimestrale</option><option value="semestrale">Semestrale</option><option value="annuale">Annuale</option><option value="ytd">Anno corrente (YTD)</option><option value="ltm">Ultimi 12 mesi (LTM)</option></select></div><div id="'+b+'_wrap_week" style="display:none"><label>Settimana ISO</label><div class="row"><select id="'+b+'_week">'+nt+'</select><select id="'+b+'_year_w">'+lt+'</select></div></div><div id="'+b+'_wrap_month"><label>Mese</label><div class="row"><select id="'+b+'_month">'+Y+'</select><select id="'+b+'_year_m">'+lt+'</select></div></div><div id="'+b+'_wrap_quarter" style="display:none"><label>Trimestre</label><div class="row"><select id="'+b+'_quarter">'+ct+'</select><select id="'+b+'_year_q">'+lt+'</select></div></div><div id="'+b+'_wrap_sem" style="display:none"><label>Semestre</label><div class="row"><select id="'+b+'_sem"><option value="1">1</option><option value="2">2</option></select><select id="'+b+'_year_s">'+lt+'</select></div></div><div id="'+b+'_wrap_year" style="display:none"><label>Anno</label><select id="'+b+'_year">'+lt+'</select></div><div class="actions"><button id="'+b+'_refresh" class="ghost">Aggiorna</button></div></div></div>'}(function(){const b=[];window.onUnifiedRangeChange=function(D){typeof D=="function"&&b.push(D)},window.emitUnifiedRangeChange=function(D){for(const N of b)try{N(D)}catch(A){logger.error(A)}}})();function i(b){return b==="d"||b==="dash"?"dash":b==="cm"||b==="comm"?"comm":b==="tg"||b==="t"||b==="team"?"t":b}function o(b,D){function N(){const U=document.getElementById(b+"_gran").value;["week","month","quarter","sem","year"].forEach(z=>{const W=document.getElementById(b+"_wrap_"+z);W&&(W.style.display="none")}),U==="settimanale"?document.getElementById(b+"_wrap_week").style.display="":U==="mensile"?document.getElementById(b+"_wrap_month").style.display="":U==="trimestrale"?document.getElementById(b+"_wrap_quarter").style.display="":U==="semestrale"?document.getElementById(b+"_wrap_sem").style.display="":U==="annuale"&&(document.getElementById(b+"_wrap_year").style.display="")}["gran","week","year_w","month","year_m","quarter","year_q","sem","year_s","year"].forEach(U=>{const j=document.getElementById(b+"_"+U);j&&(j.onchange=()=>{N(),D&&D(),window.emitUnifiedRangeChange(i(b))},j.oninput=()=>{N()})});const A=document.getElementById(b+"_refresh");A&&(A.onclick=()=>{D&&D(),window.emitUnifiedRangeChange(i(b))}),N()}function s(b){var D=new Date;function N(M,E){var G=document.getElementById(b+"_"+M),st=G?parseInt(G.value,10):NaN;return isFinite(st)?st:E}var A=document.getElementById(b+"_gran"),U=A?A.value:"mensile",j={type:U,start:null,end:null};if(U==="settimanale"){var z=N("year_w",D.getFullYear()),W=Math.max(1,Math.min(53,N("week",te(D)))),lt=en(z,W);return j.start=lt.start,j.end=lt.end,j}if(U==="mensile"){var Y=N("year_m",D.getFullYear()),nt=Math.max(1,Math.min(12,N("month",D.getMonth()+1)));return j.start=new Date(Y,nt-1,1),j.end=new Date(Y,nt,0,23,59,59,999),j}if(U==="trimestrale"){var ct=N("year_q",D.getFullYear()),$=Math.max(1,Math.min(4,N("quarter",Math.floor(D.getMonth()/3)+1)));return j.start=new Date(ct,($-1)*3,1),j.end=new Date(ct,$*3,0,23,59,59,999),j}if(U==="semestrale"){var V=N("year_s",D.getFullYear()),L=N("sem",D.getMonth()<6?1:2);return j.start=new Date(V,L===1?0:6,1),j.end=new Date(V,L===1?6:12,0,23,59,59,999),j}if(U==="annuale"){var X=N("year",D.getFullYear());return j.start=new Date(X,0,1),j.end=new Date(X,11,31,23,59,59,999),j}if(U==="ytd"){var Z=new Date(D.getFullYear(),D.getMonth()+1,0,23,59,59,999);return j.start=new Date(D.getFullYear(),0,1),j.end=Z,j}if(U==="ltm"){var K=new Date(D.getFullYear(),D.getMonth()+1,0,23,59,59,999),H=new Date(K.getFullYear(),K.getMonth()-11,1);return j.start=H,j.end=K,j}return j.type="mensile",j.start=new Date(D.getFullYear(),D.getMonth(),1),j.end=new Date(D.getFullYear(),D.getMonth()+1,0,23,59,59,999),j}function a(b){return b==="ytd"||b==="ltm"?"mensile":b}window.effectivePeriodType=a;function r(b,D){var N=String(b||"mensile").toLowerCase(),A=a(N||"mensile"),U=D?new Date(D):new Date,j=U.getUTCFullYear(),z=[];function W(it,dt){z.push({s:it.getTime(),e:dt.getTime()})}function lt(it,dt,ft){return new Date(Date.UTC(it,dt,ft))}function Y(it){return new Date(it.getTime()+24*3600*1e3-1)}function nt(it,dt){return new Date(Date.UTC(it,dt+1,0))}if(N==="ytd"){for(var ct=0;ct<=U.getUTCMonth();ct++){var $=lt(U.getUTCFullYear(),ct,1),V=Y(nt($.getUTCFullYear(),$.getUTCMonth()));z.push({s:$.getTime(),e:V.getTime()})}return z}if(N==="ltm"){for(var L=lt(U.getUTCFullYear(),U.getUTCMonth(),1),X=11;X>=0;X--){var Z=lt(L.getUTCFullYear(),L.getUTCMonth()-X,1),K=Y(nt(Z.getUTCFullYear(),Z.getUTCMonth()));z.push({s:Z.getTime(),e:K.getTime()})}return z}if(A==="settimanale"){var H=new Date(Date.UTC(U.getUTCFullYear(),U.getUTCMonth(),U.getUTCDate())),M=(H.getUTCDay()+6)%7;H.setUTCDate(H.getUTCDate()-M);for(var E=52;E>=0;E--){var G=new Date(H);G.setUTCDate(H.getUTCDate()-E*7);var st=new Date(G);st.setUTCDate(G.getUTCDate()+6),st.setUTCHours(23,59,59,999),W(G,st)}return z}if(A==="mensile"){for(var L=new Date(Date.UTC(U.getUTCFullYear(),U.getUTCMonth(),1)),X=23;X>=0;X--){var ct=new Date(Date.UTC(L.getUTCFullYear(),L.getUTCMonth()-X,1));W(ct,Y(nt(ct.getUTCFullYear(),ct.getUTCMonth())))}return z}if(A==="trimestrale"){for(var q=Math.floor(U.getUTCMonth()/3),m=11;m>=0;m--){var p=q-m,g=j+Math.floor(p/4),v=(p%4+4)%4,G=lt(g,v*3,1),st=Y(new Date(Date.UTC(g,v*3+3,0)));W(G,st)}return z}if(A==="semestrale"){for(var k=U.getUTCMonth()<6?0:1,B=5;B>=0;B--){var T=k-B,P=j+Math.floor(T/2),y=(T%2+2)%2,x=y===0?0:6,C=lt(P,x,1),I=Y(new Date(Date.UTC(P,x+6,0)));W(C,I)}return z}for(var O=2;O>=0;O--){var Q=j-O;W(lt(Q,0,1),Y(new Date(Date.UTC(Q,12,0))))}return z}function l(b,D){var N=a(b||"mensile");return(D||[]).map(function(A){var U=new Date(A.s);return N==="settimanale"?"W"+te(U)+" "+U.getUTCFullYear():N==="mensile"?String(U.getUTCMonth()+1).padStart(2,"0")+"/"+U.getUTCFullYear():N==="trimestrale"?"Q"+(Math.floor(U.getUTCMonth()/3)+1)+" "+U.getUTCFullYear():N==="semestrale"?(U.getUTCMonth()<6?"S1 ":"S2 ")+U.getUTCFullYear():String(U.getUTCFullYear())})}function c(){if(!Ut())return t();document.title="Battle Plan  Dashboard",n.innerHTML=pe()+'<div class="wrap"><div class="card"><b>Filtro</b><div class="row uf-row" style="margin-top:6px;align-items:flex-end;gap:16px;flex-wrap:wrap"><div><label>Modalit</label><select id="dash_mode" name="mode"><option value="consuntivo">Consuntivo</option><option value="previsionale">Previsionale</option></select></div><div><label>Consulente</label><select id="dash_cons"><option value="">Tutti</option></select></div></div>'+e("dash")+'</div><div class="grid" id="kpiGrid"><div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><b>VSS</b><span id="kpi_vss" class="big"></span></div><canvas id="d_mini_vss" width="320" height="90"></canvas></div><div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><b>VSD personale</b><span id="kpi_vsd" class="big"></span></div><canvas id="d_mini_vsdpersonale" width="320" height="90"></canvas></div><div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><b>VSD indiretto</b><span id="kpi_vsd_ind" class="big"></span></div><canvas id="d_mini_vsdindiretto" width="320" height="90"></canvas></div><div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><b>GI</b><span id="kpi_gi" class="big"></span></div><canvas id="d_mini_gi" width="320" height="90"></canvas></div><div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><b>NNCF</b><span id="kpi_nncf" class="big"></span></div><canvas id="d_mini_nncf" width="320" height="90"></canvas></div><div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><b>Tot Provvigioni</b><span id="kpi_provv" class="big"></span></div><canvas id="d_mini_provv" width="320" height="90"></canvas></div></div><div class="card"><b>Ultimi appuntamenti</b><div id="lastApps" class="row" style="margin-top:8px"></div></div><div class="card"><b>Ultimi BP inviati</b><div id="lastBPs" class="row" style="margin-top:8px"></div></div></div>',se(),(function(){try{var X=document.querySelector(".uf-row");if(!X)return;var Z=document.getElementById("cal_prev");Z&&(Z.textContent="");var K=document.getElementById("cal_next");K&&(K.textContent="");var H=X.querySelector("#only_4h");H&&H.parentElement&&(H.parentElement.innerHTML='<input type="checkbox" id="only_4h"> Solo slot  4h');var M=document.getElementById("cal_add"),E=X.querySelector(".right"),G=E?E.querySelector("#cal_refresh"):null;if(M&&G){var st=document.createElement("div");st.className="actions",E.parentNode.insertBefore(st,E),st.appendChild(M),st.appendChild(G),E.remove()}}catch(q){logger&&logger.warn&&logger.warn("cal header fix fail",q)}})();function b(L,X){var Z=document.getElementById(L);Z&&(Z.textContent=X)}function D(L){var X=Number(L)||0;return X.toLocaleString("it-IT")+""}function N(L){var X=Number(L)||0;return String(Math.round(X))}function A(L){return String(L).replace(/[&<>'"]/g,X=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[X])}(function(){It("/api/usernames").then(function(X){var Z=X&&X.users||[],K=document.getElementById("dash_cons");K&&(K.innerHTML='<option value="">Tutti</option>'+Z.map(function(H){return'<option value="'+A(String(H.id))+'">'+A(H.name||H.email||"User #"+H.id)+"</option>"}).join(""))}).catch(function(){})})();function U(L,X){return X==="settimanale"?window.isoWeekNum?window.isoWeekNum(L):Math.ceil(L.getDate()/7):X==="mensile"||X==="ytd"||X==="ltm"?L.getMonth()+1:X==="trimestrale"?Math.floor(L.getMonth()/3)+1:X==="semestrale"?L.getMonth()<6?1:2:L.getFullYear()}function j(L){if(typeof r=="function")return(r(L,new Date)||[]).map(function(ft){return{s:ft.s,e:ft.e}});var X=new Date,Z=[];function K(ft,ht){Z.push({s:ft.getTime(),e:ht.getTime()})}function H(ft){var ht=new Date(ft);return ht.setHours(23,59,59,999),ht}function M(ft,ht){return new Date(ft,ht+1,0,23,59,59,999)}var E=String(L||"mensile").toLowerCase();if(E==="settimanale"){var G=new Date(X),st=(G.getDay()+6)%7;G.setDate(G.getDate()-st),G.setHours(0,0,0,0);for(var q=52;q>=0;q--){var m=new Date(G);m.setDate(m.getDate()-q*7);var p=new Date(m);p.setDate(m.getDate()+6),p.setHours(23,59,59,999),K(m,p)}return Z}if(E==="mensile"||E==="ytd"||E==="ltm"){if(E==="ytd")for(var g=0;g<=X.getMonth();g++){var v=new Date(X.getFullYear(),g,1);K(v,M(X.getFullYear(),g))}else for(var k=E==="ltm"?12:24,B=new Date(X.getFullYear(),X.getMonth(),1),T=k-1;T>=0;T--){var m=new Date(B.getFullYear(),B.getMonth()-T,1);K(m,M(m.getFullYear(),m.getMonth()))}return Z}if(E==="trimestrale"){for(var P=Math.floor(X.getMonth()/3)*3,y=new Date(X.getFullYear(),P,1),x=11;x>=0;x--){var C=new Date(y.getFullYear(),y.getMonth()-x*3,1);K(C,H(new Date(C.getFullYear(),C.getMonth()+3,0)))}return Z}if(E==="semestrale"){for(var I=X.getMonth()<6?0:6,O=new Date(X.getFullYear(),I,1),m=5;m>=0;m--){var Q=new Date(O.getFullYear(),O.getMonth()-m*6,1);K(Q,H(new Date(Q.getFullYear(),Q.getMonth()+6,0)))}return Z}for(var it=2;it>=0;it--){var dt=new Date(X.getFullYear()-it,0,1);K(dt,H(new Date(dt.getFullYear(),12,0)))}return Z}function z(L){switch(String(L)){case"provv_gi":return"ProvvGI";case"provv_vsd":return"ProvvVSD";case"tot_provv":return"TotProvvigioni";default:return L}}function W(L,X,Z,K){var H=K||s("dash"),M=String(H.type||"mensile").toLowerCase(),E=M==="ytd"||M==="ltm"?"mensile":M,G=j(M);function st(p,g){var v=new Date(g.startDate).getTime(),k=new Date(g.endDate).getTime();return v>=p.s&&k<=p.e}function q(p,g){if(!p)return 0;if(g==="VSDTotale")return Number(p.VSDPersonale||0)+Number(p.VSDIndiretto||0);if(g==="ProvvGI")return Number(p.ProvvGI||0);if(g==="ProvvVSD")return Number(p.ProvvVSD||0);if(g==="TotProvvigioni"){var v=p.TotProvvigioni;return Number(v!=null?v:Number(p.ProvvGI||0)+Number(p.ProvvVSD||0))}return Number(p[g]||0)}var m=(function(){var p=G.length?oe(new Date(G[0].s)):oe(new Date),g=G.length?oe(new Date(G[G.length-1].e)):oe(new Date),v="?global=1&type="+encodeURIComponent(E)+"&from="+encodeURIComponent(p)+"&to="+encodeURIComponent(g);return Z&&(v+="&userId="+encodeURIComponent(Z)),v})();return It("/api/periods"+m).catch(function(){return It("/api/periods"+m.replace("?global=1",""))}).then(function(p){var g=p&&p.periods||[],v=g.filter(function(T){return!(T.type!==E||Z&&String(T.userId||T.uid||"")!==String(Z))}),k=z(L),B=G.map(function(T){for(var P=0,y=0;y<v.length;y++){var x=v[y];if(st(T,x)){var C=X==="previsionale"?x.indicatorsPrev||{}:x.indicatorsCons||{};P+=q(C,k)}}return{x:new Date(T.s),y:Math.round(P*100)/100}});return B})}function lt(L,X,Z){var K=document.getElementById(L);if(K){if(typeof window.drawFullLine=="function"){window.drawFullLine(L,X,Z);return}var H=K.getContext("2d");K.width=K.clientWidth||320,K.height=K.clientHeight||80,H.clearRect(0,0,K.width,K.height);var M=Math.max(1,...Z),E=Z.length>1?(K.width-8)/(Z.length-1):0;H.strokeStyle="#2e6cff",H.lineWidth=2,H.beginPath();for(var G=0;G<Z.length;G++){var st=4+G*E,q=K.height-6-Z[G]/M*(K.height-12);G===0?H.moveTo(st,q):H.lineTo(st,q)}H.stroke()}}function Y(){var L=(document.getElementById("dash_mode")||{}).value||"consuntivo",X=s("dash"),Z=a(X.type||"mensile"),K=new Date(X.start).getTime(),H=new Date(X.end).getTime(),M=(document.getElementById("dash_cons")||{}).value||"";function E(m){return m=Number(m==null?"":m),isFinite(m)?m:0}function G(m){if(!m)return 0;for(var p=["VSDIndiretto","vsdIndiretto","VSD_indiretto","VSDI"],g=0;g<p.length;g++)if(m[p[g]]!=null)return E(m[p[g]]);return m.VSDTotale!=null&&m.VSDPersonale!=null?E(m.VSDTotale)-E(m.VSDPersonale):0}function st(m){return m?m.TotProvvigioni!=null?E(m.TotProvvigioni):E(m.ProvvGI)+E(m.ProvvVSD):0}var q=(function(){var m=oe(new Date(K)),p=oe(new Date(H)),g="?type="+encodeURIComponent(Z)+"&from="+encodeURIComponent(m)+"&to="+encodeURIComponent(p);return M&&(g+="&userId="+encodeURIComponent(M)),g})();return It("/api/periods"+q).then(function(m){for(var p=m&&m.periods||[],g={VSS:0,VSDPersonale:0,VSDIndiretto:0,GI:0,NNCF:0,PROVV:0},v=0;v<p.length;v++){var k=p[v];if(String(k.type)===String(Z)&&!(M&&String(k.userId||k.uid||"")!==String(M))){var B=new Date(k.startDate).getTime(),T=new Date(k.endDate).getTime();if(!(B<K||T>H)){var P=L==="previsionale"?k.indicatorsPrev||{}:k.indicatorsCons||{};g.VSS+=E(P.VSS),g.VSDPersonale+=E(P.VSDPersonale),g.VSDIndiretto+=G(P),g.GI+=E(P.GI),g.NNCF+=E(P.NNCF),g.PROVV+=st(P)}}}b("kpi_vss",D(g.VSS)),b("kpi_vsd",D(g.VSDPersonale)),b("kpi_vsd_ind",D(g.VSDIndiretto)),b("kpi_gi",D(g.GI)),b("kpi_nncf",N(g.NNCF)),b("kpi_provv",D(g.PROVV))})}function nt(){var L=(document.getElementById("dash_mode")||{}).value||"consuntivo",X=(document.getElementById("dash_cons")||{}).value||"",Z=s("dash"),K=String(Z.type||"mensile").toLowerCase(),H=j(K),M=typeof l=="function"?l(K,H):H.map(function(G){return U(new Date(G.s),K)});function E(G,st){var q=G.map(function(m){return m.y});lt(st,M,q)}Promise.all([W("VSS",L,X||null,Z),W("VSDPersonale",L,X||null,Z),W("VSDIndiretto",L,X||null,Z),W("GI",L,X||null,Z),W("NNCF",L,X||null,Z),W("TotProvvigioni",L,X||null,Z)]).then(function(G){E(G[0],"d_mini_vss"),E(G[1],"d_mini_vsdpersonale"),E(G[2],"d_mini_vsdindiretto"),E(G[3],"d_mini_gi"),E(G[4],"d_mini_nncf"),E(G[5],"d_mini_provv")}).catch(function(G){logger.error(G)})}function ct(){var L=(document.getElementById("dash_cons")||{}).value||"",X=(typeof s=="function"?s("dash"):{})||{},Z=typeof a=="function"?a(X.type||"mensile"):X.type||"mensile";(function(){var m=document.getElementById("lastApps");if(m){var p=m.parentElement;if(!document.getElementById("nextApps")){var g=document.createElement("div");g.className="card",g.innerHTML='<b>Prossimi appuntamenti (oggi + domani)</b><div id="nextApps" style="margin-top:8px"></div>',p.parentElement.insertBefore(g,p)}}})();function K(q){return'<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px">'+q+"</div>"}function H(q){return q=String(q||"").toLowerCase(),q.indexOf("mezza")>-1?240:q.indexOf("giorn")>-1||q.indexOf("formaz")>-1||q.indexOf("mbs")>-1?570:q.indexOf("sottoprod")>-1?240:(q.indexOf("vend")>-1,90)}function M(q){var m=new Date(q.start),p=new Date(q.end);(!(p instanceof Date)||isNaN(p)||p<m)&&(p=new Date(m.getTime()+H(q.type||"vendita")*6e4));var g=ri(m)+" "+ua(m)+""+(("0"+p.getHours()).slice(-2)+":"+("0"+p.getMinutes()).slice(-2)),v=q.nncf?"  NNCF ":"",k=String(q.type||"").toLowerCase(),B;return k.indexOf("mbs")>-1?B="VSD ind "+D(q.vsdIndiretto||0):k.indexOf("sottoprod")>-1?B="Tel "+N(q.telefonate||0)+"  AppFissati "+N(q.appFissati||0):k.indexOf("formaz")>-1?B="":B="VSS "+D(q.vss||0)+"  VSD "+D(q.vsdPersonal||0)+v,'<div class="card lastApp" data-aid="'+A(String(q.id||""))+'" style="cursor:pointer"><div class="small muted">'+A(g)+"  "+A(q.type||"manuale")+'</div><div style="display:flex;justify-content:space-between;align-items:center;gap:8px"><div><b>'+A(q.client||"")+'</b></div><div class="row" style="gap:6px"><button class="ghost btn-ics" title="Esporta .ics" data-ics="'+A(String(q.id||""))+'"></button></div></div>'+(B?'<div class="small">'+B+"</div>":"")+"</div>"}function E(q){return q&&Object.keys(q).length>0}function G(q){return q=Number(q||0),isFinite(q)?q:0}var st=(function(){var q=oe(new Date(X.start)),m=oe(new Date(X.end)),p="?type="+encodeURIComponent(Z)+"&from="+encodeURIComponent(q)+"&to="+encodeURIComponent(m);return L&&(p+="&userId="+encodeURIComponent(L)),p})();Promise.all([It("/api/appointments"),It("/api/periods"+st)]).then(function(q){var m=q[0]&&q[0].appointments||[],p=q[1]&&q[1].periods||[];(function(){var v=document.getElementById("nextApps");if(v){var k=new Date,B=new Date(k.getFullYear(),k.getMonth(),k.getDate(),0,0,0,0),T=new Date(k.getFullYear(),k.getMonth(),k.getDate()+2,0,0,0,0),P=m.filter(function(y){var x=new Date(y.start).getTime(),C=x>=B.getTime()&&x<T.getTime(),I=L?String(y.userId||y.uid||"")===String(L):!0;return C&&I}).sort(function(y,x){return new Date(y.start)-new Date(x.start)});v.innerHTML=P.length?K(P.map(M).join("")):'<div class="muted">Nessun appuntamento tra oggi e domani</div>',v.querySelectorAll(".lastApp[data-aid]").forEach(function(y){y.addEventListener("click",function(){try{ze("bp_edit_aid",y.getAttribute("data-aid"))}catch(x){}f()})}),v.querySelectorAll("button[data-ics]").forEach(function(y){y.addEventListener("click",function(x){x.stopPropagation();var C=y.getAttribute("data-ics"),I=P.find(O=>String(O.id)===String(C))||m.find(O=>String(O.id)===String(C));if(!I){wt("Appuntamento non trovato");return}if(window.BP&&BP.ICS&&typeof BP.ICS.downloadIcsForAppointment=="function")if(BP.ICS.downloadIcsForAppointment(I)){typeof haptic=="function"&&haptic("medium");try{document.dispatchEvent(new Event("ics:exported"))}catch(Q){}wt(".ics esportato")}else wt("Export .ics non disponibile");else wt("Export .ics non disponibile")})})}})(),(function(){var v=document.getElementById("lastApps");if(v){var k=m.filter(function(B){return L?String(B.userId||B.uid||"")===String(L):!0}).sort(function(B,T){return new Date(T.start)-new Date(B.start)}).slice(0,6);v.innerHTML=k.length?K(k.map(M).join("")):'<div class="muted">Nessun appuntamento</div>',v.querySelectorAll(".lastApp[data-aid]").forEach(function(B){B.addEventListener("click",function(){try{ze("bp_edit_aid",B.getAttribute("data-aid"))}catch(T){}f()})}),v.querySelectorAll("button[data-ics]").forEach(function(B){B.addEventListener("click",function(T){T.stopPropagation();var P=B.getAttribute("data-ics"),y=k.find(x=>String(x.id)===String(P))||m.find(x=>String(x.id)===String(P));if(!y){wt("Appuntamento non trovato");return}if(window.BP&&BP.ICS&&typeof BP.ICS.downloadIcsForAppointment=="function")if(BP.ICS.downloadIcsForAppointment(y)){typeof haptic=="function"&&haptic("medium");try{document.dispatchEvent(new Event("ics:exported"))}catch(C){}wt(".ics esportato")}else wt("Export .ics non disponibile");else wt("Export .ics non disponibile")})})}})(),(function(){var v=document.getElementById("lastBPs");if(v){var k=p.filter(function(T){return!(String(T.type)!==String(Z)||L&&String(T.userId||T.uid||"")!==String(L))}).sort(function(T,P){return new Date(P.endDate)-new Date(T.endDate)}).slice(0,3),B=k.map(function(T){var P=li(T.type,T.startDate),y=T.indicatorsPrev||{},x=T.indicatorsCons||{},C=E(x),I=C?x:y,O=G(I.VSS),Q=G(I.VSDPersonale),it=G(I.VSDIndiretto),dt=G(I.GI),ft=G(I.NNCF),ht=Q+it;return'<div class="card lastBP" data-pid="'+A(String(T.id||""))+'" style="cursor:pointer;flex:1 1 320px"><div style="display:flex;align-items:center;gap:8px"><div><b>'+A(P)+'</b></div><span class="chip small">'+(C?"Consuntivo":"Previsionale")+'</span></div><div class="row" style="margin-top:6px;gap:8px;flex-wrap:wrap"><span class="chip small">VSS <b>'+D(O)+'</b></span><span class="chip small">VSD <b>'+D(ht)+'</b> <span class="muted">(P '+D(Q)+"  I "+D(it)+')</span></span><span class="chip small">GI <b>'+D(dt)+'</b></span><span class="chip small">NNCF <b>'+N(ft)+"</b></span></div></div>"}).join("");v.innerHTML=B?K(B):'<div class="muted">Nessun BP</div>',v.querySelectorAll(".lastBP[data-pid]").forEach(function(T){T.addEventListener("click",function(){try{ze("bp_open_period",{id:T.getAttribute("data-pid"),mode:!1})}catch(P){}u()})})}})()}).catch(function(q){logger.error(q)})}o("dash",function(){typeof haptic=="function"&&haptic("light"),Y(),nt(),ct()});var $=document.getElementById("dash_mode");$&&($.onchange=function(){typeof haptic=="function"&&haptic("light"),Y(),nt(),ct()});var V=document.getElementById("dash_cons");V&&(V.onchange=function(){typeof haptic=="function"&&haptic("light"),Y(),nt(),ct()}),Y(),nt(),ct(),typeof kickFinal=="function"&&kickFinal("dashboard")}function d(){if(!Ut())return t();document.title="Battle Plan  Calendario";function b(V){return ua(V)}if(!document.getElementById("cal_dynamic_css")){var D='\n      /* ============== CALENDAR ============== */\n      #cal_container{ overflow-x:auto; -webkit-overflow-scrolling:touch; }\n      #cal_container .calendar{ min-width: 860px; }\n\n      .calendar{ display:grid; grid-template-columns: 44px repeat(7, 1fr); gap:10px; }\n      .calendar .weekLabel{ color:var(--muted); font-size:12px; display:flex; align-items:center; justify-content:center; }\n\n      .calendar .day{\n        min-height:120px; background: var(--card);\n        border:2px solid var(--hair2); border-radius:14px; padding:8px;\n        display:flex; flex-direction:column; gap:3px; overflow:hidden;\n      }\n      .calendar .day.today{\n        outline: 2px solid var(--accent);\n        box-shadow: 0 0 0 2px rgba(0,0,0,.06) inset;\n      }\n      .calendar .day .dnum{ font-weight:800; }\n      .calendar .day .small{\n        font-size:12px; line-height:1.15;\n        white-space:nowrap; overflow:hidden; text-overflow:ellipsis; width:100%;\n      }\n      .calendar .day .tag{ padding:2px 6px; border-radius:999px; border:1px solid var(--hair2); font-size:11px; align-self:flex-start; }\n      .calendar .day.busy0{ border-color:#27ae60; background:rgba(39,174,96,.08); }\n      .calendar .day.busy1{ border-color:#ff9f1a; background:rgba(255,159,26,.10); }\n      .calendar .day.busy2{ border-color:#7d1731; background:rgba(125,23,49,.12); }\n      .calendar .day.dense .small{ font-size:11px; line-height:1.1; }\n      .calendar .day.dense .tag{ transform:scale(.9); transform-origin:left top; }\n\n      @media (max-width: 900px){\n        .calendar{ grid-template-columns: 36px repeat(7, 1fr); }\n        .calendar .weekLabel{ display:flex !important; font-size:11px; }\n        .calendar .day{ min-height:92px; padding:6px; }\n        .calendar .day .dnum{ font-size:16px; }\n        .calendar .day .small{ white-space: normal !important; overflow: visible !important; text-overflow: clip !important; }\n        .calendar .day.dense .small{ font-size:clamp(9px,2.4vw,11px); }\n        .calendar .day .tag{ font-size:10px; }\n      }\n\n      /* Header filters alignment (desktop + mobile) */\n      #cal_controls{\n        display:flex;\n        flex-direction:column;\n        gap:10px;\n      }\n      #cal_controls .cal-row{\n        display:flex;\n        gap:10px;\n        align-items:flex-end;\n      }\n      #cal_controls .cal-row > *{ flex:1 1 0; }\n      #cal_controls button{ flex:0 0 auto; }\n      .cal-filters{ display:flex; align-items:flex-end; gap:8px; flex-wrap:wrap; }\n      .cal-filters .chip{\n        display:inline-flex; align-items:center; gap:6px;\n        padding:6px 10px; border-radius:999px; border:1px solid var(--hair2);\n      }\n      .cal-filters .chip input[type=checkbox]{ width:16px; height:16px; }\n      @media (max-width: 600px){\n        #cal_controls{\n          display:grid;\n          grid-template-columns: 1fr 1fr 1fr;\n          grid-template-areas:\n            "consult consult consult"\n            "prev month next"\n            "add add add"\n            "free free free"\n            "fourh refresh refresh";\n          align-items:end;\n        }\n        #cal_controls .cal-row{ display:contents; }\n        #cal_consultant_wrap{ grid-area:consult; }\n        #cal_prev{ grid-area:prev; justify-self:start; }\n        #cal_month_wrap{ grid-area:month; }\n        #cal_next{ grid-area:next; }\n        #cal_add{ grid-area:add; justify-self:start; }\n        #only_free{ grid-area:free; }\n        #only_4h{ grid-area:fourh; }\n        #cal_refresh{ grid-area:refresh; justify-self:end; }\n        .cal-filters{ align-items:center; }\n\n        /* Force chips to occupy full width to avoid overlap */\n        #only_free, #only_4h{\n          display:flex !important;\n          width:100% !important;\n          min-width:0 !important;\n          align-items:center;\n        }\n        /* Ensure chips span all columns when areas fallback */\n        #only_free, #only_4h{ grid-column: 1 / -1; }\n        /* Allow buttons to shrink within grid cells */\n        #cal_prev, #cal_next, #cal_add, #cal_refresh{ min-width:0; }\n      }\n    ',N=document.createElement("style");N.id="cal_dynamic_css",N.textContent=D,document.head.appendChild(N)}var A=new Date,U=oe(io(A)).slice(0,7);n.innerHTML=pe()+'<div class="wrap"><div class="card"><div id="cal_controls"><div class="cal-row"><div id="cal_consultant_wrap"><label>Consulente</label><select id="cal_consultant"></select></div><button id="cal_prev" class="ghost" title="Mese precedente"></button><div id="cal_month_wrap"><label>Mese</label><input type="month" id="cal_month" value="'+U+'"></div><button id="cal_next" class="ghost" title="Mese successivo"></button></div><div class="cal-row cal-filters"><button id="cal_add" class="ghost">Aggiungi appuntamento</button><label id="only_free" class="chip small"><input type="checkbox" id="only_free_cb"> Solo giorni liberi</label> <label id="only_4h" class="chip small"><input type="checkbox" id="only_4h_cb"> Solo slot  4h</label><button id="cal_refresh" class="ghost">Aggiorna</button></div></div></div><div id="cal_container"></div><div id="cal_results" class="card" style="margin-top:8px;display:none"></div><div id="cal_day_box" class="card" style="margin-top:8px;display:none"></div><div class="card" id="cal_free_slots" style="margin-top:8px;display:none"></div></div>',se();var j=document.getElementById("cal_consultant");function z(){var V=Ut()||{};j.innerHTML='<option value="'+Ft(V.id||"")+'">'+Ft(V.name||"")+"</option>",It("/api/users").then(function(L){for(var X=L.users||[],Z='<option value="all">Tutti</option>',K=0;K<X.length;K++){var H=X[K];Z+='<option value="'+Ft(H.id)+'">'+Ft(H.name||H.email||H.id)+"</option>"}j.innerHTML=Z,j.value=V.id}).catch(function(){j.innerHTML='<option value="'+Ft(V.id||"")+'">'+Ft(V.name||"")+"</option>"})}z();function W(V,L,X,Z){var K="/api/appointments",H="/api/availability?from="+V+"-"+ye(L)+"-01&to="+V+"-"+ye(L)+"-"+ye(new Date(V,L,0).getDate());Z==="all"?(K+="?global=1",H+="&global=1"):Z&&Z!==Ut().id&&(K+="?user="+Z,H+="&user="+Z),Promise.all([It(K),It(H)]).then(function(M){var E=M[0]&&M[0].appointments?M[0].appointments:[],G=M[1]||{slots:[]},st=G.slots||[],q=new Date(V,L-1,1),m=new Date(V,L,0,23,59,59,999);function p(Pt,Kt){for(var Wt={vss:0,vsd:0,vsdI:0,telefonate:0,appFissati:0,nncf:0,count:0},Gt=0;Gt<E.length;Gt++){var $t=E[Gt],de=new Date($t.start);de>=Pt&&de<=Kt&&(Wt.vss+=Number($t.vss||0),Wt.vsd+=Number($t.vsdPersonal||0),Wt.vsdI+=Number($t.vsdIndiretto||0),Wt.telefonate+=Number($t.telefonate||0),Wt.appFissati+=Number($t.appFissati||0),Wt.nncf+=$t.nncf?1:0,Wt.count+=1)}return Wt}function g(Pt,Kt,Wt){var Gt=document.getElementById("cal_results");if(Gt){var $t=Wt?'<div class="right"><button id="res_reset" class="ghost">Torna al mese</button></div>':"";if(Gt.innerHTML='<div style="display:flex;justify-content:space-between;align-items:center"><b>Risultati  '+Kt+"</b>"+$t+'</div><div class="row" style="margin-top:8px;gap:8px;flex-wrap:wrap"><span class="chip small">VSS <b>'+Te(Pt.vss)+'</b></span><span class="chip small">VSD <b>'+Te(Pt.vsd)+'</b></span><span class="chip small">VSD ind <b>'+Te(Pt.vsdI)+'</b></span><span class="chip small">Tel <b>'+ie(Pt.telefonate)+'</b></span><span class="chip small">AppFiss <b>'+ie(Pt.appFissati)+'</b></span><span class="chip small">NNCF <b>'+ie(Pt.nncf)+'</b></span><span class="chip small">N. app <b>'+ie(Pt.count)+"</b></span></div>",Gt.style.display="block",Wt){var de=document.getElementById("res_reset");de&&(de.onclick=function(){g(p(q,m),x,!1)})}}}for(var v={},k=0;k<E.length;k++){var B=E[k],T=new Date(B.start);if(!(T<q||T>m)){var P=oe(T);v[P]||(v[P]={vss:0,vsd:0,vsdI:0,telefonate:0,appFissati:0,nncf:0,mins:0,count:0,items:[]}),v[P].vss+=Number(B.vss||0),v[P].vsd+=Number(B.vsdPersonal||0),v[P].vsdI+=Number(B.vsdIndiretto||0),v[P].telefonate+=Number(B.telefonate||0),v[P].appFissati+=Number(B.appFissati||0),v[P].nncf+=B.nncf?1:0,v[P].mins+=Number(B.durationMinutes||0),v[P].count+=1,v[P].items.push(B)}}var y=["Lun","Mar","Mer","Gio","Ven","Sab","Dom"],x=new Date(V,L-1,1).toLocaleString("it-IT",{month:"long",year:"numeric"}),C='<div class="card"><b class="neon">'+x+"</b></div>";C+='<div class="calendar">',C+='<div class="weekLabel">W</div>';for(var I=0;I<7;I++)C+='<div class="weekLabel">'+y[I]+"</div>";var O=new Date(V,L-1,1),Q=(O.getDay()+6)%7,it=new Date(O);it.setDate(O.getDate()-Q);for(var dt=0;dt<6;dt++){var ft=new Date(it),ht="W"+te(ft);C+='<div class="weekLabel" data-ws="'+oe(ft)+'" style="cursor:pointer">'+ht+"</div>";for(var Ct=0;Ct<7;Ct++){var vt=it.getMonth()===L-1,P=oe(it),J=v[P]||{vss:0,vsd:0,vsdI:0,telefonate:0,appFissati:0,nncf:0,mins:0,count:0,items:[]},ot=it.getDay(),ut=ot===0||ot===6,yt=!ut&&st.some(function(Kt){return Kt.date===P});if(vt&&X){if(X.only_free&&J.count>0){C+="<div></div>",it.setDate(it.getDate()+1);continue}if(X.only_4h&&!yt){C+="<div></div>",it.setDate(it.getDate()+1);continue}}if(!vt)C+="<div></div>";else{var _t="";ut?J.count>0&&(_t="busy2"):J.count===0?_t="busy0":yt?_t="busy1":_t="busy2";var Mt="",Et=0;ut&&J.count===0||(J.vss>0&&(Mt+='<div class="small">VSS '+Te(J.vss)+"</div>",Et++),J.vsd>0&&(Mt+='<div class="small">VSD '+Te(J.vsd)+"</div>",Et++),J.vsdI>0&&(Mt+='<div class="small">VSD ind '+Te(J.vsdI)+"</div>",Et++),J.telefonate>0&&(Mt+='<div class="small">Tel '+ie(J.telefonate)+"</div>",Et++),J.appFissati>0&&(Mt+='<div class="small">AppFiss '+ie(J.appFissati)+"</div>",Et++),J.nncf>0&&(Mt+='<div class="small">NNCF '+ie(J.nncf)+"</div>",Et++),J.count>0&&(Mt+='<div class="small">App. '+ie(J.count)+"</div>",Et++),yt&&(Mt+='<div class="tag" style="margin-top:4px">slot 4h</div>',Et++));var Rt=Et>=3?" dense":"",et=yt?" slot-free":"";C+='<div class="day '+_t+Rt+et+'" data-day="'+P+'" title="Settimana '+te(it)+'"><div class="dnum">'+it.getDate()+"</div>"+(Mt||"")+"</div>"}it.setDate(it.getDate()+1)}}C+="</div>",document.getElementById("cal_container").innerHTML=C,g(p(q,m),x,!1),document.querySelectorAll(".calendar .weekLabel[data-ws]").forEach(function(Pt){Pt.addEventListener("click",function(){var Kt=Pt.getAttribute("data-ws"),Wt=new Date(Kt),Gt=new Date(Wt);Gt.setDate(Gt.getDate()+6),Gt.setHours(23,59,59,999);var $t="Settimana "+("W"+te(Wt))+"  "+ri(Wt)+""+ri(Gt);g(p(Wt,Gt),$t,!0)})}),document.querySelectorAll(".day[data-day]").forEach(function(Pt){Pt.addEventListener("click",function(){var Kt=Pt.getAttribute("data-day"),Wt=v[Kt]&&v[Kt].items?v[Kt].items.slice():[];Wt.sort(function(ge,Ke){return new Date(ge.start)-new Date(Ke.start)});var Gt=document.getElementById("cal_day_box"),$t="<b>Appuntamenti del "+Kt.split("-").reverse().join("/")+"</b>";if(!Wt.length)$t+='<div class="muted" style="margin-top:6px">Nessun appuntamento</div>';else{$t+='<div class="row" style="margin-top:8px">';for(var de=0;de<Wt.length;de++){var Jt=Wt[de],zi=' data-start="'+Jt.start+'" data-end="'+Jt.end+'" data-title="'+Ft(Jt.client||"Appuntamento")+'" ',vn=String(Jt.type||"").toLowerCase(),Re;vn.indexOf("mbs")>-1?Re="VSD ind "+Te(Jt.vsdIndiretto||0):vn.indexOf("sottoprod")>-1?Re="Tel "+ie(Jt.telefonate||0)+"  AppFissati "+ie(Jt.appFissati||0):vn.indexOf("formaz")>-1?Re="":Re="VSS "+Te(Jt.vss)+"  VSD "+Te(Jt.vsdPersonal)+"  NNCF "+(Jt.nncf?"":""),$t+='<div class="card cal-app" data-aid="'+Jt.id+'" '+zi+' style="flex:1 1 320px;cursor:pointer"><div class="small muted">'+b(Jt.start)+""+b(Jt.end)+"  "+Ft(Jt.type||"")+"</div><div><b>"+Ft(Jt.client||"")+"</b></div>"+(Re?'<div class="small">'+Re+"</div>":"")+(Jt.notes?'<div class="small muted">'+Ft(Jt.notes)+"</div>":"")+"</div>"}$t+="</div>"}var bn=(st||[]).filter(function(ge){return ge.date===Kt});if(bn.length){$t+='<div class="row" style="margin-top:8px">';for(var yn=0;yn<bn.length;yn++){var Xe=bn[yn],Ui=Xe.part==="morning"?"mattina":"pomeriggio";$t+='<div class="card slotBtn" data-start="'+Xe.start+'" data-end="'+Xe.end+'" style="flex:1 1 280px;cursor:pointer"><div class="small">'+Ui+"  "+b(Xe.start)+""+b(Xe.end)+"</div></div>"}$t+="</div>"}if(Gt.style.display="block",Gt.innerHTML=$t,Gt.querySelectorAll(".cal-app").forEach(function(ge){ge.addEventListener("click",function(Ke){Ke.stopPropagation(),ze("bp_edit_aid",ge.getAttribute("data-aid")),f()})}),Gt.querySelectorAll(".slotBtn").forEach(function(ge){ge.addEventListener("click",function(Ke){Ke.stopPropagation(),ze("bp_prefill_slot",{start:ge.getAttribute("data-start"),end:ge.getAttribute("data-end")}),f(),wt("Slot precompilato negli appuntamenti")})}),window.scrollTo({top:Gt.getBoundingClientRect().top+window.scrollY-80,behavior:"smooth"}),typeof window.wireICSInsideDayBox=="function")try{window.wireICSInsideDayBox()}catch(ge){}})});var at=document.getElementById("cal_free_slots"),gt=(function(){var Pt=new Date;return Pt.getFullYear()+"-"+ye(Pt.getMonth()+1)+"-"+ye(Pt.getDate())})(),pt=(st||[]).filter(function(Pt){return String(Pt.date||"").slice(0,10)>=gt});if(Z==="all"){var bt=G.details||[],St="<b>Slot liberi  4h per consulente (da oggi in poi)</b>";St+='<div class="row" style="margin-top:8px;gap:8px;flex-wrap:wrap">';for(var xt=0;xt<bt.length;xt++){var it=bt[xt];St+='<span class="chip small">'+Ft(it.name||"")+" <b>"+ie(it.total||0)+"</b></span>"}St+="</div>",at.style.display="block",at.innerHTML=St}else if(pt.length){var Bt='<b>Slot liberi  4h (da oggi in poi)</b>  <span class="badge">Tot: '+pt.length+"</span>";Bt+='<div class="row" style="margin-top:8px">';for(var kt=0;kt<pt.length&&kt<80;kt++){var T=pt[kt],Yt=T.part==="morning"?"mattina":"pomeriggio";Bt+='<div class="card slotBtn" data-start="'+T.start+'" data-end="'+T.end+'" style="flex:1 1 280px;cursor:pointer"><div class="small"><b>'+ri(T.start)+"</b>  "+Yt+'</div><div class="small">'+b(T.start)+""+b(T.end)+"</div></div>"}Bt+="</div>",at.style.display="block",at.innerHTML=Bt,at.querySelectorAll(".slotBtn").forEach(function(Pt){Pt.addEventListener("click",function(){ze("bp_prefill_slot",{start:Pt.getAttribute("data-start"),end:Pt.getAttribute("data-end")}),f(),wt("Slot precompilato negli appuntamenti")})})}else at.style.display="block",at.innerHTML='<b>Slot liberi  4h (da oggi in poi)</b>  <span class="badge">Tot: 0</span><div class="muted" style="margin-top:6px">Nessuno slot libero disponibile.</div>';try{window.injectTodayCSS&&window.injectTodayCSS()}catch(Pt){}try{window.hookCalendar?window.hookCalendar():(window.markToday&&window.markToday(),window.clampSlotCounters&&window.clampSlotCounters())}catch(Pt){}}).catch(function(M){logger.error(M),wt("Errore calendario")})}function lt(){var V=document.getElementById("cal_month").value,L=parseInt(V.split("-")[0],10),X=parseInt(V.split("-")[1],10),Z={only_free:document.getElementById("only_free_cb").checked,only_4h:document.getElementById("only_4h_cb").checked},K=document.getElementById("cal_consultant").value;W(L,X,Z,K)}document.getElementById("cal_refresh").onclick=lt;var Y=document.getElementById("cal_add");Y&&(Y.onclick=function(){f()}),document.getElementById("cal_month").onchange=lt;function nt(V){var L=document.getElementById("cal_month");if(L){var X=L.value.split("-"),Z=+X[0],K=+X[1];K+=V,K<=0?(K=12,Z--):K>12&&(K=1,Z++),L.value=Z+"-"+ye(K),lt()}}var ct=document.getElementById("cal_prev"),$=document.getElementById("cal_next");ct&&(ct.onclick=function(){nt(-1)}),$&&($.onclick=function(){nt(1)}),document.getElementById("only_free_cb").onchange=lt,document.getElementById("only_4h_cb").onchange=lt,j.onchange=lt,lt()}function u(){if(!Ut())return t();document.title="Battle Plan  BP",n.innerHTML=pe()+'<div class="wrap"><div class="card"><b>Da inviare</b><div id="bp_to_send" class="grid" style="margin-top:8px"></div></div><div class="card" id="bp_sent_box" style="margin-top:8px"><div id="bp_sent_head" style="display:flex;align-items:center;justify-content:space-between;cursor:pointer"><b>BP inviati (periodi in essere)</b><span id="bp_sent_chev" class="chev"></span></div><div id="bp_sent" class="row" style="margin-top:8px;display:none"></div></div><div class="card" style="margin-top:8px"><b>Crea/Aggiorna BP</b><div class="row" style="margin-top:8px"><div><label>Tipo</label><select id="p_type"><option value="settimanale">Settimanale (lundom)</option><option value="mensile">Mensile</option><option value="trimestrale">Trimestrale</option><option value="semestrale">Semestrale</option><option value="annuale">Annuale</option></select></div><div id="wrap_week" style="display:none"><label>Settimana ISO (153)</label><input type="number" id="p_week" min="1" max="53" value="'+te(new Date)+'"></div><div id="wrap_month" style="display:none"><label>Mese</label><select id="p_month"><option value="1">Gennaio</option><option value="2">Febbraio</option><option value="3">Marzo</option><option value="4">Aprile</option><option value="5">Maggio</option><option value="6">Giugno</option><option value="7">Luglio</option><option value="8">Agosto</option><option value="9">Settembre</option><option value="10">Ottobre</option><option value="11">Novembre</option><option value="12">Dicembre</option></select></div><div id="wrap_quarter" style="display:none"><label>Trimestre</label><select id="p_quarter"><option value="1">T1</option><option value="2">T2</option><option value="3">T3</option><option value="4">T4</option></select></div><div id="wrap_semester" style="display:none"><label>Semestre</label><select id="p_sem"><option value="1">1 semestre</option><option value="2">2 semestre</option></select></div><div><label>Anno</label><input type="number" id="p_year" min="2000" max="2100" value="'+new Date().getFullYear()+'"></div></div><div class="row"><div class="small muted">Modalit: <b id="p_mode_lbl">Previsionale</b>  <button class="ghost" id="btnImport" style="padding:4px 8px">Importa da agenda</button></div></div><div class="row" style="align-items:center"><div class="small"><b>Periodo selezionato:</b> <span id="p_label" class="neon"></span></div><input type="hidden" id="p_start"><input type="hidden" id="p_end"></div><div class="row small" style="margin-top:6px;opacity:.9"><div><b>Previsionale</b></div><div><b>Consuntivo</b></div><div><b>Avanzamento</b></div></div><div class="row" id="p_rows" style="margin-top:4px"></div><div class="row" style="margin-top:8px;align-items:center;gap:8px;justify-content:space-between"><div id="p_delete_zone"></div><div class="right"><button id="btnSaveP">Salva BP</button></div></div></div><div class="card"><b>BP salvati</b><div id="p_list" class="row" style="margin-top:8px"></div></div></div>',se();var b=!1,D=null,N=[],A=null,U=Ut()||{};function j(et){return String(et).replace(/[&<>'"]/g,at=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[at])}function z(et){if(!et)return"";var at=new Date(et);return at.getFullYear()+"-"+("0"+(at.getMonth()+1)).slice(-2)+"-"+("0"+at.getDate()).slice(-2)}function W(et){var at=new Date(et);return("0"+at.getDate()).slice(-2)+"/"+("0"+(at.getMonth()+1)).slice(-2)+"/"+at.getFullYear()}function lt(et){var at=Number(et)||0;return at.toLocaleString("it-IT")+""}function Y(et){var at=document.createElement("div");return at.innerHTML=et.trim(),at.firstChild}function nt(et){return!!(et&&et.indicatorsCons&&Object.keys(et.indicatorsCons).length>0)}function ct(){return U&&U.grade?Promise.resolve(U):It("/api/usernames").then(function(et){var at=String((Ut()||{}).id||""),gt=(et&&et.users||[]).find(function(pt){return String(pt.id)===at});return gt&&gt.grade&&(U.grade=gt.grade),U}).catch(function(){return U})}function $(){var et=U&&U.grade||(Ut()||{}).grade;return et==="senior"?"senior":"junior"}ct();var V=document.getElementById("p_type"),L=document.getElementById("p_year"),X=document.getElementById("wrap_week"),Z=document.getElementById("wrap_month"),K=document.getElementById("wrap_quarter"),H=document.getElementById("wrap_semester"),M=document.getElementById("p_week"),E=document.getElementById("p_month"),G=document.getElementById("p_quarter"),st=document.getElementById("p_sem"),q=document.getElementById("p_label"),m=document.getElementById("p_start"),p=document.getElementById("p_end"),g=document.getElementById("p_mode_lbl"),v=document.getElementById("btnImport");function k(et){b=!!et,g.textContent=b?"Consuntivo":"Previsionale",v.style.display=b?"none":"";var at=document.querySelectorAll("[data-row]");at.forEach(function(gt){var pt=gt.querySelector("[data-prev]"),bt=gt.querySelector("[data-cons]"),St=gt.querySelector("[data-bar]");if(b){if(pt){pt.removeAttribute("hidden");var xt=pt.querySelector("input");xt&&(xt.setAttribute("readonly","readonly"),xt.classList.add("disabled"))}if(bt){bt.removeAttribute("hidden");var Bt=bt.querySelector("input");Bt&&(Bt.removeAttribute("readonly"),Bt.classList.remove("disabled"))}St&&St.removeAttribute("hidden")}else{if(pt){pt.removeAttribute("hidden");var kt=pt.querySelector("input");kt&&(kt.removeAttribute("readonly"),kt.classList.remove("disabled"))}bt&&bt.setAttribute("hidden","hidden"),St&&St.setAttribute("hidden","hidden")}}),vt()}function B(){var et=V.value;X.style.display=et==="settimanale"?"":"none",Z.style.display=et==="mensile"?"":"none",K.style.display=et==="trimestrale"?"":"none",H.style.display=et==="semestrale"?"":"none",T()}function T(){var et=V.value,at=parseInt(L.value,10),gt,pt,bt;if(et==="settimanale"){var St=Math.max(1,Math.min(53,parseInt(M.value||"1",10))),xt=en(at,St);gt=xt.start,pt=xt.end,bt="Sett. "+St+"  "+W(gt)+"  "+W(pt)}else if(et==="mensile"){var Bt=parseInt(E.value,10);gt=new Date(at,Bt-1,1),pt=new Date(at,Bt,0),bt=gt.toLocaleString("it-IT",{month:"long",year:"numeric"})+"  "+W(gt)+"  "+W(pt)}else if(et==="trimestrale"){var kt=parseInt(G.value,10);gt=new Date(at,(kt-1)*3,1),pt=new Date(at,kt*3,0),bt="Trimestre "+kt+" "+at+"  "+W(gt)+"  "+W(pt)}else if(et==="semestrale"){var Yt=parseInt(st.value,10);gt=new Date(at,Yt===1?0:6,1),pt=new Date(at,Yt===1?6:12,0),bt=(Yt===1?"1":"2")+" semestre "+at+"  "+W(gt)+"  "+W(pt)}else gt=new Date(at,0,1),pt=new Date(at,11,31),bt="Anno "+at+"  "+W(gt)+"  "+W(pt);m.value=z(gt),p.value=z(pt),q.textContent=bt,k(!1),D=null,A=null,I(),vt()}function P(et){for(var at="",gt=0;gt<et.length;gt++){var pt=et[gt],bt=/^(VSS|VSDPersonale|VSDIndiretto|GI)$/i.test(pt);at+='<div class="row" data-row="'+pt+'"><div data-prev><label>'+pt+' (Prev)</label><input type="number" step="1" id="prev_'+pt+'" placeholder="'+(bt?"":"n")+'"></div><div data-cons><label>'+pt+' (Cons)</label><input type="number" step="1" id="cons_'+pt+'" placeholder="'+(bt?"":"n")+'"></div><div data-bar class="small"><div style="height:10px;background:rgba(255,255,255,.12);border-radius:999px;overflow:hidden"><div id="bar_'+pt+'" style="height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2));"></div></div><div id="pct_'+pt+'" class="small muted">0%</div></div></div>'}document.getElementById("p_rows").innerHTML=at,k(!1),x(),y()}function y(){for(var et=0;et<N.length;et++){var at=N[et],gt=document.getElementById("prev_"+at),pt=document.getElementById("cons_"+at);if(!(!gt||!pt)){var bt=Number(gt.value||0),St=Number(pt.value||0),xt=bt>0?Math.round(St/bt*100):St>0?100:0;xt=Math.max(0,Math.min(200,xt));var Bt=document.getElementById("bar_"+at),kt=document.getElementById("pct_"+at);Bt&&(Bt.style.width=Math.min(xt,100)+"%"),kt&&(kt.textContent=xt+"%")}}}function x(){for(var et=0;et<N.length;et++)(function(at){var gt=document.getElementById("prev_"+at),pt=document.getElementById("cons_"+at);gt&&(gt.oninput=y),pt&&(pt.oninput=y)})(N[et])}function C(){for(var et=0;et<N.length;et++){var at=document.getElementById("prev_"+N[et]);at&&(at.value="")}y()}function I(){for(var et=0;et<N.length;et++){var at=document.getElementById("cons_"+N[et]);at&&(at.value="")}y()}function O(et){for(var at in et){var gt=document.getElementById("prev_"+at);gt&&(gt.value=String(et[at]||0))}y()}function Q(et){for(var at in et){var gt=document.getElementById("cons_"+at);gt&&(gt.value=String(et[at]||0))}y()}function it(){if(!b){var et=m.value,at=p.value;if(!et||!at){wt("Seleziona il periodo");return}It("/api/appointments").then(function(gt){for(var pt=gt.appointments||[],bt=new Date(et),St=new Date(at),xt={VSS:0,VSDPersonale:0,VSDIndiretto:0,GI:0,Telefonate:0,AppFissati:0,AppFatti:0,CorsiLeadership:0,iProfile:0,MBS:0,NNCF:0},Bt=0;Bt<pt.length;Bt++){var kt=pt[Bt],Yt=new Date(kt.start);Yt>=bt&&Yt<=St&&(xt.VSS+=Number(kt.vss||0),xt.VSDPersonale+=Number(kt.vsdPersonal||0),xt.VSDIndiretto+=Number(kt.vsdIndiretto||0),xt.Telefonate+=Number(kt.telefonate||0),xt.AppFissati+=Number(kt.appFissati||0),kt.nncf&&(xt.AppFatti+=1,xt.NNCF+=1))}O(xt),wt("Previsionale compilato dalla tua agenda"),ci(),window.addXP(10)}).catch(function(){wt("Errore import agenda")})}}function dt(et,at){et=Object.assign({},et||{});var gt=Number(et.GI||0),pt=Number(et.VSDPersonale||0),bt=gt*.15,St=pt*(String(at)==="senior"?.25:.2);return et.ProvvGI=Math.round(bt*100)/100,et.ProvvVSD=Math.round(St*100)/100,et.TotProvvigioni=Math.round((et.ProvvGI+et.ProvvVSD)*100)/100,et}function ft(et,at,gt){return fetch(at,{method:et,headers:gt?{"Content-Type":"application/json"}:void 0,body:gt?JSON.stringify(gt):void 0}).then(function(pt){return pt.ok?pt.json().catch(function(){return{}}):Promise.reject(new Error("HTTP "+pt.status))})}function ht(et){for(var at=encodeURIComponent(et),gt=[function(){return ft("POST","/api/periods/delete",{id:et})},function(){return ft("POST","/api/periods",{id:et,_delete:!0})},function(){return ft("POST","/api/periods/"+at,{_method:"DELETE"})},function(){return ft("DELETE","/api/periods/"+at,null)},function(){return ft("DELETE","/api/periods?id="+at,null)}],pt=Promise.reject(new Error("start")),bt=0;bt<gt.length;bt++)(function(St){pt=pt.catch(St)})(gt[bt]);return pt.catch(function(St){throw logger.warn("Delete fallback: tutte le route fallite",St),St})}function Ct(et){return A?{id:D||A.id,type:A.type,startDate:z(A.startDate),endDate:z(A.endDate),indicatorsPrev:Object.assign({},A.indicatorsPrev||{}),indicatorsCons:et!=null?et:Object.assign({},A.indicatorsCons||{})}:null}function vt(){var et=document.getElementById("p_delete_zone");if(et){if(!D){et.innerHTML="";return}var at=!!(A&&nt(A)),gt="";at&&(gt+='<button id="btnDelCons" class="ghost" style="border-color:#7d1731;color:#7d1731">Elimina Consuntivo</button> '),gt+='<button id="btnDelBP" class="ghost" style="border-color:#7d1731;color:#7d1731">Elimina BP</button>',et.innerHTML=gt;var pt=document.getElementById("btnDelBP");pt&&(pt.onclick=function(){if(confirm("Eliminare definitivamente questo BP?")){pt.disabled=!0;var St=A?JSON.parse(JSON.stringify(A)):null;ht(D).then(function(){wt("BP eliminato");try{document.dispatchEvent(new Event("bp:deleted"))}catch(Bt){}if(D=null,A=null,C(),I(),k(!1),T(),ot(),typeof showUndo=="function"&&St){var xt={type:St.type,startDate:z(St.startDate),endDate:z(St.endDate),indicatorsPrev:Object.assign({},St.indicatorsPrev||{}),indicatorsCons:Object.assign({},St.indicatorsCons||{})};showUndo("BP eliminato",function(){return fe("/api/periods",xt).then(function(){try{document.dispatchEvent(new Event("bp:saved"))}catch(Bt){}ot()})},5e3)}}).catch(function(){wt("Endpoint delete non disponibile")}).finally(function(){pt.disabled=!1})}});var bt=document.getElementById("btnDelCons");bt&&(bt.onclick=function(){if(confirm("Rimuovere solo il Consuntivo?")){bt.disabled=!0;var St=A?JSON.parse(JSON.stringify(A.indicatorsCons||{})):null,xt=Ct({});if(!xt){bt.disabled=!1;return}var Bt=$();xt.indicatorsPrev=dt(xt.indicatorsPrev,Bt),xt.indicatorsCons={},fe("/api/periods",xt).then(function(){wt("Consuntivo eliminato");try{document.dispatchEvent(new Event("bp:saved"))}catch(Yt){}if(A&&(A.indicatorsCons={}),k(!0),ot(),vt(),typeof showUndo=="function"&&St){var kt=Ct(St);showUndo("Consuntivo eliminato",function(){return fe("/api/periods",kt).then(function(){try{document.dispatchEvent(new Event("bp:saved"))}catch(Yt){}A&&(A.indicatorsCons=St),ot(),vt()})},5e3)}}).catch(function(){wt("Errore eliminazione Consuntivo")}).finally(function(){bt.disabled=!1})}})}}function J(){var et=V.value,at=m.value,gt=p.value;if(!at||!gt){wt("Seleziona il periodo");return}for(var pt={},bt={},St=0;St<N.length;St++){var xt=N[St];pt[xt]=Number(document.getElementById("prev_"+xt).value||0),b&&(bt[xt]=Number(document.getElementById("cons_"+xt).value||0))}var Bt=$();pt=dt(pt,Bt),b&&(bt=dt(bt,Bt));var kt={type:et,startDate:at,endDate:gt,indicatorsPrev:pt};b&&(kt.indicatorsCons=bt),D&&(kt.id=D),fe("/api/periods",kt).then(function(Yt){wt("BP salvato"),b?window.addXP(20):window.addXP(10),ci();try{document.dispatchEvent(new Event("bp:saved"))}catch(Pt){}ot(),!D&&Yt&&Yt.id&&(D=Yt.id),D&&A&&(A.indicatorsPrev=pt,b&&(A.indicatorsCons=bt)),vt()}).catch(function(){wt("Errore salvataggio BP")})}function ot(){It("/api/periods").then(function(et){var at=et.periods||[];at.sort(function(kt,Yt){return new Date(Yt.startDate)-new Date(kt.startDate)});for(var gt="",pt=0;pt<at.length;pt++){var bt=at[pt],St=li(bt.type,bt.startDate)+"  "+W(bt.startDate)+"  "+W(bt.endDate);gt+='<div class="card" style="flex:1 1 360px"><div><b>'+j(St)+'</b></div><div class="small">Prev VSS '+lt((bt.indicatorsPrev||{}).VSS||0)+"  Cons "+lt((bt.indicatorsCons||{}).VSS||0)+'</div><div class="right" style="margin-top:6px"><button class="ghost" data-edit="'+bt.id+'">Modifica previs.</button><button data-cons="'+bt.id+'">Consuntivo</button></div></div>'}document.getElementById("p_list").innerHTML=gt||'<div class="muted">Nessun BP</div>',document.querySelectorAll("[data-edit]").forEach(function(kt){kt.addEventListener("click",function(){var Yt=kt.getAttribute("data-edit"),Pt=(et.periods||[]).find(function(Kt){return Kt.id===Yt});Pt&&ut(Pt,!1)})}),document.querySelectorAll("[data-cons]").forEach(function(kt){kt.addEventListener("click",function(){var Yt=kt.getAttribute("data-cons"),Pt=(et.periods||[]).find(function(Kt){return Kt.id===Yt});Pt&&ut(Pt,!0)})}),Rt(at);var xt=yi("bp_open_period",null);if(xt){Fn("bp_open_period");var Bt=at.find(function(kt){return kt.id===xt.id});Bt&&ut(Bt,xt.mode===!0)}})}function ut(et,at){A=et||null,V.value=et.type;var gt=new Date(et.startDate),pt=gt.getFullYear();if(L.value=String(pt),et.type==="settimanale")M.value=String(te(gt));else if(et.type==="mensile")E.value=String(gt.getMonth()+1);else if(et.type==="trimestrale"){var bt=Math.floor(gt.getMonth()/3)+1;G.value=String(bt)}else et.type==="semestrale"&&(st.value=gt.getMonth()<6?"1":"2");B(),C(),I(),O(et.indicatorsPrev||{}),Q(et.indicatorsCons||{}),k(!!at),D=et.id||null,vt(),wt(at?"Compila il consuntivo":"Modifica previsionale"),window.scrollTo({top:0,behavior:"smooth"})}function yt(et,at){at=at||new Date;var gt=at.getFullYear();if(et==="settimanale"){var pt=en(gt,te(at));return{start:pt.start,end:pt.end}}return et==="mensile"?{start:io(at),end:oo(at)}:et==="trimestrale"?{start:Ti(at),end:so(at)}:et==="semestrale"?{start:Pi(at),end:ao(at)}:{start:Do(at),end:_i(at)}}function _t(et,at){return at=at||new Date,et==="settimanale"?Ff(at):et==="mensile"?Nf(at):et==="trimestrale"?Rf(at):et==="semestrale"?Vf(at):zf(at)}function Mt(et){var at=en(new Date().getFullYear(),te(new Date)),gt=at.start,pt=Math.floor((new Date(et)-gt)/(1e3*60*60*24));return pt<=13}function Et(et,at,gt,pt,bt,St){var xt=li(at,gt),Bt=Y('<div class="card" style="position:relative"><div class="small muted">'+j(et)+"</div><div><b>"+j(xt)+'</b></div><div class="small muted">'+W(gt)+"  "+W(pt)+'</div><div class="right" style="margin-top:6px"><button class="ghost" type="button" data-sug="1">'+j(bt)+"</button></div></div>");return Bt.querySelector("[data-sug]").addEventListener("click",St),Bt}function Rt(et){var at=document.getElementById("bp_to_send"),gt=document.getElementById("bp_sent");at.innerHTML="",gt.innerHTML="";function pt(Zt,ue,ne){return et.find(function(Me){return Me.type===Zt&&z(Me.startDate)===z(ue)&&z(Me.endDate)===z(ne)})}var bt=new Date,St=bt.getDay(),xt=St===5||St===6||St===0,Bt=oo(bt),kt=so(bt),Yt=ao(bt),Pt=_i(bt),Kt=xt&&Mt(Bt),Wt=xt&&Mt(kt),Gt=xt&&Mt(Yt),$t=xt&&Mt(Pt);["settimanale","mensile","trimestrale","semestrale","annuale"].forEach(function(Zt){var ue=yt(Zt,bt),ne=pt(Zt,ue.start,ue.end);if(ne){var Me=Y('<div class="card" style="flex:1 1 360px"><div><b>'+j(li(Zt,ue.start))+'</b></div><div class="small muted">'+W(ue.start)+"  "+W(ue.end)+'</div><div class="right" style="margin-top:6px"><button class="ghost" type="button" data-mid="'+ne.id+'">Modifica</button></div></div>');Me.querySelector("[data-mid]").addEventListener("click",function(){ut(ne,!1)}),gt.appendChild(Me)}});function de(Zt,ue,ne){var Me=pt(Zt,ne.start,ne.end),Hi=pt(Zt,ue.start,ue.end);Me?at.appendChild(Et("Previsionale",Zt,ne.start,ne.end,"Modifica",function(){ut(Me,!1)})):at.appendChild(Et("Previsionale",Zt,ne.start,ne.end,"Compila",function(){if(V.value=Zt,L.value=String(ne.start.getFullYear()),Zt==="settimanale")M.value=String(te(ne.start));else if(Zt==="mensile")E.value=String(ne.start.getMonth()+1);else if(Zt==="trimestrale"){var hr=Math.floor(ne.start.getMonth()/3)+1;G.value=String(hr)}else Zt==="semestrale"&&(st.value=ne.start.getMonth()<6?"1":"2");B()})),Hi&&!nt(Hi)&&at.appendChild(Et("Consuntivo",Zt,ue.start,ue.end,"Consuntivo",function(){ut(Hi,!0)}))}if(xt){var Jt=yt("settimanale",bt),zi=_t("settimanale",bt);de("settimanale",Jt,zi)}if(Kt){var vn=yt("mensile",bt),Re=_t("mensile",bt);de("mensile",vn,Re)}if(Wt){var bn=yt("trimestrale",bt),yn=_t("trimestrale",bt);de("trimestrale",bn,yn)}if(Gt){var Xe=yt("semestrale",bt),Ui=_t("semestrale",bt);de("semestrale",Xe,Ui)}if($t){var ge=yt("annuale",bt),Ke=_t("annuale",bt);de("annuale",ge,Ke)}at.children.length||(at.innerHTML='<div class="muted">Nessun suggerimento attivo in questo momento</div>');var ur=document.getElementById("bp_sent_head"),fr=document.getElementById("bp_sent_chev");ur.onclick=function(){var Zt=document.getElementById("bp_sent"),ue=Zt.style.display!=="none";Zt.style.display=ue?"none":"",fr.textContent=ue?"":""}}It("/api/settings").then(function(et){N=et&&et.indicators||["VSS","VSDPersonale","VSDIndiretto","GI","Telefonate","AppFissati","AppFatti","CorsiLeadership","iProfile","MBS","NNCF"],P(N)}).catch(function(){N=["VSS","VSDPersonale","GI","NNCF"],P(N)}),V.onchange=B,L.oninput=T,M.oninput=T,E.onchange=T,G.onchange=T,st.onchange=T,v.onclick=it,document.getElementById("btnSaveP").onclick=J,B(),ot()}function f(){if(!Ut())return t();if(document.title="Battle Plan  Appuntamenti",!document.getElementById("appts_css")){const y=document.createElement("style");y.id="appts_css",y.textContent="\n      .appt-type .seg, #a_nncf.seg{\n        padding:8px 12px;border:1px solid #bcd7ff;border-radius:12px;\n        background:#eef5ff;color:#1463ff;cursor:pointer;user-select:none;\n        transition:.15s;\n      }\n      .appt-type .seg.active, #a_nncf.seg.active{\n        background:var(--accent);color:#fff;border-color:var(--accent);\n        box-shadow:0 0 0 2px rgba(20,99,255,.08) inset;\n      }\n      .appt-type > div{display:flex;flex-wrap:wrap;gap:8px;margin-top:4px}\n      .appt-row-end-dur{display:flex;gap:8px;align-items:flex-end}\n      #a_desc{width:100%;min-height:3.2em}\n      #a_list .grid3{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}\n    ",document.head.appendChild(y)}n.innerHTML=pe()+'<div class="wrap"><div class="card"><b id="a_form_title">Nuovo appuntamento</b><div class="row" style="margin-top:8px;align-items:flex-end;gap:12px;flex-wrap:wrap"><div style="min-width:320px"><label>Cliente *</label><div style="display:flex;gap:8px;align-items:center"><input id="a_client" list="clientList" placeholder="Denominazione" style="flex:1"><datalist id="clientList"></datalist><button id="a_nncf" class="seg" data-active="0" aria-pressed="false">NNCF</button></div></div><div><label>Data/ora inizio</label><input id="a_start" type="datetime-local"></div><div class="appt-row-end-dur"><div><label>Ora fine</label><input id="a_end" type="time"></div><div><label>Durata (min)</label><input id="a_dur" type="number" placeholder="60" min="1" style="width:80px"></div></div></div><div style="margin-top:8px"><label>Descrizione appuntamento</label><textarea id="a_desc" rows="2" style="width:100%;min-height:3.2em"></textarea></div><div class="row" style="align-items:flex-end;gap:12px;flex-wrap:wrap"><div class="appt-type"><label>Tipo</label><div><button type="button" id="t_vendita" class="seg">Vendita</button><button type="button" id="t_mezza"   class="seg" data-vsd="1000">Mezza giornata</button><button type="button" id="t_full"    class="seg" data-vsd="2000">Giornata intera</button><button type="button" id="t_form"    class="seg">Formazione</button><button type="button" id="t_mbs"     class="seg">MBS</button><button type="button" id="t_sotto"   class="seg">Sottoprodotti</button></div><input id="a_type" type="hidden" value="vendita"></div><div id="row_vss"><label>VSS</label><input id="a_vss" type="number" step="1" placeholder="0"></div><div id="row_vsd_p"><label>VSD personale</label><input id="a_vsd" type="number" step="1" placeholder="0"></div><div id="row_vsd_i" style="display:none"><label>VSD indiretto</label><input id="a_vsd_i" type="number" step="1" placeholder="0"></div><div id="row_tel" style="display:none"><label>Telefonate</label><input id="a_tel" type="number" step="1" placeholder="0"></div><div id="row_app" style="display:none"><label>Appunt. fissati</label><input id="a_app" type="number" step="1" placeholder="0"></div></div><div class="row" style="margin-top:8px;gap:8px;align-items:center"><div><button id="btnSaveA">Salva</button></div><div><button id="btnSaveExportA" class="ghost">Salva ed esporta</button></div><div class="right" style="margin-left:auto"><button id="btnDeleteA" class="danger" style="display:none">Elimina</button></div></div></div><div class="card"><b>Elenco appuntamenti</b><div class="row" style="margin-top:8px;align-items:flex-end;gap:12px;flex-wrap:wrap"><div><label>Vista</label><select id="af_type"><option value="sett">Settimana</option><option value="mese">Mese</option></select></div><div id="af_week_wrap"><label>Settimana ISO</label><input id="af_week" type="number" min="1" max="53" value="'+te(new Date)+'"></div><div id="af_month_wrap" style="display:none"><label>Mese</label><select id="af_month"><option value="1">Gennaio</option><option value="2">Febbraio</option><option value="3">Marzo</option><option value="4">Aprile</option><option value="5">Maggio</option><option value="6">Giugno</option><option value="7">Luglio</option><option value="8">Agosto</option><option value="9">Settembre</option><option value="10">Ottobre</option><option value="11">Novembre</option><option value="12">Dicembre</option></select></div><div><label>Anno</label><input id="af_year" type="number" min="2000" max="2100" value="'+new Date().getFullYear()+'"></div><div class="right" style="margin-left:auto;display:flex;gap:8px"><button id="af_prev" class="ghost"></button><button id="af_next" class="ghost"></button></div></div><div id="a_list" style="margin-top:8px"></div></div></div>',se();function b(y){return String(y).replace(/[&<>'"]/g,x=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[x])}function D(y){var x=Number(y)||0;return x.toLocaleString("it-IT")+""}function N(y){var x=new Date(y);return("0"+x.getDate()).slice(-2)+"/"+("0"+(x.getMonth()+1)).slice(-2)+"/"+x.getFullYear()}function A(y){if(!y)return"";const x=new Date(y);return isNaN(x)?"":x.toISOString()}function U(y){if(!y)return"";const x=new Date(y);return isNaN(x)?"":new Date(x.getTime()-x.getTimezoneOffset()*6e4).toISOString().slice(0,16)}function j(y){return y=String(y||"").toLowerCase(),y.indexOf("mezza")>-1?240:y.indexOf("giorn")>-1||y.indexOf("formaz")>-1||y.indexOf("mbs")>-1?570:y.indexOf("sottoprod")>-1?240:90}const z=document.getElementById("a_nncf");z.addEventListener("click",()=>{const y=z.getAttribute("data-active")!=="1";z.setAttribute("data-active",y?"1":"0"),z.setAttribute("aria-pressed",y?"true":"false"),z.classList.toggle("active",y),y&&L(document.getElementById("t_vendita"),!0)});const W=document.getElementById("t_vendita"),lt=document.getElementById("t_mezza"),Y=document.getElementById("t_full"),nt=document.getElementById("t_form"),ct=document.getElementById("t_mbs"),$=document.getElementById("t_sotto"),V=[W,lt,Y,nt,ct,$];function L(y,x=!1){V.forEach(ht=>ht.classList.toggle("active",ht===y));const C=document.getElementById("a_type"),I=document.getElementById("a_client"),O=document.getElementById("row_vss"),Q=document.getElementById("row_vsd_p"),it=document.getElementById("row_vsd_i"),dt=document.getElementById("row_tel"),ft=document.getElementById("row_app");document.getElementById("a_vss").value="",document.getElementById("a_vsd").value="",document.getElementById("a_vsd_i").value="",document.getElementById("a_tel").value="",document.getElementById("a_app").value="",O.style.display="",Q.style.display="",it.style.display="none",dt.style.display="none",ft.style.display="none",I.disabled=!1,z.style.display="",x||(z.setAttribute("data-active","0"),z.setAttribute("aria-pressed","false"),z.classList.remove("active")),(I.value==="Formazione"||I.value==="MBS"||I.value==="Sottoprodotti")&&(I.value=""),y===W?(C.value="vendita",X(90)):y===lt?(C.value="mezza",X(240),document.getElementById("a_vsd").value="1000"):y===Y?(C.value="giornata",X(570),document.getElementById("a_vsd").value="2000"):y===nt?(C.value="formazione",X(570),I.value="Formazione",I.disabled=!0,O.style.display="none",Q.style.display="none",z.style.display="none"):y===ct?(C.value="MBS",X(570),I.value="MBS",I.disabled=!0,O.style.display="none",Q.style.display="none",it.style.display="",document.getElementById("a_vsd_i").value="2000",z.style.display="none"):y===$&&(C.value="sottoprodotti",X(240),I.value="Sottoprodotti",I.disabled=!0,O.style.display="none",Q.style.display="none",dt.style.display="",ft.style.display="",z.style.display="none")}function X(y){const x=document.getElementById("a_dur");x.value=String(y),Z()}V.forEach(y=>y.addEventListener("click",x=>{x.preventDefault(),L(y)})),L(W);function Z(){const y=document.getElementById("a_start").value,x=parseInt(document.getElementById("a_dur").value||"0",10);if(!y||!isFinite(x)||x<=0){document.getElementById("a_end").value="";return}const C=new Date(y),I=new Date(C.getTime()+x*6e4);document.getElementById("a_end").value=("0"+I.getHours()).slice(-2)+":"+("0"+I.getMinutes()).slice(-2)}function K(){const y=document.getElementById("a_start").value,x=document.getElementById("a_end").value;if(!y||!x)return;const C=new Date(y),I=x.split(":");if(I.length<2)return;const O=new Date(C);O.setHours(parseInt(I[0],10)||0,parseInt(I[1],10)||0,0,0),O<C&&O.setDate(O.getDate()+1);let Q=Math.round((O-C)/6e4);document.getElementById("a_dur").value=String(Math.max(1,Q))}document.getElementById("a_start").addEventListener("change",Z),document.getElementById("a_dur").addEventListener("input",Z),document.getElementById("a_end").addEventListener("change",K),It("/api/clients").then(y=>{const x=y&&y.clients||[],C=document.getElementById("clientList");C&&(C.innerHTML=x.map(I=>'<option value="'+b(I.name)+'"></option>').join(""))});let H=null;function M(){H=null,document.getElementById("a_form_title").textContent="Nuovo appuntamento",document.getElementById("a_client").value="",document.getElementById("a_start").value="",document.getElementById("a_end").value="",document.getElementById("a_dur").value="",document.getElementById("a_vss").value="",document.getElementById("a_vsd").value="",document.getElementById("a_vsd_i").value="",document.getElementById("a_tel").value="",document.getElementById("a_app").value="",document.getElementById("a_desc").value="",document.getElementById("a_client").disabled=!1,z.style.display="",z.setAttribute("data-active","0"),z.setAttribute("aria-pressed","false"),z.classList.remove("active"),L(W),document.getElementById("btnDeleteA").style.display="none"}function E(y){H=y.id,document.getElementById("a_form_title").textContent="Modifica appuntamento";var x=String(y.type||"vendita").toLowerCase();x.indexOf("mezza")>-1?L(lt):x.indexOf("giorn")>-1?L(Y):x.indexOf("formaz")>-1?L(nt):x.indexOf("mbs")>-1?L(ct):x.indexOf("sottoprod")>-1?L($):L(W),document.getElementById("a_client").value=y.client||"",document.getElementById("a_start").value=U(y.start);const C=new Date(y.start);let I=y.end?new Date(y.end):null,O=Number(y.durationMinutes);I instanceof Date&&!isNaN(I)&&I>=C?O=Math.max(1,Math.round((I-C)/6e4)):isFinite(O)&&O>0?I=new Date(C.getTime()+O*6e4):(O=j(y.type||"vendita"),I=new Date(C.getTime()+O*6e4)),document.getElementById("a_dur").value=String(O),document.getElementById("a_end").value=("0"+I.getHours()).slice(-2)+":"+("0"+I.getMinutes()).slice(-2),document.getElementById("a_vss").value=y.vss||"",document.getElementById("a_vsd").value=y.vsdPersonal||y.vsd||"",document.getElementById("a_vsd_i").value=y.vsdIndiretto||"",document.getElementById("a_tel").value=y.telefonate||"",document.getElementById("a_app").value=y.appFissati||"",document.getElementById("a_desc").value=y.notes||"";const Q=!!y.nncf;z.setAttribute("data-active",Q?"1":"0"),z.setAttribute("aria-pressed",Q?"true":"false"),z.classList.toggle("active",Q),document.getElementById("btnDeleteA").style.display=""}function G(){let y=(document.getElementById("a_client").value||"").trim();const x=document.getElementById("a_type").value;if(!y){const dt=String(x||"").toLowerCase();if(dt==="formazione"||dt==="mbs"||dt==="sottoprodotti")y=x;else return wt("Cliente obbligatorio"),null}const C=document.getElementById("a_start").value;if(!C)return wt("Data/ora obbligatorie"),null;let I=parseInt(document.getElementById("a_dur").value||"60",10);(!isFinite(I)||I<=0)&&(I=60);const O=document.getElementById("a_end").value;let Q;if(O){const dt=new Date(C),ft=O.split(":"),ht=new Date(dt);ht.setHours(parseInt(ft[0],10)||0,parseInt(ft[1],10)||0,0,0),ht<dt&&ht.setDate(ht.getDate()+1),Q=ht.toISOString(),I=Math.max(1,Math.round((ht-dt)/6e4)),document.getElementById("a_dur").value=String(I)}else Q=new Date(new Date(C).getTime()+I*6e4).toISOString();const it=document.getElementById("a_desc").value||"";return{id:H||void 0,client:y,start:A(C),end:Q,durationMinutes:I,type:x,vss:Number(document.getElementById("a_vss").value||0),vsdPersonal:Number(document.getElementById("a_vsd").value||0),vsdIndiretto:Number(document.getElementById("a_vsd_i").value||0),telefonate:Number(document.getElementById("a_tel").value||0),appFissati:Number(document.getElementById("a_app").value||0),notes:it,nncf:z.getAttribute("data-active")==="1"}}function st(y){const x=G();if(!x)return;const C=!H;fe("/api/appointments",x).then(()=>{if(wt("Appuntamento salvato"),typeof haptics<"u"&&haptics.try("success"),document.dispatchEvent(new Event("appt:saved")),C)try{document.dispatchEvent(new Event("appt:created"))}catch(I){}if(y&&window.BP&&BP.ICS&&typeof BP.ICS.downloadIcsForAppointment=="function")if(BP.ICS.downloadIcsForAppointment(x)){typeof haptics<"u"&&haptics.try("medium");try{document.dispatchEvent(new Event("ics:exported"))}catch(O){}wt(".ics esportato")}else wt("Export .ics non disponibile");M(),P()}).catch(()=>wt("Errore salvataggio"))}function q(){if(!H||!confirm("Eliminare l'appuntamento?"))return;const y=G();fetch("/api/appointments?id="+encodeURIComponent(H),{method:"DELETE",headers:{Authorization:"Bearer "+wi()}}).then(x=>{if(!x.ok)throw new Error("HTTP "+x.status);return x.json()}).then(()=>{wt("Eliminato"),typeof showUndo=="function"&&y&&showUndo("Appuntamento eliminato",function(){return fe("/api/appointments",y)},5e3),M(),P()}).catch(()=>wt("Errore eliminazione"))}document.getElementById("btnSaveA").onclick=()=>st(!1),document.getElementById("btnSaveExportA").onclick=()=>st(!0),document.getElementById("btnDeleteA").onclick=q;function m(){const y=document.getElementById("af_type").value,x=parseInt(document.getElementById("af_year").value,10);if(y==="sett"){const C=Math.max(1,Math.min(53,parseInt(document.getElementById("af_week").value||te(new Date),10))),I=en(x,C);return{s:new Date(I.start),e:new Date(I.end)}}else{const C=parseInt(document.getElementById("af_month").value||new Date().getMonth()+1,10);return{s:new Date(x,C-1,1),e:new Date(x,C,0,23,59,59,999)}}}function p(y){const x=document.getElementById("af_type").value,C=parseInt(document.getElementById("af_year").value,10);if(x==="sett"){const I=parseInt(document.getElementById("af_week").value,10),O=new Date(en(C,I).start);O.setDate(O.getDate()+7*y),document.getElementById("af_year").value=O.getFullYear(),document.getElementById("af_week").value=te(O)}else{const I=parseInt(document.getElementById("af_month").value,10),O=new Date(C,I-1,1);O.setMonth(O.getMonth()+y),document.getElementById("af_year").value=O.getFullYear(),document.getElementById("af_month").value=O.getMonth()+1}P()}document.getElementById("af_prev").onclick=()=>p(-1),document.getElementById("af_next").onclick=()=>p(1);const g=document.getElementById("af_type"),v=document.getElementById("af_week"),k=document.getElementById("af_month"),B=document.getElementById("af_year");g.onchange=function(){const y=g.value;document.getElementById("af_week_wrap").style.display=y==="sett"?"":"none",document.getElementById("af_month_wrap").style.display=y==="mese"?"":"none",P()},[v,k,B].forEach(y=>{y&&(y.onchange=P)});function T(y){const x=new Date(y.start);let C=y.end?new Date(y.end):null;if(!(C instanceof Date)||isNaN(C)||C<x){const it=isFinite(y.durationMinutes)?Number(y.durationMinutes):j(y.type||"vendita");C=new Date(x.getTime()+it*6e4)}const I=N(x)+" "+("0"+x.getHours()).slice(-2)+":"+("0"+x.getMinutes()).slice(-2)+""+("0"+C.getHours()).slice(-2)+":"+("0"+C.getMinutes()).slice(-2);var O,Q=String(y.type||"").toLowerCase();return Q.indexOf("mbs")>-1?O="VSD ind "+D(y.vsdIndiretto||0):Q.indexOf("sottoprod")>-1?O="Tel "+ie(y.telefonate||0)+"  AppFissati "+ie(y.appFissati||0):Q.indexOf("formaz")>-1?O="":O="VSS "+D(y.vss||0)+"  VSD "+D(y.vsdPersonal||0)+"  NNCF "+(y.nncf?"":""),'<div class="card" data-aid="'+b(String(y.id||""))+'" style="flex:1 1 320px;cursor:pointer"><div class="small muted">'+b(I)+"  "+b(y.type||"vendita")+'</div><div style="display:flex;justify-content:space-between;align-items:center;gap:8px"><div><b>'+b(y.client||"")+'</b></div><button class="ghost btn-ics" title="Esporta" data-ics="'+b(String(y.id||""))+'"></button></div>'+(O?'<div class="small">'+O+"</div>":"")+"</div>"}function P(){It("/api/appointments").then(y=>{const x=y&&y.appointments||[],C=m(),I=C.s.getTime(),O=C.e.getTime(),Q=x.filter(ot=>{const ut=new Date(ot.start).getTime();return ut>=I&&ut<=O}).sort((ot,ut)=>new Date(ot.start)-new Date(ut.start)),it=new Date,dt=Q.filter(ot=>new Date(ot.start)>=it),ft=Q.filter(ot=>new Date(ot.start)<it),ht=document.getElementById("a_list");let Ct="";Ct+="<div><b>Prossimi</b></div>",Ct+=dt.length?'<div class="grid3">'+dt.map(T).join("")+"</div>":'<div class="muted" style="margin:6px 0 12px">Nessun appuntamento futuro</div>';const vt="past_"+Math.random().toString(36).slice(2,8);Ct+='<div id="'+vt+'_head" style="margin-top:12px;display:flex;align-items:center;justify-content:space-between;cursor:pointer"><b>Passati</b><span class="chev"></span></div><div id="'+vt+'_box" style="display:none;margin-top:8px">'+(ft.length?'<div class="grid3">'+ft.map(T).join("")+"</div>":'<div class="muted">Nessun appuntamento passato</div>')+"</div>",ht.innerHTML=Ct,(function(){const ot=document.getElementById(vt+"_head"),ut=document.getElementById(vt+"_box"),yt=ot.querySelector(".chev");ot.onclick=function(){const _t=ut.style.display==="none";ut.style.display=_t?"":"none",yt.textContent=_t?"":""}})();const J=Q;ht.querySelectorAll("[data-ics]").forEach(ot=>{ot.addEventListener("click",ut=>{ut.stopPropagation();const yt=ot.getAttribute("data-ics"),_t=J.find(Mt=>String(Mt.id)===String(yt));if(!_t){wt("Appuntamento non trovato");return}if(window.BP&&BP.ICS&&typeof BP.ICS.downloadIcsForAppointment=="function")if(BP.ICS.downloadIcsForAppointment(_t)){typeof haptics<"u"&&haptics.try("medium");try{document.dispatchEvent(new Event("ics:exported"))}catch(Et){}wt("Esportato")}else wt("Export .ics non disponibile");else wt("Export .ics non disponibile")})}),ht.querySelectorAll(".card[data-aid]").forEach(ot=>{ot.addEventListener("click",()=>{const ut=ot.getAttribute("data-aid"),yt=J.find(_t=>String(_t.id)===String(ut));yt&&(E(yt),window.scrollTo({top:0,behavior:"smooth"}))})})})}try{const y=yi("bp_prefill_slot",null);if(y&&y.start){const x=new Date(y.start),C=new Date(y.end||y.start),I=new Date(x.getTime()-x.getTimezoneOffset()*6e4).toISOString().slice(0,16);document.getElementById("a_start").value=I,document.getElementById("a_dur").value=String(Math.max(1,Math.round((C-x)/6e4))),Z(),wt("Slot precompilato negli appuntamenti")}Fn("bp_prefill_slot")}catch(y){}try{const y=yi("bp_edit_aid",null);y&&It("/api/appointments").then(x=>{const I=(x&&x.appointments||[]).find(O=>String(O.id)===String(y));I&&(E(I),window.scrollTo({top:0,behavior:"smooth"}))}).finally(()=>{try{Fn("bp_edit_aid")}catch(x){}})}catch(y){}document.getElementById("btnSaveA").onclick=()=>st(!1),document.getElementById("btnSaveExportA").onclick=()=>st(!0),document.getElementById("btnDeleteA").onclick=q,It("/api/clients").then(()=>{}),P()}function h(){if(!Ut())return t();document.title="Battle Plan  Classifiche",n.innerHTML=pe()+('<div class="wrap"><div class="card"><div class="row"><div><label>Vista</label><select id="lb_tab"><option value="per_indicator">Per indicatore</option><option value="overall">Generale (score)</option></select></div><div><label>Modalit</label><select id="lb_mode"><option value="consuntivo">Consuntivo</option><option value="previsionale">Previsionale</option></select></div><div id="lb_ind_wrap"><label>Indicatore</label><select id="lb_indicator"><option value="VSS">VSS</option><option value="VSDPersonale">VSD</option><option value="GI">GI</option><option value="NNCF">NNCF</option></select></div></div>'+e("lb")+'</div><div class="card"><b id="lb_title">Classifica</b><div id="lb_podium" style="margin:10px 0"></div><div id="lb_table"></div></div></div>'),se();function b(Y){if(!Y)return"";var nt=new Date(Y);return nt.getFullYear()+"-"+("0"+(nt.getMonth()+1)).slice(-2)+"-"+("0"+nt.getDate()).slice(-2)}function D(Y){return Y==="ytd"||Y==="ltm"?"mensile":Y}document.getElementById("lb_tab").onchange=function(){var Y=this.value;document.getElementById("lb_ind_wrap").style.display=Y==="per_indicator"?"":"none",A()},o("lb",A),document.getElementById("lb_mode").onchange=A,document.getElementById("lb_indicator").onchange=A;function N(){var Y=s("lb"),nt=b(Y.start),ct=b(Y.end),$=D(Y.type||"mensile");return"&from="+encodeURIComponent(nt)+"&to="+encodeURIComponent(ct)+"&type="+encodeURIComponent($)}function A(){var Y=document.getElementById("lb_tab").value,nt=N(),ct=document.getElementById("lb_mode").value;if(Y==="overall")It("/api/leaderboard_overall?mode="+encodeURIComponent(ct)+nt).then(lt);else{var $=document.getElementById("lb_indicator").value;It("/api/leaderboard?indicator="+encodeURIComponent($)+"&mode="+encodeURIComponent(ct)+nt).then(function(V){W(V,$)})}}function U(Y){return Y===0?"":Y===1?"":Y===2?"":Y+1+"."}function j(Y){var nt=document.getElementById("lb_podium");if(!Y||!Y.length){nt.innerHTML="";return}for(var ct=Y.slice(0,3),$='<div class="row" style="align-items:flex-end">',V=0;V<ct.length;V++){var L=80-V*15;$+='<div class="card" style="flex:1 1 120px;height:'+L+'px;display:flex;align-items:flex-end;justify-content:center"><div>'+Ft(U(V)+" "+ct[V].name)+"</div></div>"}$+="</div>",nt.innerHTML=$}function z(Y,nt,ct){var $=Math.min(100,Math.max(0,Math.round(ct)));return'<div class="card lb-card" style="flex:1 1 280px"><div class="big">'+Ft(Y)+'</div><div class="small muted">'+Ft(nt)+'</div><div class="lb-bar"><div style="width:'+$+'%"></div></div></div>'}function W(Y,nt){document.getElementById("lb_title").textContent="Classifica  "+nt;var ct=Y.ranking||[];if(j(ct),!ct.length){document.getElementById("lb_table").innerHTML='<div class="muted">Nessun dato</div>';return}for(var $='<div class="row">',V=ct[0].total||1,L=0;L<ct.length;L++){var X=ct[L];$+=z(U(L)+" "+X.name,"Totale: "+ie(X.total),X.total/V*100)}$+="</div>",document.getElementById("lb_table").innerHTML=$}function lt(Y){document.getElementById("lb_title").textContent="Classifica generale";var nt=Y.ranking||[];if(j(nt),!nt.length){document.getElementById("lb_table").innerHTML='<div class="muted">Nessun dato</div>';return}for(var ct=nt[0].score||0,$='<div class="row">',V=0;V<nt.length;V++){var L=nt[V];$+=z(U(V)+" "+L.name,"Score: "+ie(L.score)+"/100",ct?L.score/ct*100:0)}$+="</div>",document.getElementById("lb_table").innerHTML=$}A()}(function(){function b(){var D=document.getElementById("bp-overlay");return D||(D=document.createElement("div"),D.id="bp-overlay",D.className="hidden",D.setAttribute("role","dialog"),D.setAttribute("aria-modal","true"),D.innerHTML='<div class="bp-overlay-backdrop" id="bp-overlay-backdrop"></div><div class="bp-overlay-panel" id="bp-overlay-panel"></div>',document.body.appendChild(D),document.getElementById("bp-overlay-backdrop").addEventListener("click",hideOverlay)),D}window.showOverlay=function(D){var N=b(),A=document.getElementById("bp-overlay-panel");A.innerHTML=D||"",N.classList.remove("hidden");var U=A.querySelector("input, textarea, select, button");U&&setTimeout(function(){try{U.focus()}catch(j){}},0)},window.hideOverlay=function(){var D=document.getElementById("bp-overlay");D&&D.classList.add("hidden")}})();function w(){if(!Ut())return t();document.title="Battle Plan  Clienti",n.innerHTML=pe()+'<div class="wrap"><div class="card"><b>Nuovo cliente</b><div class="row" style="margin-top:8px"><div><label>Ragione sociale</label><input id="cl_name" type="text" placeholder="Es. Rossi S.r.l."></div><div><label>Stato</label><select id="cl_new_state"><option value="potenziale">Potenziale</option><option value="lead non chiuso">Lead non chiuso</option><option value="attivo">Attivo</option></select></div><div><label>Consulente</label><select id="cl_new_owner"><option value=""></option></select></div><div class="right"><button id="cl_add">Aggiungi</button></div></div></div><div class="card"><b>Filtri elenco</b><div class="row" style="margin-top:8px"><div><label>Stato</label><select id="cl_f_state"><option value="">Tutti</option><option value="attivo">Attivo</option><option value="lead non chiuso">Lead non chiuso</option><option value="potenziale">Potenziale</option></select></div><div><label>Consulente</label><select id="cl_f_cons"><option value="">Tutti</option></select></div><div><label>Ordina per</label><select id="cl_order"><option value="az">Ragione sociale (AZ)</option><option value="last_desc">Ultimo appuntamento (recenti prima)</option></select></div><div class="right"><button class="ghost" id="cl_f_apply">Applica</button></div></div></div><div class="card"><b>Elenco clienti</b><div id="cl_list" class="row" style="margin-top:8px"></div></div></div>',se();function b(){const A=(document.getElementById("cl_name").value||"").trim();if(!A){wt("Nome obbligatorio");return}const U=document.getElementById("cl_new_state"),j=document.getElementById("cl_new_owner"),z={name:A};U&&(z.status=U.value),j&&j.value&&(z.consultantId=j.value),fe("/api/clients",z).then(function(){document.getElementById("cl_name").value="",N(),ci(),window.addXP(5)}).catch(function(W){logger.error(W),wt("Errore creazione cliente")})}function D(){It("/api/usernames").then(function(A){const U=A&&A.users||[],j=document.getElementById("cl_f_cons"),z=document.getElementById("cl_new_owner");j&&(j.innerHTML='<option value="">Tutti</option>'+U.map(function(W){return'<option value="'+W.id+'">'+Ft(W.name)+(W.grade?" ("+W.grade+")":"")+"</option>"}).join("")),z&&(z.innerHTML='<option value=""></option>'+U.map(function(W){return'<option value="'+W.id+'">'+Ft(W.name)+(W.grade?" ("+W.grade+")":"")+"</option>"}).join(""))}).catch(function(A){logger.error(A)})}function N(){It("/api/clients").then(function(A){const U=A&&A.clients||[],j=document.getElementById("cl_f_state").value,z=document.getElementById("cl_f_cons").value;function W(nt){return String(nt||"").trim().toLowerCase()}const Y=U.filter(function(nt){return!(j&&W(nt.status)!==W(j)||z&&String(nt.consultantId||"")!==String(z))}).map(function(nt){const ct=Ft(nt.name||""),$=Ft(nt.status||"potenziale"),V=nt.consultantName?Ft(nt.consultantName):"unknown",L=String(nt.id||"");return'<div class="card" data-clid="'+L+'" data-name-lower="'+ct.toLowerCase()+'" data-status="'+$+'" data-consultant-id="'+Ft(String(nt.consultantId||""))+'" style="flex:1 1 380px"><div><b>'+ct+'</b></div><div class="small">Stato: <b class="cl-status">'+$+'</b></div><div class="small">Consulente: <b class="cl-cons">'+V+'</b></div><div class="small muted">Ultimo appuntamento: <span class="last-appt"></span></div><div class="right" style="margin-top:6px"><button class="ghost" data-del="'+L+'">Rimuovi</button></div></div>'}).join("");document.getElementById("cl_list").innerHTML=Y||'<div class="muted">Nessun cliente</div>',document.querySelectorAll("[data-del]").forEach(function(nt){nt.addEventListener("click",function(){const ct=nt.getAttribute("data-del");confirm("Rimuovere il cliente?")&&fetch("/api/clients?id="+encodeURIComponent(ct),{method:"DELETE",headers:{Authorization:"Bearer "+wi()}}).then(function($){if(!$.ok)throw new Error("HTTP "+$.status);return $.json()}).then(function(){wt("Cliente rimosso"),N()}).catch(function($){logger.error($),wt("Errore rimozione")})})}),window.BPFinal&&typeof BPFinal.ensureClientSection=="function"?BPFinal.ensureClientSection():setTimeout(function(){const nt=document.getElementById("cl_list"),ct=Array.from(nt.children).filter($=>$.classList.contains("card"));ct.sort(($,V)=>String($.getAttribute("data-name-lower")||"").localeCompare(String(V.getAttribute("data-name-lower")||"")));for(const $ of ct)nt.appendChild($)},0)})}document.getElementById("cl_add").onclick=b,document.getElementById("cl_f_apply").onclick=N,D(),N(),typeof kickFinal=="function"&&kickFinal("clients")}function _(){if(!Ut())return t();document.title="Battle Plan  Squadra";var b=pe()+'<div class="wrap">'+('<div class="card"><b>Vista Amministratore</b><div id="t_adminbar" class="row" style="margin-top:8px;display:flex;align-items:flex-end;gap:16px;flex-wrap:wrap"><div><label>Modalit</label><select id="t_mode" name="mode"><option value="consuntivo">Consuntivo</option><option value="previsionale">Previsionale</option></select></div><div id="t_unified_wrap">'+e("t")+'</div></div></div><div class="card"><b>Grafico</b><div class="row" style="margin-top:8px;align-items:flex-end;gap:16px;flex-wrap:wrap"><div><label>Indicatore grafico</label><select id="t_ind"><option value="VSS">VSS</option><option value="VSDPersonale">VSD Personale</option><option value="VSDIndiretto">VSD Indiretto</option><option value="VSDTotale">VSD Totale</option><option value="GI">GI</option><option value="NNCF">NNCF</option><option value="provv_gi">Provv GI</option><option value="provv_vsd">Provv VSD</option><option value="tot_provv" selected>Tot Provvigioni</option></select></div><div><label>Consulente</label><select id="t_cons"><option value="">Tutti</option></select></div></div><div style="margin-top:8px"><canvas id="t_chart" height="160"></canvas></div></div><div class="card"><b>Aggregato Squadra</b><div id="t_agg" class="row" style="margin-top:8px"></div></div><div class="card"><b>Riepilogo per utente</b><div id="t_users" class="row" style="margin-top:8px"></div></div>')+"</div>";n.innerHTML=b,se(),(function(){var M=document.getElementById("t_adminbar"),E=document.getElementById("t_unified_wrap");if(!(!M||!E)){var G=E.querySelector(".row");G&&(Array.from(G.children).forEach(function(st){st.classList.remove("right"),st.style.marginTop="0",M.appendChild(st)}),E.remove())}})();function D(H){return H=Number(H||0),isFinite(H)?H:0}function N(H){if(!H)return"";var M=new Date(H);return M.getFullYear()+"-"+("0"+(M.getMonth()+1)).slice(-2)+"-"+("0"+M.getDate()).slice(-2)}function A(H){return H=String(H||"mensile").toLowerCase(),H.indexOf("sett")===0?"settimanale":H.indexOf("mes")===0?"mensile":H.indexOf("tri")===0?"trimestrale":H.indexOf("sem")===0?"semestrale":H.indexOf("ann")===0?"annuale":"mensile"}function U(){var H=s("t"),M=N(H.start),E=N(H.end),G=A(H.type);return"&from="+encodeURIComponent(M)+"&to="+encodeURIComponent(E)+"&type="+encodeURIComponent(G)}function j(H){switch(String(H)){case"provv_gi":return"ProvvGI";case"provv_vsd":return"ProvvVSD";case"tot_provv":return"TotProvvigioni";default:return H}}function z(H){var M=Number(H)||0;return M.toLocaleString("it-IT")+""}function W(H){var M=Number(H)||0;return String(Math.round(M))}function lt(H){return String(H).replace(/[&<>'"]/g,M=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[M])}var Y=null;function nt(H,M){return M==="settimanale"?window.isoWeekNum?window.isoWeekNum(H):Math.ceil(H.getDate()/7):M==="mensile"||M==="ytd"||M==="ltm"?H.getMonth()+1:M==="trimestrale"?Math.floor(H.getMonth()/3)+1:M==="semestrale"?H.getMonth()<6?1:2:H.getFullYear()}function ct(H,M){var E=document.getElementById("t_chart");if(E){var G=X(M),st=typeof l=="function"?l(M,G):H.map(function(B){return nt(B.x,M)}),q=H.map(function(B){return B.y});if(!Le){var g=E.getContext("2d");E.width=E.clientWidth||600,E.height=E.clientHeight||160,g.clearRect(0,0,E.width,E.height);var m=Math.max(1,...q),p=q.length>1?(E.width-8)/(q.length-1):0;g.beginPath(),g.lineWidth=2,g.strokeStyle="#2e6cff",q.forEach(function(T,P){var y=4+P*p,x=E.height-6-T/m*(E.height-12);P?g.lineTo(y,x):g.moveTo(y,x)}),g.stroke(),g.fillStyle="#2e6cff",q.forEach(function(T,P){var y=4+P*p,x=E.height-6-T/m*(E.height-12);g.beginPath(),g.arc(y,x,2,0,Math.PI*2),g.fill()});return}var g=E.getContext("2d"),v=typeof window.computeTickOptions=="function"?window.computeTickOptions(st,E.width||600):{autoSkip:!0,maxRotation:0,minRotation:0};if(Y)Y.data.labels=st,Y.data.datasets[0].data=q,Y.options.scales.x.ticks=v,Y.update();else{var k=typeof Le.getChart=="function"?Le.getChart(E):null;k&&k.destroy(),Y=new Le(g,{type:"line",data:{labels:st,datasets:[{label:"",data:q,tension:.3,pointRadius:3,pointHoverRadius:5}]},options:{responsive:!1,maintainAspectRatio:!1,animation:!1,animations:!1,plugins:{legend:{display:!1}},scales:{x:{grid:{display:!1},ticks:v},y:{beginAtZero:!0}}}})}}}function $(H){return'<div class="card" style="flex:1 1 360px"><div style="display:flex;align-items:center;gap:8px"><div><b>'+lt(H.name||"User #"+H.userId)+"</b></div>"+(H.grade?'<span class="chip small">'+lt(H.grade)+"</span>":"")+'</div><div class="small" style="margin-top:6px">VSS '+z(H.vss||0)+'</div><div class="small">VSD Pers. '+z(H.vsdP||0)+'</div><div class="small">VSD Ind. '+z(H.vsdI||0)+'</div><div class="small">VSD Tot. '+z((H.vsdP||0)+(H.vsdI||0))+'</div><div class="small">GI '+z(H.gi||0)+'</div><div class="small">NNCF '+W(H.nncf||0)+'</div><div class="small muted" style="margin-top:6px">Provv GI '+z(H.provvGi||0)+'</div><div class="small muted">Provv VSD '+z(H.provvVsd||0)+'</div><div class="small"><b>Tot Provvigioni '+z(H.provvTot||0)+"</b></div></div>"}function V(H){return'<div class="card" style="flex:1 1 460px"><div class="neon" style="font-weight:900">Totali squadra</div><div class="small" style="margin-top:6px">VSS '+z(H.vss)+'</div><div class="small">VSD Pers. '+z(H.vsdP)+'</div><div class="small">VSD Ind. '+z(H.vsdI)+'</div><div class="small">VSD Tot. '+z(H.vsdP+H.vsdI)+'</div><div class="small">GI '+z(H.gi)+'</div><div class="small">NNCF '+W(H.nncf)+'</div><div class="small muted" style="margin-top:6px">Provv GI '+z(H.provvGi)+'</div><div class="small muted">Provv VSD '+z(H.provvVsd)+'</div><div class="small"><b>Tot Provvigioni '+z(H.provvTot)+"</b></div></div>"}function L(){var H=(document.getElementById("t_mode")||{}).value||"consuntivo",M=U();Promise.all([It("/api/usernames"),It("/api/leaderboard?indicator="+encodeURIComponent("VSS")+M+"&mode="+encodeURIComponent(H)),It("/api/leaderboard?indicator="+encodeURIComponent("VSDPersonale")+M+"&mode="+encodeURIComponent(H)),It("/api/leaderboard?indicator="+encodeURIComponent("VSDIndiretto")+M+"&mode="+encodeURIComponent(H)),It("/api/leaderboard?indicator="+encodeURIComponent("GI")+M+"&mode="+encodeURIComponent(H)),It("/api/leaderboard?indicator="+encodeURIComponent("NNCF")+M+"&mode="+encodeURIComponent(H)),It("/api/leaderboard?indicator="+encodeURIComponent("ProvvGI")+M+"&mode="+encodeURIComponent(H)),It("/api/leaderboard?indicator="+encodeURIComponent("ProvvVSD")+M+"&mode="+encodeURIComponent(H))]).then(function(E){var G=E[0]||{},st=E[1]&&(E[1].rows||E[1].ranking)||[],q=E[2]&&(E[2].rows||E[2].ranking)||[],m=E[3]&&(E[3].rows||E[3].ranking)||[],p=E[4]&&(E[4].rows||E[4].ranking)||[],g=E[5]&&(E[5].rows||E[5].ranking)||[],v=E[6]&&(E[6].rows||E[6].ranking)||[],k=E[7]&&(E[7].rows||E[7].ranking)||[],B=(G.users||[]).map(function(vt){return{id:String(vt.id),name:vt.name||vt.email||"User #"+vt.id,grade:vt.grade==="senior"?"senior":"junior"}}),T=document.getElementById("t_cons");T&&(T.innerHTML='<option value="">Tutti</option>'+B.map(function(vt){return'<option value="'+vt.id+'">'+lt(vt.name)+"</option>"}).join(""));function P(vt){for(var J={},ot=0;ot<vt.length;ot++){var ut=vt[ot],yt=String(ut.userId||ut.id||ut.uid||""),_t=D(ut.total||ut.value||ut.sum||0);yt&&(J[yt]=_t)}return J}var y=P(st),x=P(q),C=P(m),I=P(p),O=P(g),Q=P(v),it=P(k),dt=B.map(function(vt){var J=D(y[vt.id]),ot=D(x[vt.id]),ut=D(C[vt.id]),yt=D(I[vt.id]),_t=D(O[vt.id]),Mt=D(Q[vt.id]),Et=D(it[vt.id]);return{userId:vt.id,name:vt.name,grade:vt.grade,vss:J,vsdP:ot,vsdI:ut,gi:yt,nncf:_t,provvGi:Mt,provvVsd:Et,provvTot:Mt+Et}}),ft=document.getElementById("t_users");ft&&(ft.innerHTML=dt.length?dt.map($).join(""):'<div class="muted">Nessun dato</div>');var ht=dt.reduce(function(vt,J){return vt.vss+=J.vss,vt.vsdP+=J.vsdP,vt.vsdI+=J.vsdI,vt.gi+=J.gi,vt.nncf+=J.nncf,vt.provvGi+=J.provvGi,vt.provvVsd+=J.provvVsd,vt.provvTot+=J.provvTot,vt},{vss:0,vsdP:0,vsdI:0,gi:0,nncf:0,provvGi:0,provvVsd:0,provvTot:0}),Ct=document.getElementById("t_agg");Ct&&(Ct.innerHTML=V(ht)),K()}).catch(function(E){logger.error(E),wt("Errore caricamento squadra")})}function X(H){return(typeof r=="function"?r(H,new Date):[]).map(function(M){return{s:M.s,e:M.e}})}function Z(H,M,E,G){var st=G||s("t"),q=String(st.type||"mensile").toLowerCase(),m=q==="ytd"||q==="ltm"?"mensile":q,p=X(q);function g(B,T){var P=new Date(T.startDate).getTime(),y=new Date(T.endDate).getTime();return P>=B.s&&y<=B.e}function v(B,T){if(!B)return 0;if(T==="VSDTotale")return Number(B.VSDPersonale||0)+Number(B.VSDIndiretto||0);if(T==="ProvvGI")return Number(B.ProvvGI||0);if(T==="ProvvVSD")return Number(B.ProvvVSD||0);if(T==="TotProvvigioni"){var P=B.TotProvvigioni;return Number(P!=null?P:Number(B.ProvvGI||0)+Number(B.ProvvVSD||0))}return Number(B[T]||0)}var k=(function(){var B=p.length?N(new Date(p[0].s)):N(new Date),T=p.length?N(new Date(p[p.length-1].e)):N(new Date),P="?global=1&type="+encodeURIComponent(m)+"&from="+encodeURIComponent(B)+"&to="+encodeURIComponent(T);return E&&(P+="&userId="+encodeURIComponent(E)),P})();return It("/api/periods"+k).catch(function(){return It("/api/periods"+k.replace("?global=1",""))}).then(function(B){var T=B&&B.periods||[],P=T.filter(function(x){return!(x.type!==m||E&&String(x.userId||x.uid||"")!==String(E))}),y=p.map(function(x){for(var C=0,I=0;I<P.length;I++){var O=P[I];if(g(x,O)){var Q=M==="previsionale"?O.indicatorsPrev||{}:O.indicatorsCons||{};C+=v(Q,j(H))}}return{x:new Date(x.s),y:Math.round(C*100)/100}});return y})}function K(){var H=document.getElementById("t_ind").value,M=document.getElementById("t_mode").value||"consuntivo",E=document.getElementById("t_cons").value||"",G=s("t"),st=G.type,q=j(H);U()+(E?"&userId="+encodeURIComponent(E):"")+("&indicator="+encodeURIComponent(q))+("&mode="+encodeURIComponent(M));var m=Z(q,M,E||null,G);m.then(function(p){ct(p,st)}).catch(function(p){logger.error(p),ct([],st)})}o("t",function(){typeof haptic=="function"&&haptic("light"),L()}),document.getElementById("t_mode").onchange=function(){typeof haptic=="function"&&haptic("light"),L()},document.getElementById("t_ind").onchange=function(){typeof haptic=="function"&&haptic("light"),K()},document.getElementById("t_cons").onchange=function(){typeof haptic=="function"&&haptic("light"),K()},L()}function S(){if(!Ut())return t();var b=Ut().role==="admin";document.title="Battle Plan  Provvigioni",n.innerHTML=pe()+'<div class="wrap"><div class="card"><b>Calcolo provvigioni</b><div class="row" style="margin-top:8px; gap:12px; flex-wrap:wrap">'+(b?'<div><label>Utente</label><select id="comm_user"><option value="__all">Tutta la squadra</option></select></div>':"")+'<div><label>Modalit</label><select id="comm_mode" name="mode"><option value="consuntivo">Consuntivo</option><option value="previsionale">Previsionale</option></select></div></div>'+e("comm")+'</div><div class="card"><b>Indicatori periodo</b><div id="comm_total" style="margin-top:8px"></div></div><div class="card"><b>Provvigioni  ripartizione</b><div class="small muted">Confronto tra Provvigioni GI e Provvigioni VSD sul periodo selezionato</div><div class="row" style="margin-top:8px; align-items:center; gap:16px; flex-wrap:wrap"><canvas id="cm_pie_provv" width="260" height="260" style="max-width:260px; max-height:260px"></canvas><div id="cm_pie_legend" class="small"></div></div></div><div class="card"><b>Dettaglio</b><div id="comm_rows" class="row" style="margin-top:8px; gap:12px; flex-wrap:wrap"></div></div></div>',se();function D($){return document.getElementById($)}function N($){if(!$)return"";var V=new Date($);return V.getFullYear()+"-"+("0"+(V.getMonth()+1)).slice(-2)+"-"+("0"+V.getDate()).slice(-2)}function A($){var V=Number($)||0;return V.toLocaleString("it-IT")+""}function U($){return $=Number($==null?"":$),isFinite($)?$:0}function j($){return $?$.TotProvvigioni!=null?U($.TotProvvigioni):U($.ProvvGI)+U($.ProvvVSD):0}function z($,V){return'<div class="card"><div class="small muted">'+Ft($)+'</div><div style="font-weight:700; font-size:20px; margin-top:4px">'+V+"</div></div>"}function W($){return'<div class="table" style="overflow:auto"><table class="simple" style="width:100%; border-collapse:separate; border-spacing:12px 8px"><tbody><tr><td>'+z("VSD personale",A($.vsd||0))+"</td><td>"+z("GI",A($.gi||0))+"</td></tr><tr><td>"+z("Provv. VSD",A($.provv_vsd||0))+"</td><td>"+z("Provv. GI",A($.provv_gi||0))+"</td><td>"+z("Totale Provvigioni",A($.provv_total||0))+"</td></tr></tbody></table></div>"}function lt($){return $.length?$.map(function(V){return'<div class="card" style="flex:1 1 320px"><div><b>'+Ft(V.name)+'</b></div><div class="small" style="margin-top:4px">GI '+A(V.gi||0)+"  VSD "+A(V.vsd||0)+'</div><div class="small muted" style="margin-top:2px">Provv. GI '+A(V.provv_gi||0)+"  Provv. VSD "+A(V.provv_vsd||0)+'</div><div class="small" style="margin-top:6px"><b>Totale: '+A(V.provv_total||0)+"</b></div></div>"}).join(""):'<div class="muted">Nessun dato</div>'}function Y($,V,L){var X=document.getElementById("cm_pie_provv"),Z=document.getElementById("cm_pie_legend");if(!X||!X.getContext){Z&&(Z.innerHTML="");return}var K=X.getContext("2d"),H=X.width,M=X.height,E=H/2,G=M/2,st=Math.min(H,M)/2-8;K.clearRect(0,0,H,M);var q=Math.max(0,$||0),m=Math.max(0,V||0),p=q+m,g=L>0?Math.round(p/L*100):null;if(p<=0){K.beginPath(),K.arc(E,G,st,0,Math.PI*2),K.strokeStyle="#ccd0d5",K.lineWidth=10,K.setLineDash([6,6]),K.stroke(),K.setLineDash([]),K.globalCompositeOperation="destination-out",K.beginPath(),K.arc(E,G,st*.55,0,Math.PI*2),K.fill(),K.globalCompositeOperation="source-over",K.fillStyle="#111",K.textAlign="center",K.textBaseline="middle",K.font="bold 20px system-ui, -apple-system, Segoe UI, Roboto, sans-serif",K.fillText(g==null?"":g+"%",E,G),Z&&(Z.innerHTML='<div class="muted">Nessuna provvigione nel periodo</div>');return}var v=[{label:"Provv. GI",value:q,color:"#4F8EF7"},{label:"Provv. VSD",value:m,color:"#F79F4F"}],k=-Math.PI/2;v.forEach(function(P){var y=P.value/p*Math.PI*2;K.beginPath(),K.moveTo(E,G),K.arc(E,G,st,k,k+y),K.closePath(),K.fillStyle=P.color,K.fill(),k+=y}),K.globalCompositeOperation="destination-out",K.beginPath(),K.arc(E,G,st*.55,0,Math.PI*2),K.fill(),K.globalCompositeOperation="source-over",K.fillStyle="#111",K.textAlign="center",K.textBaseline="middle",K.font="bold 20px system-ui, -apple-system, Segoe UI, Roboto, sans-serif",K.fillText(g==null?"":g+"%",E,G);var B=Math.round(q/p*100),T=Math.round(m/p*100);Z&&(Z.innerHTML='<div class="row" style="gap:16px; flex-wrap:wrap"><div class="row" style="gap:8px; align-items:center"><span style="display:inline-block;width:12px;height:12px;background:#4F8EF7;border-radius:3px"></span><span><b>Provv. GI</b> '+A(q)+"  "+B+'%</span></div><div class="row" style="gap:8px; align-items:center"><span style="display:inline-block;width:12px;height:12px;background:#F79F4F;border-radius:3px"></span><span><b>Provv. VSD</b> '+A(m)+"  "+T+"%</span></div></div>")}function nt(){var $=s("comm"),V=D("comm_mode").value||"consuntivo",L=b?D("comm_user").value||"__all":String(Ut().id),X=new Date($.start).getTime(),Z=new Date($.end).getTime(),K=a($.type||"mensile"),H=(function(){var M=N(new Date(X)),E=N(new Date(Z)),G="?type="+encodeURIComponent(K)+"&from="+encodeURIComponent(M)+"&to="+encodeURIComponent(E);return b&&L&&L!=="__all"&&(G+="&userId="+encodeURIComponent(L)),G})();It("/api/periods"+H).then(function(M){var E=M&&M.periods||[],G=E.filter(function(m){if(m.type!==K)return!1;var p=new Date(m.startDate).getTime(),g=new Date(m.endDate).getTime();return!(p<X||g>Z||b&&L!=="__all"&&String(m.userId||m.uid||"")!==String(L)||!b&&String(m.userId||m.uid||"")!==String(Ut().id))}),st={gi:0,vsd:0,provv_gi:0,provv_vsd:0,provv_total:0},q={};G.forEach(function(m){var p=V==="previsionale"?m.indicatorsPrev||{}:m.indicatorsCons||{},g=String(m.userId||m.uid||""),v=m.userName||m.name||"User "+g,k=U(p.GI),B=U(p.VSDPersonale),T=U(p.ProvvGI),P=U(p.ProvvVSD),y=j(p);st.gi+=k,st.vsd+=B,st.provv_gi+=T,st.provv_vsd+=P,st.provv_total+=y,q[g]||(q[g]={userId:g,name:v,gi:0,vsd:0,provv_gi:0,provv_vsd:0,provv_total:0}),q[g].gi+=k,q[g].vsd+=B,q[g].provv_gi+=T,q[g].provv_vsd+=P,q[g].provv_total+=y}),D("comm_total").innerHTML=W(st),D("comm_rows").innerHTML=lt(Object.values(q).sort(function(m,p){return(p.provv_total||0)-(m.provv_total||0)})),Y(st.provv_gi||0,st.provv_vsd||0,st.gi||0)}).catch(function(M){logger.error(M),wt("Errore nel caricamento dati")})}function ct(){b&&It("/api/usernames").then(function($){var V=D("comm_user");if(V){for(var L='<option value="__all">Tutta la squadra</option>',X=$&&$.users||[],Z=0;Z<X.length;Z++){var K=X[Z];L+='<option value="'+K.id+'">'+Ft(K.name||"User "+K.id)+"</option>"}V.innerHTML=L}})}o("comm",function(){nt()}),D("comm_mode").onchange=function(){haptic("light"),nt()},b&&(D("comm_user").onchange=function(){haptic("light"),nt()}),ct(),nt()}function F(){if(!Ut())return t();document.title="Battle Plan  Vendite e Riordini",n.innerHTML=pe()+'\n    <div class="wrap">\n\n      <div class="card">\n        <b>Filtro</b>\n        <div class="row" style="margin-top:6px;align-items:flex-end;gap:16px;flex-wrap:wrap">\n          <div>\n            <label>Consulente</label>\n            <select id="vr_cons"><option value="">Tutti</option></select>\n          </div>\n        </div>\n        '.concat(e("vr"),'\n      </div>\n\n      <div class="card">\n        <b>Vendite e Riordini</b>\n        <div class="table" style="overflow:auto">\n          <table class="simple" style="min-width:980px">\n            <thead>\n              <tr>\n                <th>Data</th>\n                <th>Cliente</th>\n                <th>Consulente</th>\n              </tr>\n            </thead>\n            <tbody id="vr_rows">\n              <tr><td colspan="3" class="muted">Nessun dato</td></tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n    </div>'),se(),o("vr",()=>{})}function R(){if(!Ut())return t();document.title="Battle Plan  GI & Scadenzario",n.innerHTML=pe()+'\n  <div class="wrap">\n\n    <div class="card">\n      <b>Filtro</b>\n      <div class="row" style="margin-top:6px;align-items:flex-end;gap:16px;flex-wrap:wrap">\n        <div>\n          <label>Consulente</label>\n          <select id="gi_cons"><option value="">Tutti</option></select>\n        </div>\n      </div>\n      '.concat(e("gi"),'\n    </div>\n\n    <div class="card">\n      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">\n        <b>Vendite (GI)</b>\n        <button class="ghost" id="gi_add">Nuova vendita</button>\n      </div>\n      <div class="table" style="overflow:auto">\n        <table class="simple" style="min-width:980px">\n          <thead>\n            <tr>\n              <th>Data vendita</th>\n              <th>Cliente</th>\n              <th>Consulente</th>\n              <th>Servizi</th>\n              <th style="text-align:right">Tot. VSS</th>\n              <th>Piano pagamenti</th>\n              <th></th>\n            </tr>\n          </thead>\n          <tbody id="gi_rows"></tbody>\n        </table>\n      </div>\n    </div>\n\n  </div>'),se();const b=V=>document.getElementById(V),D=V=>String(V||"").replace(/[&<>'"]/g,L=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[L]),N=V=>(Number(V)||0).toLocaleString("it-IT")+"",A=V=>{const L=new Date(V);return L.getFullYear()+"-"+("0"+(L.getMonth()+1)).slice(-2)+"-"+("0"+L.getDate()).slice(-2)};function U(){const V=window.readUnifiedRange&&window.readUnifiedRange("gi")||{};if(!V||!V.start||!V.end){const L=new Date,X=new Date(L.getFullYear(),0,1),Z=new Date(L.getFullYear(),11,31,23,59,59);return{from:A(X),to:A(Z)}}return{from:A(V.start),to:A(V.end)}}let j=[];function z(){return It("/api/clients").then(V=>(j=V&&V.clients||[],It("/api/usernames"))).then(V=>{const L=V&&V.users||[],X=b("gi_cons");X&&(X.innerHTML='<option value="">Tutti</option>'+L.map(Z=>'<option value="'+D(String(Z.id))+'">'+D(Z.name)+"</option>").join(""))})}function W(V){const L=Array.isArray(V.schedule)?V.schedule.slice():[];if(!L.length)return'<span class="muted"></span>';const X=L.find(E=>E.kind==="deposit"||/acconto/i.test(E.note||"")),Z=L.filter(E=>E!==X),K=X?"Acconto: "+N(X.amount):"";if(!Z.length)return K||'<span class="muted"></span>';const H=Math.round(Z[0].amount||0),M=Z.every(E=>Math.abs(Math.round(E.amount||0)-H)<=1);return(K?K+" + ":"")+(M?Z.length+" rate da "+N(H):"piano personalizzato")}function lt(V){return'<tr data-id="'+D(String(V.id))+'"><td>'+new Date(V.date||V.createdAt).toLocaleDateString("it-IT")+"</td><td>"+D(V.clientName||"")+"</td><td>"+D(V.consultantName||"")+"</td><td>"+D(V.services||"")+'</td><td style="text-align:right"><b>'+N(V.vssTotal||0)+"</b></td><td>"+W(V)+'</td><td class="right"><button class="ghost" data-edit="'+D(String(V.id))+'">Modifica</button></td></tr>'}function Y(){const V=U(),L=(b("gi_cons")||{}).value||"",X="?from="+encodeURIComponent(V.from)+"&to="+encodeURIComponent(V.to)+(L?"&userId="+encodeURIComponent(L):"");It("/api/gi"+X).then(Z=>{let K=Z&&Z.sales||[];K.sort((H,M)=>+new Date(M.date||M.createdAt||0)-+new Date(H.date||H.createdAt||0)),b("gi_rows").innerHTML=K.length?K.map(lt).join(""):'<tr><td colspan="7" class="muted">Nessuna vendita</td></tr>',ct()}).catch(Z=>{logger.error(Z),wt("Errore caricamento GI")})}function nt(V){const L=V.sale||{},X=Array.isArray(L.schedule)?L.schedule.slice():[],Z=X.find(C=>C.kind==="deposit"||/acconto/i.test(C.note||"")),K=X.filter(C=>C!==Z),H=K.length>0?K.every(C=>Math.abs((+C.amount||0)-(+K[0].amount||0))<=1):!0,M=K.length&&H?"rate":"manual",E=A(new Date),G='<div class="modal"><div class="card gi-modal"><style>.gi-modal{min-width:min(760px,96vw);max-width:980px;max-height:86vh;overflow:auto}@media (max-width:740px){ .gi-grid{display:block} .gi-col{width:100%} .gi-modal{min-width:96vw} }.gi-grid{display:flex; gap:12px; flex-wrap:wrap} .gi-col{flex:1; min-width:240px}.gi-col input, .gi-col select, .gi-col textarea{width:100%; min-width:0}.gi-section{border-top:1px solid var(--hair, rgba(0,0,0,.12)); padding-top:10px; margin-top:10px}.pilltabs{display:flex; gap:12px; align-items:center} .pilltabs label{display:flex; align-items:center; gap:6px; cursor:pointer; padding:6px 10px; border:1px solid var(--hair, rgba(0,0,0,.15)); border-radius:999px}.mrow{display:flex; gap:8px; align-items:center; flex-wrap:wrap}.mrow label{min-width:96px}.mrow input[type=date], .mrow select{min-width:160px; max-width:100%}.mrow input[type=text]{flex:1; min-width:220px; max-width:100%}.mini input[type=number]{width:120px}.gi-rlist{margin-top:6px; max-height:200px; overflow:auto; border:1px dashed rgba(0,0,0,.15); border-radius:8px; padding:6px}.gi-r{display:flex; gap:6px; align-items:center; padding:4px 0}.gi-r input[type=date]{min-width:160px} .gi-r input[type=number]{width:120px} .gi-r input[type=text]{flex:1; min-width:220px; max-width:100%}.gi-foot{display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:12px}</style><div style="display:flex;justify-content:space-between;align-items:center"><b>'+(V.title||(L.id?"Modifica vendita":"Nuova vendita"))+'</b><button class="ghost" id="m_close">Chiudi</button></div><div class="gi-grid"><div class="gi-col"><label>Data</label><input id="m_date" type="date" value="'+D(A(L.date||E))+'"></div><div class="gi-col"><label>Cliente</label><select id="gi_client_select"><option value="">Caricamento</option></select></div><div class="gi-col"><label>Totale VSS</label><input id="m_vss" type="number" step="1" value="'+D(Number(L.vssTotal||0))+'"></div></div><div class="gi-section"><label>Servizi</label><textarea id="m_srv" rows="2">'+D(L.services||"")+'</textarea></div><div class="gi-section"><b>Acconto</b><div class="mrow mini" style="margin-top:6px"><label><input id="acc_enable" type="checkbox" '+(Z?"checked":"")+'> Abilita</label><label>Tipo</label><select id="acc_type"><option value="abs">Valore assoluto</option><option value="perc">Percentuale</option></select><label>Valore</label><input id="acc_value" type="number" step="1" value="'+(Z?D(Number(Z._fromPerc?Z._rawPerc:Z.amount)):"0")+'"><label>Scadenza</label><input id="acc_date" type="date" value="'+D(A(Z?Z.dueDate:L.date||E))+'"><label>Nota</label><input id="acc_note" placeholder="es. Acconto" value="'+D(Z&&Z.note||"Acconto")+'"></div></div><div class="gi-section"><b>Modalit pagamenti</b><div class="pilltabs" style="margin:6px 0 8px"><label><input type="radio" name="pmode" value="rate" '+(M==="rate"?"checked":"")+'> Rateale</label><label><input type="radio" name="pmode" value="manual" '+(M!=="rate"?"checked":"")+'> Scaglioni manuali</label></div><div id="p_rate" style="display:'+(M==="rate"?"block":"none")+'"><div class="mrow mini"><label>N rate</label><input id="rt_n" type="number" value="'+D(K.length||12)+'"><label>Frequenza</label><select id="rt_freq"><option value="M">Mensile</option><option value="Q">Trimestrale</option><option value="W">Settimanale</option><option value="Y">Annuale</option></select><label>Prima scadenza</label><input id="rt_first" type="date" value="'+D(K[0]?A(K[0].dueDate):A(L.date||E))+'"><button class="ghost" id="rt_build">Ricalcola rate</button></div><div id="rt_preview" class="gi-rlist muted small"></div></div><div id="p_manual" style="display:'+(M!=="rate"?"block":"none")+'"><div class="mrow mini"><button class="ghost" id="mn_add">Aggiungi scaglione</button></div><div id="mn_list" class="gi-rlist"></div></div></div><div class="gi-foot"><div><div id="tot_prog" class="small muted">Programmato: 0</div><div id="tot_chk"  class="small muted">Totale VSS: 0</div></div><div style="display:flex;gap:8px">'+(L.id?'<button class="ghost danger" id="m_del">Elimina</button>':"")+'<button id="m_save">Salva</button></div></div></div></div>';showOverlay(G);const st=document.documentElement.style.overflow;document.documentElement.style.overflow="hidden";function q(){document.documentElement.style.overflow=st,hideOverlay()}(function(){const I=b("gi_client_select");I.innerHTML='<option value=""> seleziona cliente </option>'+j.map(Q=>'<option value="'+D(Q.id)+'">'+D(Q.name)+"</option>").join("");const O=L.clientId||L.client_id||"";if(O&&(I.value=String(O)),!I.value&&L.clientName){const Q=j.find(it=>String(it.name).trim().toLowerCase()===String(L.clientName).trim().toLowerCase());Q&&(I.value=String(Q.id))}})(),Z&&Z._fromPerc&&(b("acc_type").value="perc"),Array.from(document.querySelectorAll('input[name="pmode"]')).forEach(C=>{C.addEventListener("change",()=>{const I=document.querySelector('input[name="pmode"]:checked').value==="rate";b("p_rate").style.display=I?"block":"none",b("p_manual").style.display=I?"none":"block",x()})});function m(C,I){const O=new Date(C);return O.setMonth(O.getMonth()+I),O}function p(C,I){const O=new Date(C);return O.setDate(O.getDate()+I*7),O}function g(C,I){const O=new Date(C);return O.setMonth(O.getMonth()+I*3),O}function v(C,I){const O=new Date(C);return O.setFullYear(O.getFullYear()+I),O}function k(){const C=Math.max(1,Number(b("rt_n").value||0)),I=b("rt_freq").value,O=new Date(b("rt_first").value||E),Q=Math.max(0,Number(b("m_vss").value||0)),it=P(),dt=Math.max(0,Q-it),ft=Math.round(dt/C),ht=[];for(let Ct=0;Ct<C;Ct++){let vt;I==="M"?vt=m(O,Ct):I==="Q"?vt=g(O,Ct):I==="W"?vt=p(O,Ct):vt=v(O,Ct),ht.push({dueDate:vt.toISOString(),amount:ft,note:"Rata "+(Ct+1)+"/"+C,kind:"installment"})}return B(ht),ht}function B(C){b("rt_preview").innerHTML=C.map(I=>"<div>"+new Date(I.dueDate).toLocaleDateString("it-IT")+"  "+N(I.amount)+' <span class="muted">'+D(I.note||"")+"</span></div>").join(""),b("rt_preview")._data=C,x()}function T(C){const I=b("mn_list");I.innerHTML="",C.forEach((O,Q)=>{const it=document.createElement("div");it.className="gi-r",it.innerHTML='<input type="date" data-k="dueDate" value="'+D(A(O.dueDate))+'"><input type="number" step="1" data-k="amount" value="'+D(Number(O.amount||0))+'" style="width:120px"><input type="text" data-k="note"   value="'+D(O.note||"")+'" placeholder="nota" style="flex:1"><button class="ghost" data-del="'+Q+'"></button>',I.appendChild(it)}),I.querySelectorAll("[data-del]").forEach(O=>{O.onclick=()=>{const Q=Number(O.getAttribute("data-del")),it=I._data||[];it.splice(Q,1),T(it)}}),I.oninput=()=>{const O=I._data||[];Array.from(I.children).forEach((it,dt)=>{const ft=O[dt];if(!ft)return;const ht=it.querySelector('[data-k="dueDate"]').value,Ct=Number(it.querySelector('[data-k="amount"]').value||0),vt=it.querySelector('[data-k="note"]').value;ft.dueDate=new Date(ht).toISOString(),ft.amount=Math.round(Ct),ft.note=vt}),x()},I._data=C,x()}if(b("m_date").value=D(A(L.date||E)),b("m_vss").value=D(Number(L.vssTotal||0)),b("m_srv").value=D(L.services||""),b("acc_type").value=Z&&Z._fromPerc?"perc":"abs",b("acc_value").value=Z?Z._fromPerc?Z._rawPerc:Z.amount:0,b("acc_date").value=D(A(Z?Z.dueDate:L.date||E)),b("acc_note").value=Z?D(Z.note||"Acconto"):"Acconto",M==="rate"){const C=K.length||12;b("rt_n").value=C,b("rt_first").value=K[0]?D(A(K[0].dueDate)):D(A(L.date||E)),B(K.length?K:k())}else T(K);b("rt_build").onclick=()=>B(k()),b("mn_add").onclick=()=>{const I=b("mn_list")._data||[];I.push({dueDate:new Date().toISOString(),amount:0,note:"",kind:"manual"}),T(I)},b("m_close").onclick=q;function P(){if(!b("acc_enable").checked)return 0;const C=Math.max(0,Number(b("m_vss").value||0)),I=b("acc_type").value,O=Number(b("acc_value").value||0);return Math.round(I==="perc"?C*(O/100):O)}function y(){const C=[];if(b("acc_enable").checked){const O=P();C.push({dueDate:new Date(b("acc_date").value||E).toISOString(),amount:O,note:b("acc_note").value||"Acconto",kind:"deposit",_fromPerc:b("acc_type").value==="perc",_rawPerc:Number(b("acc_value").value||0)})}if(document.querySelector('input[name="pmode"]:checked').value==="rate"){const O=(b("rt_preview")._data||[]).map(Q=>Object.assign({},Q));return C.concat(O)}else{const O=(b("mn_list")._data||[]).map(Q=>Object.assign({kind:"manual"},Q));return C.concat(O)}}function x(){const C=Math.max(0,Number(b("m_vss").value||0)),I=y(),O=Math.round(I.reduce((Q,it)=>Q+Number(it.amount||0),0));b("tot_prog").textContent="Programmato: "+N(O),b("tot_chk").textContent="Totale VSS: "+N(C)+(O===C?" OK":" (manca "+N(C-O)+")"),b("m_save").disabled=O!==C||!b("gi_client_select").value}if(["m_vss","acc_enable","acc_type","acc_value","acc_date","rt_n","rt_freq","rt_first"].forEach(C=>{const I=b(C);I&&I.addEventListener("input",x)}),b("gi_client_select").addEventListener("change",x),x(),b("m_save").onclick=()=>{const C=b("gi_client_select").value||"",I=j.find(Q=>String(Q.id)===String(C));if(!I){wt("Seleziona un cliente");return}const O={id:L.id||void 0,date:new Date(b("m_date").value||E).toISOString(),clientId:I.id,clientName:I.name,vssTotal:Math.round(Number(b("m_vss").value||0)),services:b("m_srv").value||"",schedule:y()};Promise.resolve(fe("/api/gi",O)).then(()=>{q(),haptic("light"),Y()}).catch(Q=>{logger.error(Q),wt("Errore salvataggio")})},L.id){const C=b("m_del");C&&(C.onclick=async()=>{if(!confirm("Eliminare definitivamente questa vendita?"))return;const I=L?JSON.parse(JSON.stringify(L)):null;try{if(await Bf("/api/gi?id="+encodeURIComponent(L.id)).catch(()=>fe("/api/gi/delete",{id:L.id})),q(),wt("Vendita eliminata"),Y(),typeof showUndo=="function"&&I){const O={date:new Date(I.date||I.createdAt||new Date).toISOString(),clientId:I.clientId,clientName:I.clientName,vssTotal:Math.round(Number(I.vssTotal||0)),services:I.services||"",schedule:Array.isArray(I.schedule)?I.schedule:[]};showUndo("Vendita eliminata",function(){return fe("/api/gi",O).then(function(){Y()})},5e3)}}catch(O){logger.error(O),wt("Errore eliminazione")}})}}function ct(){document.querySelectorAll("[data-edit]").forEach(V=>{V.addEventListener("click",()=>{const L=V.getAttribute("data-edit");$(L)})})}document.addEventListener("gi:edit",function(V){const L=V&&V.detail&&V.detail.id;L&&$(L)}),b("gi_add").onclick=()=>{nt({title:"Nuova vendita"})};function $(V){It("/api/gi?from=1900-01-01&to=2999-12-31").then(L=>{const X=(L&&L.sales||[]).find(Z=>String(Z.id)===String(V));if(!X){wt("Vendita non trovata");return}nt({title:"Modifica vendita",sale:X})})}o("gi",()=>{haptic("light"),Y()}),(b("gi_cons")||{}).onchange=()=>{haptic("light"),Y()},z().then(Y)}window.viewGI=window.viewGI||R;function tt(){if(!Ut())return t();document.title="Battle Plan  Report",n.innerHTML=pe()+'<div class="wrap"><div class="card"><b>Sezioni da includere</b><div id="rep_toggles" class="row" style="margin-top:8px; gap:8px; flex-wrap:wrap"><button class="pill" data-type="mensile" id="tog_mese">Mese</button><button class="pill" data-type="trimestrale" id="tog_trimestre">Trimestre</button><button class="pill" data-type="semestrale" id="tog_semestre">Semestre</button><button class="pill" data-type="annuale" id="tog_anno">Anno</button></div></div><div class="card"><b>Indicatori aggiuntivi</b><div id="rep_indicators" class="row" style="margin-top:8px; gap:8px; flex-wrap:wrap"><button class="pill" data-key="Telefonate" id="ind_Telefonate">Telefonate</button><button class="pill" data-key="AppFissati" id="ind_AppFissati">AppFissati</button><button class="pill" data-key="AppFatti" id="ind_AppFatti">AppFatti</button><button class="pill" data-key="CorsiLeadership" id="ind_CorsiLeadership">CorsiLeadership</button><button class="pill" data-key="iProfile" id="ind_iProfile">iProfile</button><button class="pill" data-key="MBS" id="ind_MBS">MBS</button><button class="pill" data-key="Note" id="ind_Note">Note</button></div></div><div class="card"><b>Report</b><div class="row" style="margin-top:8px"><div style="min-width:320px"><label>Oggetto email</label><input id="report_subject" placeholder="Report BP"></div></div><div class="row" style="margin-top:8px; flex-wrap:wrap"><div style="flex:1 1 100%; min-width:0"><label>Corpo email</label><textarea id="report_body" rows="12" placeholder="Testo del report" style="width:100%; box-sizing:border-box; overflow:auto; resize:vertical; max-height:70vh; white-space:pre-wrap; word-break:break-word"></textarea></div></div><div class="row" id="report-actions" style="gap:8px;margin-top:8px;flex-wrap:wrap"><button class="ghost" id="rep_copy">Copia report</button><span style="flex:0 0 8px"></span><button class="ghost" id="rep_gmail_web">Gmail Web</button><button class="ghost" id="rep_gmail_app">Gmail App</button></div></div></div>',se();var b=[],D={mensile:!1,trimestrale:!1,semestrale:!1,annuale:!1},N={Telefonate:!0,AppFissati:!0,AppFatti:!0,CorsiLeadership:!0,iProfile:!0,MBS:!0,Note:!0},A=[{k:"VSS",money:!0,label:"VSS"},{k:"VSDPersonale",money:!0,label:"VSDPersonale"},{k:"VSDIndiretto",money:!0,label:"VSDIndiretto"},{k:"GI",money:!0,label:"GI"},{k:"Telefonate",money:!1,label:"Telefonate"},{k:"AppFissati",money:!1,label:"AppFissati"},{k:"AppFatti",money:!1,label:"AppFatti"},{k:"CorsiLeadership",money:!1,label:"CorsiLeadership"},{k:"iProfile",money:!1,label:"iProfile"},{k:"MBS",money:!1,label:"MBS"},{k:"NNCF",money:!1,label:"NNCF"}];function U(J){return N[J]!==!1}function j(J){return document.getElementById(J)}var z=j("report_body");function W(J,ot){var ut=new Date(J.getTime());return ut.setDate(ut.getDate()+ot),ut}function lt(J){return en(J.getFullYear(),te(J))}function Y(J){var ot=lt(J);return lt(W(ot.start,7))}function nt(J){var ot=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];return ot[J.getMonth()]}function ct(J){return Math.floor(J.getMonth()/3)+1}function $(J){return J.getMonth()<6?1:2}function V(J){var ot=J.getDay();return ot===5||ot===6||ot===0}function L(J,ot){return J==="mensile"?{start:io(ot),end:oo(ot)}:J==="trimestrale"?{start:Ti(ot),end:so(ot)}:J==="semestrale"?{start:Pi(ot),end:ao(ot)}:{start:Do(ot),end:_i(ot)}}function X(J,ot){return ot>=W(J,-7)&&ot<=W(J,5)}function Z(J,ot){var ut=L(J,ot),yt=L(J,W(ut.start,-1)),_t=L(J,W(ut.end,1)),Mt=X(yt.end,ot),Et=X(ut.end,ot);return Mt&&!Et?{closing:yt,next:ut}:{closing:ut,next:_t}}function K(J,ot,ut){for(var yt=0;yt<b.length;yt++){var _t=b[yt];if(_t.type===J&&oe(_t.startDate)===oe(ot)&&oe(_t.endDate)===oe(ut))return _t}return null}function H(J,ot){var ut=J&&J[ot];return Number(ut||0)}function M(J){return ie(J)+""}function E(J,ot){var ut=A.some(function(yt){return yt.k===J&&yt.money});return ut?M(ot):ie(ot)}function G(J,ot){return J>ot?"":J<ot?"":"="}function st(J,ot,ut,yt){var _t=K(ot,ut,yt)||{},Mt=_t.indicatorsPrev||{},Et=_t.indicatorsCons||{},Rt=[J,""];return A.forEach(function(et){if(U(et.k)){var at=H(Mt,et.k),gt=H(Et,et.k);Rt.push(et.label+" "+E(et.k,gt)+" vs "+E(et.k,at)+" di previsionali ("+G(gt,at)+")")}}),N.Note&&Rt.push("Note:"),Rt.join("\n")}function q(J,ot,ut,yt){var _t=K(ot,ut,yt)||{},Mt=_t.indicatorsPrev||{},Et=[J,""];return A.forEach(function(Rt){U(Rt.k)&&Et.push(Rt.label+" "+E(Rt.k,H(Mt,Rt.k)))}),N.Note&&Et.push("Possibili note:"),Et.join("\n")}function m(J){return"BP CONSUNTIVO SETT. "+te(J)+" "+J.getFullYear()}function p(J){return"BP PREVISIONALE SETT. "+te(J)+" "+J.getFullYear()}function g(J){return"BP CONSUNTIVO "+nt(J)+" "+J.getFullYear()}function v(J){var ot=nt(J);return"BP PREVISIONALE "+ot+" "+J.getFullYear()}function k(J){return"BP CONSUNTIVO T"+ct(J)+" "+J.getFullYear()}function B(J){return"BP PREVISIONALE T"+ct(J)+" "+J.getFullYear()}function T(J){return"BP CONSUNTIVO S"+$(J)+" "+J.getFullYear()}function P(J){return"BP PREVISIONALE S"+$(J)+" "+J.getFullYear()}function y(J){return"BP CONSUNTIVO "+J.getFullYear()}function x(J){return"BP PREVISIONALE "+J.getFullYear()}function C(){var J=new Date,ot=[];if(V(J)){var ut=lt(J),yt=Y(J);ot.push(st(m(ut.start),"settimanale",ut.start,ut.end)),ot.push(q(p(yt.start),"settimanale",yt.start,yt.end))}function _t(Mt,Et,Rt){var et=Z(Mt,J);ot.push(st(Et(et.closing.start),Mt,et.closing.start,et.closing.end)),ot.push(q(Rt(et.next.start),Mt,et.next.start,et.next.end))}D.mensile&&_t("mensile",g,v),D.trimestrale&&_t("trimestrale",k,B),D.semestrale&&_t("semestrale",T,P),D.annuale&&_t("annuale",y,x),z.value=ot.join("\n\n")+(ot.length?"\n":"")}function I(J,ot){J.classList.toggle("active",!!ot),J.style.opacity=ot?"1":"0.65"}function O(){I(j("tog_mese"),D.mensile),I(j("tog_trimestre"),D.trimestrale),I(j("tog_semestre"),D.semestrale),I(j("tog_anno"),D.annuale)}function Q(){Object.keys(N).forEach(function(J){var ot=j("ind_"+J);ot&&I(ot,N[J])})}function it(){var J=new Date;function ot(ut){var yt=L(ut,J),_t=L(ut,W(yt.start,-1));return X(yt.end,J)||X(_t.end,J)}D.mensile=ot("mensile"),D.trimestrale=ot("trimestrale"),D.semestrale=ot("semestrale"),D.annuale=ot("annuale"),O()}function dt(){function J(ot){var ut=ot.currentTarget.getAttribute("data-type");D[ut]=!D[ut],O(),C()}j("tog_mese").onclick=J,j("tog_trimestre").onclick=J,j("tog_semestre").onclick=J,j("tog_anno").onclick=J}function ft(){function J(ot){var ut=ot.currentTarget.getAttribute("data-key");N[ut]=!N[ut],Q(),C()}Object.keys(N).forEach(function(ot){var ut=j("ind_"+ot);ut&&(ut.onclick=J)})}function ht(J){return encodeURIComponent(String(J||""))}function Ct(){var J=j("rep_gmail_web"),ot=j("rep_gmail_app"),ut=j("rep_copy");ut&&(ut.onclick=function(){try{navigator.clipboard.writeText(z.value||"");var yt=ut.textContent;ut.textContent="Copiato!",setTimeout(function(){ut.textContent=yt},1200)}catch(_t){}}),!(!J||!ot)&&It("/api/users_emails").then(function(yt){var _t=(yt&&yt.emails||(yt&&yt.users||[]).map(function(Rt){return Rt.email})).filter(Boolean).join(",");function Mt(){return j("report_subject").value||"Report BP"}function Et(){return z.value||""}J.onclick=function(){try{navigator.clipboard.writeText(Et())}catch(et){}var Rt="https://mail.google.com/mail/?view=cm&fs=1&tf=1&su="+ht(Mt())+"&cc="+ht(_t)+"&body="+ht(Et());window.open(Rt,"_blank"),document.dispatchEvent(new Event("report:composed"))},ot.onclick=function(){try{navigator.clipboard.writeText(Et())}catch(et){}var Rt="googlegmail:///co?subject="+ht(Mt())+"&cc="+ht(_t)+"&body="+ht(Et());location.href=Rt,document.dispatchEvent(new Event("report:composed")),setTimeout(function(){document.hidden||(location.href="mailto:?subject="+ht(Mt())+"&cc="+ht(_t)+"&body="+ht(Et()),document.dispatchEvent(new Event("report:composed")))},1200)}})}function vt(){It("/api/periods").then(function(J){b=J&&J.periods||[],it(),Q(),ft(),dt(),C(),Ct()})}vt()}function rt(){var b=Ut();if(!b)return t();if(document.title="Battle Plan  Utenti",b.role!=="admin"){n.innerHTML=pe()+'<div class="wrap"><div class="card"><b>Il mio profilo</b><div class="row" style="margin-top:8px"><div><label>Nome</label><input id="p_name" type="text" value="'+Ft(b.name||"")+'"></div><div><label>Email</label><input id="p_email" type="email" value="'+Ft(b.email||"")+'"></div></div><div class="row"><div><label>Nuova password</label><input id="p_pwd" type="password" placeholder="Lascia vuoto per non cambiare"></div><div class="right" style="align-self:flex-end"><button id="p_save">Aggiorna</button></div></div><div class="row"><div><label>Ruolo</label><input value="'+Ft(b.role||"consultant")+'" disabled></div><div><label>Grade</label><input value="'+Ft(b.grade||"junior")+'" disabled></div></div></div></div>',se(),we("#p_save").onclick=function(){var A=we("#p_name").value.trim(),U=we("#p_email").value.trim(),j=we("#p_pwd").value,z={id:b.id,name:A,email:U};j&&(z.password=j),fe("/api/users",z).then(function(){wt("Profilo aggiornato"),window.addXP(3);var W=Ut();W&&(W.name=A,W.email=U,localStorage.setItem("user",JSON.stringify(W)));try{document.dispatchEvent(new Event("user:profile-updated"))}catch(lt){}}).catch(function(W){logger.error(W),wt("Errore aggiornamento")})};return}n.innerHTML=pe()+'<div class="wrap"><div class="card"><b>Gestione utenti</b><div id="users_list" class="row" style="margin-top:8px"></div></div></div>',se();function D(A){var U=Ft(A.name||A.email||"user_"+A.id),j=A.grade==="senior"?"senior":"junior",z=A.role==="admin"?"admin":"consultant";return'<div class="card" style="flex:1 1 380px"><div><b>'+U+'</b> <span class="small muted">('+Ft(z)+')</span></div><div class="row" style="margin-top:6px"><div><label>Nome</label><input data-nfor="'+A.id+'" type="text" value="'+Ft(A.name||"")+'"></div><div><label>Email</label><input data-efor="'+A.id+'" type="email" value="'+Ft(A.email||"")+'"></div></div><div class="row"><div><label>Nuova password</label><input data-pfor="'+A.id+'" type="password" placeholder="(opzionale)"></div><div><label>Grade</label><select data-gfor="'+A.id+'"><option value="junior"'+(j==="junior"?" selected":"")+'>Junior</option><option value="senior"'+(j==="senior"?" selected":"")+'>Senior</option></select></div><div><label>Ruolo</label><select data-rfor="'+A.id+'"><option value="consultant"'+(z==="consultant"?" selected":"")+'>Consulente</option><option value="admin"'+(z==="admin"?" selected":"")+'>Admin</option></select></div><div class="right" style="align-self:flex-end"><button class="ghost" data-save="'+A.id+'">Aggiorna</button> <button class="danger" data-del="'+A.id+'" title="Elimina utente">Elimina</button></div></div></div>'}function N(){It("/api/users").then(function(A){var U=A&&A.users||[],j=we("#users_list");j&&(j.innerHTML=U.map(D).join(""),ro("[data-save]").forEach(function(z){z.addEventListener("click",function(){var W=z.getAttribute("data-save"),lt=(we('input[data-nfor="'+W+'"]')||{}).value||"",Y=(we('input[data-efor="'+W+'"]')||{}).value||"",nt=(we('select[data-gfor="'+W+'"]')||{}).value||"junior",ct=(we('select[data-rfor="'+W+'"]')||{}).value||"consultant",$=we('input[data-pfor="'+W+'"]'),V=$?$.value:"",L={id:W,name:lt,email:Y,grade:nt,role:ct};V&&(L.password=V),fe("/api/users",L).then(function(){wt("Aggiornato"),window.addXP(5),$&&($.value="")}).catch(function(X){logger.error(X),wt("Errore aggiornamento")})})}),ro("[data-del]").forEach(function(z){z.addEventListener("click",function(){var W=z.getAttribute("data-del");if(confirm("Eliminare definitivamente questo utente?")){var lt=(Array.isArray(U)?U:[]).find(function(Y){return String(Y.id)===String(W)});fetch("/api/users?id="+encodeURIComponent(W),{method:"DELETE",headers:{Authorization:"Bearer "+wi()}}).then(function(Y){if(!Y.ok)throw new Error("HTTP "+Y.status);return Y.json()}).then(function(){if(wt("Utente eliminato"),N(),typeof showUndo=="function"&&lt){var Y={id:lt.id,name:lt.name,email:lt.email,grade:lt.grade,role:lt.role};showUndo("Utente eliminato",function(){return fe("/api/users",Y).then(function(){N()})},5e3)}}).catch(function(Y){logger.error(Y),wt("Errore eliminazione")})}})}))})}N()}window.viewHome=c,window.viewCalendar=d,window.viewPeriods=u,window.viewAppointments=f,window.viewLeaderboard=h,window.viewClients=w,window.viewTeam=_,window.viewCommissions=S,window.viewVendite=F,window.viewReport=tt,window.viewUsers=rt,window.toggleDrawer=Ai,window.logout=Ef,window.rerenderTopbarSoon=Yf,document.addEventListener("DOMContentLoaded",function(){Ut()?(se(),c()):t()})})();export{qf as __vite_legacy_guard};
